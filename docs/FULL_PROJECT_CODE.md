# WEB4TG - ПОЛНЫЙ КОД ПРОЕКТА

Весь исходный код главного приложения и 13 демо-приложений.

---

## ЧАСТЬ 1: ГЛАВНОЕ ПРИЛОЖЕНИЕ

### App.tsx (Точка входа)
```tsx
import { useState, useEffect, Suspense, lazy, useCallback } from "react";
import { QueryClientProvider } from "@tanstack/react-query";
import { queryClient } from "./lib/queryClient";
import { Toaster } from "@/components/ui/toaster";
import { useTelegram } from "./hooks/useTelegram";
import { Home, ShoppingCart, Briefcase, Bot } from "lucide-react";
import { trackDemoView } from "./hooks/useGamification";
import UserAvatar from "./components/UserAvatar";

// Eager load providers to prevent blank screen (Suspense fallback={null} + #root:empty CSS loop)
import { RewardsProvider } from "./contexts/RewardsContext";
import { XPNotificationProvider } from "./contexts/XPNotificationContext";
import { LazyMotionProvider } from "./utils/LazyMotionProvider";

// Lazy load ALL pages including ShowcasePage for optimal bundle splitting
const ShowcasePage = lazy(() => import("./components/ShowcasePage"));
const ProjectsPage = lazy(() => import("./components/ProjectsPage"));
const AboutPage = lazy(() => import("./components/AboutPage"));
const DemoAppLanding = lazy(() => import("./components/DemoAppLanding"));
const ConstructorPage = lazy(() => import("./components/ConstructorPage"));
const ProfilePage = lazy(() => import("./components/ProfilePage"));
const CheckoutPage = lazy(() => import("./components/CheckoutPage"));
const DemoAppShell = lazy(() => import("./components/DemoAppShell"));
const HelpPage = lazy(() => import("./components/HelpPage"));
const ReviewPage = lazy(() => import("./components/ReviewPage"));
const AIAgentPage = lazy(() => import("./components/AIAgentPage"));
const AIProcessPage = lazy(() => import("./components/AIProcessPage"));
const PhotoGallery = lazy(() => import("./pages/PhotoGallery"));
const ReferralProgram = lazy(() => import("./components/ReferralProgram").then(m => ({ default: m.ReferralProgram })));
const GamificationHub = lazy(() => import("./components/GamificationHub").then(m => ({ default: m.GamificationHub })));
const PremiumTasksEarningPage = lazy(() => import("./components/PremiumTasksEarningPage").then(m => ({ default: m.PremiumTasksEarningPage })));

// Global components
import GlobalSidebar from "./components/GlobalSidebar";

// Simple hash router types
interface Route {
  path: string;
  component: string;
  params?: Record<string, string>;
}

// Router utilities
const parseHash = (): Route => {
  const hash = window.location.hash.slice(1) || '/';
  const [path, ...rest] = hash.split('?');
  
  // Parse demo routes
  const demoMatch = path.match(/^\/demos\/([^\/]+)(?:\/app)?$/);
  if (demoMatch) {
    const demoId = demoMatch[1];
    const isApp = path.includes('/app');
    return {
      path: isApp ? '/demos/:id/app' : '/demos/:id',
      component: isApp ? 'demoApp' : 'demoLanding',
      params: { id: demoId }
    };
  }
  
  // Regular routes
  const routeMap: Record<string, string> = {
    '/': 'showcase',
    '/projects': 'projects',
    '/about': 'about',
    '/constructor': 'constructor',
    '/profile': 'profile',
    '/help': 'help',
    '/review': 'review',
    '/checkout': 'checkout',
    '/ai-agent': 'aiAgent',
    '/ai-process': 'aiProcess',
    '/photo-gallery': 'photoGallery',
    '/referral': 'referral',
    '/rewards': 'rewards',
    '/earning': 'earning'
  };
  
  // Always default to showcase page if route not found
  return {
    path,
    component: routeMap[path] || 'showcase',
    params: {}
  };
};

const navigate = (path: string) => {
  window.location.hash = path;
};

const goBack = () => {
  window.history.back();
};

function App() {
  const [route, setRoute] = useState<Route>({ path: '/', component: 'showcase', params: {} });
  const [orderData, setOrderData] = useState<any>(null);
  const { hapticFeedback, user } = useTelegram();
  
  // Initialize route after mount to ensure showcase is default
  useEffect(() => {
    setRoute(parseHash());
  }, []);

  // Listen for hash changes
  useEffect(() => {
    const handleHashChange = () => {
      setRoute(parseHash());
    };
    
    window.addEventListener('hashchange', handleHashChange);
    
    return () => window.removeEventListener('hashchange', handleHashChange);
  }, []);

  // Optimized scroll to top - single reliable mechanism
  useEffect(() => {
    // Single scroll after content renders
    requestAnimationFrame(() => {
      window.scrollTo({ top: 0, behavior: 'instant' });
    });
  }, [route.component, route.params?.id]);

  // Telegram BackButton - показываем на всех страницах кроме главной
  useEffect(() => {
    const tg = window.Telegram?.WebApp;
    if (!tg?.BackButton) return;

    // Определяем, нужно ли показывать кнопку "Назад"
    const isMainPage = route.component === 'showcase';
    
    if (!isMainPage) {
      tg.BackButton.show();
    } else {
      tg.BackButton.hide();
    }

    // Обработчик клика на BackButton
    const handleBackButton = () => {
      hapticFeedback.light();
      
      // Специальная логика для разных страниц
      if (route.component === 'checkout') {
        // Из чекаута возвращаемся в конструктор
        setOrderData(null);
        navigate('/constructor');
      } else if (route.component === 'demoApp' || route.component === 'demoLanding') {
        // Из демо возвращаемся на главную
        navigate('/');
      } else if (route.component === 'help' || route.component === 'review') {
        // Из справки/отзывов возвращаемся в профиль
        navigate('/profile');
      } else {
        // Для остальных страниц - на главную
        navigate('/');
      }
    };

    tg.BackButton.onClick(handleBackButton);

    // Cleanup
    return () => {
      tg.BackButton.offClick(handleBackButton);
    };
  }, [route.component, hapticFeedback]);

  // Navigation handlers - memoized for better performance with React.memo children
  const handleNavigate = useCallback((section: string, data?: any) => {
    if (data) {
      setOrderData(data);
    } else if (section !== 'checkout') {
      setOrderData(null);
    }
    
    navigate(`/${section}`);
    hapticFeedback.light();
  }, [hapticFeedback]);

  const handleOpenDemo = useCallback((demoId: string) => {
    navigate(`/demos/${demoId}/app`);
    hapticFeedback.medium();
    // Track demo view for gamification
    trackDemoView();
  }, [hapticFeedback]);

  const handleOpenDemoApp = useCallback((demoId: string) => {
    navigate(`/demos/${demoId}/app`);
    hapticFeedback.medium();
  }, [hapticFeedback]);

  const handleCloseDemo = useCallback(() => {
    // Navigate back to the main showcase page
    navigate('/');
    hapticFeedback.light();
  }, [hapticFeedback]);

  const handleCheckoutBack = useCallback(() => {
    setOrderData(null);
    navigate('/constructor');
    hapticFeedback.light();
  }, [hapticFeedback]);

  const handlePaymentSuccess = useCallback(() => {
    setOrderData(null);
    navigate('/profile');
    hapticFeedback.medium();
  }, [hapticFeedback]);

  // No loading screen - instant load
  const PageLoader = useCallback(() => null, []);

  // Route component rendering with Suspense - no loading fallback for smooth experience
  const renderRoute = () => {
    return (
      <Suspense fallback={null}>
        {(() => {
          switch (route.component) {
            case 'showcase':
              return <ShowcasePage onOpenDemo={handleOpenDemo} onNavigate={handleNavigate} />;
            
            case 'projects':
              return <ProjectsPage onNavigate={handleNavigate} onOpenDemo={handleOpenDemo} />;
            
            case 'about':
              return <AboutPage onNavigate={handleNavigate} />;
            
            case 'demoLanding':
              const demoId = route.params?.id;
              if (!demoId) {
                return (
                  <div className="max-w-md mx-auto px-4 py-6">
                    <h1 className="ios-title font-bold mb-4">Ошибка</h1>
                    <p className="ios-body text-secondary-label">ID демо не указан</p>
                    <button 
                      onClick={() => navigate('/')} 
                      className="mt-4 ios-button-filled"
                    >
                      Назад к главной
                    </button>
                  </div>
                );
              }
              return <DemoAppLanding demoId={demoId} />;
            
            case 'demoApp':
              return <DemoAppShell demoId={route.params?.id!} onClose={handleCloseDemo} />;
            
            case 'constructor':
              return <ConstructorPage onNavigate={handleNavigate} />;
            
            case 'profile':
              return <ProfilePage onNavigate={handleNavigate} />;
            
            case 'help':
              return <HelpPage onBack={() => navigate('/profile')} />;
            
            case 'review':
              return <ReviewPage onBack={() => navigate('/profile')} />;
            
            case 'checkout':
              if (!orderData) {
                navigate('/constructor');
                return null;
              }
              return (
                <CheckoutPage 
                  selectedFeatures={orderData.selectedFeatures || []}
                  projectName={orderData.projectName || ''}
                  totalAmount={orderData.totalAmount || 0}
                  onBack={handleCheckoutBack}
                  onSuccess={handlePaymentSuccess}
                />
              );
            
            case 'aiAgent':
              return <AIAgentPage onNavigate={handleNavigate} />;
            
            case 'aiProcess':
              return <AIProcessPage onNavigate={handleNavigate} />;
            
            case 'photoGallery':
              return <PhotoGallery />;
            
            case 'referral':
              return <ReferralProgram />;
            
            case 'rewards':
              return <GamificationHub />;
            
            case 'earning':
              return <PremiumTasksEarningPage onNavigate={handleNavigate} />;
            
            // Always show showcase page as default fallback
            default:
              return <ShowcasePage onOpenDemo={handleOpenDemo} onNavigate={handleNavigate} />;
          }
        })()} 
      </Suspense>
    );
  };

  // Check if we should show bottom navigation
  const shouldShowBottomNav = !route.component.includes('demo') && route.component !== 'notFound';
  
  // Pages that should show the global sidebar (all except demo apps)
  const shouldShowSidebar = !route.component.includes('demo') && route.component !== 'notFound';

  return (
    <QueryClientProvider client={queryClient}>
      <LazyMotionProvider>
        <RewardsProvider>
          <XPNotificationProvider>
              <div className="relative min-h-screen">
                <div className="floating-elements"></div>
                
                {/* Global Sidebar for all pages except demo apps */}
                {shouldShowSidebar && (
                  <GlobalSidebar 
                    currentRoute={route.component} 
                    onNavigate={handleNavigate}
                    user={user}
                  />
                )}
                
                <div className="pb-24">
                  {renderRoute()}
                </div>
            
                {/* Liquid Glass Bottom Navigation */}
                {shouldShowBottomNav && (
                  <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 w-auto">
                    <div className="relative">
                      {/* Animated Background Glow */}
                      <div 
                        className="absolute -inset-2 rounded-full opacity-20"
                        style={{
                          background: 'radial-gradient(circle, rgba(16, 185, 129, 0.6) 0%, rgba(16, 185, 129, 0.2) 50%, transparent 70%)',
                          filter: 'blur(20px)',
                          animation: 'pulse 3s ease-in-out infinite',
                        }}
                      />
                      
                      {/* Liquid Glass Container */}
                      <div 
                        className="relative backdrop-blur-xl rounded-full border border-white/30 px-4 py-3 shadow-2xl"
                        style={{
                          background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%)',
                          boxShadow: `
                            0 8px 32px rgba(0, 0, 0, 0.4),
                            inset 0 1px 0 rgba(255, 255, 255, 0.3),
                            inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                            0 0 60px rgba(16, 185, 129, 0.2)
                          `,
                        }}
                      >
                        {/* Inner Highlight */}
                        <div 
                          className="absolute top-1 left-1/4 right-1/4 h-px bg-gradient-to-r from-transparent via-white/50 to-transparent rounded-full"
                        />
                        
                        <nav className="relative flex items-center justify-center gap-2" role="navigation" aria-label="Главное меню">
                          {/* Liquid Glass Blob - анимированная капля под активной иконкой */}
                          <div 
                            className="absolute transition-all duration-500 ease-out pointer-events-none"
                            style={{
                              left: route.component === 'showcase' ? '-2px' :
                                    route.component === 'aiAgent' ? '54px' :
                                    route.component === 'projects' ? '110px' :
                                    route.component === 'constructor' ? '166px' :
                                    ['profile', 'referral', 'rewards', 'earning'].includes(route.component) ? '222px' : '-2px',
                              top: '-2px',
                              width: '52px',
                              height: '52px',
                              zIndex: 1,
                            }}
                          >
                            {/* Основной слой капли */}
                            <div 
                              className="absolute inset-0"
                              style={{
                                background: 'radial-gradient(ellipse 100% 90% at 50% 45%, rgba(16, 185, 129, 0.35) 0%, rgba(16, 185, 129, 0.22) 40%, transparent 70%)',
                                borderRadius: '45% 55% 50% 50% / 50% 50% 45% 55%',
                                filter: 'blur(12px)',
                                animation: 'liquid-morph 4s ease-in-out infinite',
                              }}
                            />
                            {/* Второй слой капли */}
                            <div 
                              className="absolute inset-0"
                              style={{
                                background: 'radial-gradient(ellipse at center, rgba(16, 185, 129, 0.28) 0%, rgba(16, 185, 129, 0.15) 50%, transparent 70%)',
                                borderRadius: '50% 45% 55% 50% / 55% 50% 50% 45%',
                                filter: 'blur(16px)',
                                animation: 'liquid-morph-reverse 5s ease-in-out infinite',
                              }}
                            />
                            {/* Внутреннее свечение */}
                            <div 
                              className="absolute inset-0"
                              style={{
                                background: 'radial-gradient(circle at center, rgba(16, 185, 129, 0.4) 0%, rgba(16, 185, 129, 0.18) 30%, transparent 60%)',
                                borderRadius: '50%',
                                filter: 'blur(8px)',
                              }}
                            />
                          </div>
                    
                          {/* Главная */}
                          <button
                            onClick={() => {navigate('/'); hapticFeedback.light();}}
                            className="relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 hover:bg-white/5"
                            style={{ zIndex: 10 }}
                            aria-label="Главная страница"
                            aria-current={route.component === 'showcase' ? 'page' : undefined}
                          >
                            <Home
                              className={`transition-all duration-300 ${
                                route.component === 'showcase' 
                                  ? 'w-6 h-6 text-white' 
                                  : 'w-5 h-5 text-white/70 hover:text-white'
                              }`}
                              strokeWidth={2}
                            />
                          </button>
                          
                          {/* ИИ Агент */}
                          <button
                            onClick={() => {navigate('/ai-process'); hapticFeedback.light();}}
                            className="relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 hover:bg-white/5"
                            style={{ zIndex: 10 }}
                            aria-label="ИИ агенты для бизнеса"
                            aria-current={route.component === 'aiProcess' || route.component === 'aiAgent' ? 'page' : undefined}
                          >
                            <Bot
                              className={`transition-all duration-300 ${
                                route.component === 'aiProcess' || route.component === 'aiAgent'
                                  ? 'w-6 h-6 text-white' 
                                  : 'w-5 h-5 text-white/70 hover:text-white'
                              }`}
                              strokeWidth={2}
                            />
                          </button>
                          
                          {/* Витрина */}
                          <button
                            onClick={() => {navigate('/projects'); hapticFeedback.light();}}
                            className="relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 hover:bg-white/5"
                            style={{ zIndex: 10 }}
                            aria-label="Витрина проектов"
                            aria-current={route.component === 'projects' ? 'page' : undefined}
                          >
                            <Briefcase
                              className={`transition-all duration-300 ${
                                route.component === 'projects' 
                                  ? 'w-6 h-6 text-white' 
                                  : 'w-5 h-5 text-white/70 hover:text-white'
                              }`}
                              strokeWidth={2}
                            />
                          </button>
                          
                          {/* Заказать */}
                          <button
                            onClick={() => {navigate('/constructor'); hapticFeedback.light();}}
                            className="relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 hover:bg-white/5"
                            style={{ zIndex: 10 }}
                            aria-label="Заказать проект"
                            aria-current={route.component === 'constructor' ? 'page' : undefined}
                          >
                            <ShoppingCart
                              className={`transition-all duration-300 ${
                                route.component === 'constructor'
                                  ? 'w-6 h-6 text-white' 
                                  : 'w-5 h-5 text-white/70 hover:text-white'
                              }`}
                              strokeWidth={2}
                            />
                          </button>
                          
                          {/* Профиль - с аватаром Telegram */}
                          <button
                            onClick={() => {navigate('/profile'); hapticFeedback.light();}}
                            className="relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 hover:bg-white/5"
                            style={{ zIndex: 10 }}
                            aria-label="Профиль пользователя"
                            aria-current={route.component === 'profile' || route.component === 'referral' || route.component === 'rewards' || route.component === 'earning' ? 'page' : undefined}
                          >
                            <UserAvatar
                              photoUrl={user?.photo_url}
                              firstName={user?.first_name}
                              size="sm"
                              className={`transition-all duration-300 ${
                                route.component === 'profile' || route.component === 'referral' || route.component === 'rewards' || route.component === 'earning'
                                  ? 'ring-2 ring-white/50 scale-110' 
                                  : 'opacity-80 hover:opacity-100'
                              }`}
                            />
                          </button>
                    
                  </nav>
                </div>
              </div>
            </div>
          )}
          
          <Toaster />
        </div>
      </XPNotificationProvider>
      </RewardsProvider>
      </LazyMotionProvider>
    </QueryClientProvider>
  );
}

export default App;```

### main.tsx
```tsx
import { createRoot } from "react-dom/client";
import App from "./App";
import "./index.css";
import { initWebVitals } from "./utils/webVitals";
import { errorMonitor } from "./utils/errorMonitoring";
import { initTelegramWebApp } from "./lib/telegram";

// Initialize and render immediately
if (typeof window !== 'undefined') {
  // Init Telegram ASAP (ready() already called in HTML)
  try {
    initTelegramWebApp();
  } catch (error) {
    console.log('[Telegram] Not running in Telegram environment');
  }
  
  // Defer non-critical init to after render
  setTimeout(() => {
    initWebVitals();
    errorMonitor.init();
  }, 0);
}

// Render React app immediately
createRoot(document.getElementById("root")!).render(<App />);
```

## СТРАНИЦЫ

### pages/not-found.tsx
```tsx
import { Card, CardContent } from "@/components/ui/card";
import { AlertCircle } from "lucide-react";

export default function NotFound() {
  return (
    <div className="min-h-screen w-full flex items-center justify-center bg-gray-50">
      <Card className="w-full max-w-md mx-4">
        <CardContent className="pt-6">
          <div className="flex mb-4 gap-2">
            <AlertCircle className="h-8 w-8 text-red-500" />
            <h1 className="text-2xl font-bold text-gray-900">404 Page Not Found</h1>
          </div>

          <p className="mt-4 text-sm text-gray-600">
            Did you forget to add the page to the router?
          </p>
        </CardContent>
      </Card>
    </div>
  );
}
```

### pages/PhotoGallery.tsx
```tsx
import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { apiRequest } from "@/lib/queryClient";
import { ObjectUploader } from "@/components/ObjectUploader";
import { Button } from "@/components/ui/button";
import { Card } from "@/components/ui/card";
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Upload, Trash2, X } from "lucide-react";

interface Photo {
  id: number;
  title: string;
  description: string | null;
  objectPath: string;
  thumbnailPath: string | null;
  uploadedAt: string;
  userId: string | null;
}

/**
 * PhotoGallery - Оптимизированная страница фотогалереи
 * 
 * Особенности:
 * - Мгновенная загрузка фотографий из PostgreSQL
 * - Прямая загрузка в Object Storage через presigned URLs
 * - Glassmorphism дизайн (2025 trending dark theme)
 * - Масонная сетка с lazy loading
 * - Fullscreen preview с метаданными
 */
export default function PhotoGallery() {
  const [selectedPhoto, setSelectedPhoto] = useState<Photo | null>(null);
  const [showUploadForm, setShowUploadForm] = useState(false);
  const [uploadedFileUrl, setUploadedFileUrl] = useState<string>("");
  const [formData, setFormData] = useState({
    title: "",
    description: "",
  });

  const queryClient = useQueryClient();

  // Fetch all photos
  const { data: photos = [], isLoading } = useQuery<Photo[]>({
    queryKey: ["/api/photos"],
  });

  // Delete photo mutation
  const deleteMutation = useMutation({
    mutationFn: async (photoId: number) => {
      return apiRequest("DELETE", `/api/photos/${photoId}`);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/photos"] });
      setSelectedPhoto(null);
    },
  });

  // Create photo mutation
  const createPhotoMutation = useMutation({
    mutationFn: async (data: { title: string; description: string; objectPath: string }) => {
      return apiRequest("POST", "/api/photos", data);
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["/api/photos"] });
      setShowUploadForm(false);
      setUploadedFileUrl("");
      setFormData({ title: "", description: "" });
    },
  });

  // Handle photo upload complete
  const handleUploadComplete = (result: any) => {
    // Get the full signed URL - backend will normalize it to permanent path
    const uploadedUrl = result.successful?.[0]?.uploadURL;
    if (uploadedUrl) {
      setUploadedFileUrl(uploadedUrl);
      setShowUploadForm(true);
    }
  };

  // Get presigned upload URL
  const getUploadUrl = async () => {
    const response = await fetch("/api/photos/upload-url", {
      method: "POST",
    });
    const data = await response.json();
    return {
      method: "PUT" as const,
      url: data.uploadURL,
    };
  };

  // Submit photo metadata
  const handleSubmitMetadata = () => {
    if (!uploadedFileUrl || !formData.title) return;
    
    createPhotoMutation.mutate({
      title: formData.title,
      description: formData.description || "",
      objectPath: uploadedFileUrl,
    });
  };

  return (
    <div className="min-h-screen bg-black text-white">
      {/* Header - Glassmorphism Sticky */}
      <header className="sticky top-0 z-50 bg-white/10 backdrop-blur-xl border-b border-white/20 h-16">
        <div className="h-full px-4 py-5 flex items-center justify-between">
          <h1 className="text-base font-medium">Фотогалерея</h1>
          <ObjectUploader
            maxNumberOfFiles={1}
            maxFileSize={10485760}
            onGetUploadParameters={getUploadUrl}
            onComplete={handleUploadComplete}
            buttonClassName="bg-blue-600 hover:bg-blue-700 rounded-full h-10 px-6"
          >
            <Upload className="w-4 h-4 mr-2" />
            <span className="text-sm">Загрузить</span>
          </ObjectUploader>
        </div>
      </header>

      {/* Photo Grid - Masonry Layout */}
      <main className="p-4">
        {isLoading ? (
          <div className="grid grid-cols-2 gap-4">
            {[1, 2, 3, 4, 5, 6].map((i) => (
              <div key={i} className="bg-white/5 animate-pulse rounded-lg h-48" />
            ))}
          </div>
        ) : photos.length === 0 ? (
          <div className="flex items-center justify-center min-h-[60vh]">
            <Card className="bg-white/10 backdrop-blur-xl border-white/20 p-8 text-center">
              <Upload className="w-12 h-12 mx-auto mb-4 text-white/40" />
              <h2 className="text-lg font-semibold mb-2 text-white/90">Нет фотографий</h2>
              <p className="text-sm text-white/60 mb-4">Загрузите первую фотографию</p>
            </Card>
          </div>
        ) : (
          <div className="grid grid-cols-2 gap-4">
            {photos.map((photo) => (
              <div
                key={photo.id}
                onClick={() => setSelectedPhoto(photo)}
                className="relative group cursor-pointer rounded-lg overflow-hidden hover-elevate active-elevate-2"
                data-testid={`card-photo-${photo.id}`}
              >
                <img
                  src={photo.objectPath}
                  alt={photo.title}
                  className="w-full h-48 object-cover"
                  loading="lazy"
                  decoding="async"
                />
                <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-0 group-active:opacity-100 transition-opacity">
                  <div className="absolute bottom-0 left-0 right-0 p-3">
                    <p className="text-sm font-medium truncate text-white/95">{photo.title}</p>
                    {photo.description && (
                      <p className="text-xs text-white/60 truncate">{photo.description}</p>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </main>

      {/* Fullscreen Photo Detail Modal */}
      {selectedPhoto && (
        <Dialog open={!!selectedPhoto} onOpenChange={() => setSelectedPhoto(null)}>
          <DialogContent className="bg-black border-white/20 max-w-4xl p-0">
            <div className="relative">
              <button
                onClick={() => setSelectedPhoto(null)}
                className="absolute top-4 right-4 z-10 bg-white/10 backdrop-blur-md rounded-full p-2 hover-elevate"
                data-testid="button-close-photo"
              >
                <X className="w-5 h-5" />
              </button>
              <img
                src={selectedPhoto.objectPath}
                alt={selectedPhoto.title}
                className="w-full max-h-[70vh] object-contain"
              />
            </div>
            <div className="p-6 bg-white/5 backdrop-blur-xl border-t border-white/20">
              <DialogHeader>
                <DialogTitle className="text-xl font-semibold text-white/95">
                  {selectedPhoto.title}
                </DialogTitle>
                <DialogDescription className="text-sm text-white/60">
                  {selectedPhoto.description || "Без описания"}
                </DialogDescription>
              </DialogHeader>
              <div className="mt-4 flex items-center justify-between">
                <p className="text-xs text-white/40">
                  {new Date(selectedPhoto.uploadedAt).toLocaleDateString("ru-RU", {
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                  })}
                </p>
                <Button
                  variant="destructive"
                  size="sm"
                  onClick={() => deleteMutation.mutate(selectedPhoto.id)}
                  disabled={deleteMutation.isPending}
                  data-testid="button-delete-photo"
                >
                  <Trash2 className="w-4 h-4 mr-2" />
                  {deleteMutation.isPending ? "Удаление..." : "Удалить"}
                </Button>
              </div>
            </div>
          </DialogContent>
        </Dialog>
      )}

      {/* Upload Metadata Form */}
      {showUploadForm && (
        <Dialog open={showUploadForm} onOpenChange={setShowUploadForm}>
          <DialogContent className="bg-white/10 backdrop-blur-xl border-white/20">
            <DialogHeader>
              <DialogTitle className="text-white/95">Добавить информацию о фото</DialogTitle>
            </DialogHeader>
            <div className="space-y-4">
              <div>
                <Label htmlFor="title" className="text-white/90">Название *</Label>
                <Input
                  id="title"
                  value={formData.title}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  className="bg-white/5 border-white/20 text-white"
                  placeholder="Введите название фотографии"
                  data-testid="input-photo-title"
                />
              </div>
              <div>
                <Label htmlFor="description" className="text-white/90">Описание</Label>
                <Textarea
                  id="description"
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  className="bg-white/5 border-white/20 text-white resize-none"
                  placeholder="Добавьте описание (необязательно)"
                  rows={3}
                  data-testid="input-photo-description"
                />
              </div>
            </div>
            <DialogFooter>
              <Button
                variant="outline"
                onClick={() => {
                  setShowUploadForm(false);
                  setUploadedFileUrl("");
                  setFormData({ title: "", description: "" });
                }}
                className="border-white/20"
              >
                Отмена
              </Button>
              <Button
                onClick={handleSubmitMetadata}
                disabled={!formData.title || createPhotoMutation.isPending}
                className="bg-blue-600 hover:bg-blue-700"
                data-testid="button-save-photo"
              >
                {createPhotoMutation.isPending ? "Сохранение..." : "Сохранить"}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      )}
    </div>
  );
}
```

## КОМПОНЕНТЫ (Главные)

### components/AboutPage.tsx
```tsx
import { ArrowRight, Zap, Shield, Clock, Users, Code, Rocket } from "lucide-react";

interface AboutPageProps {
  onNavigate: (section: string) => void;
}

export default function AboutPage({ onNavigate }: AboutPageProps) {
  return (
    <div 
      className="min-h-screen pb-32"
      style={{ 
        background: '#09090B',
        color: '#E4E4E7',
        paddingTop: '140px'
      }}
    >
      <div className="max-w-md mx-auto">
        
        {/* HERO SECTION */}
        <header className="px-7 pt-8 pb-16">
          <p 
            className="scroll-fade-in"
            style={{
              fontSize: '11px',
              fontWeight: 500,
              letterSpacing: '0.18em',
              color: '#71717A',
              textTransform: 'uppercase',
              marginBottom: '24px'
            }}
          >
            О студии
          </p>
          
          <h1 
            className="scroll-fade-in-delay-1"
            style={{
              fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',
              fontSize: '32px',
              fontWeight: 600,
              letterSpacing: '-0.025em',
              lineHeight: '1.2',
              color: '#FAFAFA'
            }}
          >
            Мы создаём
            <br />
            <span style={{ color: '#A78BFA' }}>будущее продаж</span>
            <br />
            в Telegram.
          </h1>
          
          <p 
            className="scroll-fade-in-delay-2"
            style={{
              fontSize: '15px',
              fontWeight: 400,
              letterSpacing: '-0.01em',
              lineHeight: '1.6',
              color: '#71717A',
              marginTop: '20px',
              maxWidth: '320px'
            }}
          >
            Web4TG Studio — команда разработчиков, специализирующихся на премиальных Telegram Mini Apps для бизнеса.
          </p>
        </header>

        {/* Hairline */}
        <div 
          className="mx-7"
          style={{ height: '1px', background: '#27272A' }}
        />

        {/* MISSION SECTION */}
        <section className="px-7 py-12">
          <p 
            style={{
              fontSize: '10px',
              fontWeight: 600,
              letterSpacing: '0.12em',
              color: '#52525B',
              textTransform: 'uppercase',
              marginBottom: '16px'
            }}
          >
            Миссия
          </p>
          
          <div 
            style={{
              padding: '24px',
              borderRadius: '16px',
              background: 'linear-gradient(135deg, rgba(139,92,246,0.08) 0%, rgba(59,130,246,0.04) 100%)',
              border: '1px solid rgba(139, 92, 246, 0.15)'
            }}
          >
            <p style={{
              fontSize: '17px',
              fontWeight: 500,
              color: '#E4E4E7',
              lineHeight: '1.5',
              fontStyle: 'italic'
            }}>
              «Сделать передовые технологии доступными для каждого бизнеса — от локальной кофейни до федеральной сети.»
            </p>
          </div>
        </section>

        {/* VALUES SECTION */}
        <section className="px-7 py-8">
          <p 
            style={{
              fontSize: '10px',
              fontWeight: 600,
              letterSpacing: '0.12em',
              color: '#52525B',
              textTransform: 'uppercase',
              marginBottom: '20px'
            }}
          >
            Наши принципы
          </p>
          
          <div className="space-y-4">
            {[
              { 
                icon: Shield, 
                title: 'Качество без компромиссов', 
                desc: 'Каждое приложение проходит 47 проверок перед запуском'
              },
              { 
                icon: Clock, 
                title: 'Скорость', 
                desc: 'От идеи до работающего MVP за 14 дней'
              },
              { 
                icon: Code, 
                title: 'Технологичность', 
                desc: 'React, TypeScript, современный стек 2025 года'
              },
              { 
                icon: Users, 
                title: 'Партнёрство', 
                desc: 'Мы не подрядчики — мы ваши технические партнёры'
              }
            ].map((item, index) => (
              <div 
                key={index}
                style={{
                  display: 'flex',
                  gap: '16px',
                  padding: '20px',
                  borderRadius: '14px',
                  background: 'rgba(255, 255, 255, 0.02)',
                  border: '1px solid rgba(255, 255, 255, 0.04)'
                }}
              >
                <div style={{
                  width: '44px',
                  height: '44px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  borderRadius: '12px',
                  background: 'rgba(139, 92, 246, 0.1)',
                  flexShrink: 0
                }}>
                  <item.icon size={20} color="#A78BFA" />
                </div>
                <div>
                  <p style={{
                    fontSize: '15px',
                    fontWeight: 600,
                    color: '#FAFAFA',
                    marginBottom: '4px'
                  }}>
                    {item.title}
                  </p>
                  <p style={{
                    fontSize: '13px',
                    color: '#71717A',
                    lineHeight: '1.4'
                  }}>
                    {item.desc}
                  </p>
                </div>
              </div>
            ))}
          </div>
        </section>

        {/* STATS SECTION */}
        <section className="px-7 py-8">
          <p 
            style={{
              fontSize: '10px',
              fontWeight: 600,
              letterSpacing: '0.12em',
              color: '#52525B',
              textTransform: 'uppercase',
              marginBottom: '20px'
            }}
          >
            В цифрах
          </p>
          
          <div 
            style={{
              display: 'grid',
              gridTemplateColumns: '1fr 1fr',
              gap: '12px'
            }}
          >
            {[
              { value: '50+', label: 'проектов запущено' },
              { value: '14', label: 'дней средний срок' },
              { value: '127%', label: 'средний рост продаж' },
              { value: '24/7', label: 'поддержка клиентов' }
            ].map((stat, index) => (
              <div 
                key={index}
                style={{
                  padding: '20px',
                  borderRadius: '14px',
                  background: 'rgba(255, 255, 255, 0.02)',
                  border: '1px solid rgba(255, 255, 255, 0.04)',
                  textAlign: 'center'
                }}
              >
                <p style={{
                  fontSize: '28px',
                  fontWeight: 700,
                  color: '#FAFAFA',
                  letterSpacing: '-0.03em'
                }}>
                  {stat.value}
                </p>
                <p style={{
                  fontSize: '12px',
                  color: '#52525B',
                  marginTop: '4px'
                }}>
                  {stat.label}
                </p>
              </div>
            ))}
          </div>
        </section>

        {/* CTA SECTION */}
        <section className="px-7 py-12">
          <div 
            style={{
              padding: '28px',
              borderRadius: '20px',
              background: 'linear-gradient(135deg, rgba(139,92,246,0.15) 0%, rgba(59,130,246,0.08) 100%)',
              border: '1px solid rgba(139, 92, 246, 0.2)',
              textAlign: 'center'
            }}
          >
            <div style={{
              width: '56px',
              height: '56px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              borderRadius: '16px',
              background: 'rgba(139, 92, 246, 0.2)',
              margin: '0 auto 16px'
            }}>
              <Rocket size={28} color="#A78BFA" />
            </div>
            
            <h3 style={{
              fontSize: '20px',
              fontWeight: 600,
              color: '#FAFAFA',
              marginBottom: '8px'
            }}>
              Готовы начать?
            </h3>
            
            <p style={{
              fontSize: '14px',
              color: '#71717A',
              marginBottom: '20px',
              lineHeight: '1.5'
            }}>
              Обсудим ваш проект и подберём
              <br />
              оптимальное решение
            </p>
            
            <button
              onClick={() => onNavigate('constructor')}
              style={{
                display: 'inline-flex',
                alignItems: 'center',
                gap: '8px',
                padding: '14px 28px',
                borderRadius: '12px',
                background: '#A78BFA',
                border: 'none',
                color: '#09090B',
                fontSize: '15px',
                fontWeight: 600,
                cursor: 'pointer',
                transition: 'all 0.2s'
              }}
              data-testid="button-cta-constructor"
            >
              Заказать проект
              <ArrowRight size={18} />
            </button>
          </div>
        </section>

        {/* CONTACT SECTION */}
        <section className="px-7 py-8 pb-16">
          <p 
            style={{
              fontSize: '10px',
              fontWeight: 600,
              letterSpacing: '0.12em',
              color: '#52525B',
              textTransform: 'uppercase',
              marginBottom: '16px'
            }}
          >
            Контакты
          </p>
          
          <div 
            style={{
              padding: '24px',
              borderRadius: '16px',
              background: 'rgba(255, 255, 255, 0.02)',
              border: '1px solid rgba(255, 255, 255, 0.04)'
            }}
          >
            <div style={{ marginBottom: '16px' }}>
              <p style={{
                fontSize: '12px',
                color: '#52525B',
                marginBottom: '4px'
              }}>
                Telegram
              </p>
              <p style={{
                fontSize: '15px',
                fontWeight: 500,
                color: '#FAFAFA'
              }}>
                @web4tg_studio
              </p>
            </div>
            
            <div style={{ marginBottom: '16px' }}>
              <p style={{
                fontSize: '12px',
                color: '#52525B',
                marginBottom: '4px'
              }}>
                Email
              </p>
              <p style={{
                fontSize: '15px',
                fontWeight: 500,
                color: '#FAFAFA'
              }}>
                hello@web4tg.studio
              </p>
            </div>
            
            <div>
              <p style={{
                fontSize: '12px',
                color: '#52525B',
                marginBottom: '4px'
              }}>
                Время работы
              </p>
              <p style={{
                fontSize: '15px',
                fontWeight: 500,
                color: '#FAFAFA'
              }}>
                Пн-Пт, 10:00 — 19:00 МСК
              </p>
            </div>
          </div>
        </section>

      </div>
    </div>
  );
}
```

### components/AIAgentPage.tsx
```tsx
import { memo, useCallback, useState, useEffect } from "react";
import { 
  Sparkles, 
  ArrowRight,
  Zap,
  Shield,
  Globe,
  Brain,
  TrendingUp,
  Clock
} from "lucide-react";

interface AIAgentPageProps {
  onNavigate: (path: string) => void;
}

const AIAgentPage = memo(({ onNavigate }: AIAgentPageProps) => {
  const [scrollY, setScrollY] = useState(0);
  
  const handleNavigateProcess = useCallback(() => {
    onNavigate('ai-process');
  }, [onNavigate]);

  useEffect(() => {
    const handleScroll = () => setScrollY(window.scrollY);
    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <div className="min-h-screen bg-[#000000] overflow-hidden" style={{ paddingTop: '140px' }}>
      
      {/* ===============================================
          HERO - Full screen dramatic intro
          =============================================== */}
      <section className="relative min-h-screen flex items-center justify-center px-5">
        {/* Parallax backgrounds - optimized for mobile */}
        <div 
          className="absolute inset-0 opacity-30"
          style={{
            background: 'radial-gradient(ellipse 180% 100% at 50% -15%, rgba(59, 130, 246, 0.4) 0%, rgba(139, 92, 246, 0.35) 40%, transparent 100%)',
            transform: `translateY(${scrollY * 0.5}px)`,
          }}
        />
        
        <div 
          className="absolute inset-0 opacity-20"
          style={{
            background: 'radial-gradient(circle at 15% 90%, rgba(139, 92, 246, 0.4) 0%, transparent 50%), radial-gradient(circle at 85% 10%, rgba(59, 130, 246, 0.4) 0%, transparent 50%)',
            transform: `translateY(${scrollY * 0.3}px)`,
          }}
        />
        
        <div className="relative z-10 text-center w-full">
          {/* Badge */}
          <div className="flex justify-center mb-8 scroll-fade-in">
            <div 
              className="inline-flex items-center gap-2 px-4 py-2.5 rounded-full backdrop-blur-3xl"
              style={{
                background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(59, 130, 246, 0.15) 100%)',
                border: '1px solid rgba(139, 92, 246, 0.4)',
                boxShadow: 'inset 0 1px 0 rgba(255, 255, 255, 0.15), 0 10px 40px rgba(139, 92, 246, 0.3)'
              }}
            >
              <Sparkles className="w-3.5 h-3.5 text-[#8B5CF6]" strokeWidth={2.5} />
              <span 
                style={{
                  fontSize: '10px',
                  fontWeight: 700,
                  background: 'linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%)',
                  WebkitBackgroundClip: 'text',
                  WebkitTextFillColor: 'transparent',
                  letterSpacing: '0.12em',
                  textTransform: 'uppercase'
                }}
              >
                Новая эра
              </span>
            </div>
          </div>

          {/* Main headline - Mobile optimized */}
          <h1 
            className="mb-4 px-3 scroll-fade-in-delay-1"
            style={{ 
              fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',
              fontSize: 'clamp(48px, 18vw, 72px)',
              fontWeight: 800,
              letterSpacing: '-0.07em',
              lineHeight: '0.88',
              background: 'linear-gradient(180deg, #FFFFFF 0%, #FFFFFF 30%, rgba(255, 255, 255, 0.35) 100%)',
              WebkitBackgroundClip: 'text',
              WebkitTextFillColor: 'transparent',
            }}
          >
            ИИ агент
          </h1>

          {/* Gradient line */}
          <div className="flex justify-center mb-5 scroll-fade-in-delay-2">
            <div 
              className="h-1.5 w-20 rounded-full"
              style={{
                background: 'linear-gradient(90deg, #8B5CF6 0%, #3B82F6 100%)',
                boxShadow: '0 0 20px rgba(139, 92, 246, 0.7), 0 0 40px rgba(59, 130, 246, 0.5)'
              }}
            />
          </div>
          
          {/* Subheadline */}
          <p 
            className="mb-3 px-5 scroll-fade-in-delay-3"
            style={{
              fontSize: '21px',
              lineHeight: '1.25',
              fontWeight: 600,
              color: 'rgba(255, 255, 255, 0.82)',
              letterSpacing: '-0.035em',
            }}
          >
            Работает.
            <br />
            Пока вы спите.
          </p>
          
          {/* Value prop */}
          <p 
            className="mb-12 px-5 scroll-fade-in-delay-4"
            style={{
              fontSize: '18px',
              lineHeight: '1.35',
              fontWeight: 700,
              letterSpacing: '-0.025em',
              background: 'linear-gradient(90deg, #10B981 0%, #34D399 100%)',
              WebkitBackgroundClip: 'text',
              WebkitTextFillColor: 'transparent',
            }}
          >
            Окупается за полгода
          </p>
          
          {/* CTA */}
          <div className="flex flex-col items-center gap-3.5 px-5 scroll-fade-in-delay-5">
            <button
              onClick={handleNavigateProcess}
              className="w-full max-w-[280px] group relative py-4 rounded-full font-semibold active:scale-[0.96]"
              style={{
                fontSize: '16px',
                letterSpacing: '-0.015em',
                background: '#FFFFFF',
                color: '#000000',
                boxShadow: '0 12px 48px rgba(255, 255, 255, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.15) inset',
                transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)'
              }}
              data-testid="button-start-trial"
            >
              <span className="relative z-10 flex items-center justify-center gap-2">
                Попробовать
                <ArrowRight className="w-4.5 h-4.5 transition-transform group-hover:translate-x-1 duration-300" strokeWidth={2.5} />
              </span>
            </button>
            
            <p 
              style={{
                fontSize: '12px',
                color: 'rgba(255, 255, 255, 0.38)',
                letterSpacing: '0.02em'
              }}
            >
              Бесплатно 7 дней
            </p>
          </div>
        </div>

        {/* Scroll indicator */}
        <div 
          className="absolute bottom-8 left-1/2 -translate-x-1/2"
          style={{
            opacity: Math.max(0, 1 - scrollY / 400),
          }}
        >
          <div 
            className="w-1 h-12 rounded-full"
            style={{
              background: 'linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%)',
              animation: 'bounce 2.5s ease-in-out infinite'
            }}
          />
        </div>
      </section>

      {/* ===============================================
          STATS - Clean numbers
          =============================================== */}
      <section className="relative py-20 px-5 scroll-fade-in">
        <div className="max-w-xs mx-auto">
          {/* Title */}
          <h2 
            className="text-center mb-16 scroll-fade-in-delay-1"
            style={{
              fontSize: '36px',
              fontWeight: 700,
              letterSpacing: '-0.055em',
              color: '#FFFFFF',
              lineHeight: '0.95'
            }}
          >
            В цифрах
          </h2>

          {/* Stats */}
          <div className="space-y-14">
            <StatCard
              number="192%"
              label="ROI за год"
              sublabel="Средний показатель"
              gradient="linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%)"
            />
            <StatCard
              number="24/7"
              label="Всегда на связи"
              sublabel="Без выходных"
              gradient="linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)"
            />
            <StatCard
              number="< 2s"
              label="Время ответа"
              sublabel="Мгновенно"
              gradient="linear-gradient(135deg, #10B981 0%, #059669 100%)"
            />
          </div>
        </div>
      </section>

      {/* ===============================================
          FEATURES - One at a time
          =============================================== */}
      <section className="py-20 px-5 scroll-fade-in">
        <div className="max-w-xs mx-auto">
          <h2 
            className="text-center mb-4 scroll-fade-in-delay-1"
            style={{
              fontSize: '36px',
              fontWeight: 700,
              letterSpacing: '-0.055em',
              color: '#FFFFFF',
              lineHeight: '0.95'
            }}
          >
            Возможности
          </h2>
          
          <p 
            className="text-center mb-16"
            style={{
              fontSize: '16px',
              color: 'rgba(255, 255, 255, 0.48)',
              letterSpacing: '-0.015em'
            }}
          >
            Всё для успеха
          </p>

          <div className="space-y-10">
            <FeatureBlock
              icon={<Zap className="w-8 h-8" strokeWidth={2} />}
              title="Мгновенный запуск"
              description="10 минут — и готово"
              gradient="linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%)"
            />
            
            <FeatureBlock
              icon={<Shield className="w-8 h-8" strokeWidth={2} />}
              title="Безопасность"
              description="Шифрование и GDPR"
              gradient="linear-gradient(135deg, #10B981 0%, #047857 100%)"
            />
            
            <FeatureBlock
              icon={<Globe className="w-8 h-8" strokeWidth={2} />}
              title="150+ языков"
              description="Понимает всех"
              gradient="linear-gradient(135deg, #F59E0B 0%, #D97706 100%)"
            />
            
            <FeatureBlock
              icon={<Brain className="w-8 h-8" strokeWidth={2} />}
              title="Учится сам"
              description="Становится умнее"
              gradient="linear-gradient(135deg, #8B5CF6 0%, #6D28D9 100%)"
            />
          </div>
        </div>
      </section>

      {/* ===============================================
          WHY - Simple benefits
          =============================================== */}
      <section className="py-20 px-5 scroll-fade-in">
        <div className="max-w-xs mx-auto">
          <h2 
            className="text-center mb-16 scroll-fade-in-delay-1"
            style={{
              fontSize: '36px',
              fontWeight: 700,
              letterSpacing: '-0.055em',
              color: '#FFFFFF',
              lineHeight: '0.95'
            }}
          >
            Почему мы
          </h2>

          <div className="space-y-6">
            <BenefitItem 
              icon={<Clock className="w-5.5 h-5.5" strokeWidth={2.5} />}
              text="Никогда не спит"
              subtext="24/7 без перерывов"
            />
            <BenefitItem 
              icon={<Zap className="w-5.5 h-5.5" strokeWidth={2.5} />}
              text="Отвечает мгновенно"
              subtext="Меньше 2 секунд"
            />
            <BenefitItem 
              icon={<TrendingUp className="w-5.5 h-5.5" strokeWidth={2.5} />}
              text="Окупается быстро"
              subtext="74% за год"
            />
          </div>
        </div>
      </section>

      {/* ===============================================
          FINAL CTA - Closer
          =============================================== */}
      <section className="relative py-28 px-5 pb-32 scroll-fade-in">
        {/* Background */}
        <div 
          className="absolute inset-0 opacity-40"
          style={{
            background: 'radial-gradient(ellipse 140% 80% at 50% 50%, rgba(139, 92, 246, 0.3) 0%, transparent 90%)'
          }}
        />

        {/* Animated orbs */}
        <div 
          className="absolute top-1/4 left-1/4 w-32 h-32 rounded-full opacity-30"
          style={{
            background: 'radial-gradient(circle, rgba(139, 92, 246, 0.9) 0%, transparent 70%)',
            filter: 'blur(50px)',
            animation: 'float 9s ease-in-out infinite'
          }}
        />
        <div 
          className="absolute bottom-1/3 right-1/4 w-32 h-32 rounded-full opacity-30"
          style={{
            background: 'radial-gradient(circle, rgba(59, 130, 246, 0.9) 0%, transparent 70%)',
            filter: 'blur(50px)',
            animation: 'float 11s ease-in-out infinite reverse'
          }}
        />
        
        <div className="relative z-10 text-center max-w-xs mx-auto">
          <h2 
            className="mb-6"
            style={{
              fontSize: '48px',
              fontWeight: 700,
              letterSpacing: '-0.065em',
              color: '#FFFFFF',
              lineHeight: '0.88'
            }}
          >
            Начните
            <br />
            сегодня
          </h2>
          
          <p 
            className="mb-12"
            style={{
              fontSize: '18px',
              lineHeight: '1.4',
              color: 'rgba(255, 255, 255, 0.68)',
              letterSpacing: '-0.025em',
              fontWeight: 500
            }}
          >
            Сотни компаний уже
            <br />
            доверились нам
          </p>
          
          <button
            onClick={handleNavigateProcess}
            className="w-full group relative py-4.5 rounded-full font-semibold mb-4 active:scale-[0.96]"
            style={{
              fontSize: '17px',
              letterSpacing: '-0.02em',
              background: '#FFFFFF',
              color: '#000000',
              boxShadow: '0 20px 60px rgba(255, 255, 255, 0.35)',
              transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)'
            }}
            data-testid="button-start-cta"
          >
            <span className="relative z-10 flex items-center justify-center gap-2.5">
              Запустить ИИ
              <ArrowRight className="w-5 h-5 transition-transform group-hover:translate-x-1.5 duration-300" strokeWidth={2.5} />
            </span>
          </button>
          
          <p 
            style={{
              fontSize: '13px',
              color: 'rgba(255, 255, 255, 0.38)',
              letterSpacing: '0.02em'
            }}
          >
            7 дней бесплатно · Без карты
          </p>
        </div>
      </section>

      {/* Animations */}
      <style>{`
        @keyframes bounce {
          0%, 100% { transform: translateY(0); opacity: 0.4; }
          50% { transform: translateY(-14px); opacity: 0.2; }
        }
        @keyframes float {
          0%, 100% { transform: translate(0, 0) scale(1); }
          33% { transform: translate(-20px, -25px) scale(1.08); }
          66% { transform: translate(20px, -15px) scale(0.92); }
        }
      `}</style>

    </div>
  );
});

AIAgentPage.displayName = 'AIAgentPage';

// Stat Card - Mobile optimized
const StatCard = memo(({ number, label, sublabel, gradient }: { 
  number: string; 
  label: string; 
  sublabel: string;
  gradient: string;
}) => (
  <div className="text-center">
    <div 
      className="mb-4"
      style={{
        fontSize: '68px',
        fontWeight: 800,
        letterSpacing: '-0.065em',
        lineHeight: '0.9',
        background: gradient,
        WebkitBackgroundClip: 'text',
        WebkitTextFillColor: 'transparent',
      }}
    >
      {number}
    </div>
    <p 
      style={{
        fontSize: '17px',
        lineHeight: '1.3',
        color: 'rgba(255, 255, 255, 0.75)',
        letterSpacing: '-0.02em',
        fontWeight: 600,
        marginBottom: '5px'
      }}
    >
      {label}
    </p>
    <p 
      style={{
        fontSize: '14px',
        color: 'rgba(255, 255, 255, 0.42)',
        letterSpacing: '-0.01em'
      }}
    >
      {sublabel}
    </p>
  </div>
));
StatCard.displayName = 'StatCard';

// Feature Block - Mobile focused
const FeatureBlock = memo(({ 
  icon, 
  title, 
  description,
  gradient
}: { 
  icon: React.ReactNode; 
  title: string; 
  description: string;
  gradient: string;
}) => (
  <div className="text-center">
    {/* Icon */}
    <div 
      className="w-20 h-20 rounded-[24px] flex items-center justify-center mx-auto mb-5"
      style={{
        background: gradient,
        boxShadow: '0 16px 48px rgba(0, 0, 0, 0.45)'
      }}
    >
      <div style={{ color: 'white' }}>
        {icon}
      </div>
    </div>

    {/* Title */}
    <h3 
      className="mb-2.5"
      style={{
        fontSize: '22px',
        fontWeight: 700,
        letterSpacing: '-0.04em',
        color: '#FFFFFF',
        lineHeight: '1.15'
      }}
    >
      {title}
    </h3>

    {/* Description */}
    <p 
      style={{
        fontSize: '15px',
        lineHeight: '1.45',
        color: 'rgba(255, 255, 255, 0.58)',
        letterSpacing: '-0.015em'
      }}
    >
      {description}
    </p>
  </div>
));
FeatureBlock.displayName = 'FeatureBlock';

// Benefit Item - Compact mobile
const BenefitItem = memo(({ icon, text, subtext }: { 
  icon: React.ReactNode; 
  text: string;
  subtext: string;
}) => (
  <div className="flex items-center gap-4 py-4">
    <div 
      className="flex-shrink-0 w-12 h-12 rounded-[18px] flex items-center justify-center"
      style={{
        background: 'linear-gradient(135deg, rgba(52, 199, 89, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%)',
        border: '1px solid rgba(52, 199, 89, 0.35)'
      }}
    >
      <div style={{ color: '#34C759' }}>
        {icon}
      </div>
    </div>
    <div className="flex-1">
      <p 
        style={{
          fontSize: '16px',
          lineHeight: '1.25',
          color: 'rgba(255, 255, 255, 0.88)',
          letterSpacing: '-0.025em',
          fontWeight: 600,
          marginBottom: '3px'
        }}
      >
        {text}
      </p>
      <p 
        style={{
          fontSize: '14px',
          color: 'rgba(255, 255, 255, 0.48)',
          letterSpacing: '-0.01em'
        }}
      >
        {subtext}
      </p>
    </div>
  </div>
));
BenefitItem.displayName = 'BenefitItem';

export default AIAgentPage;
```

### components/AIProcessPage.tsx
```tsx
import { memo, useCallback, useState, useEffect } from "react";
import { 
  Check,
  MessageSquare,
  Smartphone,
  Rocket,
  Bot,
  Sparkles,
  ArrowRight,
  Zap
} from "lucide-react";

interface AIProcessPageProps {
  onNavigate: (path: string) => void;
}

const AIProcessPage = memo(({ onNavigate }: AIProcessPageProps) => {
  const [scrollY, setScrollY] = useState(0);
  
  const handleGetConsultation = useCallback(() => {
    // Open Telegram for consultation
    window.open('https://t.me/your_username', '_blank');
  }, []);

  useEffect(() => {
    const handleScroll = () => setScrollY(window.scrollY);
    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  return (
    <div className="min-h-screen bg-[#000000] pb-24 overflow-hidden" style={{ paddingTop: '140px' }}>
      <div className="max-w-md mx-auto">
        
        {/* Apple-Style Hero with Parallax */}
        <section className="relative px-6 pt-8 pb-16">
          {/* Dynamic gradient background */}
          <div 
            className="absolute inset-0 opacity-40 pointer-events-none"
            style={{
              background: 'radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0, 122, 255, 0.2) 0%, transparent 60%)',
              transform: `translateY(${scrollY * 0.3}px)`,
              transition: 'transform 0.1s ease-out'
            }}
          />
          
          <div className="relative z-10">
            {/* Badge */}
            <div className="flex justify-center mb-6 scroll-fade-in">
              <div 
                className="inline-flex items-center gap-2 px-4 py-2 rounded-full"
                style={{
                  background: 'rgba(0, 122, 255, 0.1)',
                  border: '1px solid rgba(0, 122, 255, 0.2)',
                  backdropFilter: 'blur(20px)'
                }}
              >
                <Sparkles className="w-4 h-4 text-[#007AFF]" />
                <span 
                  style={{
                    fontSize: '13px',
                    fontWeight: 600,
                    color: '#007AFF',
                    letterSpacing: '0.02em'
                  }}
                >
                  ИИ + TELEGRAM
                </span>
              </div>
            </div>

            {/* Hero headline - Apple SF Pro style */}
            <h1 
              className="text-center mb-5 scroll-fade-in-delay-1"
              style={{ 
                fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',
                fontSize: 'clamp(40px, 11vw, 52px)',
                fontWeight: 700,
                letterSpacing: '-0.05em',
                lineHeight: '1.05',
                background: 'linear-gradient(180deg, #FFFFFF 0%, rgba(255, 255, 255, 0.7) 100%)',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                backgroundClip: 'text'
              }}
            >
              От идеи до
              <br />
              запуска за
              <br />
              24 часа
            </h1>
            
            {/* Subtitle */}
            <p 
              className="text-center mb-3 scroll-fade-in-delay-2"
              style={{
                fontSize: '19px',
                lineHeight: '1.42',
                fontWeight: 400,
                color: 'rgba(255, 255, 255, 0.65)',
                letterSpacing: '-0.015em'
              }}
            >
              Разработка Telegram Mini App
              <br />
              с интеграцией ИИ агента
            </p>

            {/* CTA Button */}
            <div className="flex justify-center mb-8 scroll-fade-in-delay-3">
              <a
                href="https://t.me/web4tgs"
                target="_blank"
                rel="noopener noreferrer"
                className="group relative inline-flex items-center gap-3 px-8 py-4 rounded-full font-semibold transition-all duration-300 active:scale-[0.97]"
                style={{
                  background: 'linear-gradient(135deg, #007AFF 0%, #0051D5 100%)',
                  color: '#FFFFFF',
                  fontSize: '17px',
                  letterSpacing: '-0.01em',
                  boxShadow: '0 8px 32px rgba(0, 122, 255, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1) inset'
                }}
                data-testid="button-consultation"
              >
                <MessageSquare className="w-5 h-5" />
                Получить консультацию
                <ArrowRight className="w-5 h-5 transition-transform group-hover:translate-x-1" />
              </a>
            </div>

            {/* Stats Row */}
            <div className="flex justify-center gap-8 mb-8 scroll-fade-in-delay-4">
              <StatBadge number="900M+" label="пользователей" />
              <StatBadge number="24/7" label="поддержка" />
              <StatBadge number="100%" label="автоматизация" />
            </div>
          </div>
        </section>

        {/* Process Steps - Premium Cards */}
        <section className="px-6 py-6 space-y-5">
          
          <ProcessStepPremium
            number="1"
            title="Разработка приложения"
            description="Создаём Telegram Mini App с современным дизайном и удобной навигацией"
            duration="7-14 дней"
            accentGradient="linear-gradient(135deg, #007AFF 0%, #0051D5 100%)"
            icon={<Smartphone className="w-6 h-6" />}
            features={[
              "Адаптивный дизайн",
              "Быстрая загрузка",
              "Полная интеграция с Telegram"
            ]}
          />

          <ProcessStepPremium
            number="2"
            title="Внедрение ИИ агента"
            description="Интегрируем умного ассистента с пониманием контекста вашего бизнеса"
            duration="3-5 дней"
            accentGradient="linear-gradient(135deg, #BF5AF2 0%, #8E2DE2 100%)"
            icon={<Bot className="w-6 h-6" />}
            features={[
              "Обучение на ваших данных",
              "150+ языков",
              "Умная аналитика"
            ]}
          />

          <ProcessStepPremium
            number="3"
            title="Настройка и обучение"
            description="Обучаем систему вашим процессам и оптимизируем работу"
            duration="2-3 дня"
            accentGradient="linear-gradient(135deg, #FF9F0A 0%, #FF6B00 100%)"
            icon={<Zap className="w-6 h-6" />}
            features={[
              "Тонкая настройка",
              "Тестирование сценариев",
              "Обучение команды"
            ]}
          />

          <ProcessStepPremium
            number="4"
            title="Запуск и поддержка"
            description="Мягкий запуск с мониторингом и бесплатной поддержкой"
            duration="7 дней"
            accentGradient="linear-gradient(135deg, #34C759 0%, #30D158 100%)"
            icon={<Rocket className="w-6 h-6" />}
            features={[
              "Постепенный запуск",
              "Мониторинг 24/7",
              "Месяц поддержки"
            ]}
          />

        </section>

        {/* Benefits - Glass Card */}
        <section className="px-6 py-8">
          <h2 
            className="text-center mb-8"
            style={{
              fontSize: '32px',
              fontWeight: 700,
              letterSpacing: '-0.04em',
              color: '#FFFFFF',
              lineHeight: '1.1'
            }}
          >
            Что вы
            <br />
            получите
          </h2>
          
          <div 
            className="rounded-[28px] p-8 space-y-5"
            style={{
              background: 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.03) 100%)',
              backdropFilter: 'blur(40px) saturate(180%)',
              border: '0.5px solid rgba(255, 255, 255, 0.15)',
              boxShadow: `
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 20px 60px rgba(0, 0, 0, 0.4),
                0 2px 8px rgba(0, 0, 0, 0.25)
              `
            }}
          >
            <BenefitItemPremium text="Telegram Mini App с премиум дизайном" />
            <BenefitItemPremium text="ИИ агент с глубоким пониманием бизнеса" />
            <BenefitItemPremium text="Автоматизация поддержки клиентов" />
            <BenefitItemPremium text="Аналитика и инсайты в реальном времени" />
            <BenefitItemPremium text="Месяц бесплатной технической поддержки" />
            <BenefitItemPremium text="Регулярные обновления и улучшения" />
          </div>
        </section>

        {/* Why Telegram - Feature Grid */}
        <section className="px-6 py-8">
          <h2 
            className="text-center mb-8"
            style={{
              fontSize: '32px',
              fontWeight: 700,
              letterSpacing: '-0.04em',
              color: '#FFFFFF',
              lineHeight: '1.1'
            }}
          >
            Почему
            <br />
            Telegram?
          </h2>
          
          <div className="space-y-4">
            <WhyFeatureCard
              icon="🌍"
              title="900M+ активных пользователей"
              description="Ваши клиенты уже здесь. Не нужно их убеждать установить новое приложение."
            />
            <WhyFeatureCard
              icon="⚡️"
              title="Мгновенный доступ"
              description="Открывается прямо в Telegram. Без установки, без регистрации, без трения."
            />
            <WhyFeatureCard
              icon="🔔"
              title="Нативные уведомления"
              description="100% доставка сообщений. Ваши клиенты всегда в курсе важных событий."
            />
          </div>
        </section>

        {/* CTA Section - Premium */}
        <section className="px-6 py-12">
          <div 
            className="rounded-[28px] p-8 text-center relative overflow-hidden"
            style={{
              background: 'linear-gradient(135deg, rgba(0, 122, 255, 0.15) 0%, rgba(88, 86, 214, 0.15) 100%)',
              backdropFilter: 'blur(20px)',
              border: '1px solid rgba(0, 122, 255, 0.3)',
              boxShadow: '0 20px 60px rgba(0, 122, 255, 0.2)'
            }}
          >
            {/* Animated glow */}
            <div 
              className="absolute inset-0 opacity-30"
              style={{
                background: 'radial-gradient(circle at 50% 0%, rgba(0, 122, 255, 0.4) 0%, transparent 70%)',
                animation: 'pulse 3s ease-in-out infinite'
              }}
            />
            
            <div className="relative z-10">
              <h3 
                style={{
                  fontSize: '28px',
                  fontWeight: 700,
                  letterSpacing: '-0.03em',
                  color: '#FFFFFF',
                  marginBottom: '12px'
                }}
              >
                Готовы начать?
              </h3>
              
              <p 
                style={{
                  fontSize: '17px',
                  lineHeight: '1.47',
                  color: 'rgba(255, 255, 255, 0.7)',
                  marginBottom: '24px'
                }}
              >
                Обсудим ваш проект и рассчитаем
                <br />
                точную стоимость за 15 минут
              </p>

              <button
                onClick={handleGetConsultation}
                className="w-full py-4 bg-white text-black font-semibold rounded-full transition-all duration-200 active:scale-[0.97] mb-3 group"
                style={{
                  fontSize: '17px',
                  letterSpacing: '-0.02em',
                  boxShadow: '0 4px 24px rgba(255, 255, 255, 0.25)',
                  border: 'none'
                }}
                data-testid="button-get-consultation"
              >
                <span className="flex items-center justify-center gap-2">
                  Получить консультацию
                  <ArrowRight className="w-5 h-5 transition-transform group-active:translate-x-1" />
                </span>
              </button>
              
              <p 
                style={{
                  fontSize: '13px',
                  color: 'rgba(255, 255, 255, 0.5)',
                  letterSpacing: '0.01em'
                }}
              >
                Бесплатная консультация · Расчёт стоимости · Без обязательств
              </p>
            </div>
          </div>
        </section>

      </div>
    </div>
  );
});

AIProcessPage.displayName = 'AIProcessPage';

// Stat Badge Component
const StatBadge = memo(({ number, label }: { number: string; label: string }) => (
  <div className="text-center">
    <div 
      style={{
        fontSize: '24px',
        fontWeight: 700,
        letterSpacing: '-0.03em',
        color: '#FFFFFF',
        lineHeight: '1',
        marginBottom: '4px'
      }}
    >
      {number}
    </div>
    <div 
      style={{
        fontSize: '12px',
        color: 'rgba(255, 255, 255, 0.5)',
        letterSpacing: '0.02em',
        textTransform: 'uppercase'
      }}
    >
      {label}
    </div>
  </div>
));
StatBadge.displayName = 'StatBadge';

// Premium Process Step Component
const ProcessStepPremium = memo(({ 
  number,
  title,
  description,
  duration,
  accentGradient,
  icon,
  features
}: { 
  number: string;
  title: string;
  description: string;
  duration: string;
  accentGradient: string;
  icon: React.ReactNode;
  features: string[];
}) => (
  <div 
    className="rounded-[24px] p-6 relative overflow-hidden group interactive-smooth active:scale-[0.98]"
    style={{
      background: 'rgba(255, 255, 255, 0.04)',
      backdropFilter: 'blur(20px)',
      border: '0.5px solid rgba(255, 255, 255, 0.1)',
      boxShadow: '0 4px 16px rgba(0, 0, 0, 0.25)',
      transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)'
    }}
  >
    {/* Gradient accent line */}
    <div 
      className="absolute top-0 left-0 right-0 h-1 opacity-60"
      style={{
        background: accentGradient
      }}
    />

    {/* Icon Badge */}
    <div className="flex items-start gap-4 mb-4">
      <div 
        className="flex-shrink-0 flex items-center justify-center rounded-2xl"
        style={{
          width: '56px',
          height: '56px',
          background: accentGradient,
          boxShadow: '0 8px 24px rgba(0, 0, 0, 0.3)'
        }}
      >
        <div style={{ color: 'white' }}>
          {icon}
        </div>
      </div>
      
      <div className="flex-1 pt-1">
        <div className="flex items-center justify-between mb-2">
          <h3 
            style={{
              fontSize: '20px',
              fontWeight: 700,
              letterSpacing: '-0.02em',
              color: '#FFFFFF'
            }}
          >
            {title}
          </h3>
          <div 
            className="px-3 py-1.5 rounded-full shrink-0"
            style={{
              background: 'rgba(255, 255, 255, 0.1)',
              fontSize: '13px',
              color: 'rgba(255, 255, 255, 0.8)',
              fontWeight: 600
            }}
          >
            {duration}
          </div>
        </div>
        <p 
          style={{
            fontSize: '15px',
            lineHeight: '1.5',
            color: 'rgba(255, 255, 255, 0.65)',
            letterSpacing: '-0.01em',
            marginBottom: '16px'
          }}
        >
          {description}
        </p>

        {/* Features list */}
        <div className="space-y-2">
          {features.map((feature, index) => (
            <div key={index} className="flex items-center gap-2">
              <div 
                className="w-1.5 h-1.5 rounded-full"
                style={{ background: accentGradient }}
              />
              <span 
                style={{
                  fontSize: '14px',
                  color: 'rgba(255, 255, 255, 0.6)',
                  letterSpacing: '-0.01em'
                }}
              >
                {feature}
              </span>
            </div>
          ))}
        </div>
      </div>
    </div>

    {/* Large number background */}
    <div 
      className="absolute -bottom-4 -right-4 opacity-5 select-none pointer-events-none"
      style={{
        fontSize: '120px',
        fontWeight: 900,
        color: '#FFFFFF',
        lineHeight: '1'
      }}
    >
      {number}
    </div>
  </div>
));
ProcessStepPremium.displayName = 'ProcessStepPremium';

// Premium Benefit Item
const BenefitItemPremium = memo(({ text }: { text: string }) => (
  <div className="flex items-center gap-3 group">
    <div 
      className="flex-shrink-0 flex items-center justify-center rounded-full transition-transform group-hover:scale-110"
      style={{
        width: '28px',
        height: '28px',
        background: 'linear-gradient(135deg, rgba(52, 199, 89, 0.3) 0%, rgba(48, 209, 88, 0.3) 100%)',
        border: '1px solid rgba(52, 199, 89, 0.3)'
      }}
    >
      <Check className="w-4 h-4 text-[#34C759]" />
    </div>
    <p 
      style={{
        fontSize: '16px',
        lineHeight: '1.5',
        color: 'rgba(255, 255, 255, 0.9)',
        letterSpacing: '-0.01em',
        fontWeight: 500
      }}
    >
      {text}
    </p>
  </div>
));
BenefitItemPremium.displayName = 'BenefitItemPremium';

// Why Feature Card
const WhyFeatureCard = memo(({ 
  icon, 
  title, 
  description 
}: { 
  icon: string; 
  title: string; 
  description: string;
}) => (
  <div 
    className="rounded-[20px] p-5 interactive-smooth active:scale-[0.98]"
    style={{
      background: 'rgba(255, 255, 255, 0.04)',
      backdropFilter: 'blur(10px)',
      border: '0.5px solid rgba(255, 255, 255, 0.1)',
      transition: 'all 0.3s ease'
    }}
  >
    <div className="flex gap-4">
      <div 
        style={{
          fontSize: '32px',
          lineHeight: '1',
          flexShrink: 0
        }}
      >
        {icon}
      </div>
      <div className="flex-1">
        <h4 
          style={{
            fontSize: '17px',
            fontWeight: 600,
            color: '#FFFFFF',
            marginBottom: '6px',
            letterSpacing: '-0.02em'
          }}
        >
          {title}
        </h4>
        <p 
          style={{
            fontSize: '15px',
            lineHeight: '1.5',
            color: 'rgba(255, 255, 255, 0.6)',
            letterSpacing: '-0.01em'
          }}
        >
          {description}
        </p>
      </div>
    </div>
  </div>
));
WhyFeatureCard.displayName = 'WhyFeatureCard';

export default AIProcessPage;
```

### components/AnimatedBusinessIcons.tsx
```tsx
import React from 'react';

// Иконка - Магазин ОДЕЖДЫ (сумка для покупок)
export const ClothingIcon = () => (
  <svg width="100" height="100" viewBox="0 0 120 120" className="animated-clothing-icon" style={{display: 'block'}}>
    <defs>
      <linearGradient id="bagGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stopColor="rgba(255,255,255,1)" />
        <stop offset="100%" stopColor="rgba(255,255,255,0.85)" />
      </linearGradient>
    </defs>
    
    <style>{`
      @keyframes bagSwing {
        0%, 100% { transform: rotate(-2deg); }
        50% { transform: rotate(2deg); }
      }
      @keyframes badgePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
      @keyframes sparkle {
        0%, 100% { opacity: 0.4; transform: scale(0.8); }
        50% { opacity: 1; transform: scale(1.2); }
      }
      .bag { animation: bagSwing 3s ease-in-out infinite; transform-origin: 60px 35px; }
      .badge { animation: badgePulse 2s ease-in-out infinite; }
      .sparkle { animation: sparkle 2s ease-in-out infinite; }
    `}</style>
    
    {/* Сумка для покупок */}
    <g className="bag">
      {/* Основа сумки */}
      <path d="M 35 45 L 30 85 C 30 88, 33 90, 36 90 L 84 90 C 87 90, 90 88, 90 85 L 85 45 Z" 
            fill="url(#bagGradient)" 
            stroke="rgba(255,255,255,0.5)" 
            strokeWidth="1.5" />
      
      {/* Верхний край сумки */}
      <rect x="30" y="42" width="60" height="5" rx="1" fill="rgba(255,255,255,0.9)" stroke="rgba(255,255,255,0.6)" strokeWidth="0.8" />
      
      {/* Ручки */}
      <path d="M 45 45 Q 45 30, 52 28 Q 60 27, 60 35" 
            stroke="rgba(255,255,255,0.95)" 
            strokeWidth="3" 
            fill="none" 
            strokeLinecap="round" />
      <path d="M 75 45 Q 75 30, 68 28 Q 60 27, 60 35" 
            stroke="rgba(255,255,255,0.95)" 
            strokeWidth="3" 
            fill="none" 
            strokeLinecap="round" />
      
      {/* Декор на сумке */}
      <circle cx="60" cy="65" r="10" fill="rgba(77, 208, 225, 0.3)" stroke="rgba(77, 208, 225, 0.6)" strokeWidth="1.5" />
      <path d="M 54 65 L 58 69 L 66 61" stroke="white" strokeWidth="2.5" fill="none" strokeLinecap="round" strokeLinejoin="round" />
      
      {/* Складки на сумке */}
      <line x1="42" y1="50" x2="40" y2="82" stroke="rgba(255,255,255,0.3)" strokeWidth="1" />
      <line x1="78" y1="50" x2="80" y2="82" stroke="rgba(255,255,255,0.3)" strokeWidth="1" />
    </g>
    
    {/* Значок скидки */}
    <g className="badge">
      <circle cx="85" cy="50" r="12" fill="rgba(239, 83, 80, 0.95)" stroke="white" strokeWidth="1.5" />
      <text x="85" y="54" fontSize="10" fontWeight="bold" fill="white" textAnchor="middle">-50%</text>
    </g>
    
    {/* Звездочки */}
    <g className="sparkle" style={{animationDelay: '0s'}}>
      <path d="M 20 50 l 2 5 l 5 2 l -5 2 l -2 5 l -2 -5 l -5 -2 l 5 -2 Z" fill="white" opacity="0.9" />
    </g>
    <g className="sparkle" style={{animationDelay: '0.6s'}}>
      <path d="M 100 70 l 1.5 4 l 4 1.5 l -4 1.5 l -1.5 4 l -1.5 -4 l -4 -1.5 l 4 -1.5 Z" fill="white" opacity="0.85" />
    </g>
  </svg>
);

// Иконка - ЭЛЕКТРОНИКА (ноутбук)
export const ElectronicsIcon = () => (
  <svg width="100" height="100" viewBox="0 0 120 120" className="animated-electronics-icon" style={{display: 'block'}}>

    <defs>
      <linearGradient id="laptopGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stopColor="rgba(255,255,255,0.95)" />
        <stop offset="100%" stopColor="rgba(255,255,255,0.8)" />
      </linearGradient>
      <linearGradient id="screenGlow" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stopColor="rgba(16, 185, 129, 0.5)" />
        <stop offset="100%" stopColor="rgba(16, 185, 129, 0.2)" />
      </linearGradient>
    </defs>
    
    <style>{`
      @keyframes screenFlicker {
        0%, 100% { opacity: 0.4; }
        50% { opacity: 1; }
      }
      @keyframes typingDots {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 1; }
      }
      @keyframes powerPulse {
        0%, 100% { opacity: 0.5; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.2); }
      }
      .screen-content { animation: screenFlicker 3s ease-in-out infinite; }
      .typing { animation: typingDots 1.5s ease-in-out infinite; }
      .power-light { animation: powerPulse 2s ease-in-out infinite; }
    `}</style>
    
    {/* Экран ноутбука */}
    <rect x="25" y="20" width="70" height="50" rx="3" fill="url(#laptopGradient)" stroke="rgba(255,255,255,0.6)" strokeWidth="2" />
    <rect x="28" y="23" width="64" height="44" rx="2" fill="url(#screenGlow)" className="screen-content" />
    
    {/* Контент на экране - код/интерфейс */}
    <g opacity="0.8">
      <rect x="33" y="28" width="16" height="3" rx="1.5" fill="rgba(255,255,255,0.5)" />
      <rect x="33" y="34" width="24" height="3" rx="1.5" fill="rgba(255,255,255,0.4)" />
      <rect x="33" y="40" width="20" height="3" rx="1.5" fill="rgba(255,255,255,0.5)" />
      <rect x="33" y="46" width="28" height="3" rx="1.5" fill="rgba(255,255,255,0.4)" />
      
      {/* Иконки приложений */}
      <rect x="65" y="28" width="10" height="10" rx="2" fill="rgba(255,255,255,0.4)" />
      <rect x="78" y="28" width="10" height="10" rx="2" fill="rgba(255,255,255,0.35)" />
      <rect x="65" y="41" width="10" height="10" rx="2" fill="rgba(255,255,255,0.4)" />
      <rect x="78" y="41" width="10" height="10" rx="2" fill="rgba(255,255,255,0.35)" />
    </g>
    
    {/* Камера */}
    <circle cx="60" cy="24" r="1.5" fill="rgba(16, 185, 129, 0.6)" />
    
    {/* База ноутбука */}
    <path d="M 20 72 L 25 72 L 30 70 L 90 70 L 95 72 L 100 72 L 95 78 L 25 78 Z" 
          fill="url(#laptopGradient)" 
          stroke="rgba(255,255,255,0.5)" 
          strokeWidth="1" />
    
    {/* Клавиатура */}
    <g opacity="0.6">
      {[0, 1, 2, 3, 4].map((row) => (
        <g key={row}>
          {[0, 1, 2, 3, 4, 5, 6, 7, 8].map((col) => (
            <rect 
              key={`${row}-${col}`}
              x={35 + col * 5.5} 
              y={73 + row * 1} 
              width="4" 
              height="0.8" 
              rx="0.3"
              fill="rgba(255,255,255,0.3)" 
            />
          ))}
        </g>
      ))}
    </g>
    
    {/* Тачпад */}
    <rect x="52" y="74" width="16" height="10" rx="1" fill="rgba(255,255,255,0.2)" />
    
    {/* Индикатор питания */}
    <circle cx="38" cy="76" r="1.5" fill="rgba(16, 185, 129, 0.8)" className="power-light" />
    
    {/* Печатающиеся точки */}
    <g className="typing" style={{animationDelay: '0s'}}>
      <circle cx="35" cy="52" r="1" fill="rgba(255,255,255,0.6)" />
    </g>
    <g className="typing" style={{animationDelay: '0.3s'}}>
      <circle cx="40" cy="52" r="1" fill="rgba(255,255,255,0.6)" />
    </g>
    <g className="typing" style={{animationDelay: '0.6s'}}>
      <circle cx="45" cy="52" r="1" fill="rgba(255,255,255,0.6)" />
    </g>
  </svg>
);

// Иконка - САЛОН КРАСОТЫ (зеркало с косметикой)
export const BeautyIcon = () => (
  <svg width="100" height="100" viewBox="0 0 120 120" className="animated-beauty-icon" style={{display: 'block'}}>
    <defs>
      <radialGradient id="mirrorGradient">
        <stop offset="0%" stopColor="rgba(255,255,255,0.95)" />
        <stop offset="100%" stopColor="rgba(255,255,255,0.7)" />
      </radialGradient>
      <filter id="mirrorShine">
        <feGaussianBlur stdDeviation="2"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    
    <style>{`
      @keyframes mirrorShine {
        0%, 100% { opacity: 0.3; transform: translateX(-10px); }
        50% { opacity: 0.8; transform: translateX(10px); }
      }
      @keyframes lipstickTwist {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-3px); }
      }
      @keyframes brushRotate {
        0%, 100% { transform: rotate(-5deg); }
        50% { transform: rotate(5deg); }
      }
      @keyframes sparkle {
        0%, 100% { opacity: 0.4; transform: scale(0.8); }
        50% { opacity: 1; transform: scale(1.2); }
      }
      .shine { animation: mirrorShine 3s ease-in-out infinite; }
      .lipstick { animation: lipstickTwist 2s ease-in-out infinite; }
      .brush { animation: brushRotate 3s ease-in-out infinite; transform-origin: 25px 55px; }
      .sparkle { animation: sparkle 2s ease-in-out infinite; }
    `}</style>
    
    {/* Зеркало */}
    <ellipse cx="60" cy="50" rx="32" ry="38" fill="url(#mirrorGradient)" filter="url(#mirrorShine)" stroke="rgba(255,255,255,0.8)" strokeWidth="2.5" />
    <ellipse cx="60" cy="50" rx="28" ry="34" fill="rgba(77, 208, 225, 0.15)" />
    
    {/* Блеск на зеркале */}
    <ellipse cx="50" cy="35" rx="15" ry="20" fill="rgba(255,255,255,0.4)" className="shine" />
    
    {/* Ножка зеркала */}
    <rect x="57" y="85" width="6" height="8" rx="1" fill="rgba(255,255,255,0.85)" />
    <ellipse cx="60" cy="85" rx="8" ry="3" fill="rgba(255,255,255,0.8)" />
    
    {/* Помада слева */}
    <g className="lipstick">
      <rect x="20" y="65" width="8" height="18" rx="1" fill="rgba(239, 83, 80, 0.9)" stroke="rgba(255,255,255,0.6)" strokeWidth="0.8" />
      <rect x="21" y="62" width="6" height="4" rx="1" fill="rgba(239, 83, 80, 1)" />
      <ellipse cx="24" cy="62" rx="3" ry="1.5" fill="rgba(255,100,100,1)" />
    </g>
    
    {/* Кисточка справа */}
    <g className="brush">
      <rect x="23" y="50" width="4" height="22" rx="0.5" fill="rgba(255,255,255,0.85)" />
      <ellipse cx="25" cy="50" rx="4" ry="6" fill="rgba(255,255,255,0.7)" />
      <path d="M 21 48 Q 25 44, 29 48" fill="rgba(255,255,255,0.6)" />
    </g>
    
    {/* Тени для век */}
    <g transform="translate(88, 60)">
      <rect x="0" y="0" width="14" height="10" rx="2" fill="rgba(255,255,255,0.8)" stroke="rgba(255,255,255,0.6)" strokeWidth="0.8" />
      <rect x="2" y="2" width="4" height="6" rx="1" fill="rgba(239, 83, 80, 0.5)" />
      <rect x="7" y="2" width="4" height="6" rx="1" fill="rgba(77, 208, 225, 0.5)" />
      <line x1="6" y1="2" x2="6" y2="8" stroke="rgba(255,255,255,0.4)" strokeWidth="0.5" />
    </g>
    
    {/* Блестки вокруг */}
    <g className="sparkle" style={{animationDelay: '0s'}}>
      <path d="M 35 25 l 2 5 l 5 2 l -5 2 l -2 5 l -2 -5 l -5 -2 l 5 -2 Z" fill="white" opacity="0.9" />
    </g>
    <g className="sparkle" style={{animationDelay: '0.6s'}}>
      <path d="M 85 30 l 2 5 l 5 2 l -5 2 l -2 5 l -2 -5 l -5 -2 l 5 -2 Z" fill="white" opacity="0.85" />
    </g>
    <g className="sparkle" style={{animationDelay: '1.2s'}}>
      <path d="M 75 70 l 1.5 4 l 4 1.5 l -4 1.5 l -1.5 4 l -1.5 -4 l -4 -1.5 l 4 -1.5 Z" fill="white" opacity="0.8" />
    </g>
    <g className="sparkle" style={{animationDelay: '1.8s'}}>
      <path d="M 40 75 l 1.5 4 l 4 1.5 l -4 1.5 l -1.5 4 l -1.5 -4 l -4 -1.5 l 4 -1.5 Z" fill="white" opacity="0.8" />
    </g>
  </svg>
);

// Иконка - РЕСТОРАН (клош с паром)
export const RestaurantIcon = () => (
  <svg width="100" height="100" viewBox="0 0 120 120" className="animated-restaurant-icon" style={{display: 'block'}}>
    <defs>
      <linearGradient id="cloche Gradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stopColor="rgba(255,255,255,1)" />
        <stop offset="50%" stopColor="rgba(255,255,255,0.9)" />
        <stop offset="100%" stopColor="rgba(255,255,255,0.75)" />
      </linearGradient>
      <radialGradient id="plateGlow">
        <stop offset="0%" stopColor="rgba(16, 185, 129, 0.3)" />
        <stop offset="100%" stopColor="rgba(16, 185, 129, 0.1)" />
      </radialGradient>
    </defs>
    
    <style>{`
      @keyframes steamFloat {
        0% { opacity: 0.8; transform: translateY(0) scale(0.9); }
        100% { opacity: 0; transform: translateY(-30px) scale(1.4); }
      }
      @keyframes clocheFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-4px); }
      }
      @keyframes shine {
        0%, 100% { opacity: 0.2; }
        50% { opacity: 0.6; }
      }
      .steam { animation: steamFloat 2.5s ease-out infinite; }
      .cloche { animation: clocheFloat 3s ease-in-out infinite; }
      .shine-effect { animation: shine 3s ease-in-out infinite; }
    `}</style>
    
    {/* Основание - тарелка */}
    <ellipse cx="60" cy="75" rx="42" ry="8" fill="rgba(255,255,255,0.9)" stroke="rgba(255,255,255,0.7)" strokeWidth="1.5" />
    <ellipse cx="60" cy="75" rx="38" ry="6" fill="url(#plateGlow)" />
    
    {/* Клош (крышка) */}
    <g className="cloche">
      <path d="M 30 70 Q 30 35, 60 25 Q 90 35, 90 70 Z" 
            fill="url(#clocheGradient)" 
            stroke="rgba(255,255,255,0.6)" 
            strokeWidth="1.5" />
      
      {/* Блеск на клоше */}
      <ellipse cx="50" cy="45" rx="12" ry="18" fill="rgba(255,255,255,0.3)" className="shine-effect" />
      
      {/* Ручка клоша */}
      <ellipse cx="60" cy="25" rx="5" ry="3" fill="rgba(255,255,255,0.95)" stroke="rgba(255,255,255,0.7)" strokeWidth="0.8" />
      <rect x="58" y="22" width="4" height="5" rx="1" fill="rgba(255,255,255,0.9)" />
      <circle cx="60" cy="22" r="2.5" fill="rgba(77, 208, 225, 0.4)" />
    </g>
    
    {/* Пар, выходящий сверху */}
    <g className="steam" style={{animationDelay: '0s'}}>
      <path d="M 52 20 Q 50 12, 52 4" stroke="rgba(255,255,255,0.9)" strokeWidth="3" fill="none" strokeLinecap="round" />
    </g>
    <g className="steam" style={{animationDelay: '0.5s'}}>
      <path d="M 60 18 Q 58 10, 60 2" stroke="rgba(255,255,255,0.9)" strokeWidth="3" fill="none" strokeLinecap="round" />
    </g>
    <g className="steam" style={{animationDelay: '1s'}}>
      <path d="M 68 20 Q 70 12, 68 4" stroke="rgba(255,255,255,0.9)" strokeWidth="3" fill="none" strokeLinecap="round" />
    </g>
    <g className="steam" style={{animationDelay: '1.5s'}}>
      <path d="M 56 19 Q 54 11, 56 3" stroke="rgba(255,255,255,0.8)" strokeWidth="2.5" fill="none" strokeLinecap="round" />
    </g>
    <g className="steam" style={{animationDelay: '2s'}}>
      <path d="M 64 19 Q 66 11, 64 3" stroke="rgba(255,255,255,0.8)" strokeWidth="2.5" fill="none" strokeLinecap="round" />
    </g>
    
    {/* Декоративные звездочки свежести */}
    <g className="shine-effect" style={{animationDelay: '0s'}}>
      <path d="M 25 50 l 1.5 4 l 4 1.5 l -4 1.5 l -1.5 4 l -1.5 -4 l -4 -1.5 l 4 -1.5 Z" fill="white" opacity="0.8" />
    </g>
    <g className="shine-effect" style={{animationDelay: '0.8s'}}>
      <path d="M 95 45 l 1.5 4 l 4 1.5 l -4 1.5 l -1.5 4 l -1.5 -4 l -4 -1.5 l 4 -1.5 Z" fill="white" opacity="0.8" />
    </g>
  </svg>
);

// Иконка - ФИТНЕС (сердце с пульсом)
export const FitnessIcon = () => (
  <svg width="100" height="100" viewBox="0 0 120 120" className="animated-fitness-icon" style={{display: 'block'}}>
    <defs>
      <linearGradient id="heartGrad" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stopColor="rgba(239, 83, 80, 1)" />
        <stop offset="100%" stopColor="rgba(239, 83, 80, 0.7)" />
      </linearGradient>
      <filter id="heartGlow">
        <feGaussianBlur stdDeviation="3"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    
    <style>{`
      @keyframes heartBeat {
        0%, 100% { transform: scale(1); }
        10% { transform: scale(1.15); }
        20% { transform: scale(1); }
        30% { transform: scale(1.1); }
        40%, 100% { transform: scale(1); }
      }
      @keyframes pulseWave {
        0% { opacity: 0; transform: translateX(-60px); }
        50% { opacity: 1; }
        100% { opacity: 0; transform: translateX(60px); }
      }
      @keyframes rateNumber {
        0%, 100% { opacity: 0.6; }
        50% { opacity: 1; }
      }
      .heart-main { animation: heartBeat 1.5s ease-in-out infinite; }
      .pulse-line { animation: pulseWave 2s ease-in-out infinite; }
      .bpm { animation: rateNumber 1.5s ease-in-out infinite; }
    `}</style>
    
    {/* Большое сердце */}
    <g className="heart-main">
      <path d="M 60 35 C 60 27, 52 20, 45 20 C 35 20, 30 27, 30 35 C 30 48, 60 70, 60 70 C 60 70, 90 48, 90 35 C 90 27, 85 20, 75 20 C 68 20, 60 27, 60 35 Z" 
            fill="url(#heartGrad)" 
            filter="url(#heartGlow)"
            stroke="rgba(255,255,255,0.8)" 
            strokeWidth="2" />
      
      {/* Блеск на сердце */}
      <ellipse cx="50" cy="32" rx="8" ry="12" fill="rgba(255,255,255,0.3)" />
    </g>
    
    {/* Линия пульса */}
    <g>
      <path d="M 15 55 L 35 55 L 40 48 L 45 62 L 50 45 L 55 55 L 105 55" 
            stroke="rgba(255,255,255,0.9)" 
            strokeWidth="2.5" 
            fill="none" 
            strokeLinecap="round" 
            strokeLinejoin="round" />
    </g>
    
    {/* Анимированная волна пульса */}
    <g className="pulse-line">
      <path d="M 0 55 L 20 55 L 25 48 L 30 62 L 35 45 L 40 55 L 60 55" 
            stroke="rgba(77, 208, 225, 0.8)" 
            strokeWidth="3" 
            fill="none" 
            strokeLinecap="round" 
            strokeLinejoin="round" />
    </g>
    
    {/* BPM индикатор */}
    <g className="bpm">
      <text x="60" y="90" fontSize="16" fontWeight="bold" fill="white" textAnchor="middle" opacity="0.9">
        120
      </text>
      <text x="60" y="102" fontSize="10" fill="rgba(255,255,255,0.7)" textAnchor="middle">
        BPM
      </text>
    </g>
    
    {/* Точки пульса */}
    <circle cx="40" cy="48" r="2.5" fill="rgba(77, 208, 225, 0.9)">
      <animate attributeName="r" values="2.5;3.5;2.5" dur="1.5s" repeatCount="indefinite" />
    </circle>
    <circle cx="45" cy="62" r="2.5" fill="rgba(77, 208, 225, 0.9)">
      <animate attributeName="r" values="2.5;3.5;2.5" dur="1.5s" begin="0.2s" repeatCount="indefinite" />
    </circle>
    <circle cx="50" cy="45" r="2.5" fill="rgba(77, 208, 225, 0.9)">
      <animate attributeName="r" values="2.5;3.5;2.5" dur="1.5s" begin="0.4s" repeatCount="indefinite" />
    </circle>
  </svg>
);

// Иконка - АВТОСЕРВИС (машина)
export const CarServiceIcon = () => (
  <svg width="100" height="100" viewBox="0 0 120 120" className="animated-carservice-icon" style={{display: 'block'}}>
    <defs>
      <linearGradient id="carGradient" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stopColor="rgba(255,255,255,1)" />
        <stop offset="100%" stopColor="rgba(255,255,255,0.8)" />
      </linearGradient>
      <radialGradient id="wheelGradient">
        <stop offset="0%" stopColor="rgba(100,100,100,0.8)" />
        <stop offset="100%" stopColor="rgba(150,150,150,0.6)" />
      </radialGradient>
    </defs>
    
    <style>{`
      @keyframes carFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-5px); }
      }
      @keyframes wheelSpin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      @keyframes wrenchFloat {
        0%, 100% { transform: translateY(0) rotate(-15deg); }
        50% { transform: translateY(-3px) rotate(-12deg); }
      }
      @keyframes sparkAnimate {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 1; }
      }
      .car-body { animation: carFloat 3s ease-in-out infinite; }
      .wheel { animation: wheelSpin 2s linear infinite; }
      .wrench { animation: wrenchFloat 2s ease-in-out infinite; }
      .spark { animation: sparkAnimate 1.5s ease-in-out infinite; }
    `}</style>
    
    {/* Корпус машины */}
    <g className="car-body">
      {/* Крыша и кабина */}
      <path d="M 35 45 L 40 35 L 70 35 L 75 45 Z" 
            fill="url(#carGradient)" 
            stroke="rgba(255,255,255,0.6)" 
            strokeWidth="1.5" />
      
      {/* Кузов */}
      <rect x="25" y="45" width="60" height="18" rx="3" 
            fill="url(#carGradient)" 
            stroke="rgba(255,255,255,0.6)" 
            strokeWidth="1.5" />
      
      {/* Окна */}
      <path d="M 42 37 L 45 40 L 52 40 L 52 37 Z" fill="rgba(77, 208, 225, 0.4)" />
      <path d="M 58 37 L 58 40 L 65 40 L 68 37 Z" fill="rgba(77, 208, 225, 0.4)" />
      
      {/* Фары */}
      <circle cx="28" cy="48" r="2.5" fill="rgba(255, 255, 200, 0.8)" />
      <circle cx="82" cy="48" r="2.5" fill="rgba(255, 255, 200, 0.8)" />
      
      {/* Решетка радиатора */}
      <rect x="78" y="50" width="6" height="8" rx="1" fill="rgba(150,150,150,0.5)" />
      <line x1="79" y1="52" x2="79" y2="56" stroke="rgba(255,255,255,0.3)" strokeWidth="0.5" />
      <line x1="81" y1="52" x2="81" y2="56" stroke="rgba(255,255,255,0.3)" strokeWidth="0.5" />
      <line x1="83" y1="52" x2="83" y2="56" stroke="rgba(255,255,255,0.3)" strokeWidth="0.5" />
      
      {/* Дверные ручки */}
      <rect x="48" y="52" width="4" height="2" rx="0.5" fill="rgba(200,200,200,0.7)" />
      <rect x="58" y="52" width="4" height="2" rx="0.5" fill="rgba(200,200,200,0.7)" />
    </g>
    
    {/* Колеса */}
    <g>
      {/* Заднее колесо */}
      <g className="wheel" style={{transformOrigin: '38px 63px'}}>
        <circle cx="38" cy="63" r="8" fill="url(#wheelGradient)" stroke="rgba(100,100,100,0.8)" strokeWidth="1.5" />
        <circle cx="38" cy="63" r="4" fill="rgba(150,150,150,0.7)" />
        <line x1="38" y1="55" x2="38" y2="71" stroke="rgba(255,255,255,0.3)" strokeWidth="1" />
        <line x1="30" y1="63" x2="46" y2="63" stroke="rgba(255,255,255,0.3)" strokeWidth="1" />
      </g>
      
      {/* Переднее колесо */}
      <g className="wheel" style={{transformOrigin: '72px 63px'}}>
        <circle cx="72" cy="63" r="8" fill="url(#wheelGradient)" stroke="rgba(100,100,100,0.8)" strokeWidth="1.5" />
        <circle cx="72" cy="63" r="4" fill="rgba(150,150,150,0.7)" />
        <line x1="72" y1="55" x2="72" y2="71" stroke="rgba(255,255,255,0.3)" strokeWidth="1" />
        <line x1="64" y1="63" x2="80" y2="63" stroke="rgba(255,255,255,0.3)" strokeWidth="1" />
      </g>
    </g>
    
    {/* Гаечный ключ */}
    <g className="wrench" style={{transformOrigin: '92px 30px'}}>
      <rect x="88" y="25" width="20" height="5" rx="1.5" 
            fill="rgba(255,255,255,0.9)" 
            stroke="rgba(255,255,255,0.7)" 
            strokeWidth="0.8" />
      <circle cx="88" cy="27.5" r="4" 
              fill="none" 
              stroke="rgba(255,255,255,0.9)" 
              strokeWidth="2" />
      <circle cx="88" cy="27.5" r="2.5" fill="rgba(77, 208, 225, 0.4)" />
    </g>
    
    {/* Искры ремонта */}
    <g className="spark" style={{animationDelay: '0s'}}>
      <circle cx="95" cy="40" r="2" fill="rgba(255, 179, 0, 0.8)" />
      <circle cx="95" cy="40" r="3.5" fill="rgba(255, 179, 0, 0.3)" />
    </g>
    <g className="spark" style={{animationDelay: '0.4s'}}>
      <circle cx="100" cy="35" r="1.5" fill="rgba(255, 179, 0, 0.7)" />
      <circle cx="100" cy="35" r="3" fill="rgba(255, 179, 0, 0.2)" />
    </g>
    <g className="spark" style={{animationDelay: '0.8s'}}>
      <circle cx="105" cy="32" r="1.8" fill="rgba(255, 179, 0, 0.75)" />
    </g>
  </svg>
);
```

### components/AnimatedProgress.tsx
```tsx
import { motion, useSpring, useTransform } from '@/utils/LazyMotionProvider';
import { useEffect } from 'react';
import { cn } from '@/lib/utils';

interface AnimatedProgressProps {
  value: number;
  max?: number;
  className?: string;
  showPercentage?: boolean;
  color?: 'emerald' | 'cyan' | 'amber' | 'rose' | 'purple';
  size?: 'sm' | 'md' | 'lg';
  animated?: boolean;
}

export function AnimatedProgress({
  value,
  max = 100,
  className = '',
  showPercentage = false,
  color = 'emerald',
  size = 'md',
  animated = true
}: AnimatedProgressProps) {
  const percentage = Math.min(100, Math.max(0, (value / max) * 100));
  
  const spring = useSpring(0, {
    stiffness: 100,
    damping: 30,
    restDelta: 0.001
  });

  const width = useTransform(spring, [0, 100], ['0%', '100%']);

  useEffect(() => {
    if (animated) {
      spring.set(percentage);
    }
  }, [percentage, spring, animated]);

  const getColorClasses = () => {
    switch (color) {
      case 'emerald':
        return 'bg-gradient-to-r from-emerald-500 to-emerald-600';
      case 'cyan':
        return 'bg-gradient-to-r from-cyan-500 to-cyan-600';
      case 'amber':
        return 'bg-gradient-to-r from-amber-500 to-amber-600';
      case 'rose':
        return 'bg-gradient-to-r from-rose-500 to-rose-600';
      case 'purple':
        return 'bg-gradient-to-r from-purple-500 to-purple-600';
    }
  };

  const getSizeClasses = () => {
    switch (size) {
      case 'sm':
        return 'h-1.5';
      case 'md':
        return 'h-2.5';
      case 'lg':
        return 'h-4';
    }
  };

  return (
    <div className={cn('relative', className)}>
      <div className={cn(
        'w-full rounded-full overflow-hidden bg-white/10',
        getSizeClasses()
      )}>
        <motion.div
          className={cn(
            'h-full rounded-full relative overflow-hidden',
            getColorClasses()
          )}
          style={{ width: animated ? width : `${percentage}%` }}
          data-testid="progress-bar"
        >
          {/* Animated shine effect */}
          <motion.div
            className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent"
            animate={{
              x: ['-100%', '200%']
            }}
            transition={{
              repeat: Infinity,
              duration: 2,
              ease: 'linear'
            }}
          />
        </motion.div>
      </div>

      {showPercentage && (
        <motion.div
          className="absolute -top-6 right-0 text-xs font-bold text-white"
          initial={{ opacity: 0, y: 5 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.2 }}
        >
          {Math.round(percentage)}%
        </motion.div>
      )}
    </div>
  );
}

interface CircularProgressProps {
  value: number;
  max?: number;
  size?: number;
  strokeWidth?: number;
  color?: 'emerald' | 'cyan' | 'amber' | 'rose' | 'purple';
  showPercentage?: boolean;
  className?: string;
}

export function CircularProgress({
  value,
  max = 100,
  size = 120,
  strokeWidth = 8,
  color = 'emerald',
  showPercentage = true,
  className = ''
}: CircularProgressProps) {
  const percentage = Math.min(100, Math.max(0, (value / max) * 100));
  const radius = (size - strokeWidth) / 2;
  const circumference = radius * 2 * Math.PI;
  const offset = circumference - (percentage / 100) * circumference;

  const spring = useSpring(circumference, {
    stiffness: 100,
    damping: 30
  });

  useEffect(() => {
    spring.set(offset);
  }, [offset, spring]);

  const getColorClass = () => {
    switch (color) {
      case 'emerald':
        return 'text-emerald-500';
      case 'cyan':
        return 'text-cyan-500';
      case 'amber':
        return 'text-amber-500';
      case 'rose':
        return 'text-rose-500';
      case 'purple':
        return 'text-purple-500';
    }
  };

  return (
    <div className={cn('relative inline-flex items-center justify-center', className)}>
      <svg
        width={size}
        height={size}
        className="transform -rotate-90"
      >
        {/* Background circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          fill="none"
          stroke="rgba(255, 255, 255, 0.1)"
          strokeWidth={strokeWidth}
        />
        
        {/* Progress circle */}
        <motion.circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          fill="none"
          stroke="currentColor"
          strokeWidth={strokeWidth}
          strokeLinecap="round"
          strokeDasharray={circumference}
          strokeDashoffset={spring}
          className={getColorClass()}
        />
      </svg>

      {showPercentage && (
        <div className="absolute inset-0 flex items-center justify-center">
          <motion.div
            className="text-center"
            initial={{ scale: 0.8, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            transition={{ delay: 0.2 }}
          >
            <div className="text-2xl font-bold text-white">
              {Math.round(percentage)}
            </div>
            <div className="text-xs text-white/60">%</div>
          </motion.div>
        </div>
      )}
    </div>
  );
}

interface LevelProgressProps {
  currentLevel: number;
  currentXP: number;
  xpToNextLevel: number;
  className?: string;
}

export function LevelProgress({
  currentLevel,
  currentXP,
  xpToNextLevel,
  className = ''
}: LevelProgressProps) {
  const percentage = (currentXP / xpToNextLevel) * 100;

  return (
    <div className={cn('space-y-3', className)}>
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-3">
          <motion.div
            className="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center font-bold text-white text-lg"
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
          >
            {currentLevel}
          </motion.div>
          <div>
            <div className="text-sm font-bold text-white">
              Уровень {currentLevel}
            </div>
            <div className="text-xs text-white/60">
              {currentXP.toLocaleString()} / {xpToNextLevel.toLocaleString()} XP
            </div>
          </div>
        </div>

        <motion.div
          className="w-12 h-12 rounded-xl border-2 border-emerald-500/30 bg-emerald-500/10 flex items-center justify-center font-bold text-emerald-400 text-lg"
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ delay: 0.3 }}
        >
          {currentLevel + 1}
        </motion.div>
      </div>

      <AnimatedProgress
        value={currentXP}
        max={xpToNextLevel}
        showPercentage
        size="lg"
      />
    </div>
  );
}
```

### components/BackHeader.tsx
```tsx
import { ChevronLeft } from "lucide-react";

interface BackHeaderProps {
  onBack: () => void;
  title?: string;
}

export function BackHeader({ onBack, title }: BackHeaderProps) {
  return (
    <div 
      className="sticky top-0 z-50 flex items-center gap-3 py-5 bg-background/80 backdrop-blur-xl border-b border-white/10"
      style={{
        paddingTop: 'calc(var(--tg-safe-area-top, 0px) + 20px)',
        paddingBottom: '20px',
        paddingLeft: 'calc(var(--tg-safe-area-left, 0px) + 56px)',
        paddingRight: 'calc(var(--tg-safe-area-right, 0px) + 16px)',
      }}
    >
      <button
        onClick={onBack}
        className="flex items-center gap-1.5 text-white/80 hover:text-white transition-colors"
        aria-label="Назад"
        data-testid="button-back"
      >
        <ChevronLeft className="w-5 h-5" />
        <span className="text-sm font-medium">Назад</span>
      </button>
      {title && (
        <span className="ml-auto text-white/60 text-sm">{title}</span>
      )}
    </div>
  );
}

export default BackHeader;
```

### components/Breadcrumbs.tsx
```tsx
import { ChevronRight } from 'lucide-react';
import { Link } from 'wouter';

export interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface BreadcrumbsProps {
  items: BreadcrumbItem[];
  className?: string;
}

export function Breadcrumbs({ items, className = '' }: BreadcrumbsProps) {
  return (
    <nav 
      className={`flex items-center space-x-2 text-sm ${className}`}
      aria-label="Breadcrumb"
    >
      {items.map((item, index) => {
        const isLast = index === items.length - 1;
        
        return (
          <div key={index} className="flex items-center space-x-2">
            {item.href && !isLast ? (
              <Link href={item.href}>
                <a 
                  className="text-white/60 hover:text-emerald-400 transition-colors"
                  data-testid={`breadcrumb-${index}`}
                >
                  {item.label}
                </a>
              </Link>
            ) : (
              <span 
                className={isLast ? 'text-white font-medium' : 'text-white/60'}
                aria-current={isLast ? 'page' : undefined}
                data-testid={`breadcrumb-${index}`}
              >
                {item.label}
              </span>
            )}
            
            {!isLast && (
              <ChevronRight className="w-4 h-4 text-white/40" />
            )}
          </div>
        );
      })}
    </nav>
  );
}
```

### components/BusinessCards.tsx
```tsx
import { Smartphone, Code, Zap, ArrowRight, Users, ShoppingCart } from "lucide-react";
import { Card3D } from './Card3D';
import { preloadDemo } from './demos/DemoRegistry';

interface BusinessCardsProps {
  onOpenDemo: (demoId: string) => void;
}

const businessApps = [
  {
    id: "clothing-store",
    title: "ÉLÉGANCE Fashion Store",
    subtitle: "Премиум Haute Couture 2025",
    description: "Роскошный интернет-магазин одежды",
    categories: ["PREMIUM", "NEW", "LUXURY"],
    icon: Smartphone,
    stats: "2,453+ запущено",
    visual: "smartphone"
  },
  {
    id: "electronics", 
    title: "Интернет-магазин под ключ",
    description: "Продажи с первого дня",
    categories: ["E-COMMERCE", "HOT"],
    icon: ShoppingCart,
    visual: "cart"
  },
  {
    id: "beauty",
    title: "AI-помощник для бизнеса",
    description: "24/7 автоматизация",
    categories: ["AI", "AUTOMATION"],
    icon: Code,
    visual: "gear"
  }
];

export default function BusinessCards({ onOpenDemo }: BusinessCardsProps) {
  return (
    <div className="grid grid-cols-2 gap-3 p-4">
      {/* Main Large Card */}
      <Card3D 
        className="col-span-2"
        onClick={() => onOpenDemo('clothing-store')}
        intensity={10}
      >
      <div 
        className="relative bg-black rounded-3xl p-6 overflow-hidden cursor-pointer group transition-all duration-300"
        onMouseEnter={() => preloadDemo('clothing-store')}
        onTouchStart={() => preloadDemo('clothing-store')}
        style={{
          backgroundImage: `
            radial-gradient(circle at 20% 20%, rgba(77, 208, 225, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(77, 208, 225, 0.03) 0%, transparent 50%),
            radial-gradient(circle at 40% 60%, rgba(77, 208, 225, 0.02) 0%, transparent 50%)
          `,
        }}
      >
        {/* Background Texture */}
        <div className="absolute inset-0 opacity-40" style={{
          backgroundImage: `
            radial-gradient(circle at 1px 1px, rgba(77, 208, 225, 0.15) 1px, transparent 0)
          `,
          backgroundSize: '30px 30px'
        }}></div>
        
        {/* Categories Pills */}
        <div className="relative z-10 flex flex-wrap gap-2 mb-4">
          {businessApps[0].categories.map((cat, index) => (
            <span key={index} className="px-3 py-1 bg-white/10 text-white text-xs font-medium rounded-full border border-white/20">
              {cat}
            </span>
          ))}
        </div>

        {/* Main Content */}
        <div className="relative z-10">
          <h2 className="text-white text-2xl font-bold mb-2 leading-tight">
            {businessApps[0].title}
          </h2>
          <h3 className="text-[#D4AF37] text-xl font-semibold mb-4">
            {businessApps[0].subtitle}
          </h3>
          
          <div className="flex items-end justify-between">
            <div>
              <p className="text-white/80 text-sm mb-2">{businessApps[0].description}</p>
              <div className="text-white text-lg font-bold">{businessApps[0].stats}</div>
            </div>
            
            {/* 3D Visual Element */}
            <div className="relative">
              <div 
                className="w-20 h-20 rounded-full bg-gradient-to-br from-[#4DD0E1] to-[#26C6DA] flex items-center justify-center shadow-lg"
                style={{
                  transform: 'perspective(100px) rotateX(10deg) rotateY(-10deg)',
                  boxShadow: '0 20px 40px rgba(77, 208, 225, 0.3), inset 0 2px 8px rgba(255,255,255,0.3)'
                }}
              >
                <Smartphone className="w-8 h-8 text-black" />
              </div>
            </div>
          </div>
        </div>

        {/* Arrow Indicator */}
        <div className="absolute top-4 right-4">
          <ArrowRight className="w-5 h-5 text-white/40 group-hover:text-[#4DD0E1] transition-colors" />
        </div>
      </div>
      </Card3D>

      {/* E-commerce Card */}
      <Card3D onClick={() => onOpenDemo('electronics')} intensity={12}>
      <div 
        className="relative bg-black rounded-3xl p-4 overflow-hidden cursor-pointer group transition-all duration-300"
        onMouseEnter={() => preloadDemo('electronics')}
        onTouchStart={() => preloadDemo('electronics')}
        style={{
          backgroundImage: `radial-gradient(circle at 70% 30%, rgba(255, 179, 0, 0.08) 0%, transparent 60%)`
        }}
      >
        <div className="absolute inset-0 opacity-20" style={{
          backgroundImage: `radial-gradient(circle at 1px 1px, rgba(255, 179, 0, 0.1) 1px, transparent 0)`,
          backgroundSize: '20px 20px'
        }}></div>
        
        <div className="relative z-10">
          <div className="flex flex-wrap gap-1 mb-3">
            {businessApps[1].categories.map((cat, index) => (
              <span key={index} className="px-2 py-1 bg-white/10 text-white text-xs font-medium rounded-full">
                {cat}
              </span>
            ))}
          </div>
          
          <h3 className="text-white text-lg font-bold mb-2 leading-tight">
            {businessApps[1].title}
          </h3>
          
          <p className="text-white/70 text-sm mb-4">{businessApps[1].description}</p>
          
          <div className="flex justify-center">
            <div 
              className="w-16 h-16 rounded-full bg-gradient-to-br from-[#FFB300] to-[#FFA000] flex items-center justify-center"
              style={{
                boxShadow: '0 15px 30px rgba(255, 179, 0, 0.25), inset 0 2px 6px rgba(255,255,255,0.2)'
              }}
            >
              <ShoppingCart className="w-6 h-6 text-black" />
            </div>
          </div>
        </div>
      </div>
      </Card3D>

      {/* Automation Card */}
      <Card3D onClick={() => onOpenDemo('beauty')} intensity={12}>
      <div 
        className="relative bg-black rounded-3xl p-4 overflow-hidden cursor-pointer group transition-all duration-300"
        onMouseEnter={() => preloadDemo('beauty')}
        onTouchStart={() => preloadDemo('beauty')}
        style={{
          backgroundImage: `radial-gradient(circle at 30% 70%, rgba(239, 83, 80, 0.06) 0%, transparent 60%)`
        }}
      >
        <div className="absolute inset-0 opacity-20" style={{
          backgroundImage: `radial-gradient(circle at 1px 1px, rgba(239, 83, 80, 0.1) 1px, transparent 0)`,
          backgroundSize: '20px 20px'
        }}></div>
        
        <div className="relative z-10">
          <div className="flex flex-wrap gap-1 mb-3">
            {businessApps[2].categories.map((cat, index) => (
              <span key={index} className="px-2 py-1 bg-white/10 text-white text-xs font-medium rounded-full">
                {cat}
              </span>
            ))}
          </div>
          
          <h3 className="text-white text-lg font-bold mb-2 leading-tight">
            {businessApps[2].title}
          </h3>
          
          <p className="text-white/70 text-sm mb-4">{businessApps[2].description}</p>
          
          <div className="flex justify-center">
            <div 
              className="w-16 h-16 rounded-full bg-gradient-to-br from-[#EF5350] to-[#E53935] flex items-center justify-center"
              style={{
                boxShadow: '0 15px 30px rgba(239, 83, 80, 0.25), inset 0 2px 6px rgba(255,255,255,0.2)'
              }}
            >
              <Code className="w-6 h-6 text-black" />
            </div>
          </div>
        </div>
      </div>
      </Card3D>
    </div>
  );
}```

### components/Card3D.tsx
```tsx
import { useRef, useState, useCallback, ReactNode } from 'react';

interface Card3DProps {
  children: ReactNode;
  className?: string;
  onClick?: () => void;
  intensity?: number;
}

export function Card3D({ children, className = '', onClick, intensity = 15 }: Card3DProps) {
  const cardRef = useRef<HTMLDivElement>(null);
  const [transform, setTransform] = useState('');

  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLDivElement>) => {
    if (!cardRef.current) return;
    
    const card = cardRef.current;
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;
    
    const rotateX = ((y - centerY) / centerY) * intensity;
    const rotateY = ((centerX - x) / centerX) * intensity;
    
    setTransform(`perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`);
  }, [intensity]);

  const handleTouchMove = useCallback((e: React.TouchEvent<HTMLDivElement>) => {
    if (!cardRef.current || e.touches.length === 0) return;
    
    const card = cardRef.current;
    const rect = card.getBoundingClientRect();
    const touch = e.touches[0];
    const x = touch.clientX - rect.left;
    const y = touch.clientY - rect.top;
    
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;
    
    const rotateX = ((y - centerY) / centerY) * intensity;
    const rotateY = ((centerX - x) / centerX) * intensity;
    
    setTransform(`perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`);
  }, [intensity]);

  const handleMouseLeave = useCallback(() => {
    setTransform('perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)');
  }, []);

  return (
    <div
      ref={cardRef}
      className={`transition-transform duration-200 ease-out ${className}`}
      style={{ 
        transform,
        transformStyle: 'preserve-3d',
        willChange: 'transform'
      }}
      onMouseMove={handleMouseMove}
      onTouchMove={handleTouchMove}
      onMouseLeave={handleMouseLeave}
      onTouchEnd={handleMouseLeave}
      onClick={onClick}
      role={onClick ? 'button' : undefined}
      tabIndex={onClick ? 0 : undefined}
      onKeyDown={onClick ? (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          onClick();
        }
      } : undefined}
    >
      {children}
    </div>
  );
}
```

### components/CheckoutPage.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { loadStripe } from "@stripe/stripe-js";
import { Elements, PaymentElement, useStripe, useElements } from "@stripe/react-stripe-js";
import { CreditCard, Lock, CheckCircle } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { useTelegram } from "@/hooks/useTelegram";
import { BackHeader } from "./BackHeader";

const stripePromise = import.meta.env.VITE_STRIPE_PUBLIC_KEY 
  ? loadStripe(import.meta.env.VITE_STRIPE_PUBLIC_KEY)
  : null;

interface CheckoutPageProps {
  selectedFeatures: any[];
  projectName: string;
  totalAmount: number;
  onBack: () => void;
  onSuccess: () => void;
}

const CheckoutForm = ({ totalAmount, projectName, selectedFeatures, onSuccess }: { 
  totalAmount: number; 
  projectName: string; 
  selectedFeatures: any[];
  onSuccess: () => void 
}) => {
  const stripe = useStripe();
  const elements = useElements();
  const { toast } = useToast();
  const { user } = useTelegram();
  const [isProcessing, setIsProcessing] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!stripe || !elements) {
      return;
    }

    setIsProcessing(true);

    try {
      const { error } = await stripe.confirmPayment({
        elements,
        confirmParams: {
          return_url: `${window.location.origin}/success`,
        },
        redirect: 'if_required'
      });

      if (error) {
        toast({
          title: "Ошибка оплаты",
          description: error.message,
          variant: "destructive",
        });
      } else {
        // Create project after successful payment
        try {
          const createProjectResponse = await fetch('/api/create-project', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              telegramId: user?.id?.toString(),
              projectName: projectName,
              projectType: 'custom',
              features: selectedFeatures.map(f => f.id),
              paymentIntentId: 'stripe_payment_' + Date.now()
            })
          });
          
          if (createProjectResponse.ok) {
            console.log('Project created successfully');
            toast({
              title: "Оплата успешна!",
              description: "Проект создан! Мы начнем разработку в течение 24 часов.",
            });
          } else {
            throw new Error('Failed to create project');
          }
        } catch (error) {
          console.error('Error creating project:', error);
          toast({
            title: "Оплата успешна!",
            description: "Спасибо за заказ! Мы свяжемся с вами в течение 24 часов.",
          });
        }
        
        onSuccess();
      }
    } catch (err) {
      toast({
        title: "Ошибка",
        description: "Произошла ошибка при обработке платежа",
        variant: "destructive",
      });
    } finally {
      setIsProcessing(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div className="liquid-glass-card rounded-2xl p-6">
        <div className="flex items-center space-x-2 mb-4">
          <Lock className="w-4 h-4 text-system-green" />
          <span className="ios-footnote text-system-green font-medium">Безопасная оплата</span>
        </div>
        <PaymentElement />
      </div>
      
      <button 
        type="submit" 
        disabled={!stripe || isProcessing}
        className="w-full ios-button-filled h-12 flex items-center justify-center"
        data-testid="button-pay"
      >
        <CreditCard className="w-4 h-4 mr-2" />
        {isProcessing ? "Обработка..." : `Оплатить ${totalAmount.toLocaleString()} ₽`}
      </button>
    </form>
  );
};

const CheckoutPage = memo(function CheckoutPage({ selectedFeatures, projectName, totalAmount, onBack, onSuccess }: CheckoutPageProps) {
  const [clientSecret, setClientSecret] = useState("");
  const [isLoading, setIsLoading] = useState(true);
  const { toast } = useToast();

  useEffect(() => {
    // Create PaymentIntent when component mounts
    if (totalAmount > 0) {
      fetch('/api/create-payment-intent', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          amount: totalAmount,
          project_name: projectName,
          features: selectedFeatures.map(f => f.id)
        }),
      })
      .then(res => res.json())
      .then(data => {
        if (data.clientSecret) {
          setClientSecret(data.clientSecret);
        } else {
          toast({
            title: "Ошибка",
            description: "Не удалось инициализировать платеж",
            variant: "destructive",
          });
        }
        setIsLoading(false);
      })
      .catch(() => {
        toast({
          title: "Ошибка",
          description: "Проблема с подключением к серверу",
          variant: "destructive",
        });
        setIsLoading(false);
      });
    }
  }, [totalAmount, projectName, selectedFeatures, toast]);

  if (!stripePromise) {
    return (
      <div className="min-h-screen bg-black text-white p-4 flex items-center justify-center">
        <div className="liquid-glass-card rounded-2xl max-w-md w-full">
          <div className="pt-6 px-6 pb-6 text-center">
            <div className="w-16 h-16 mx-auto mb-4 bg-red-500/20 rounded-full flex items-center justify-center">
              <CreditCard className="w-8 h-8 text-red-500" />
            </div>
            <h2 className="text-xl font-bold mb-2 text-white">Платежи недоступны</h2>
            <p className="text-white/70">
              Платежная система временно недоступна. Пожалуйста, попробуйте позже или свяжитесь с нами напрямую.
            </p>
            <button className="w-full mt-4 ios-button-filled h-12" onClick={onBack} data-testid="button-back-error">
              Вернуться назад
            </button>
          </div>
        </div>
      </div>
    );
  }

  if (isLoading) {
    return (
      <div className="min-h-screen bg-black text-white p-4 flex items-center justify-center">
        <div className="liquid-glass-card rounded-2xl max-w-md w-full">
          <div className="pt-6 px-6 pb-6 text-center">
            <div className="animate-spin w-8 h-8 border-4 border-system-blue border-t-transparent rounded-full mx-auto mb-4" />
            <p className="text-white/70">Подготовка к оплате...</p>
          </div>
        </div>
      </div>
    );
  }

  const appearance = {
    theme: 'night' as const,
    variables: {
      colorPrimary: '#6366f1',
      colorBackground: 'rgba(15, 15, 15, 0.8)',
      colorText: '#ffffff',
      borderRadius: '12px',
    }
  };

  return (
    <div className="min-h-screen bg-black text-white pb-80">
      <BackHeader onBack={onBack} title="Оплата заказа" />
      
      <div className="max-w-md mx-auto p-4">
        {/* Payment Form */}
        {clientSecret && (
          <Elements 
            stripe={stripePromise} 
            options={{ 
              clientSecret,
              appearance 
            }}
          >
            <CheckoutForm 
              totalAmount={totalAmount}
              projectName={projectName}
              selectedFeatures={selectedFeatures}
              onSuccess={onSuccess}
            />
          </Elements>
        )}
      </div>

      {/* Order Summary - Fixed at Bottom */}
      <div className="liquid-glass-card-elevated rounded-2xl fixed bottom-24 left-4 right-4 max-w-md mx-auto z-50" data-testid="order-summary">
          <div className="p-6">
            <div className="flex items-center space-x-2 mb-4">
              <CheckCircle className="w-5 h-5 text-system-green" />
              <span className="ios-title3 text-white">Ваш заказ</span>
            </div>
          </div>
          <div className="px-6 pb-6 space-y-4">
            <div>
              <h3 className="ios-body font-bold text-white">{projectName}</h3>
              <p className="ios-footnote text-white/70">
                {selectedFeatures.length} {selectedFeatures.length === 1 ? 'функция' : 'функций'}
              </p>
            </div>
            
            <div className="space-y-2">
              {selectedFeatures.map((feature) => (
                <div key={feature.id} className="flex justify-between ios-footnote">
                  <span className="text-white/70">{feature.name}</span>
                  <span className="text-system-blue font-semibold">{feature.price.toLocaleString()} ₽</span>
                </div>
              ))}
            </div>
            
            <div className="border-t border-white/10 pt-2">
              <div className="flex justify-between ios-body font-bold">
                <span className="text-white">Итого:</span>
                <span className="text-system-blue">{totalAmount.toLocaleString()} ₽</span>
              </div>
              <p className="ios-caption2 text-white/70 mt-1">
                Срок разработки: 3-7 рабочих дней
              </p>
            </div>
          </div>
        </div>
    </div>
  );
});

export default CheckoutPage;```

### components/ConstructorPage.tsx
```tsx
import { useState, useCallback, useMemo, memo, useEffect, useRef } from "react";
import { trackProjectCreation, trackFeatureAdded } from "@/hooks/useGamification";
import { 
  Wrench,
  Eye,
  ShoppingCart,
  Home,
  Calculator,
  User,
  ArrowRight,
  Check,
  Package,
  Coffee,
  Dumbbell,
  GraduationCap,
  Heart,
  Settings,
  CreditCard,
  Truck,
  Bell,
  Crown,
  BarChart,
  Calendar,
  Users,
  Zap,
  Star,
  MessageSquare,
  Globe,
  Smartphone,
  Clock,
  Info,
  ChevronRight,
  Plus,
  Sparkles,
  Rocket,
  UserCircle2,
  DollarSign,
  TrendingUp,
  CheckCircle,
  Gift
} from "lucide-react";

interface ConstructorPageProps {
  onNavigate: (section: string, data?: any) => void;
}

interface SelectedFeature {
  id: string;
  name: string;
  price: number;
  category: string;
}

const appTemplates = [
  {
    id: 'ecommerce-basic',
    name: 'Интернет-магазин',
    icon: ShoppingCart,
    description: 'Продажа товаров онлайн',
    features: ['catalog', 'cart', 'auth', 'payments'],
    estimatedPrice: 45000,
    developmentTime: '7-10 дней',
    popular: true
  },
  {
    id: 'restaurant',
    name: 'Ресторан',
    icon: Coffee,
    description: 'Меню и заказы еды',
    features: ['catalog', 'cart', 'auth', 'booking-system'],
    estimatedPrice: 55000,
    developmentTime: '10-12 дней',
    popular: false
  },
  {
    id: 'fitness-center',
    name: 'Фитнес-клуб',
    icon: Dumbbell,
    description: 'Тренировки и абонементы',
    features: ['booking-system', 'auth', 'subscriptions', 'progress-tracking'],
    estimatedPrice: 65000,
    developmentTime: '12-15 дней',
    popular: false
  },
  {
    id: 'services',
    name: 'Услуги',
    icon: Settings,
    description: 'Бронирование услуг',
    features: ['catalog', 'booking-system', 'auth', 'payments'],
    estimatedPrice: 50000,
    developmentTime: '8-12 дней',
    popular: false
  }
];

const availableFeatures = [
  { id: 'catalog', name: 'Каталог', price: 8000, category: 'Основные', icon: Package, included: true },
  { id: 'cart', name: 'Корзина', price: 6000, category: 'Основные', icon: ShoppingCart, included: true },
  { id: 'auth', name: 'Авторизация', price: 4000, category: 'Основные', icon: User, included: true },
  { id: 'search', name: 'Поиск', price: 7000, category: 'Основные', icon: Zap, included: false },
  { id: 'favorites', name: 'Избранное', price: 4000, category: 'Основные', icon: Star, included: false },
  { id: 'reviews', name: 'Отзывы', price: 8000, category: 'Основные', icon: Star, included: false },
  
  { id: 'payments', name: 'Платежи', price: 15000, category: 'Платежи', icon: CreditCard, included: false },
  { id: 'subscriptions', name: 'Подписки', price: 18000, category: 'Платежи', icon: CreditCard, included: false },
  { id: 'installments', name: 'Рассрочка', price: 12000, category: 'Платежи', icon: CreditCard, included: false },
  
  { id: 'delivery-basic', name: 'Доставка', price: 10000, category: 'Доставка', icon: Truck, included: false },
  { id: 'pickup-points', name: 'Самовывоз', price: 12000, category: 'Доставка', icon: Package, included: false },
  { id: 'express-delivery', name: 'Экспресс', price: 8000, category: 'Доставка', icon: Truck, included: false },
  
  { id: 'push-notifications', name: 'Уведомления', price: 8000, category: 'Коммуникации', icon: Bell, included: false },
  { id: 'chat-support', name: 'Чат поддержки', price: 15000, category: 'Коммуникации', icon: MessageSquare, included: false },
  { id: 'video-calls', name: 'Видеозвонки', price: 20000, category: 'Коммуникации', icon: Smartphone, included: false },
  
  { id: 'loyalty-program', name: 'Бонусы', price: 22000, category: 'Маркетинг', icon: Crown, included: false },
  { id: 'promo-codes', name: 'Промокоды', price: 10000, category: 'Маркетинг', icon: Crown, included: false },
  { id: 'referral-system', name: 'Рефералы', price: 18000, category: 'Маркетинг', icon: Users, included: false },
  
  { id: 'basic-analytics', name: 'Аналитика', price: 15000, category: 'Управление', icon: BarChart, included: false },
  { id: 'admin-panel', name: 'Админ панель', price: 25000, category: 'Управление', icon: Settings, included: false },
  { id: 'crm-system', name: 'CRM', price: 40000, category: 'Управление', icon: Users, included: false },
  
  { id: 'booking-system', name: 'Бронирование', price: 18000, category: 'Бронирование', icon: Calendar, included: false },
  { id: 'queue-management', name: 'Очереди', price: 15000, category: 'Бронирование', icon: Clock, included: false },
  { id: 'calendar-sync', name: 'Календарь', price: 10000, category: 'Бронирование', icon: Calendar, included: false },
  
  { id: 'progress-tracking', name: 'Прогресс', price: 15000, category: 'Управление', icon: BarChart, included: false }
];

const categories = ['Основные', 'Платежи', 'Доставка', 'Коммуникации', 'Маркетинг', 'Управление', 'Бронирование'];

// Memoized Template Card Component
const TemplateCard = memo(({ template, onSelect }: any) => {
  const IconComponent = template.icon;
  return (
    <div
      className="ios-list-item cursor-pointer"
      onClick={onSelect}
      data-testid={`template-${template.id}`}
    >
      <div className="flex items-center space-x-3">
        <div className="w-10 h-10 bg-system-blue/10 rounded-medium flex items-center justify-center">
          <IconComponent className="w-5 h-5 text-system-blue" />
        </div>
        <div className="flex-1">
          <div className="flex items-center space-x-2">
            <span className="ios-headline font-semibold text-white">{template.name}</span>
            {template.popular && (
              <span className="px-2 py-0.5 bg-system-orange/10 rounded-full">
                <span className="ios-caption2 text-system-orange font-semibold">Популярно</span>
              </span>
            )}
          </div>
          <div className="ios-footnote text-white/70">{template.description}</div>
          <div className="ios-footnote text-white/70 flex items-center space-x-1 mt-1">
            <Clock className="w-3 h-3" />
            <span>{template.developmentTime}</span>
            <span>•</span>
            <span>от {template.estimatedPrice.toLocaleString()} ₽</span>
          </div>
        </div>
        <ChevronRight className="w-5 h-5 text-white/30" />
      </div>
    </div>
  );
});
TemplateCard.displayName = 'TemplateCard';

function ConstructorPage({ onNavigate }: ConstructorPageProps) {
  const [selectedTemplate, setSelectedTemplate] = useState<typeof appTemplates[0] | null>(null);
  const [selectedFeatures, setSelectedFeatures] = useState<SelectedFeature[]>([]);
  const [activeCategory, setActiveCategory] = useState('Основные');
  const [projectName, setProjectName] = useState('');
  const [currentStep, setCurrentStep] = useState(1);

  // Memoized select template handler
  const selectTemplate = useCallback((template: typeof appTemplates[0]) => {
    setSelectedTemplate(template);
    setProjectName(`Мой ${template.name}`);
    
    const templateFeatures = template.features.map(featureId => {
      const feature = availableFeatures.find(f => f.id === featureId);
      if (feature) {
        return {
          id: feature.id,
          name: feature.name,
          price: feature.price,
          category: feature.category
        };
      }
      return null;
    }).filter(Boolean) as SelectedFeature[];
    
    setSelectedFeatures(templateFeatures);
    setCurrentStep(2);
  }, []);

  // Track project creation when user first enters a name
  const hasTrackedProjectRef = useRef(false);
  useEffect(() => {
    if (projectName.trim().length > 0 && !hasTrackedProjectRef.current) {
      hasTrackedProjectRef.current = true;
      trackProjectCreation();
    }
  }, [projectName]);

  // Memoized toggle feature handler
  const toggleFeature = useCallback((feature: typeof availableFeatures[0]) => {
    if (feature.included) return;
    if (selectedTemplate?.features.includes(feature.id)) return;
    
    const isSelected = selectedFeatures.find(f => f.id === feature.id);
    if (isSelected) {
      setSelectedFeatures(prev => prev.filter(f => f.id !== feature.id));
    } else {
      setSelectedFeatures(prev => [...prev, {
        id: feature.id,
        name: feature.name,
        price: feature.price,
        category: feature.category
      }]);
      // Track feature addition for gamification
      trackFeatureAdded();
    }
  }, [selectedFeatures, selectedTemplate]);

  // Memoized total calculation
  const calculateTotal = useCallback(() => {
    const basePrice = selectedTemplate?.estimatedPrice || 0;
    const templateIncludedFeatures = selectedTemplate?.features || [];
    
    const featuresPrice = selectedFeatures
      .filter(f => {
        const feature = availableFeatures.find(af => af.id === f.id);
        const isIncluded = feature?.included;
        const isInTemplate = templateIncludedFeatures.includes(f.id);
        return !isIncluded && !isInTemplate;
      })
      .reduce((sum, feature) => sum + feature.price, 0);
    
    return basePrice + featuresPrice;
  }, [selectedTemplate, selectedFeatures]);

  const totalPrice = useMemo(() => calculateTotal(), [calculateTotal]);

  // Memoized order handler
  const handleOrderClick = useCallback(() => {
    if (!selectedTemplate || !projectName.trim()) return;
    
    const orderData = {
      projectName: projectName.trim(),
      selectedFeatures,
      selectedTemplate: selectedTemplate.name,
      totalAmount: totalPrice,
      estimatedDevelopmentTime: selectedTemplate.developmentTime
    };
    
    onNavigate('checkout', orderData);
  }, [selectedTemplate, projectName, selectedFeatures, totalPrice, onNavigate]);

  // Memoized step navigation
  const goToStep = useCallback((step: number) => setCurrentStep(step), []);

  // Memoized filtered features
  const filteredFeatures = useMemo(() => 
    availableFeatures.filter(f => f.category === activeCategory),
    [activeCategory]
  );

  // Memoized template handlers
  const templateHandlers = useMemo(() => 
    appTemplates.map(template => ({
      id: template.id,
      handler: () => selectTemplate(template)
    })),
    [selectTemplate]
  );

  // Memoized additional features price
  const additionalFeaturesPrice = useMemo(() => {
    const templateIncludedFeatures = selectedTemplate?.features || [];
    return selectedFeatures
      .filter(f => {
        const feature = availableFeatures.find(af => af.id === f.id);
        const isIncluded = feature?.included;
        const isInTemplate = templateIncludedFeatures.includes(f.id);
        return !isIncluded && !isInTemplate;
      })
      .reduce((sum, f) => sum + f.price, 0);
  }, [selectedFeatures, selectedTemplate]);

  return (
    <div className="min-h-screen bg-black text-white pb-32" style={{ paddingTop: '140px' }}>
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        
        {/* Payment Model Section */}
        <section className="scroll-fade-in">
          <div className="relative bg-white/10 backdrop-blur-xl rounded-3xl border border-white/20 p-7 overflow-hidden">
            {/* Subtle gradient overlay */}
            <div className="absolute inset-0 bg-gradient-to-br from-system-blue/5 via-transparent to-system-purple/5 pointer-events-none"/>
            
            <div className="relative z-10">
              {/* Header */}
              <div className="text-center mb-6 scroll-fade-in-delay-1">
                <h3 className="ios-title2 mb-2 text-white font-bold">Прозрачная оплата</h3>
                <p className="ios-subheadline text-white/70 max-w-xs mx-auto">
                  Платите поэтапно — минимальный риск, максимальный контроль
                </p>
              </div>

              {/* Payment Stages */}
              <div className="space-y-3 mb-6">
                {/* Stage 1 - 35% Prepayment */}
                <div className="relative group">
                  <div className="absolute inset-0 bg-gradient-to-r from-system-green/20 to-transparent rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity"/>
                  <div className="relative bg-white/5 backdrop-blur-xl rounded-2xl border border-white/20 p-5 hover:border-system-green/40 transition-all">
                    <div className="flex items-start space-x-4">
                      <div className="relative">
                        <div className="absolute inset-0 bg-system-green/30 rounded-xl blur-md"/>
                        <div className="relative w-12 h-12 bg-gradient-to-br from-system-green/30 to-system-green/10 rounded-xl flex items-center justify-center border border-system-green/30">
                          <Zap className="w-6 h-6 text-system-green" />
                        </div>
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center justify-between mb-2">
                          <div>
                            <div className="ios-headline font-bold text-white mb-0.5">35% предоплата</div>
                            <div className="ios-caption1 text-system-green font-semibold">Запуск разработки</div>
                          </div>
                          <div className="w-8 h-8 rounded-full bg-system-green/20 flex items-center justify-center border border-system-green/30">
                            <span className="ios-caption2 font-bold text-system-green">1</span>
                          </div>
                        </div>
                        <p className="ios-footnote text-white/70 leading-relaxed">
                          Мы начинаем создавать ваше приложение сразу после внесения предоплаты
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Stage 2 - 65% After Delivery */}
                <div className="relative group">
                  <div className="absolute inset-0 bg-gradient-to-r from-system-blue/20 to-transparent rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity"/>
                  <div className="relative bg-white/5 backdrop-blur-xl rounded-2xl border border-white/20 p-5 hover:border-system-blue/40 transition-all">
                    <div className="flex items-start space-x-4">
                      <div className="relative">
                        <div className="absolute inset-0 bg-system-blue/30 rounded-xl blur-md"/>
                        <div className="relative w-12 h-12 bg-gradient-to-br from-system-blue/30 to-system-blue/10 rounded-xl flex items-center justify-center border border-system-blue/30">
                          <CheckCircle className="w-6 h-6 text-system-blue" />
                        </div>
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center justify-between mb-2">
                          <div>
                            <div className="ios-headline font-bold text-white mb-0.5">65% при получении</div>
                            <div className="ios-caption1 text-system-blue font-semibold">Готовое приложение</div>
                          </div>
                          <div className="w-8 h-8 rounded-full bg-system-green/20 flex items-center justify-center border border-system-green/30">
                            <span className="ios-caption2 font-bold text-system-green">2</span>
                          </div>
                        </div>
                        <p className="ios-footnote text-white/70 leading-relaxed">
                          Оплачиваете остаток только после тестирования и принятия работы
                        </p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Stage 3 - Monthly Subscription */}
                <div className="relative group">
                  <div className="absolute inset-0 bg-gradient-to-r from-system-green/20 to-transparent rounded-2xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity"/>
                  <div className="relative bg-white/5 backdrop-blur-xl rounded-2xl border border-white/20 p-5 hover:border-system-green/40 transition-all">
                    <div className="flex items-start space-x-4">
                      <div className="relative">
                        <div className="absolute inset-0 bg-system-green/30 rounded-xl blur-md"/>
                        <div className="relative w-12 h-12 bg-gradient-to-br from-system-green/30 to-system-green/10 rounded-xl flex items-center justify-center border border-system-green/30">
                          <TrendingUp className="w-6 h-6 text-system-green" />
                        </div>
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center justify-between mb-2">
                          <div>
                            <div className="ios-headline font-bold text-white mb-0.5">Поддержка и развитие</div>
                            <div className="ios-caption1 text-system-green font-semibold">Ежемесячная подписка</div>
                          </div>
                          <div className="w-8 h-8 rounded-full bg-system-green/20 flex items-center justify-center border border-system-green/30">
                            <span className="ios-caption2 font-bold text-system-green">3</span>
                          </div>
                        </div>
                        <p className="ios-footnote text-white/70 leading-relaxed">
                          Стабильная работа, обновления и поддержка вашего бизнеса 24/7
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              {/* Monthly Subscription Details */}
              <div className="relative mt-6 pt-6 border-t border-white/10">
                <div className="text-center mb-5">
                  <div className="inline-flex items-center justify-center px-3 py-1 bg-system-green/10 border border-system-green/30 rounded-full mb-3">
                    <Rocket className="w-3.5 h-3.5 text-system-green mr-2" />
                    <span className="ios-caption1 text-system-green font-semibold">Что входит в подписку</span>
                  </div>
                </div>
                
                {/* What's included - Grid Layout */}
                <div className="grid grid-cols-2 gap-3 mb-5">
                  <div className="flex items-start space-x-2.5">
                    <div className="w-5 h-5 rounded-full bg-system-green/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <Check className="w-3 h-3 text-system-green" />
                    </div>
                    <span className="ios-caption1 text-white/90 leading-tight">Хостинг и сервера</span>
                  </div>
                  <div className="flex items-start space-x-2.5">
                    <div className="w-5 h-5 rounded-full bg-system-green/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <Check className="w-3 h-3 text-system-green" />
                    </div>
                    <span className="ios-caption1 text-white/90 leading-tight">Поддержка 24/7</span>
                  </div>
                  <div className="flex items-start space-x-2.5">
                    <div className="w-5 h-5 rounded-full bg-system-green/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <Check className="w-3 h-3 text-system-green" />
                    </div>
                    <span className="ios-caption1 text-white/90 leading-tight">Обновления</span>
                  </div>
                  <div className="flex items-start space-x-2.5">
                    <div className="w-5 h-5 rounded-full bg-system-green/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                      <Check className="w-3 h-3 text-system-green" />
                    </div>
                    <span className="ios-caption1 text-white/90 leading-tight">Резервные копии</span>
                  </div>
                </div>

                {/* Price Card */}
                <div className="relative">
                  <div className="absolute inset-0 bg-gradient-to-r from-system-blue/20 via-system-purple/20 to-system-green/20 rounded-2xl blur-xl"/>
                  <div className="relative bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-xl rounded-2xl border border-white/30 p-6 text-center">
                    {/* Free Month Badge */}
                    <div className="inline-flex items-center justify-center px-4 py-1.5 bg-system-green/20 border border-system-green/40 rounded-full mb-4">
                      <Gift className="w-3.5 h-3.5 text-system-green mr-2" />
                      <span className="ios-caption1 text-system-green font-bold">Первый месяц в подарок</span>
                    </div>
                    
                    {/* Price */}
                    <div className="mb-3">
                      <div className="flex items-baseline justify-center space-x-1">
                        <span className="ios-title1 font-bold text-system-green">5,999</span>
                        <span className="ios-body text-system-green">₽</span>
                      </div>
                      <div className="ios-footnote text-white/60 mt-1">в месяц со второго месяца</div>
                    </div>

                    {/* Value proposition */}
                    <div className="ios-caption2 text-white/50">
                      Всё включено • Без скрытых платежей
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* Progress Steps */}
        <section className="scroll-fade-in-delay-2">
          <div className="ios-list">
            <div className="ios-list-item">
              <div className="flex items-center space-x-3">
                <div className={`w-6 h-6 rounded-full flex items-center justify-center ${
                  currentStep >= 1 ? 'bg-system-blue' : 'bg-white/10'
                }`}>
                  {currentStep > 1 ? (
                    <Check className="w-3 h-3 text-white/90" />
                  ) : (
                    <span className="ios-caption2 text-white font-bold">1</span>
                  )}
                </div>
                <div className="flex-1">
                  <div className="ios-body font-semibold text-white">Выберите тип приложения</div>
                  <div className="ios-footnote text-white/70">Готовый шаблон под ваш бизнес</div>
                </div>
                {currentStep === 1 && <div className="w-2 h-2 bg-system-blue rounded-full" />}
              </div>
            </div>
            <div className="ios-list-item">
              <div className="flex items-center space-x-3">
                <div className={`w-6 h-6 rounded-full flex items-center justify-center ${
                  currentStep >= 2 ? 'bg-system-blue' : 'bg-white/10'
                }`}>
                  {currentStep > 2 ? (
                    <Check className="w-3 h-3 text-white/90" />
                  ) : (
                    <span className="ios-caption2 text-white font-bold">2</span>
                  )}
                </div>
                <div className="flex-1">
                  <div className="ios-body font-semibold text-white">Добавьте функции</div>
                  <div className="ios-footnote text-white/70">Расширьте возможности</div>
                </div>
                {currentStep === 2 && <div className="w-2 h-2 bg-system-blue rounded-full" />}
              </div>
            </div>
            <div className="ios-list-item">
              <div className="flex items-center space-x-3">
                <div className={`w-6 h-6 rounded-full flex items-center justify-center ${
                  currentStep >= 3 ? 'bg-system-blue' : 'bg-white/10'
                }`}>
                  <span className="ios-caption2 text-white font-bold">3</span>
                </div>
                <div className="flex-1">
                  <div className="ios-body font-semibold text-white">Оформите заказ</div>
                  <div className="ios-footnote text-white/70">Запустите разработку</div>
                </div>
                {currentStep === 3 && <div className="w-2 h-2 bg-system-blue rounded-full" />}
              </div>
            </div>
          </div>
        </section>

        {/* Step 1: Template Selection */}
        {currentStep === 1 && (
          <section className="space-y-6 scroll-fade-in-delay-3">
            <div className="text-center scroll-fade-in">
              <h2 className="ios-title3 mb-2 text-white">Шаг 1: Выберите тип</h2>
              <p className="ios-subheadline text-white/70">
                Готовые решения для разных сфер бизнеса
              </p>
            </div>

            <div className="ios-list">
              {appTemplates.map((template, idx) => (
                <TemplateCard
                  key={template.id}
                  template={template}
                  onSelect={templateHandlers[idx].handler}
                />
              ))}
            </div>

            <div className="bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 p-4 bg-system-blue/10 border-system-blue/20">
              <div className="flex items-start space-x-3">
                <Info className="w-5 h-5 text-system-blue mt-0.5" />
                <div>
                  <div className="ios-body font-semibold text-system-blue">Подсказка</div>
                  <div className="ios-footnote text-white/70">
                    Выберите тип, наиболее близкий к вашему бизнесу. 
                    Позже можно будет добавить дополнительные функции.
                  </div>
                </div>
              </div>
            </div>
          </section>
        )}

        {/* Step 2: Features Selection */}
        {currentStep === 2 && selectedTemplate && (
          <section className="space-y-6 scroll-fade-in">
            <div className="text-center scroll-fade-in-delay-1">
              <h2 className="ios-title3 mb-2 text-white">Шаг 2: Настройте функции</h2>
              <p className="ios-subheadline text-white/70">
                Добавьте нужные возможности для вашего приложения
              </p>
            </div>

            {/* Project Name */}
            <div className="liquid-glass-card rounded-2xl p-4">
              <div className="ios-field-label text-white/70">Название проекта</div>
              <input
                type="text"
                className="ios-field w-full mt-1 bg-white/10 text-white border-white/20 focus:border-system-blue"
                value={projectName}
                onChange={(e) => setProjectName(e.target.value)}
                placeholder="Введите название"
                data-testid="project-name-input"
                autoComplete="off"
                autoCorrect="off"
                autoCapitalize="off"
                spellCheck="false"
                inputMode="text"
                enterKeyHint="done"
              />
            </div>

            {/* Category Selector */}
            <div className="overflow-x-auto">
              <div className="flex space-x-2 min-w-max">
                {categories.map((category) => (
                  <button
                    key={category}
                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${
                      activeCategory === category 
                        ? 'bg-system-blue text-white shadow-lg' 
                        : 'liquid-glass-card text-white/70 hover:text-white'
                    }`}
                    onClick={() => setActiveCategory(category)}
                  >
                    {category}
                  </button>
                ))}
              </div>
            </div>

            {/* Features List */}
            <div className="ios-list">
              <div className="ios-list-header text-white/70">{activeCategory}</div>
              {filteredFeatures.map((feature) => {
                const IconComponent = feature.icon;
                const isSelected = selectedFeatures.find(f => f.id === feature.id);
                const isIncluded = feature.included;
                const isInTemplate = selectedTemplate?.features.includes(feature.id);
                const isIncludedInAny = isIncluded || isInTemplate;
                
                return (
                  <div
                    key={feature.id}
                    className={`ios-list-item ${!isIncludedInAny ? 'cursor-pointer' : ''}`}
                    onClick={() => !isIncludedInAny && toggleFeature(feature)}
                    data-testid={`feature-${feature.id}`}
                  >
                    <div className="flex items-center space-x-3">
                      <div className={`w-5 h-5 rounded border-2 flex items-center justify-center ${
                        isSelected || isIncludedInAny
                          ? 'bg-system-blue border-system-blue'
                          : 'border-white/30'
                      }`}>
                        {(isSelected || isIncludedInAny) && (
                          <Check className="w-3 h-3 text-white/90" />
                        )}
                      </div>
                      <IconComponent className="w-5 h-5 text-white/70" />
                      <div className="flex-1">
                        <div className="ios-body font-semibold text-white">{feature.name}</div>
                        {isIncludedInAny && (
                          <div className="ios-footnote text-system-green">Включено в шаблон</div>
                        )}
                      </div>
                      <div className="text-right">
                        <div className="ios-body font-semibold text-system-blue">
                          {isIncludedInAny ? 'Включено' : `+${feature.price.toLocaleString()} ₽`}
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>

            {/* Navigation Buttons */}
            <div className="flex space-x-3">
              <button
                className="ios-button-plain flex-1"
                onClick={() => goToStep(1)}
              >
                Назад
              </button>
              <button
                className="ios-button-filled flex-1"
                onClick={() => goToStep(3)}
                disabled={!projectName.trim()}
              >
                Далее
              </button>
            </div>
          </section>
        )}

        {/* Step 3: Review and Order */}
        {currentStep === 3 && selectedTemplate && (
          <section className="space-y-6">
            <div className="text-center">
              <h2 className="ios-title3 mb-2 text-white">Шаг 3: Подтвердите заказ</h2>
              <p className="ios-subheadline text-white/70">
                Проверьте конфигурацию и запустите разработку
              </p>
            </div>

            {/* Project Summary */}
            <div className="bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 p-6 space-y-4">
              <div className="text-center">
                <h3 className="ios-title3 mb-1 text-white">{projectName}</h3>
                <p className="ios-footnote text-white/70">
                  На основе шаблона "{selectedTemplate.name}"
                </p>
              </div>
              
              <div className="border-t border-white/20 pt-4">
                <div className="flex justify-between items-center mb-2">
                  <span className="ios-body text-white">Базовая стоимость</span>
                  <span className="ios-body font-semibold text-white">{selectedTemplate.estimatedPrice.toLocaleString()} ₽</span>
                </div>
                
                {additionalFeaturesPrice > 0 && (
                  <div className="flex justify-between items-center mb-2">
                    <span className="ios-body text-white">Дополнительные функции</span>
                    <span className="ios-body font-semibold text-white">
                      +{additionalFeaturesPrice.toLocaleString()} ₽
                    </span>
                  </div>
                )}
                
                <div className="border-t border-white/20 pt-2">
                  <div className="flex justify-between items-center">
                    <span className="ios-headline font-bold text-white">Итого</span>
                    <span className="ios-title3 font-bold text-system-blue">{totalPrice.toLocaleString()} ₽</span>
                  </div>
                </div>
              </div>
              
              <div className="bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 bg-system-green/10 border-system-green/20 p-4">
                <div className="flex items-center space-x-2 justify-center">
                  <Clock className="w-4 h-4 text-system-green" />
                  <span className="ios-footnote text-system-green font-semibold">
                    Готовность: {selectedTemplate.developmentTime}
                  </span>
                </div>
              </div>
            </div>

            {/* Action Buttons */}
            <div className="space-y-3">
              <button
                className="ios-button-filled w-full"
                onClick={handleOrderClick}
                data-testid="button-order"
              >
                Заказать за {totalPrice.toLocaleString()} ₽
              </button>
              
              <button
                className="ios-button-plain w-full"
                onClick={() => goToStep(2)}
              >
                Изменить функции
              </button>
              
              <div className="text-center">
                <p className="ios-footnote text-white/70">
                  Предоплата 30% • Остальное по готовности этапов
                </p>
              </div>
            </div>
          </section>
        )}
      </div>

      {/* Sticky Summary Bar */}
      {selectedTemplate && currentStep > 1 && (
        <div className="fixed bottom-20 left-0 right-0 px-4 z-40" data-testid="summary-bar">
          <div className="max-w-md mx-auto">
            <div className="bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 p-3 bg-black/90 backdrop-blur-xl border-white/20">
              <div className="flex items-center justify-between">
                <div>
                  <div className="ios-footnote text-white/70">Текущая стоимость</div>
                  <div className="ios-headline font-bold text-system-blue">
                    {totalPrice.toLocaleString()} ₽
                  </div>
                </div>
                <div className="text-right">
                  <div className="ios-footnote text-white/70">Функций</div>
                  <div className="ios-headline font-bold text-white">
                    {selectedFeatures.length}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

export default memo(ConstructorPage);
```

### components/CultSymbol.tsx
```tsx
import { m } from 'framer-motion';

interface CultSymbolProps {
  size?: 'sm' | 'md' | 'lg' | 'xl';
  animated?: boolean;
  glowing?: boolean;
  className?: string;
}

const sizes = {
  sm: { width: 32, height: 32 },
  md: { width: 48, height: 48 },
  lg: { width: 64, height: 64 },
  xl: { width: 96, height: 96 },
};

export function CultSymbol({ size = 'md', animated = true, glowing = true, className = '' }: CultSymbolProps) {
  const { width, height } = sizes[size];
  
  return (
    <m.div
      className={`relative ${className}`}
      initial={{ opacity: 0, scale: 0.8 }}
      animate={{ opacity: 1, scale: 1 }}
      transition={{ duration: 0.6, ease: 'easeOut' }}
    >
      {glowing && (
        <div
          className="absolute inset-0 blur-xl"
          style={{
            background: 'radial-gradient(circle, rgba(139, 92, 246, 0.4) 0%, transparent 70%)',
            transform: 'scale(1.5)',
          }}
        />
      )}
      
      <m.svg
        width={width}
        height={height}
        viewBox="0 0 100 100"
        fill="none"
        className="relative z-10"
        animate={animated ? {
          rotate: [0, 360],
        } : undefined}
        transition={animated ? {
          duration: 60,
          repeat: Infinity,
          ease: 'linear',
        } : undefined}
      >
        <defs>
          <linearGradient id="cultGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#A78BFA" />
            <stop offset="50%" stopColor="#8B5CF6" />
            <stop offset="100%" stopColor="#7C3AED" />
          </linearGradient>
          <linearGradient id="cultGold" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor="#F59E0B" />
            <stop offset="50%" stopColor="#D97706" />
            <stop offset="100%" stopColor="#B45309" />
          </linearGradient>
          <filter id="glow">
            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        
        <circle cx="50" cy="50" r="48" stroke="url(#cultGradient)" strokeWidth="1" fill="none" opacity="0.3" />
        <circle cx="50" cy="50" r="42" stroke="url(#cultGradient)" strokeWidth="0.5" fill="none" opacity="0.2" />
        
        <g filter="url(#glow)">
          <path
            d="M50 10 L56 30 L78 30 L60 44 L68 66 L50 52 L32 66 L40 44 L22 30 L44 30 Z"
            fill="none"
            stroke="url(#cultGradient)"
            strokeWidth="2"
            strokeLinejoin="round"
          />
        </g>
        
        <circle cx="50" cy="50" r="8" fill="url(#cultGradient)" />
        <circle cx="50" cy="50" r="4" fill="#FAFAFA" opacity="0.9" />
        
        <g opacity="0.6">
          <line x1="50" y1="20" x2="50" y2="10" stroke="url(#cultGradient)" strokeWidth="1.5" strokeLinecap="round" />
          <line x1="50" y1="90" x2="50" y2="80" stroke="url(#cultGradient)" strokeWidth="1.5" strokeLinecap="round" />
          <line x1="10" y1="50" x2="20" y2="50" stroke="url(#cultGradient)" strokeWidth="1.5" strokeLinecap="round" />
          <line x1="80" y1="50" x2="90" y2="50" stroke="url(#cultGradient)" strokeWidth="1.5" strokeLinecap="round" />
        </g>
        
        <text
          x="50"
          y="95"
          textAnchor="middle"
          fill="url(#cultGradient)"
          fontSize="6"
          fontWeight="700"
          letterSpacing="0.5"
          fontFamily="Inter, sans-serif"
        >
          W4TG
        </text>
      </m.svg>
    </m.div>
  );
}

export function ExclusiveBadge({ type = 'founding' }: { type?: 'founding' | 'elite' | 'insider' }) {
  const badges = {
    founding: {
      label: 'FOUNDING MEMBER',
      gradient: 'linear-gradient(135deg, #F59E0B 0%, #D97706 100%)',
      icon: 'M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z',
    },
    elite: {
      label: 'ELITE ACCESS',
      gradient: 'linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)',
      icon: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z',
    },
    insider: {
      label: 'INNER CIRCLE',
      gradient: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
      icon: 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z',
    },
  };
  
  const badge = badges[type];
  
  return (
    <m.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full"
      style={{
        background: badge.gradient,
        boxShadow: '0 4px 12px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.2)',
      }}
    >
      <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" d={badge.icon} />
      </svg>
      <span className="text-[9px] font-bold tracking-[0.1em] text-white">{badge.label}</span>
    </m.div>
  );
}

export function ScarcityIndicator({ spotsLeft = 3, totalSpots = 10 }: { spotsLeft?: number; totalSpots?: number }) {
  const percentage = ((totalSpots - spotsLeft) / totalSpots) * 100;
  const isUrgent = spotsLeft <= 3;
  
  return (
    <m.div
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      className="relative rounded-2xl p-4 overflow-hidden"
      style={{
        background: isUrgent 
          ? 'linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(185, 28, 28, 0.1) 100%)'
          : 'linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(124, 58, 237, 0.1) 100%)',
        border: `1px solid ${isUrgent ? 'rgba(239, 68, 68, 0.3)' : 'rgba(139, 92, 246, 0.3)'}`,
      }}
    >
      <div className="flex items-center justify-between mb-3">
        <div className="flex items-center gap-2">
          <m.div
            animate={{ scale: [1, 1.2, 1] }}
            transition={{ duration: 1.5, repeat: Infinity }}
            className="w-2 h-2 rounded-full"
            style={{ background: isUrgent ? '#EF4444' : '#8B5CF6' }}
          />
          <span className="text-xs font-bold tracking-wide" style={{ color: isUrgent ? '#EF4444' : '#A78BFA' }}>
            ОСТАЛОСЬ МЕСТ: {spotsLeft}
          </span>
        </div>
        <span className="text-[10px] font-medium text-white/50">из {totalSpots}</span>
      </div>
      
      <div className="relative h-2 rounded-full overflow-hidden" style={{ background: 'rgba(255,255,255,0.1)' }}>
        <m.div
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ duration: 1, ease: 'easeOut' }}
          className="absolute left-0 top-0 h-full rounded-full"
          style={{
            background: isUrgent 
              ? 'linear-gradient(90deg, #EF4444 0%, #DC2626 100%)'
              : 'linear-gradient(90deg, #8B5CF6 0%, #7C3AED 100%)',
          }}
        />
        <m.div
          animate={{ x: ['-100%', '200%'] }}
          transition={{ duration: 2, repeat: Infinity, ease: 'linear' }}
          className="absolute top-0 h-full w-1/3"
          style={{ background: 'linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)' }}
        />
      </div>
      
      {isUrgent && (
        <p className="mt-2 text-[10px] text-red-400/80 font-medium">
          Следующий набор через 30 дней
        </p>
      )}
    </m.div>
  );
}

export function WaitlistCounter({ count = 47 }: { count?: number }) {
  return (
    <m.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      className="flex items-center gap-3 px-4 py-2 rounded-full"
      style={{
        background: 'rgba(255,255,255,0.05)',
        border: '1px solid rgba(255,255,255,0.1)',
      }}
    >
      <div className="flex -space-x-2">
        {[...Array(4)].map((_, i) => (
          <div
            key={i}
            className="w-6 h-6 rounded-full border-2 border-black flex items-center justify-center text-[8px] font-bold"
            style={{
              background: ['#8B5CF6', '#F59E0B', '#10B981', '#3B82F6'][i],
              zIndex: 4 - i,
            }}
          >
            {String.fromCharCode(65 + i)}
          </div>
        ))}
      </div>
      <div>
        <span className="text-white text-xs font-bold">+{count}</span>
        <span className="text-white/50 text-[10px] ml-1">в очереди</span>
      </div>
    </m.div>
  );
}

export default CultSymbol;
```

### components/DailyRewards.tsx
```tsx
import { motion } from '@/utils/LazyMotionProvider';
import { Calendar, Gift, Sparkles, CheckCircle2, Lock } from 'lucide-react';
import { useState, useEffect } from 'react';
import { cn } from '@/lib/utils';

interface DailyReward {
  day: number;
  reward: string;
  xp: number;
  claimed: boolean;
  available: boolean;
  special?: boolean;
}

interface DailyRewardsProps {
  className?: string;
}

export function DailyRewards({ className = '' }: DailyRewardsProps) {
  const [rewards, setRewards] = useState<DailyReward[]>([]);
  const [currentDay, setCurrentDay] = useState(1);
  const [showClaimAnimation, setShowClaimAnimation] = useState(false);

  useEffect(() => {
    // Load from localStorage
    const stored = localStorage.getItem('daily_rewards');
    const lastClaim = localStorage.getItem('daily_rewards_last_claim');
    const today = new Date().toISOString().split('T')[0];

    if (stored && lastClaim === today) {
      setRewards(JSON.parse(stored));
      const claimed = JSON.parse(stored);
      setCurrentDay(claimed.filter((r: DailyReward) => r.claimed).length + 1);
    } else {
      // Initialize rewards
      const newRewards: DailyReward[] = Array.from({ length: 30 }, (_, i) => ({
        day: i + 1,
        reward: getRewardForDay(i + 1),
        xp: getXPForDay(i + 1),
        claimed: false,
        available: i === 0,
        special: [7, 14, 21, 30].includes(i + 1),
      }));
      setRewards(newRewards);
      setCurrentDay(1);
    }
  }, []);

  const getRewardForDay = (day: number): string => {
    if (day === 7) return '1000 монет + 5% скидка';
    if (day === 14) return '2000 монет + 10% скидка';
    if (day === 21) return '3000 монет + 15% скидка';
    if (day === 30) return '5000 монет + VIP статус';
    if (day % 5 === 0) return `${day * 50} монет`;
    return `${day * 20} монет`;
  };

  const getXPForDay = (day: number): number => {
    if (day === 30) return 1000;
    if (day === 21) return 500;
    if (day === 14) return 300;
    if (day === 7) return 200;
    return 50 + day * 10;
  };

  const claimReward = (day: number) => {
    if (day !== currentDay) return;

    const updated = rewards.map(r =>
      r.day === day
        ? { ...r, claimed: true, available: false }
        : r.day === day + 1
        ? { ...r, available: true }
        : r
    );

    setRewards(updated);
    setCurrentDay(day + 1);
    setShowClaimAnimation(true);

    // Save to localStorage
    const today = new Date().toISOString().split('T')[0];
    localStorage.setItem('daily_rewards', JSON.stringify(updated));
    localStorage.setItem('daily_rewards_last_claim', today);

    setTimeout(() => setShowClaimAnimation(false), 2000);
  };

  return (
    <div className={cn('space-y-6', className)} data-testid="daily-rewards">
      {/* Header */}
      <div className="text-center">
        <motion.div
          initial={{ scale: 0.9, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          className="inline-flex items-center gap-2 mb-3"
        >
          <Calendar className="w-6 h-6 text-emerald-400" />
          <h2 className="text-2xl font-bold text-white">
            Ежедневные награды
          </h2>
        </motion.div>
        <p className="text-white/60 text-sm">
          Заходите каждый день и получайте награды
        </p>
        <div className="mt-2 inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/20 border border-emerald-500/30">
          <Sparkles className="w-4 h-4 text-emerald-400" />
          <span className="text-sm font-semibold text-emerald-300">
            День {currentDay} из 30
          </span>
        </div>
      </div>

      {/* Rewards Grid */}
      <div className="grid grid-cols-5 gap-3">
        {rewards.map((reward, index) => (
          <motion.div
            key={reward.day}
            initial={{ opacity: 0, scale: 0.8 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: index * 0.02 }}
            className={cn(
              'relative aspect-square rounded-xl p-3 flex flex-col items-center justify-center text-center transition-all cursor-pointer',
              reward.claimed
                ? 'bg-emerald-500/20 border-2 border-emerald-500/50'
                : reward.available
                ? 'bg-white/10 border-2 border-emerald-500 hover:bg-white/15 hover:scale-105 active:scale-95'
                : 'bg-white/5 border border-white/10 opacity-60',
              reward.special && !reward.claimed && 'ring-2 ring-amber-500/50'
            )}
            onClick={() => reward.available && claimReward(reward.day)}
            whileHover={reward.available ? { scale: 1.05 } : {}}
            whileTap={reward.available ? { scale: 0.95 } : {}}
            data-testid={`reward-day-${reward.day}`}
          >
            {/* Special Badge */}
            {reward.special && !reward.claimed && (
              <div className="absolute -top-2 -right-2 w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center">
                <Sparkles className="w-3 h-3 text-white" />
              </div>
            )}

            {/* Status Icon */}
            <div className="mb-1">
              {reward.claimed ? (
                <CheckCircle2 className="w-6 h-6 text-emerald-400" />
              ) : reward.available ? (
                <Gift className="w-6 h-6 text-emerald-400 animate-bounce" />
              ) : (
                <Lock className="w-6 h-6 text-white/40" />
              )}
            </div>

            {/* Day Number */}
            <div className={cn(
              'text-lg font-bold',
              reward.claimed
                ? 'text-emerald-300'
                : reward.available
                ? 'text-white'
                : 'text-white/40'
            )}>
              {reward.day}
            </div>

            {/* XP Badge */}
            <div className={cn(
              'mt-1 text-xs font-semibold',
              reward.special ? 'text-amber-400' : 'text-white/60'
            )}>
              +{reward.xp} XP
            </div>
          </motion.div>
        ))}
      </div>

      {/* Current Reward Details */}
      {rewards.find(r => r.available) && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="glass-medium rounded-2xl p-6 border border-emerald-500/30"
        >
          <div className="flex items-start gap-4">
            <div className="w-16 h-16 rounded-xl bg-gradient-to-br from-emerald-500 to-emerald-600 flex items-center justify-center flex-shrink-0">
              <Gift className="w-8 h-8 text-white" />
            </div>
            <div className="flex-1">
              <h3 className="text-lg font-bold text-white mb-1">
                Награда дня {currentDay}
              </h3>
              <p className="text-white/70 text-sm mb-3">
                {rewards.find(r => r.available)?.reward}
              </p>
              <button
                onClick={() => {
                  const available = rewards.find(r => r.available);
                  if (available) claimReward(available.day);
                }}
                className="px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 transition-all duration-300 hover:scale-105 active:scale-95"
                data-testid="button-claim-reward"
              >
                Получить награду
              </button>
            </div>
          </div>
        </motion.div>
      )}

      {/* Claim Animation */}
      {showClaimAnimation && (
        <motion.div
          initial={{ scale: 0, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          exit={{ scale: 0, opacity: 0 }}
          className="fixed inset-0 flex items-center justify-center z-50 pointer-events-none"
        >
          <div className="glass-strong rounded-3xl p-8 text-center animate-success-scale">
            <div className="w-20 h-20 rounded-full bg-emerald-500 mx-auto flex items-center justify-center mb-4">
              <CheckCircle2 className="w-12 h-12 text-white" />
            </div>
            <h3 className="text-2xl font-bold text-white mb-2">
              Награда получена!
            </h3>
            <p className="text-white/70">
              +{rewards.find(r => r.day === currentDay - 1)?.xp} XP
            </p>
          </div>
        </motion.div>
      )}
    </div>
  );
}

interface RewardStreakProps {
  currentStreak: number;
  bestStreak: number;
  className?: string;
}

export function RewardStreak({
  currentStreak,
  bestStreak,
  className = ''
}: RewardStreakProps) {
  return (
    <div className={cn('flex items-center gap-6 justify-center', className)}>
      <div className="text-center">
        <div className="flex items-center justify-center gap-2 mb-1">
          <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse" />
          <span className="text-xs font-semibold text-white/60 uppercase tracking-wider">
            Текущий стрик
          </span>
        </div>
        <div className="flex items-center gap-2">
          <span className="text-3xl font-bold text-white">{currentStreak}</span>
          <span className="text-white/60">дней</span>
        </div>
      </div>

      <div className="w-px h-12 bg-white/10" />

      <div className="text-center">
        <div className="flex items-center justify-center gap-2 mb-1">
          <Sparkles className="w-3 h-3 text-amber-400" />
          <span className="text-xs font-semibold text-white/60 uppercase tracking-wider">
            Лучший стрик
          </span>
        </div>
        <div className="flex items-center gap-2">
          <span className="text-3xl font-bold text-amber-400">{bestStreak}</span>
          <span className="text-white/60">дней</span>
        </div>
      </div>
    </div>
  );
}
```

### components/DemoAppLanding.tsx
```tsx
import { ArrowLeft, Star, Play, ExternalLink } from "lucide-react";
import { demoApps } from "@/data/demoApps";
import { useTelegram } from "@/hooks/useTelegram";

interface DemoAppLandingProps {
  demoId: string;
}

export default function DemoAppLanding({ demoId }: DemoAppLandingProps) {
  const { hapticFeedback } = useTelegram();
  
  // Find the demo app
  const demoApp = demoApps.find(app => app.id === demoId);
  
  if (!demoApp) {
    return (
      <div className="min-h-screen bg-system-background flex items-center justify-center">
        <div className="max-w-md mx-auto px-4 text-center">
          <h2 className="ios-title2 font-bold mb-2">Приложение не найдено</h2>
          <p className="ios-body text-secondary-label mb-4">
            Запрошенное приложение не существует
          </p>
          <button
            onClick={() => window.location.hash = '/'}
            className="ios-button-filled"
          >
            На главную
          </button>
        </div>
      </div>
    );
  }

  const handleEnterApp = () => {
    hapticFeedback?.medium();
    window.location.hash = `/demos/${demoId}/app`;
  };

  const goBack = () => {
    hapticFeedback?.light();
    window.location.hash = '/';
  };

  const { home } = demoApp;

  return (
    <div className="min-h-screen bg-black">
      {/* Header */}
      <header className="sticky top-0 z-40 bg-white/10 backdrop-blur-xl border-b border-white/20">
        <div className="max-w-md mx-auto px-4 py-5">
          <div className="flex items-center space-x-3">
            <button
              onClick={goBack}
              className="ios-button-plain"
              aria-label="Назад"
            >
              <ArrowLeft className="w-5 h-5" />
            </button>
            
            <div className="flex-1 text-center">
              <h1 className="ios-headline font-semibold truncate">{demoApp.title}</h1>
              <p className="ios-caption1 text-system-blue">{demoApp.category}</p>
            </div>
            
            <div className="flex items-center space-x-1">
              <Star className="w-4 h-4 text-system-yellow fill-current" />
              <span className="ios-caption2 font-medium">4.9</span>
            </div>
          </div>
        </div>
      </header>

      {/* Hero Section */}
      {home?.hero && (
        <section className="relative overflow-hidden">
          <div className={`h-64 ${home.hero.bgClass || 'bg-gradient-to-r from-blue-500 to-purple-600'}`}>
            {home.hero.image && (
              <img 
                src={home.hero.image} 
                alt={home.hero.title}
                className="w-full h-full object-cover absolute inset-0 mix-blend-overlay"
              />
            )}
            <div className="relative h-full flex items-center justify-center text-center text-white">
              <div className="max-w-md mx-auto px-4">
                <h2 className="ios-title1 font-bold mb-2">
                  {home.hero.title || `Добро пожаловать в ${demoApp.title}`}
                </h2>
                <p className="ios-body opacity-90">
                  {home.hero.subtitle || demoApp.description}
                </p>
              </div>
            </div>
          </div>
        </section>
      )}

      {/* Banners Section */}
      {home?.banners && home.banners.length > 0 && (
        <section className="py-6">
          <div className="max-w-md mx-auto px-4">
            <div className="space-y-4">
              {home.banners.map((banner, index) => (
                <div 
                  key={index}
                  className={`relative overflow-hidden rounded-2xl h-32 ${banner.bgClass || 'bg-gradient-to-r from-indigo-500 to-purple-600'}`}
                >
                  {banner.image && (
                    <img 
                      src={banner.image} 
                      alt={banner.title}
                      className="w-full h-full object-cover absolute inset-0 mix-blend-overlay"
                    />
                  )}
                  <div className="relative h-full flex items-center text-white p-6">
                    <div>
                      <h3 className="ios-title3 font-bold mb-1">{banner.title}</h3>
                      {banner.subtitle && (
                        <p className="ios-body opacity-90">{banner.subtitle}</p>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )}

      {/* Services Section */}
      {home?.services && home.services.length > 0 && (
        <section className="pb-8">
          <div className="max-w-md mx-auto px-4">
            <h3 className="ios-title2 font-bold mb-4">Основные функции</h3>
            <div className="space-y-3">
              {home.services.map((service) => (
                <div 
                  key={service.id}
                  className="bg-white/10 backdrop-blur-xl rounded-2xl p-4 border border-white/20 hover:border-system-blue/30 transition-colors"
                >
                  <div className="flex items-center space-x-4">
                    <div className="w-12 h-12 bg-system-blue/10 rounded-xl flex items-center justify-center">
                      {service.image ? (
                        <img 
                          src={service.image} 
                          alt={service.title}
                          className="w-8 h-8 object-cover rounded"
                        />
                      ) : (
                        <div className="w-6 h-6 bg-system-blue/20 rounded"></div>
                      )}
                    </div>
                    <div className="flex-1">
                      <h4 className="ios-body font-semibold">{service.title}</h4>
                      {service.priceText && (
                        <p className="ios-caption1 text-secondary-label">{service.priceText}</p>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>
      )}

      {/* Demo Info Section */}
      <section className="py-6 bg-secondary-system-background">
        <div className="max-w-md mx-auto px-4">
          <div className="bg-white/10 backdrop-blur-xl rounded-2xl p-6 border border-white/20">
            <div className="text-center mb-4">
              <h3 className="ios-title2 font-bold mb-2">О демо-приложении</h3>
              <p className="ios-body text-secondary-label">
                {demoApp.description}
              </p>
            </div>
            
            <div className="flex items-center justify-between py-3 border-t border-separator">
              <span className="ios-body text-secondary-label">Категория</span>
              <span className="ios-body font-medium">{demoApp.category}</span>
            </div>
            
            <div className="flex items-center justify-between py-3 border-t border-separator">
              <span className="ios-body text-secondary-label">Разработчик</span>
              <span className="ios-body font-medium">{demoApp.creator}</span>
            </div>
            
            <div className="flex items-center justify-between py-3 border-t border-separator">
              <span className="ios-body text-secondary-label">Лайки</span>
              <div className="flex items-center space-x-1">
                <span className="ios-body font-medium">{demoApp.likes}</span>
                <Star className="w-4 h-4 text-system-yellow fill-current" />
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Bottom CTA */}
      <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-separator safe-area-bottom">
        <div className="max-w-md mx-auto px-4 py-3">
          <div className="flex space-x-3">
            <button
              onClick={handleEnterApp}
              className="flex-1 ios-button-filled flex items-center justify-center space-x-2"
            >
              <Play className="w-4 h-4" />
              <span>Открыть демо</span>
            </button>
            <button
              onClick={() => window.location.hash = '/projects'}
              className="px-4 ios-button-tinted flex items-center justify-center"
              aria-label="Все проекты"
            >
              <ExternalLink className="w-4 h-4" />
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}```

### components/DemoAppShell.tsx
```tsx
import { useState, Suspense, memo, useEffect } from "react";
import { Home, Grid3X3, ShoppingCart, User } from "lucide-react";
import { demoApps } from "../data/demoApps";
import { useTelegram } from "../hooks/useTelegram";
import { getDemoComponent, isDemoAvailable } from "./demos/DemoRegistry";
import { LiquidHomeButton } from "./ui/liquid-home-button";

interface DemoAppShellProps {
  demoId: string;
  onClose: () => void;
}

type TabType = 'home' | 'catalog' | 'cart' | 'profile';

const navItems: { id: TabType; icon: any; label: string }[] = [
  { id: 'home', icon: Home, label: 'Главная' },
  { id: 'catalog', icon: Grid3X3, label: 'Каталог' },
  { id: 'cart', icon: ShoppingCart, label: 'Корзина' },
  { id: 'profile', icon: User, label: 'Профиль' },
];

const DemoAppShell = memo(function DemoAppShell({ demoId, onClose }: DemoAppShellProps) {
  const [activeTab, setActiveTab] = useState<TabType>('home');
  const { hapticFeedback } = useTelegram();
  
  // Scroll to top when demo opens - single optimized call
  useEffect(() => {
    requestAnimationFrame(() => {
      window.scrollTo({ top: 0, behavior: 'instant' });
    });
  }, [demoId]);
  
  // Extract base app type from ID to support variants (e.g., 'clothing-store-2' → 'clothing-store')
  const getBaseAppType = (id: string): string => {
    // Remove variant suffixes (-2, -3, etc.) to get base type
    return id.replace(/-\d+$/, '');
  };

  // Find demo app - first try exact match, then base type fallback
  const demoApp = demoApps.find(app => app.id === demoId) || 
                  demoApps.find(app => app.id === getBaseAppType(demoId));
  
  if (!demoApp) {
    return (
      <div className="min-h-screen bg-[#0A0A0A] flex items-center justify-center">
        <div className="bg-white/5 border border-white/10 rounded-3xl p-6 mx-4 text-center">
          <h3 className="text-lg font-semibold text-white mb-2">Демо не найдено</h3>
          <p className="text-sm text-white/50">
            Приложение временно недоступно
          </p>
        </div>
      </div>
    );
  }

  const handleTabSwitch = (tab: TabType) => {
    setActiveTab(tab);
    if (hapticFeedback?.selection) {
      hapticFeedback.selection();
    }
  };

  const handleStringNavigation = (tab: string) => {
    const tabType = tab as TabType;
    handleTabSwitch(tabType);
  };

  // Navigate to main app (showcase page) using hash-based routing
  const handleNavigateHome = () => {
    window.location.hash = '#/';
    if (hapticFeedback?.medium) {
      hapticFeedback.medium();
    }
  };

  // No loading screen - instant load
  const DemoLoader = () => null;

  const renderDemoContent = () => {
    // First try exact ID match, then fallback to base type
    const exactMatch = isDemoAvailable(demoId);
    const baseAppType = exactMatch ? demoId : getBaseAppType(demoId);
    
    // Check if demo is available in registry
    if (!isDemoAvailable(baseAppType)) {
      return (
        <div className="min-h-screen bg-[#0A0A0A] flex items-center justify-center">
          <div className="bg-white/5 border border-white/10 rounded-3xl p-6 mx-4 text-center">
            <h3 className="text-lg font-semibold text-white mb-2">Демо недоступно</h3>
            <p className="text-sm text-white/50">
              Приложение {baseAppType} временно недоступно
            </p>
          </div>
        </div>
      );
    }

    // Get dynamic component from registry
    const DemoComponent = getDemoComponent(baseAppType);
    
    if (!DemoComponent) {
      return (
        <div className="min-h-screen bg-[#0A0A0A] flex items-center justify-center">
          <div className="bg-white/5 border border-white/10 rounded-3xl p-6 mx-4 text-center">
            <h3 className="text-lg font-semibold text-white mb-2">Ошибка загрузки</h3>
            <p className="text-sm text-white/50">
              Не удалось загрузить приложение
            </p>
          </div>
        </div>
      );
    }

    return (
      <Suspense fallback={null}>
        <DemoComponent activeTab={activeTab} onTabChange={handleStringNavigation} />
      </Suspense>
    );
    
  };

  // All apps use dark theme by default for premium look
  const isDarkTheme = true;
  
  // Theme colors for each app
  const getThemeColors = () => {
    if (demoId.includes('clothing-store')) {
      return {
        accentColor: '#C5E1A5',
        glowColor: 'rgba(197, 225, 165, 0.6)',
      };
    } else if (demoId.includes('electronics')) {
      return {
        accentColor: '#00D4FF',
        glowColor: 'rgba(0, 212, 255, 0.6)',
      };
    } else if (demoId.includes('beauty')) {
      return {
        accentColor: '#EC4899',
        glowColor: 'rgba(236, 72, 153, 0.6)',
      };
    } else if (demoId.includes('restaurant')) {
      return {
        accentColor: '#D97706',
        glowColor: 'rgba(217, 119, 6, 0.6)',
      };
    }
    return {
      accentColor: '#10B981',
      glowColor: 'rgba(16, 185, 129, 0.6)',
    };
  };
  
  const theme = getThemeColors();
  
  // Get background gradient based on app - all dark by default
  const getBackgroundGradient = () => {
    // All demos use pure black background for consistent dark premium look
    return 'bg-[#0A0A0A]';
  };

  return (
    <div className={`min-h-screen flex flex-col ${isDarkTheme ? 'bg-[#0A0A0A]' : 'bg-gray-100'}`}>
      {/* Mobile Container - Max width for desktop view */}
      <div className={`w-full max-w-md mx-auto ${isDarkTheme ? getBackgroundGradient() : 'bg-white'} min-h-screen flex flex-col relative shadow-2xl`}>
        
        {/* Demo Content Area - Telegram safe area bottom */}
        <div className="flex-1 tg-content-safe-bottom" style={{ paddingBottom: 'max(6rem, var(--csab, 0px))' }} data-testid="demo-content">
          {renderDemoContent()}
        </div>

        {/* Sticky Home Button */}
        <div 
          className="sticky right-5 z-50 pointer-events-none"
          style={{
            bottom: 'calc(100px + max(0px, env(safe-area-inset-bottom, 0px)))',
            marginLeft: 'auto',
            width: 'fit-content'
          }}
        >
          <div className="pointer-events-auto">
            <LiquidHomeButton onNavigateHome={handleNavigateHome} />
          </div>
        </div>
      </div>

      {/* Liquid Glass Bottom Navigation - Same style as main page */}
      <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 w-auto">
        <div className="relative">
          {/* Animated Background Glow */}
          <div 
            className="absolute -inset-2 rounded-full opacity-20"
            style={{
              background: `radial-gradient(circle, ${theme.glowColor} 0%, ${theme.glowColor.replace('0.6', '0.2')} 50%, transparent 70%)`,
              filter: 'blur(20px)',
              animation: 'pulse 3s ease-in-out infinite',
            }}
          />
          
          {/* Liquid Glass Container */}
          <div 
            className={`relative backdrop-blur-xl rounded-full border px-4 py-3 shadow-2xl ${
              isDarkTheme 
                ? 'border-white/20' 
                : 'border-white/30'
            }`}
            style={{
              background: isDarkTheme 
                ? 'linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%)'
                : 'linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%)',
              boxShadow: isDarkTheme 
                ? `0 8px 32px rgba(0, 0, 0, 0.6),
                   inset 0 1px 0 rgba(255, 255, 255, 0.2),
                   inset 0 -1px 0 rgba(0, 0, 0, 0.3),
                   0 0 60px ${theme.glowColor.replace('0.6', '0.15')}`
                : `0 8px 32px rgba(0, 0, 0, 0.4),
                   inset 0 1px 0 rgba(255, 255, 255, 0.3),
                   inset 0 -1px 0 rgba(0, 0, 0, 0.2),
                   0 0 60px ${theme.glowColor.replace('0.6', '0.2')}`,
            }}
          >
            {/* Inner Highlight */}
            <div 
              className="absolute top-1 left-1/4 right-1/4 h-px bg-gradient-to-r from-transparent via-white/50 to-transparent rounded-full"
            />
            
            <nav className="relative flex items-center justify-center gap-2" role="navigation" aria-label="Навигация демо">
              {/* Liquid Glass Blob - анимированная капля под активной иконкой */}
              <div 
                className="absolute transition-all duration-500 ease-out pointer-events-none"
                style={{
                  left: activeTab === 'home' ? '-2px' :
                        activeTab === 'catalog' ? '54px' :
                        activeTab === 'cart' ? '110px' :
                        activeTab === 'profile' ? '166px' : '-2px',
                  top: '-2px',
                  width: '52px',
                  height: '52px',
                  zIndex: 1,
                }}
              >
                {/* Основной слой капли */}
                <div 
                  className="absolute inset-0"
                  style={{
                    background: `radial-gradient(ellipse 100% 90% at 50% 45%, ${theme.glowColor.replace('0.6', '0.35')} 0%, ${theme.glowColor.replace('0.6', '0.22')} 40%, transparent 70%)`,
                    borderRadius: '45% 55% 50% 50% / 50% 50% 45% 55%',
                    filter: 'blur(12px)',
                    animation: 'liquid-morph 4s ease-in-out infinite',
                  }}
                />
                {/* Второй слой капли */}
                <div 
                  className="absolute inset-0"
                  style={{
                    background: `radial-gradient(ellipse at center, ${theme.glowColor.replace('0.6', '0.28')} 0%, ${theme.glowColor.replace('0.6', '0.15')} 50%, transparent 70%)`,
                    borderRadius: '50% 45% 55% 50% / 55% 50% 50% 45%',
                    filter: 'blur(16px)',
                    animation: 'liquid-morph-reverse 5s ease-in-out infinite',
                  }}
                />
                {/* Внутреннее свечение */}
                <div 
                  className="absolute inset-0"
                  style={{
                    background: `radial-gradient(circle at center, ${theme.glowColor.replace('0.6', '0.4')} 0%, ${theme.glowColor.replace('0.6', '0.18')} 30%, transparent 60%)`,
                    borderRadius: '50%',
                    filter: 'blur(8px)',
                  }}
                />
              </div>
              
              {/* Главная */}
              <button
                onClick={() => handleTabSwitch('home')}
                className={`relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 ${
                  isDarkTheme ? 'hover:bg-white/5' : 'hover:bg-white/10'
                }`}
                style={{ zIndex: 10 }}
                aria-label="Главная"
                aria-current={activeTab === 'home' ? 'page' : undefined}
                data-testid="nav-home"
              >
                <Home
                  className={`transition-all duration-300 ${
                    activeTab === 'home' 
                      ? 'w-6 h-6' 
                      : 'w-5 h-5'
                  } ${
                    isDarkTheme 
                      ? (activeTab === 'home' ? 'text-white' : 'text-white/70 hover:text-white')
                      : (activeTab === 'home' ? 'text-gray-900' : 'text-gray-500 hover:text-gray-900')
                  }`}
                  strokeWidth={2}
                />
              </button>
              
              {/* Каталог */}
              <button
                onClick={() => handleTabSwitch('catalog')}
                className={`relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 ${
                  isDarkTheme ? 'hover:bg-white/5' : 'hover:bg-white/10'
                }`}
                style={{ zIndex: 10 }}
                aria-label="Каталог"
                aria-current={activeTab === 'catalog' ? 'page' : undefined}
                data-testid="nav-catalog"
              >
                <Grid3X3
                  className={`transition-all duration-300 ${
                    activeTab === 'catalog' 
                      ? 'w-6 h-6' 
                      : 'w-5 h-5'
                  } ${
                    isDarkTheme 
                      ? (activeTab === 'catalog' ? 'text-white' : 'text-white/70 hover:text-white')
                      : (activeTab === 'catalog' ? 'text-gray-900' : 'text-gray-500 hover:text-gray-900')
                  }`}
                  strokeWidth={2}
                />
              </button>
              
              {/* Корзина */}
              <button
                onClick={() => handleTabSwitch('cart')}
                className={`relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 ${
                  isDarkTheme ? 'hover:bg-white/5' : 'hover:bg-white/10'
                }`}
                style={{ zIndex: 10 }}
                aria-label="Корзина"
                aria-current={activeTab === 'cart' ? 'page' : undefined}
                data-testid="nav-cart"
              >
                <ShoppingCart
                  className={`transition-all duration-300 ${
                    activeTab === 'cart' 
                      ? 'w-6 h-6' 
                      : 'w-5 h-5'
                  } ${
                    isDarkTheme 
                      ? (activeTab === 'cart' ? 'text-white' : 'text-white/70 hover:text-white')
                      : (activeTab === 'cart' ? 'text-gray-900' : 'text-gray-500 hover:text-gray-900')
                  }`}
                  strokeWidth={2}
                />
              </button>
              
              {/* Профиль */}
              <button
                onClick={() => handleTabSwitch('profile')}
                className={`relative flex items-center justify-center w-12 h-12 rounded-full transition-all duration-300 ${
                  isDarkTheme ? 'hover:bg-white/5' : 'hover:bg-white/10'
                }`}
                style={{ zIndex: 10 }}
                aria-label="Профиль"
                aria-current={activeTab === 'profile' ? 'page' : undefined}
                data-testid="nav-profile"
              >
                <User
                  className={`transition-all duration-300 ${
                    activeTab === 'profile' 
                      ? 'w-6 h-6' 
                      : 'w-5 h-5'
                  } ${
                    isDarkTheme 
                      ? (activeTab === 'profile' ? 'text-white' : 'text-white/70 hover:text-white')
                      : (activeTab === 'profile' ? 'text-gray-900' : 'text-gray-500 hover:text-gray-900')
                  }`}
                  strokeWidth={2}
                />
              </button>
              
            </nav>
          </div>
        </div>
      </div>
    </div>
  );
});

export default DemoAppShell;
```

### components/EmptyState.tsx
```tsx
import { LucideIcon } from 'lucide-react';

interface EmptyStateProps {
  icon: LucideIcon;
  title: string;
  description: string;
  action?: {
    label: string;
    onClick: () => void;
  };
  className?: string;
}

export function EmptyState({ 
  icon: Icon, 
  title, 
  description, 
  action,
  className = '' 
}: EmptyStateProps) {
  return (
    <div className={`flex flex-col items-center justify-center py-12 px-6 text-center ${className}`}>
      <div className="glass-medium rounded-full p-6 mb-4">
        <Icon className="w-12 h-12 text-emerald-400" />
      </div>
      
      <h3 className="text-xl font-semibold text-white mb-2">
        {title}
      </h3>
      
      <p className="text-white/60 text-sm mb-6 max-w-sm">
        {description}
      </p>
      
      {action && (
        <button
          onClick={action.onClick}
          className="px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 transition-all duration-300 hover:scale-105 active:scale-95"
          data-testid="button-empty-state-action"
        >
          {action.label}
        </button>
      )}
    </div>
  );
}
```

### components/ErrorBoundary.tsx
```tsx
import React, { Component, ErrorInfo, ReactNode } from 'react';
import { AlertTriangle, RefreshCw } from 'lucide-react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  handleReset = () => {
    this.setState({ hasError: false, error: null });
  };

  render() {
    if (this.state.hasError) {
      if (this.props.fallback) {
        return this.props.fallback;
      }

      return (
        <div className="min-h-screen flex items-center justify-center bg-black p-4">
          <div className="max-w-md w-full bg-gray-900 rounded-2xl p-8 text-center">
            <div className="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
              <AlertTriangle className="w-8 h-8 text-red-500" />
            </div>
            
            <h2 className="text-2xl font-bold text-white mb-2">
              Что-то пошло не так
            </h2>
            
            <p className="text-gray-400 mb-6">
              Произошла ошибка при загрузке приложения
            </p>
            
            {this.state.error && (
              <details className="mb-6 text-left">
                <summary className="text-sm text-gray-500 cursor-pointer hover:text-gray-400">
                  Технические детали
                </summary>
                <pre className="mt-2 text-xs text-red-400 bg-black/50 rounded p-3 overflow-auto max-h-32">
                  {this.state.error.message}
                </pre>
              </details>
            )}
            
            <button
              onClick={this.handleReset}
              className="w-full flex items-center justify-center space-x-2 bg-green-500 hover:bg-green-600 text-black font-medium py-3 px-6 rounded-xl transition-colors"
            >
              <RefreshCw className="w-5 h-5" />
              <span>Попробовать снова</span>
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

### components/ExpressPayment.tsx
```tsx
import { Apple, CreditCard, Smartphone } from 'lucide-react';
import { SiGooglepay } from 'react-icons/si';
import { cn } from '@/lib/utils';

interface ExpressPaymentButtonProps {
  provider: 'apple' | 'google' | 'sbp' | 'card';
  amount?: number;
  currency?: string;
  onClick: () => void;
  disabled?: boolean;
  className?: string;
}

export function ExpressPaymentButton({
  provider,
  amount,
  currency = '₽',
  onClick,
  disabled = false,
  className = ''
}: ExpressPaymentButtonProps) {
  const getButtonConfig = () => {
    switch (provider) {
      case 'apple':
        return {
          icon: Apple,
          label: 'Apple Pay',
          bgClass: 'bg-black hover:bg-gray-900',
          textClass: 'text-white',
        };
      case 'google':
        return {
          icon: SiGooglepay,
          label: 'Google Pay',
          bgClass: 'bg-white hover:bg-gray-100',
          textClass: 'text-gray-900',
        };
      case 'sbp':
        return {
          icon: Smartphone,
          label: 'СБП',
          bgClass: 'bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700',
          textClass: 'text-white',
        };
      case 'card':
        return {
          icon: CreditCard,
          label: 'Банковская карта',
          bgClass: 'bg-emerald-600 hover:bg-emerald-700',
          textClass: 'text-white',
        };
    }
  };

  const config = getButtonConfig();
  const Icon = config.icon;

  return (
    <button
      onClick={onClick}
      disabled={disabled}
      className={cn(
        'group relative w-full flex items-center justify-center gap-3 px-6 py-4 rounded-2xl font-semibold transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100',
        config.bgClass,
        config.textClass,
        className
      )}
      data-testid={`button-pay-${provider}`}
    >
      <Icon className="w-6 h-6" />
      <span className="flex items-center gap-2">
        {config.label}
        {amount && (
          <span className="font-bold">
            {amount.toLocaleString('ru-RU')} {currency}
          </span>
        )}
      </span>
      
      {/* Shine effect on hover */}
      <div className="absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none" />
    </button>
  );
}

interface ExpressPaymentGroupProps {
  amount: number;
  currency?: string;
  onApplePay?: () => void;
  onGooglePay?: () => void;
  onSBP?: () => void;
  onCard?: () => void;
  showApplePay?: boolean;
  showGooglePay?: boolean;
  showSBP?: boolean;
  showCard?: boolean;
  className?: string;
}

export function ExpressPaymentGroup({
  amount,
  currency = '₽',
  onApplePay,
  onGooglePay,
  onSBP,
  onCard,
  showApplePay = true,
  showGooglePay = true,
  showSBP = true,
  showCard = true,
  className = ''
}: ExpressPaymentGroupProps) {
  return (
    <div className={cn('space-y-3', className)}>
      <div className="text-center mb-4">
        <h3 className="text-lg font-bold text-white mb-1">
          Быстрая оплата
        </h3>
        <p className="text-sm text-white/60">
          Выберите удобный способ
        </p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
        {showApplePay && onApplePay && (
          <ExpressPaymentButton
            provider="apple"
            amount={amount}
            currency={currency}
            onClick={onApplePay}
          />
        )}
        
        {showGooglePay && onGooglePay && (
          <ExpressPaymentButton
            provider="google"
            amount={amount}
            currency={currency}
            onClick={onGooglePay}
          />
        )}
      </div>

      {showSBP && onSBP && (
        <ExpressPaymentButton
          provider="sbp"
          amount={amount}
          currency={currency}
          onClick={onSBP}
        />
      )}

      {showCard && onCard && (
        <>
          <div className="relative my-6">
            <div className="absolute inset-0 flex items-center">
              <div className="w-full border-t border-white/10" />
            </div>
            <div className="relative flex justify-center text-sm">
              <span className="px-4 bg-black text-white/40">или</span>
            </div>
          </div>

          <ExpressPaymentButton
            provider="card"
            amount={amount}
            currency={currency}
            onClick={onCard}
          />
        </>
      )}
    </div>
  );
}

interface PaymentMethodSelectorProps {
  selectedMethod: 'apple' | 'google' | 'sbp' | 'card' | null;
  onSelect: (method: 'apple' | 'google' | 'sbp' | 'card') => void;
  className?: string;
}

export function PaymentMethodSelector({
  selectedMethod,
  onSelect,
  className = ''
}: PaymentMethodSelectorProps) {
  const methods: Array<{ id: 'apple' | 'google' | 'sbp' | 'card'; icon: any; label: string }> = [
    { id: 'apple', icon: Apple, label: 'Apple Pay' },
    { id: 'google', icon: SiGooglepay, label: 'Google Pay' },
    { id: 'sbp', icon: Smartphone, label: 'СБП' },
    { id: 'card', icon: CreditCard, label: 'Карта' },
  ];

  return (
    <div className={cn('grid grid-cols-2 md:grid-cols-4 gap-3', className)}>
      {methods.map((method) => {
        const Icon = method.icon;
        const isSelected = selectedMethod === method.id;

        return (
          <button
            key={method.id}
            onClick={() => onSelect(method.id)}
            className={cn(
              'flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all duration-300 hover-elevate active-elevate-2',
              isSelected
                ? 'border-emerald-500 bg-emerald-500/10'
                : 'border-white/10 bg-white/5'
            )}
            data-testid={`select-payment-${method.id}`}
          >
            <Icon className={cn(
              'w-8 h-8 transition-colors',
              isSelected ? 'text-emerald-400' : 'text-white/60'
            )} />
            <span className={cn(
              'text-sm font-medium transition-colors',
              isSelected ? 'text-white' : 'text-white/60'
            )}>
              {method.label}
            </span>
          </button>
        );
      })}
    </div>
  );
}
```

### components/GamificationHub.tsx
```tsx
import { motion } from '@/utils/LazyMotionProvider';
import { 
  GiTreasureMap,
  GiBinoculars,
  GiTrophyCup,
  GiFlame,
  GiHammerNails,
  GiBrickWall,
  GiRocketFlight,
  GiLightningHelix,
  GiCutDiamond,
  GiImperialCrown,
  GiShield,
  GiSparkles,
  GiBullseye,
  GiLaurelCrown,
  GiPodium
} from 'react-icons/gi';
import { useMemo, memo } from 'react';
import { useGamification, type DailyTask, type Achievement } from '@/hooks/useGamification';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { 
  BronzeMedal, 
  SilverMedal, 
  GoldMedal, 
  PlatinumMedal
} from '@/components/icons/GamificationIcons';

// Memoized Daily Task Component
const DailyTaskItem = memo(({ task, index }: { task: DailyTask, index: number }) => (
  <motion.div
    initial={{ opacity: 0, x: -20 }}
    animate={{ opacity: 1, x: 0 }}
    transition={{ delay: index * 0.1 }}
    className={`p-4 rounded-lg border ${
      task.completed
        ? 'bg-emerald-500/20 border-emerald-500/30'
        : 'bg-white/5 border-white/10'
    }`}
    data-testid={`task-${task.id}`}
  >
    <div className="flex items-start justify-between mb-2">
      <div className="flex-1">
        <h4 className={`text-sm font-semibold ${
          task.completed ? 'text-emerald-300 line-through' : 'text-white'
        }`}>
          {task.name}
        </h4>
        <p className="text-xs text-white/60 mt-1">{task.description}</p>
      </div>
      <Badge 
        variant={task.completed ? "default" : "secondary"}
        className={task.completed ? 'bg-emerald-500' : ''}
      >
        +{task.xp} XP
      </Badge>
    </div>
    <Progress 
      value={(task.progress / task.maxProgress) * 100} 
      className="h-1.5 bg-white/10" 
    />
  </motion.div>
));
DailyTaskItem.displayName = 'DailyTaskItem';

// Memoized Achievement Component
const AchievementItem = memo(({ achievement, index, iconMap }: { 
  achievement: Achievement, 
  index: number,
  iconMap: Record<string, React.ReactNode>
}) => (
  <motion.div
    initial={{ opacity: 0, scale: 0.9 }}
    animate={{ opacity: 1, scale: 1 }}
    transition={{ delay: index * 0.1 }}
    className={`p-4 rounded-lg border text-center ${
      achievement.unlocked
        ? 'bg-gradient-to-br from-amber-500/20 to-orange-500/20 border-amber-500/30'
        : 'bg-white/5 border-white/10 opacity-60'
    }`}
    data-testid={`achievement-${achievement.id}`}
  >
    <motion.div
      className="flex justify-center mb-2"
      whileHover={{ scale: 1.1, rotate: 5 }}
      transition={{ type: "spring", stiffness: 300 }}
    >
      {iconMap[achievement.icon] || achievement.icon}
    </motion.div>
    <h4 className="text-xs font-semibold text-white mb-1">
      {achievement.name}
    </h4>
    <Badge 
      variant="outline" 
      className={`text-[10px] h-5 ${
        achievement.level === 'Platinum' ? 'bg-gradient-to-r from-cyan-500/20 to-blue-500/20 border-cyan-400/50' :
        achievement.level === 'Gold' ? 'bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border-yellow-400/50' :
        achievement.level === 'Silver' ? 'bg-gradient-to-r from-gray-400/20 to-gray-300/20 border-gray-400/50' :
        'bg-gradient-to-r from-orange-700/20 to-orange-600/20 border-orange-600/50'
      }`}
    >
      {achievement.level}
    </Badge>
    <div className="mt-2">
      <Progress 
        value={(achievement.progress / achievement.maxProgress) * 100} 
        className="h-1 bg-white/10" 
      />
      <p className="text-[10px] text-white/50 mt-1">
        {achievement.progress}/{achievement.maxProgress}
      </p>
    </div>
  </motion.div>
));
AchievementItem.displayName = 'AchievementItem';

// Memoized Leaderboard Item Component
const LeaderboardItem = memo(({ entry, position }: { entry: any, position: number }) => {
  const getRankMedal = () => {
    if (position === 0) return <GoldMedal className="w-6 h-6" />;
    if (position === 1) return <SilverMedal className="w-6 h-6" />;
    if (position === 2) return <BronzeMedal className="w-6 h-6" />;
    return null;
  };

  return (
    <motion.div
      initial={{ opacity: 0, x: -20 }}
      animate={{ opacity: 1, x: 0 }}
      transition={{ delay: position * 0.05 }}
      className={`flex items-center justify-between p-3 rounded-lg ${
        entry.isCurrentUser 
          ? 'bg-emerald-500/20 border border-emerald-500/30' 
          : 'bg-white/5'
      }`}
      data-testid={`leaderboard-${position}`}
    >
      <div className="flex items-center gap-3">
        <div className="w-8 text-center">
          {getRankMedal() || <span className="text-white/60 font-bold">{position + 1}</span>}
        </div>
        <div>
          <div className="text-white font-semibold">{entry.name}</div>
          <div className="text-white/60 text-xs">Уровень {entry.level}</div>
        </div>
      </div>
      <div className="text-right">
        <div className="text-emerald-400 font-bold">{entry.xp.toLocaleString()}</div>
        <div className="text-white/60 text-xs">XP</div>
      </div>
    </motion.div>
  );
});
LeaderboardItem.displayName = 'LeaderboardItem';

export function GamificationHub() {
  const { stats, dailyTasks, leaderboard } = useGamification();

  // Memoize level progress calculation
  const levelProgress = useMemo(() => 
    (stats.xp / stats.xpToNextLevel) * 100, 
    [stats.xp, stats.xpToNextLevel]
  );

  // Memoize icon mapping for achievements - Beautiful gaming icons from react-icons/gi
  const iconMap = useMemo<Record<string, React.ReactNode>>(() => {
    console.log('[GamificationHub] Игровые иконки загружены из react-icons/gi ✅');
    return {
      'compass': <GiTreasureMap className="w-12 h-12 text-amber-400" />,
      'telescope': <GiBinoculars className="w-12 h-12 text-blue-400" />,
      'star': <GiTrophyCup className="w-12 h-12 text-yellow-400" />,
      'flame': <GiFlame className="w-12 h-12 text-orange-400" />,
      'wrench': <GiHammerNails className="w-12 h-12 text-emerald-400" />,
      'layers': <GiBrickWall className="w-12 h-12 text-purple-400" />,
      'rocket': <GiRocketFlight className="w-12 h-12 text-cyan-400" />,
      'zap': <GiLightningHelix className="w-12 h-12 text-yellow-400" />,
      'gem': <GiCutDiamond className="w-12 h-12 text-pink-400" />,
      'crown': <GiImperialCrown className="w-12 h-12 text-yellow-400" />,
      'shield': <GiShield className="w-12 h-12 text-blue-400" />,
      'sparkles': <GiSparkles className="w-12 h-12 text-purple-400" />,
    };
  }, []);

  // Memoize level medal
  const levelMedal = useMemo(() => {
    if (stats.level >= 30) return <PlatinumMedal className="w-10 h-10" />;
    if (stats.level >= 20) return <GoldMedal className="w-10 h-10" />;
    if (stats.level >= 10) return <SilverMedal className="w-10 h-10" />;
    return <BronzeMedal className="w-10 h-10" />;
  }, [stats.level]);

  return (
    <div className="min-h-screen bg-black text-white pb-24" style={{ paddingTop: '140px' }}>
      <div className="max-w-md mx-auto px-4 py-6 space-y-6" data-testid="gamification-hub">
      {/* User Progress Card */}
      <Card className="bg-gradient-to-br from-emerald-500/20 to-cyan-500/20 backdrop-blur-xl border-white/20">
        <CardHeader>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <motion.div
                initial={{ scale: 0, rotate: -180 }}
                animate={{ scale: 1, rotate: 0 }}
                transition={{ type: "spring", stiffness: 200, damping: 15 }}
              >
                {levelMedal}
              </motion.div>
              <div>
                <CardTitle className="text-white flex items-center gap-2">
                  Уровень {stats.level}
                </CardTitle>
                <CardDescription className="text-white/60">
                  {stats.xp} / {stats.xpToNextLevel} XP
                </CardDescription>
              </div>
            </div>
            <div className="flex items-center gap-1 text-emerald-400">
              <GiFlame className="w-5 h-5" />
              <span className="text-2xl font-bold">{stats.streak.current}</span>
            </div>
          </div>
        </CardHeader>
        <CardContent>
          <Progress value={levelProgress} className="h-3 bg-white/10" />
          <div className="grid grid-cols-3 gap-4 mt-4">
            <div className="text-center">
              <div className="text-2xl font-bold text-white">{stats.totalXp}</div>
              <div className="text-xs text-white/60">Всего XP</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold text-white">{stats.streak.best}</div>
              <div className="text-xs text-white/60">Лучший стрик</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold text-white">{stats.completedTasks}</div>
              <div className="text-xs text-white/60">Выполнено</div>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Daily Tasks */}
      <Card className="bg-white/5 backdrop-blur-xl border-white/10">
        <CardHeader>
          <CardTitle className="text-white flex items-center gap-2">
            <GiBullseye className="w-5 h-5 text-emerald-400" />
            Ежедневные задания
          </CardTitle>
          <CardDescription className="text-white/60">
            Выполняйте задания и получайте XP
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-3">
            {dailyTasks.map((task: DailyTask, index: number) => (
              <DailyTaskItem key={task.id} task={task} index={index} />
            ))}
          </div>
        </CardContent>
      </Card>

      {/* Achievements */}
      <Card className="bg-white/5 backdrop-blur-xl border-white/10">
        <CardHeader>
          <CardTitle className="text-white flex items-center gap-2">
            <GiTrophyCup className="w-5 h-5 text-emerald-400" />
            Достижения
          </CardTitle>
          <CardDescription className="text-white/60">
            Разблокируйте награды и бонусы
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="grid grid-cols-2 gap-3">
            {stats.achievements.slice(0, 4).map((achievement: Achievement, index: number) => (
              <AchievementItem 
                key={achievement.id} 
                achievement={achievement} 
                index={index} 
                iconMap={iconMap}
              />
            ))}
          </div>
        </CardContent>
      </Card>

      {/* Leaderboard */}
      <Card className="bg-white/5 backdrop-blur-xl border-white/10">
        <CardHeader>
          <CardTitle className="text-white flex items-center gap-2">
            <GiPodium className="w-5 h-5 text-emerald-400" />
            Таблица лидеров
          </CardTitle>
          <CardDescription className="text-white/60">
            Ваша позиция: #{leaderboard.position} из {leaderboard.totalUsers.toLocaleString()}
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="space-y-2">
            {leaderboard.nearbyUsers.map((user: { rank: number; name: string; level: number; xp: number }, index: number) => (
              <div
                key={user.rank}
                className={`flex items-center gap-3 p-3 rounded-lg ${
                  user.name === 'Вы'
                    ? 'bg-emerald-500/20 border border-emerald-500/30'
                    : 'bg-white/5'
                }`}
                data-testid={`leaderboard-${user.rank}`}
              >
                <div 
                  className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${
                    user.rank <= 3
                      ? 'bg-gradient-to-r from-amber-500 to-orange-500 text-white'
                      : 'bg-white/10 text-white/70'
                  }`}
                >
                  #{user.rank}
                </div>
                <div className="flex-1">
                  <div className={`text-sm font-semibold ${
                    user.name === 'Вы' ? 'text-emerald-300' : 'text-white'
                  }`}>
                    {user.name}
                  </div>
                  <div className="text-xs text-white/50">
                    Уровень {user.level} • {user.xp.toLocaleString()} XP
                  </div>
                </div>
                {user.name === 'Вы' && (
                  <GiLaurelCrown className="w-5 h-5 text-emerald-400" />
                )}
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  </div>
  );
}
```

### components/GlobalSidebar.tsx
```tsx
import { useState, useCallback } from "react";
import { Menu, X, Sparkles, MessageCircle, Bot, Users, Home, Send, ChevronRight } from "lucide-react";
import { SiInstagram, SiTelegram } from "react-icons/si";
import UserAvatar from "./UserAvatar";

interface GlobalSidebarProps {
  currentRoute: string;
  onNavigate: (section: string) => void;
  user?: {
    photo_url?: string;
    first_name?: string;
  };
}

export default function GlobalSidebar({ currentRoute, onNavigate, user }: GlobalSidebarProps) {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [pressedItem, setPressedItem] = useState<string | null>(null);
  const [hoveredItem, setHoveredItem] = useState<string | null>(null);

  const menuItems = [
    { 
      icon: Home, 
      label: 'Главная', 
      section: '', 
      routes: ['showcase'],
      description: 'Все возможности'
    },
    { 
      icon: Sparkles, 
      label: 'Бизнес приложения', 
      section: 'projects', 
      routes: ['projects'],
      description: 'Готовые решения'
    },
    { 
      icon: Bot, 
      label: 'ИИ агент для бизнеса', 
      section: 'ai-process', 
      routes: ['aiProcess', 'aiAgent'],
      description: 'Автоматизация 24/7'
    },
    { 
      icon: Users, 
      label: 'О студии', 
      section: 'about', 
      routes: ['about'],
      description: 'Наша команда'
    },
    { 
      icon: MessageCircle, 
      label: 'Заказать проект', 
      section: 'constructor', 
      routes: ['constructor', 'checkout'],
      description: 'Индивидуальное решение'
    },
  ];

  const isActive = (routes: string[]) => routes.includes(currentRoute);

  const handleNavClick = useCallback((section: string) => {
    setPressedItem(section);
    setTimeout(() => {
      onNavigate(section);
      setSidebarOpen(false);
      setPressedItem(null);
    }, 180);
  }, [onNavigate]);

  const socialLinks = [
    { 
      icon: SiInstagram, 
      label: 'Instagram', 
      url: 'https://instagram.com/web4tg',
      color: '#E4405F',
      hoverBg: 'rgba(228, 64, 95, 0.15)'
    },
    { 
      icon: SiTelegram, 
      label: 'Telegram канал', 
      url: 'https://t.me/web4_tg',
      color: '#26A5E4',
      hoverBg: 'rgba(38, 165, 228, 0.15)'
    },
    { 
      icon: Send, 
      label: 'Консультация', 
      url: 'https://t.me/web4tgs',
      color: '#A78BFA',
      hoverBg: 'rgba(167, 139, 250, 0.15)'
    },
  ];

  const isProfileActive = ['profile', 'referral', 'rewards', 'earning'].includes(currentRoute);
  const isProfilePressed = pressedItem === 'profile';
  const isProfileHovered = hoveredItem === 'profile';

  return (
    <>
      {/* SIDEBAR OVERLAY */}
      <div 
        className={`fixed inset-0 z-[100] transition-all duration-300 ${sidebarOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}
        style={{ 
          background: 'rgba(0,0,0,0.6)', 
          backdropFilter: 'blur(24px)',
          WebkitBackdropFilter: 'blur(24px)'
        }}
        onClick={() => setSidebarOpen(false)}
      />
      
      {/* SIDEBAR PANEL - Glassmorphism */}
      <div 
        className={`fixed top-0 left-0 h-full z-[100] transition-transform duration-300 ease-out ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}
        style={{ 
          width: '320px',
          background: 'rgba(12,12,14,0.85)',
          backdropFilter: 'blur(40px) saturate(180%)',
          WebkitBackdropFilter: 'blur(40px) saturate(180%)',
          borderRight: '1px solid rgba(255,255,255,0.08)',
          boxShadow: sidebarOpen ? '20px 0 80px rgba(0,0,0,0.6), inset 0 0 60px rgba(139,92,246,0.03)' : 'none',
          display: 'flex',
          flexDirection: 'column',
          overflowY: 'auto',
          overflowX: 'hidden'
        }}
      >
        {/* Decorative gradient line at top */}
        <div style={{
          position: 'absolute',
          top: 0,
          left: 0,
          right: 0,
          height: '2px',
          background: 'linear-gradient(90deg, transparent 0%, rgba(139,92,246,0.5) 50%, transparent 100%)'
        }} />

        {/* Sidebar Header with User */}
        <div style={{ 
          padding: '60px 24px 28px 24px',
          borderBottom: '1px solid rgba(255,255,255,0.05)'
        }}>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div style={{
                position: 'relative'
              }}>
                <UserAvatar
                  photoUrl={user?.photo_url}
                  firstName={user?.first_name}
                  size="md"
                  className="ring-2 ring-white/10"
                />
                {/* Online indicator */}
                <div style={{
                  position: 'absolute',
                  bottom: '2px',
                  right: '2px',
                  width: '10px',
                  height: '10px',
                  borderRadius: '50%',
                  background: '#22C55E',
                  border: '2px solid #0C0C0E'
                }} />
              </div>
              <div style={{ flex: 1 }}>
                <p style={{
                  fontSize: '16px',
                  fontWeight: 600,
                  letterSpacing: '-0.02em',
                  color: '#FAFAFA'
                }}>
                  {user?.first_name || 'Гость'}
                </p>
                
                {/* Level Progress Bar */}
                <div style={{ marginTop: '8px' }}>
                  <div style={{
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    marginBottom: '6px'
                  }}>
                    <div style={{
                      display: 'flex',
                      alignItems: 'center',
                      gap: '6px'
                    }}>
                      <div style={{
                        padding: '2px 8px',
                        borderRadius: '6px',
                        background: 'linear-gradient(135deg, rgba(139,92,246,0.2) 0%, rgba(59,130,246,0.15) 100%)',
                        border: '1px solid rgba(139, 92, 246, 0.25)'
                      }}>
                        <span style={{
                          fontSize: '10px',
                          fontWeight: 700,
                          color: '#A78BFA',
                          letterSpacing: '0.02em'
                        }}>
                          LVL 1
                        </span>
                      </div>
                      <span style={{
                        fontSize: '11px',
                        color: '#52525B'
                      }}>
                        Новичок
                      </span>
                    </div>
                    <span style={{
                      fontSize: '10px',
                      fontWeight: 600,
                      color: '#71717A'
                    }}>
                      0/100 XP
                    </span>
                  </div>
                  
                  {/* Progress Bar */}
                  <div style={{
                    position: 'relative',
                    width: '100%',
                    height: '6px',
                    borderRadius: '4px',
                    background: 'rgba(255,255,255,0.06)',
                    overflow: 'hidden'
                  }}>
                    {/* Progress Fill */}
                    <div style={{
                      position: 'absolute',
                      left: 0,
                      top: 0,
                      height: '100%',
                      width: '5%',
                      borderRadius: '4px',
                      background: 'linear-gradient(90deg, #8B5CF6 0%, #A78BFA 50%, #C4B5FD 100%)',
                      boxShadow: '0 0 12px rgba(139, 92, 246, 0.5)',
                      transition: 'width 0.5s ease'
                    }} />
                    {/* Shimmer Effect */}
                    <div style={{
                      position: 'absolute',
                      left: 0,
                      top: 0,
                      height: '100%',
                      width: '100%',
                      background: 'linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%)',
                      animation: 'shimmer 2s infinite'
                    }} />
                  </div>
                </div>
              </div>
            </div>
            <button
              onClick={() => setSidebarOpen(false)}
              style={{
                width: '40px',
                height: '40px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                borderRadius: '12px',
                background: 'rgba(255,255,255,0.04)',
                border: '1px solid rgba(255,255,255,0.06)',
                cursor: 'pointer',
                transition: 'all 0.2s ease',
                flexShrink: 0
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.background = 'rgba(255,255,255,0.08)';
                e.currentTarget.style.borderColor = 'rgba(255,255,255,0.1)';
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.background = 'rgba(255,255,255,0.04)';
                e.currentTarget.style.borderColor = 'rgba(255,255,255,0.06)';
              }}
              aria-label="Закрыть меню"
              data-testid="button-close-sidebar"
            >
              <X size={18} color="#A1A1AA" />
            </button>
          </div>
          
          {/* Minimalist App Progress */}
          <div style={{ marginTop: '24px' }}>
            {/* Section Label */}
            <p style={{
              fontSize: '10px',
              fontWeight: 700,
              letterSpacing: '0.15em',
              color: '#52525B',
              textTransform: 'uppercase',
              marginBottom: '12px'
            }}>
              Статус вашего проекта
            </p>
            
            {/* Progress Card */}
            <div style={{
              padding: '16px',
              borderRadius: '14px',
              background: 'rgba(255,255,255,0.02)',
              border: '1px solid rgba(255,255,255,0.06)'
            }}>
              {/* Title Row */}
              <div style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                marginBottom: '16px'
              }}>
                <span style={{
                  fontSize: '14px',
                  fontWeight: 600,
                  color: '#FAFAFA',
                  letterSpacing: '-0.01em'
                }}>
                  Разработка приложения
                </span>
                <span style={{
                  fontSize: '13px',
                  fontWeight: 600,
                  color: '#71717A'
                }}>
                  0%
                </span>
              </div>
              
              {/* Minimal Progress Bar */}
              <div style={{
                width: '100%',
                height: '4px',
                borderRadius: '2px',
                background: 'rgba(255,255,255,0.08)',
                marginBottom: '16px',
                overflow: 'hidden'
              }}>
                <div style={{
                  height: '100%',
                  width: '2%',
                  borderRadius: '2px',
                  background: '#A78BFA',
                  transition: 'width 0.4s ease'
                }} />
              </div>
              
              {/* Stages Row */}
              <div style={{
                display: 'flex',
                justifyContent: 'space-between',
                gap: '8px'
              }}>
                {[
                  { name: 'Бриф', num: 1, active: true },
                  { name: 'Дизайн', num: 2, active: false },
                  { name: 'Код', num: 3, active: false },
                  { name: 'Запуск', num: 4, active: false }
                ].map((stage) => (
                  <div key={stage.name} style={{
                    flex: 1,
                    display: 'flex',
                    flexDirection: 'column',
                    alignItems: 'center',
                    gap: '8px'
                  }}>
                    {/* Number Circle */}
                    <div style={{
                      width: '28px',
                      height: '28px',
                      borderRadius: '50%',
                      background: stage.active 
                        ? 'rgba(167, 139, 250, 0.15)'
                        : 'rgba(255,255,255,0.04)',
                      border: stage.active 
                        ? '1.5px solid rgba(167, 139, 250, 0.4)'
                        : '1.5px solid rgba(255,255,255,0.08)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center'
                    }}>
                      <span style={{
                        fontSize: '11px',
                        fontWeight: 600,
                        color: stage.active ? '#A78BFA' : '#52525B'
                      }}>
                        {stage.num}
                      </span>
                    </div>
                    {/* Label */}
                    <span style={{
                      fontSize: '10px',
                      fontWeight: stage.active ? 600 : 500,
                      color: stage.active ? '#A1A1AA' : '#52525B',
                      textAlign: 'center'
                    }}>
                      {stage.name}
                    </span>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
        
        {/* Sidebar Navigation */}
        <nav style={{ padding: '24px 16px', flex: 1 }}>
          <p style={{
            fontSize: '10px',
            fontWeight: 700,
            letterSpacing: '0.15em',
            color: '#52525B',
            textTransform: 'uppercase',
            padding: '0 16px',
            marginBottom: '12px'
          }}>
            Навигация
          </p>
          
          {/* Nav Items */}
          <div style={{ display: 'flex', flexDirection: 'column', gap: '4px' }}>
            {menuItems.map((item) => {
              const active = isActive(item.routes);
              const isPressed = pressedItem === item.section;
              const isHovered = hoveredItem === item.section;
              
              return (
                <button
                  key={item.section}
                  onClick={() => handleNavClick(item.section)}
                  onMouseEnter={() => setHoveredItem(item.section)}
                  onMouseLeave={() => setHoveredItem(null)}
                  className="w-full group"
                  style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '14px',
                    padding: '14px 16px',
                    borderRadius: '14px',
                    background: isPressed 
                      ? 'rgba(139, 92, 246, 0.2)' 
                      : active 
                        ? 'rgba(255,255,255,0.06)' 
                        : isHovered
                          ? 'rgba(255,255,255,0.04)'
                          : 'transparent',
                    border: isPressed 
                      ? '1px solid rgba(139, 92, 246, 0.35)'
                      : active 
                        ? '1px solid rgba(255,255,255,0.08)' 
                        : '1px solid transparent',
                    cursor: 'pointer',
                    transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
                    transform: isPressed ? 'scale(0.98)' : 'scale(1)',
                    position: 'relative',
                    overflow: 'hidden'
                  }}
                  data-testid={`button-nav-${item.section || 'home'}`}
                >
                  {/* Glow effect for active */}
                  {active && (
                    <div style={{
                      position: 'absolute',
                      left: 0,
                      top: '50%',
                      transform: 'translateY(-50%)',
                      width: '3px',
                      height: '24px',
                      borderRadius: '0 4px 4px 0',
                      background: 'linear-gradient(180deg, #A78BFA 0%, #8B5CF6 100%)',
                      boxShadow: '0 0 12px rgba(139, 92, 246, 0.5)'
                    }} />
                  )}
                  
                  <div style={{
                    width: '40px',
                    height: '40px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    borderRadius: '12px',
                    background: isPressed 
                      ? 'rgba(139, 92, 246, 0.3)'
                      : active 
                        ? 'rgba(139, 92, 246, 0.15)' 
                        : 'rgba(255,255,255,0.04)',
                    border: active ? '1px solid rgba(139, 92, 246, 0.2)' : '1px solid transparent',
                    transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
                    flexShrink: 0
                  }}>
                    <item.icon 
                      size={20} 
                      color={isPressed || active ? '#A78BFA' : isHovered ? '#E4E4E7' : '#71717A'} 
                      style={{ transition: 'color 0.2s ease' }}
                    />
                  </div>
                  
                  <div style={{ flex: 1, textAlign: 'left' }}>
                    <span style={{
                      fontSize: '15px',
                      fontWeight: isPressed || active ? 600 : 500,
                      color: isPressed || active ? '#FAFAFA' : isHovered ? '#E4E4E7' : '#A1A1AA',
                      transition: 'all 0.2s ease',
                      display: 'block'
                    }}>
                      {item.label}
                    </span>
                    <span style={{
                      fontSize: '11px',
                      color: '#52525B',
                      marginTop: '2px',
                      display: 'block',
                      opacity: active || isHovered ? 1 : 0.7,
                      transition: 'opacity 0.2s ease'
                    }}>
                      {item.description}
                    </span>
                  </div>
                  
                  <ChevronRight 
                    size={16} 
                    color={active ? '#A78BFA' : '#3F3F46'}
                    style={{
                      opacity: active || isHovered ? 1 : 0,
                      transform: isHovered && !active ? 'translateX(2px)' : 'translateX(0)',
                      transition: 'all 0.2s ease'
                    }}
                  />
                </button>
              );
            })}
          </div>
          
          {/* Divider */}
          <div style={{
            height: '1px',
            background: 'linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.06) 50%, transparent 100%)',
            margin: '16px 0'
          }} />
          
          {/* Profile Button with Avatar */}
          <button
            onClick={() => handleNavClick('profile')}
            onMouseEnter={() => setHoveredItem('profile')}
            onMouseLeave={() => setHoveredItem(null)}
            className="w-full group"
            style={{
              display: 'flex',
              alignItems: 'center',
              gap: '14px',
              padding: '14px 16px',
              borderRadius: '14px',
              background: isProfilePressed
                ? 'rgba(139, 92, 246, 0.2)'
                : isProfileActive 
                  ? 'rgba(255,255,255,0.06)' 
                  : isProfileHovered
                    ? 'rgba(255,255,255,0.04)'
                    : 'transparent',
              border: isProfilePressed
                ? '1px solid rgba(139, 92, 246, 0.35)'
                : isProfileActive 
                  ? '1px solid rgba(255,255,255,0.08)' 
                  : '1px solid transparent',
              cursor: 'pointer',
              transition: 'all 0.2s cubic-bezier(0.4, 0, 0.2, 1)',
              transform: isProfilePressed ? 'scale(0.98)' : 'scale(1)',
              position: 'relative'
            }}
            data-testid="button-nav-profile"
          >
            {/* Glow effect for active */}
            {isProfileActive && (
              <div style={{
                position: 'absolute',
                left: 0,
                top: '50%',
                transform: 'translateY(-50%)',
                width: '3px',
                height: '24px',
                borderRadius: '0 4px 4px 0',
                background: 'linear-gradient(180deg, #A78BFA 0%, #8B5CF6 100%)',
                boxShadow: '0 0 12px rgba(139, 92, 246, 0.5)'
              }} />
            )}
            
            <div style={{
              position: 'relative',
              width: '40px',
              height: '40px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center'
            }}>
              <UserAvatar
                photoUrl={user?.photo_url}
                firstName={user?.first_name}
                size="sm"
                className={isProfilePressed || isProfileActive ? 'ring-2 ring-violet-400/40' : ''}
              />
            </div>
            
            <div style={{ flex: 1, textAlign: 'left' }}>
              <span style={{
                fontSize: '15px',
                fontWeight: isProfilePressed || isProfileActive ? 600 : 500,
                color: isProfilePressed || isProfileActive ? '#FAFAFA' : isProfileHovered ? '#E4E4E7' : '#A1A1AA',
                transition: 'all 0.2s ease',
                display: 'block'
              }}>
                Мой профиль
              </span>
              <span style={{
                fontSize: '11px',
                color: '#52525B',
                marginTop: '2px',
                display: 'block',
                opacity: isProfileActive || isProfileHovered ? 1 : 0.7,
                transition: 'opacity 0.2s ease'
              }}>
                Награды и достижения
              </span>
            </div>
            
            <ChevronRight 
              size={16} 
              color={isProfileActive ? '#A78BFA' : '#3F3F46'}
              style={{
                opacity: isProfileActive || isProfileHovered ? 1 : 0,
                transform: isProfileHovered && !isProfileActive ? 'translateX(2px)' : 'translateX(0)',
                transition: 'all 0.2s ease'
              }}
            />
          </button>
        </nav>
        
        {/* Quick Stats Card */}
        <div style={{
          margin: '0 16px 16px',
          padding: '20px',
          borderRadius: '16px',
          background: 'linear-gradient(135deg, rgba(139,92,246,0.12) 0%, rgba(59,130,246,0.06) 100%)',
          border: '1px solid rgba(139, 92, 246, 0.12)',
          position: 'relative',
          overflow: 'hidden'
        }}>
          {/* Decorative gradient orb */}
          <div style={{
            position: 'absolute',
            top: '-20px',
            right: '-20px',
            width: '80px',
            height: '80px',
            borderRadius: '50%',
            background: 'radial-gradient(circle, rgba(139,92,246,0.2) 0%, transparent 70%)',
            filter: 'blur(20px)'
          }} />
          
          <div style={{ position: 'relative' }}>
            <p style={{
              fontSize: '11px',
              fontWeight: 600,
              letterSpacing: '0.05em',
              color: '#A78BFA',
              marginBottom: '8px',
              textTransform: 'uppercase'
            }}>
              Декабрь 2025
            </p>
            <p style={{
              fontSize: '28px',
              fontWeight: 700,
              color: '#FAFAFA',
              letterSpacing: '-0.03em',
              lineHeight: 1
            }}>
              3 слота
            </p>
            <p style={{
              fontSize: '13px',
              color: '#71717A',
              marginTop: '6px'
            }}>
              осталось на этот месяц
            </p>
          </div>
        </div>
        
        {/* Boost with AI Card - Like in reference */}
        <div style={{ 
          padding: '16px 20px',
          marginTop: 'auto'
        }}>
          <div style={{
            padding: '20px',
            borderRadius: '16px',
            background: 'rgba(255,255,255,0.04)',
            border: '1px solid rgba(255,255,255,0.08)'
          }}>
            <div style={{
              display: 'flex',
              alignItems: 'center',
              gap: '10px',
              marginBottom: '10px'
            }}>
              <Sparkles size={18} color="#A78BFA" />
              <span style={{
                fontSize: '14px',
                fontWeight: 600,
                color: '#FAFAFA'
              }}>
                Boost with <span style={{ color: '#A78BFA' }}>AI</span>
              </span>
            </div>
            <p style={{
              fontSize: '12px',
              color: '#71717A',
              lineHeight: 1.5,
              marginBottom: '16px'
            }}>
              ИИ-ассистент для бизнеса: ответы 24/7, рост продаж на 300%
            </p>
            
            {/* Glow Button */}
            <button
              onClick={() => handleNavClick('ai-process')}
              style={{
                position: 'relative',
                width: '100%',
                padding: '14px 20px',
                borderRadius: '12px',
                background: 'linear-gradient(135deg, #7C3AED 0%, #8B5CF6 50%, #A78BFA 100%)',
                border: 'none',
                cursor: 'pointer',
                transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
                overflow: 'visible'
              }}
              onMouseEnter={(e) => {
                e.currentTarget.style.transform = 'translateY(-2px)';
                e.currentTarget.style.boxShadow = '0 8px 32px rgba(139, 92, 246, 0.5), 0 0 60px rgba(139, 92, 246, 0.3)';
              }}
              onMouseLeave={(e) => {
                e.currentTarget.style.transform = 'translateY(0)';
                e.currentTarget.style.boxShadow = '0 4px 20px rgba(139, 92, 246, 0.4), 0 0 40px rgba(139, 92, 246, 0.2)';
              }}
              onMouseDown={(e) => {
                e.currentTarget.style.transform = 'translateY(0) scale(0.98)';
              }}
              onMouseUp={(e) => {
                e.currentTarget.style.transform = 'translateY(-2px) scale(1)';
              }}
              data-testid="button-upgrade-pro"
            >
              {/* Glow effect underneath */}
              <div style={{
                position: 'absolute',
                bottom: '-8px',
                left: '20%',
                right: '20%',
                height: '20px',
                background: 'radial-gradient(ellipse at center, rgba(139, 92, 246, 0.6) 0%, transparent 70%)',
                filter: 'blur(12px)',
                pointerEvents: 'none'
              }} />
              <span style={{
                position: 'relative',
                fontSize: '14px',
                fontWeight: 600,
                color: '#FFFFFF',
                letterSpacing: '0.02em'
              }}>
                Узнать больше
              </span>
            </button>
          </div>
        </div>

        {/* Sidebar Footer with Social Links */}
        <div style={{
          padding: '20px 24px 28px',
          borderTop: '1px solid rgba(255,255,255,0.05)',
          background: 'linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.2) 100%)'
        }}>
          {/* Social Links Label */}
          <p style={{
            fontSize: '10px',
            fontWeight: 700,
            letterSpacing: '0.15em',
            color: '#52525B',
            textTransform: 'uppercase',
            marginBottom: '12px'
          }}>
            Связаться с нами
          </p>
          
          {/* Social Links */}
          <div style={{
            display: 'flex',
            gap: '10px',
            marginBottom: '20px'
          }}>
            {socialLinks.map((social) => (
              <a
                key={social.label}
                href={social.url}
                target="_blank"
                rel="noopener noreferrer"
                style={{
                  width: '48px',
                  height: '48px',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  borderRadius: '14px',
                  background: 'rgba(255,255,255,0.04)',
                  border: '1px solid rgba(255,255,255,0.06)',
                  cursor: 'pointer',
                  transition: 'all 0.25s cubic-bezier(0.4, 0, 0.2, 1)'
                }}
                aria-label={social.label}
                data-testid={`link-social-${social.label.toLowerCase().replace(' ', '-')}`}
                onMouseEnter={(e) => {
                  e.currentTarget.style.background = social.hoverBg;
                  e.currentTarget.style.borderColor = `${social.color}40`;
                  e.currentTarget.style.transform = 'translateY(-2px)';
                  e.currentTarget.style.boxShadow = `0 8px 24px ${social.color}20`;
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.background = 'rgba(255,255,255,0.04)';
                  e.currentTarget.style.borderColor = 'rgba(255,255,255,0.06)';
                  e.currentTarget.style.transform = 'translateY(0)';
                  e.currentTarget.style.boxShadow = 'none';
                }}
              >
                <social.icon size={22} color={social.color} />
              </a>
            ))}
          </div>
          
          {/* Copyright */}
          <div style={{
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between'
          }}>
            <div>
              <p style={{
                fontSize: '12px',
                fontWeight: 500,
                color: '#71717A'
              }}>
                Web4TG Studio
              </p>
              <p style={{
                fontSize: '11px',
                color: '#3F3F46',
                marginTop: '2px'
              }}>
                2025
              </p>
            </div>
            <div style={{
              padding: '6px 10px',
              borderRadius: '8px',
              background: 'rgba(34, 197, 94, 0.1)',
              border: '1px solid rgba(34, 197, 94, 0.2)'
            }}>
              <p style={{
                fontSize: '10px',
                fontWeight: 600,
                color: '#22C55E',
                letterSpacing: '0.02em'
              }}>
                ONLINE
              </p>
            </div>
          </div>
        </div>
      </div>

      {/* TOP BAR WITH MENU BUTTON - Glassmorphism Style */}
      <div 
        className="fixed top-0 left-0 right-0 z-[90]"
        style={{
          background: 'rgba(15,15,20,0.65)',
          backdropFilter: 'blur(40px) saturate(180%)',
          WebkitBackdropFilter: 'blur(40px) saturate(180%)',
          borderBottom: '1px solid rgba(255,255,255,0.06)',
          paddingTop: 'max(env(safe-area-inset-top, 0px), 48px)',
          boxShadow: '0 4px 30px rgba(0,0,0,0.3)'
        }}
      >
        <div className="max-w-md mx-auto px-5 py-6 flex items-center justify-between">
          {/* Glass Menu Button */}
          <button
            onClick={() => setSidebarOpen(true)}
            className="glass-menu-btn"
            style={{
              width: '44px',
              height: '44px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              borderRadius: '12px',
              background: 'rgba(255,255,255,0.08)',
              backdropFilter: 'blur(20px)',
              WebkitBackdropFilter: 'blur(20px)',
              border: '1px solid rgba(255,255,255,0.12)',
              cursor: 'pointer',
              transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',
              boxShadow: '0 2px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)'
            }}
            onMouseEnter={(e) => {
              e.currentTarget.style.background = 'rgba(255,255,255,0.15)';
              e.currentTarget.style.borderColor = 'rgba(255,255,255,0.2)';
              e.currentTarget.style.transform = 'scale(1.05)';
              e.currentTarget.style.boxShadow = '0 4px 20px rgba(139,92,246,0.25), inset 0 1px 0 rgba(255,255,255,0.15)';
            }}
            onMouseLeave={(e) => {
              e.currentTarget.style.background = 'rgba(255,255,255,0.08)';
              e.currentTarget.style.borderColor = 'rgba(255,255,255,0.12)';
              e.currentTarget.style.transform = 'scale(1)';
              e.currentTarget.style.boxShadow = '0 2px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1)';
            }}
            onMouseDown={(e) => {
              e.currentTarget.style.transform = 'scale(0.95)';
            }}
            onMouseUp={(e) => {
              e.currentTarget.style.transform = 'scale(1.05)';
            }}
            aria-label="Открыть меню"
            data-testid="button-open-sidebar"
          >
            <Menu size={20} color="#FAFAFA" />
          </button>
          
          {/* Logo */}
          <p style={{
            fontSize: '13px',
            fontWeight: 600,
            letterSpacing: '0.14em',
            color: '#FAFAFA',
            fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',
            textShadow: '0 0 20px rgba(255,255,255,0.1)'
          }}>
            WEB4TG STUDIO
          </p>
          
          {/* Empty space for balance */}
          <div style={{ width: '44px' }} />
        </div>
      </div>
    </>
  );
}
```

### components/HapticComponentsDemo.tsx
```tsx
import { HapticButton } from './ui/haptic-button';
import { Page, PageHeader, PageSection } from './ui/page';
import { HapticCard, HapticIconButton } from './ui/haptic-card';
import { Heart, ShoppingCart, Star, Plus, Minus } from 'lucide-react';
import { useState } from 'react';

/**
 * Демонстрация Haptic компонентов
 * Показывает все варианты использования новых компонентов с тактильной отдачей
 */
export function HapticComponentsDemo() {
  const [count, setCount] = useState(0);

  return (
    <Page withPadding withSafeArea>
      <PageHeader 
        title="Haptic Компоненты"
        subtitle="Тактильная отдача и анимации для Telegram Mini Apps"
      />

      {/* Кнопки */}
      <PageSection>
        <h2 className="text-xl font-bold text-white mb-4">HapticButton</h2>
        
        <div className="space-y-3">
          <HapticButton 
            variant="primary" 
            size="lg"
            hapticStyle="light"
            onClick={() => alert('Primary кнопка!')}
            data-testid="button-primary"
          >
            Primary Button
          </HapticButton>

          <HapticButton 
            variant="secondary" 
            size="md"
            hapticStyle="medium"
            onClick={() => alert('Secondary кнопка!')}
            data-testid="button-secondary"
          >
            Secondary Button
          </HapticButton>

          <HapticButton 
            variant="ghost" 
            size="sm"
            hapticStyle="light"
            onClick={() => alert('Ghost кнопка!')}
            data-testid="button-ghost"
          >
            Ghost Button
          </HapticButton>

          <HapticButton 
            variant="destructive" 
            size="md"
            hapticStyle="heavy"
            onClick={() => alert('Удалено!')}
            data-testid="button-destructive"
          >
            Delete Button
          </HapticButton>
        </div>
      </PageSection>

      {/* Иконочные кнопки */}
      <PageSection delay={0.1}>
        <h2 className="text-xl font-bold text-white mb-4">HapticIconButton</h2>
        
        <div className="flex gap-3">
          <HapticIconButton
            icon={<Heart className="w-5 h-5" />}
            variant="default"
            size="lg"
            hapticStyle="light"
            onClick={() => alert('Добавлено в избранное!')}
            data-testid="icon-heart"
            aria-label="Добавить в избранное"
          />

          <HapticIconButton
            icon={<ShoppingCart className="w-5 h-5" />}
            variant="glass"
            size="md"
            hapticStyle="medium"
            onClick={() => alert('Добавлено в корзину!')}
            data-testid="icon-cart"
            aria-label="Добавить в корзину"
          />

          <HapticIconButton
            icon={<Star className="w-5 h-5" />}
            variant="ghost"
            size="sm"
            hapticStyle="light"
            onClick={() => alert('Оценка!')}
            data-testid="icon-star"
            aria-label="Оценить"
          />
        </div>
      </PageSection>

      {/* Интерактивные карточки */}
      <PageSection delay={0.2}>
        <h2 className="text-xl font-bold text-white mb-4">HapticCard</h2>
        
        <div className="space-y-4">
          <HapticCard
            hapticStyle="light"
            pressScale={0.98}
            onClick={() => alert('Карточка нажата!')}
            className="p-6 bg-gradient-to-r from-blue-500/20 to-purple-500/20 backdrop-blur-xl border border-white/20 rounded-2xl"
            data-testid="card-demo-1"
          >
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center">
                <Star className="w-6 h-6 text-white" />
              </div>
              <div>
                <h3 className="text-white font-bold text-lg">Премиум товар</h3>
                <p className="text-white/60 text-sm">Нажмите для деталей</p>
              </div>
            </div>
          </HapticCard>

          <HapticCard
            hapticStyle="medium"
            pressScale={0.95}
            onClick={() => alert('Вторая карточка!')}
            className="p-6 bg-gradient-to-r from-green-500/20 to-emerald-500/20 backdrop-blur-xl border border-white/20 rounded-2xl"
            data-testid="card-demo-2"
          >
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-white font-bold text-lg">Специальное предложение</h3>
                <p className="text-white/60 text-sm">Скидка 50%</p>
              </div>
              <div className="text-white font-black text-3xl">-50%</div>
            </div>
          </HapticCard>
        </div>
      </PageSection>

      {/* Практический пример: счетчик */}
      <PageSection delay={0.3}>
        <h2 className="text-xl font-bold text-white mb-4">Практический пример</h2>
        
        <div className="p-6 bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl">
          <div className="text-center mb-6">
            <div className="text-white/60 text-sm mb-2">Количество товаров</div>
            <div className="text-white font-black text-5xl">{count}</div>
          </div>

          <div className="flex gap-3">
            <HapticButton
              variant="destructive"
              size="lg"
              hapticStyle="light"
              onClick={() => setCount(Math.max(0, count - 1))}
              disabled={count === 0}
              className="flex-1"
              data-testid="button-minus"
            >
              <Minus className="w-6 h-6" />
            </HapticButton>

            <HapticButton
              variant="primary"
              size="lg"
              hapticStyle="light"
              onClick={() => setCount(count + 1)}
              className="flex-1"
              data-testid="button-plus"
            >
              <Plus className="w-6 h-6" />
            </HapticButton>
          </div>
        </div>
      </PageSection>

      {/* Документация */}
      <PageSection delay={0.4}>
        <div className="p-6 bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl">
          <h3 className="text-white font-bold mb-3">✨ Особенности</h3>
          <ul className="text-white/80 text-sm space-y-2">
            <li>📳 <strong>Haptic Feedback</strong> - Тактильная вибрация при нажатии</li>
            <li>🎨 <strong>Анимация scale</strong> - Плавное сжатие (0.97-0.95)</li>
            <li>⚡ <strong>Оптимизация</strong> - Duration 0.1s для быстрого отклика</li>
            <li>🎯 <strong>3 стиля вибрации</strong> - light, medium, heavy</li>
            <li>🎭 <strong>4 варианта дизайна</strong> - primary, secondary, ghost, destructive</li>
            <li>📏 <strong>3 размера</strong> - sm, md, lg</li>
          </ul>
        </div>
      </PageSection>
    </Page>
  );
}
```

### components/HelpPage.tsx
```tsx
import { useState, memo } from "react";
import { 
  Phone,
  Mail,
  MessageCircle,
  Clock,
  Shield,
  CreditCard,
  Package,
  Smartphone,
  Star,
  CheckCircle,
  AlertCircle,
  Info,
  HelpCircle,
  Search,
  ChevronDown,
  ChevronUp,
  Zap,
  Users,
  Code,
  Globe,
  DollarSign,
  Calendar,
  Settings,
  Lock,
  Headphones,
  Award,
  TrendingUp,
  FileText,
  Download
} from "lucide-react";
import { BackHeader } from "./BackHeader";

interface HelpPageProps {
  onBack: () => void;
}

interface FAQItem {
  id: number;
  question: string;
  answer: string;
  category: string;
  icon: any;
  color: string;
}

const faqCategories = [
  { id: 'all', name: 'Все вопросы', icon: HelpCircle },
  { id: 'development', name: 'Разработка', icon: Code },
  { id: 'payment', name: 'Оплата', icon: CreditCard },
  { id: 'support', name: 'Поддержка', icon: Headphones },
  { id: 'features', name: 'Функции', icon: Settings }
];

const faqItems: FAQItem[] = [
  {
    id: 1,
    question: "Сколько времени занимает разработка приложения?",
    answer: "Сроки разработки зависят от сложности проекта:\n\n• Простой магазин (каталог + корзина) — 5-7 дней\n• Ресторан с доставкой — 7-10 дней\n• Фитнес-центр с записью — 8-12 дней\n• Сложные проекты с уникальным функционалом — до 14 дней\n\nМы всегда соблюдаем оговоренные сроки и информируем о ходе работ ежедневно.",
    category: "development",
    icon: Clock,
    color: "text-system-blue"
  },
  {
    id: 2,
    question: "Какие способы оплаты вы принимаете?",
    answer: "Мы работаем со всеми популярными способами оплаты:\n\n• Банковские карты (Visa, MasterCard, МИР)\n• СБП (Система быстрых платежей)\n• Онлайн-банкинг (Сбербанк, Тинькофф, Альфа-Банк)\n• Электронные кошельки (ЮMoney, QIWI)\n• Банковские переводы для юридических лиц\n\nОплата происходит поэтапно: 50% аванс, 50% при сдаче проекта.",
    category: "payment",
    icon: CreditCard,
    color: "text-system-green"
  },
  {
    id: 3,
    question: "Нужен ли мне собственный Telegram Bot Token?",
    answer: "Нет, не нужен! Мы создаем Mini App (мини-приложение), которое работает внутри Telegram без создания отдельного бота.\n\nПреимущества Mini App:\n• Не требует токенов или настройки API\n• Автоматически интегрируется с Telegram\n• Доступно всем пользователям Telegram\n• Работает на всех устройствах\n• Поддерживает платежи через Telegram\n\nВам нужно только предоставить контент и пожелания по дизайну.",
    category: "development",
    icon: Smartphone,
    color: "text-system-purple"
  },
  {
    id: 4,
    question: "Можно ли вносить изменения после запуска?",
    answer: "Конечно! Мы предоставляем полную техподдержку:\n\n• Первый месяц — бесплатная поддержка\n• Мелкие правки (тексты, цены) — бесплатно\n• Добавление новых товаров/услуг — бесплатно\n• Крупные изменения функционала — по отдельному тарифу\n• Срочные исправления — в течение 2 часов\n\nВсе изменения вносятся через удобную админ-панель или по вашему запросу.",
    category: "support",
    icon: Package,
    color: "text-system-orange"
  },
  {
    id: 5,
    question: "Насколько безопасны платежи в приложении?",
    answer: "Безопасность платежей — наш приоритет №1:\n\n• Используем только сертифицированные платежные системы\n• Все данные передаются по защищенному протоколу HTTPS\n• Платежные данные не сохраняются на наших серверах\n• Соответствуем стандарту PCI DSS\n• Интеграция с Telegram Payments (высший уровень безопасности)\n• Автоматическое шифрование всех транзакций\n\nВаши клиенты могут быть уверены в безопасности своих данных.",
    category: "features",
    icon: Shield,
    color: "text-system-red"
  },
  {
    id: 6,
    question: "Какую поддержку вы предоставляете после запуска?",
    answer: "Мы обеспечиваем комплексную поддержку 24/7:\n\n• Техническая поддержка — круглосуточно\n• Ответ в Telegram — в течение 30 минут\n• Устранение критических ошибок — в течение 15 минут\n• Бесплатные консультации — первые 30 дней\n• Обучение работе с админ-панелью\n• Помощь в настройке аналитики\n\nКонтакты поддержки: @web4tgs в Telegram",
    category: "support",
    icon: MessageCircle,
    color: "text-system-teal"
  },
  {
    id: 7,
    question: "Какие функции входят в базовый пакет?",
    answer: "Базовый пакет включает все необходимое для работы:\n\n• Каталог товаров/услуг с фото и описаниями\n• Корзина и оформление заказов\n• Система уведомлений\n• Админ-панель для управления\n• Интеграция с Telegram\n• Адаптивный дизайн для всех устройств\n• Базовая аналитика заказов\n• SSL-сертификат безопасности\n\nДополнительно можно добавить: платежи, доставку, бонусную систему, расширенную аналитику.",
    category: "features",
    icon: Package,
    color: "text-system-blue"
  },
  {
    id: 8,
    question: "Сколько стоит разработка приложения?",
    answer: "Стоимость зависит от типа и сложности приложения:\n\n• Простой магазин — от 25 000 ₽\n• Ресторан/кафе — от 30 000 ₽\n• Фитнес-центр — от 35 000 ₽\n• Сфера услуг — от 28 000 ₽\n• Уникальные проекты — от 40 000 ₽\n\nВ стоимость входит: разработка, дизайн, тестирование, запуск, месяц поддержки.\nДополнительные функции: платежи (+15 000 ₽), доставка (+12 000 ₽), аналитика (+12 000 ₽).",
    category: "payment",
    icon: DollarSign,
    color: "text-system-green"
  },
  {
    id: 9,
    question: "Предоставляете ли вы исходный код?",
    answer: "Да, после полной оплаты вы получаете:\n\n• Полный исходный код приложения\n• Документацию по развертыванию\n• Инструкции по внесению изменений\n• Доступ к административной панели\n• Права на коммерческое использование\n• Техническую документацию\n\nВы становитесь полноправным владельцем приложения и можете модифицировать его по своему усмотрению.",
    category: "development",
    icon: Code,
    color: "text-system-purple"
  },
  {
    id: 10,
    question: "Можете ли вы интегрировать приложение с моей CRM?",
    answer: "Да, мы интегрируем приложения с популярными CRM-системами:\n\n• amoCRM — автоматическая передача заказов\n• Битрикс24 — синхронизация клиентов и сделок\n• RetailCRM — управление заказами и складом\n• МойСклад — учет товаров и продаж\n• 1С — интеграция с учетными системами\n• Собственные API — разработаем под ваши нужды\n\nИнтеграция позволяет автоматизировать все бизнес-процессы.",
    category: "features",
    icon: Settings,
    color: "text-system-orange"
  }
];

const contactMethods = [
  {
    id: 1,
    title: "Telegram поддержка",
    description: "Самый быстрый способ получить помощь",
    detail: "Отвечаем в течение 30 минут, 24/7",
    action: () => window.open('https://t.me/web4tgs', '_blank'),
    icon: MessageCircle,
    color: "bg-system-blue/10 text-system-blue",
    urgent: true
  },
  {
    id: 2,
    title: "Телефонная поддержка",
    description: "+7 (999) 999-99-99",
    detail: "Звонки принимаем с 9:00 до 21:00 МСК",
    action: () => window.open('tel:+79999999999', '_blank'),
    icon: Phone,
    color: "bg-system-green/10 text-system-green",
    urgent: false
  },
  {
    id: 3,
    title: "Email поддержка",
    description: "support@web4tg.com",
    detail: "Подробные вопросы и техническая документация",
    action: () => window.open('mailto:support@web4tg.com', '_blank'),
    icon: Mail,
    color: "bg-system-purple/10 text-system-purple",
    urgent: false
  }
];

const serviceFeatures = [
  {
    icon: CheckCircle,
    title: "Гарантия качества",
    description: "100% возврат средств, если результат не устроит",
    color: "text-system-green"
  },
  {
    icon: Star,
    title: "4.9/5 рейтинг",
    description: "Средняя оценка от 127+ довольных клиентов",
    color: "text-system-orange"
  },
  {
    icon: Shield,
    title: "Полная безопасность",
    description: "Соблюдаем GDPR и российские стандарты защиты данных",
    color: "text-system-blue"
  },
  {
    icon: Zap,
    title: "Быстрая разработка",
    description: "От идеи до запуска за 5-14 дней",
    color: "text-system-purple"
  },
  {
    icon: TrendingUp,
    title: "Рост продаж",
    description: "Клиенты увеличивают выручку в среднем на 180%",
    color: "text-system-green"
  },
  {
    icon: Award,
    title: "Премиум качество",
    description: "Используем только современные технологии и лучшие практики",
    color: "text-system-red"
  }
];

const HelpPage = memo(function HelpPage({ onBack }: HelpPageProps) {
  const [activeCategory, setActiveCategory] = useState('all');
  const [searchQuery, setSearchQuery] = useState('');
  const [expandedFAQ, setExpandedFAQ] = useState<number | null>(null);

  const filteredFAQs = faqItems.filter(item => {
    const matchesCategory = activeCategory === 'all' || item.category === activeCategory;
    const matchesSearch = searchQuery === '' || 
                         item.question.toLowerCase().includes(searchQuery.toLowerCase()) ||
                         item.answer.toLowerCase().includes(searchQuery.toLowerCase());
    return matchesCategory && matchesSearch;
  });

  const toggleFAQ = (id: number) => {
    setExpandedFAQ(expandedFAQ === id ? null : id);
  };

  return (
    <div className="min-h-screen bg-black text-white pb-32" style={{ paddingTop: '140px' }}>
      <BackHeader onBack={onBack} title="Справка" />

      <div className="max-w-md mx-auto px-4 space-y-6 mt-4">
        {/* Hero Section */}
        <section className="ios-slide-up scroll-fade-in">
          <div className="glass-card p-6 text-center">
            <div className="w-16 h-16 bg-system-blue/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <HelpCircle className="w-8 h-8 text-system-blue" />
            </div>
            <h2 className="ios-title3 mb-2">Центр поддержки</h2>
            <p className="ios-body text-secondary-label mb-4">
              Найдите ответы на все вопросы о создании Telegram приложений
            </p>
            <button 
              className="ios-button-filled"
              onClick={() => window.open('https://t.me/web4tgs', '_blank')}
            >
              Связаться с поддержкой
            </button>
          </div>
        </section>

        {/* Search */}
        <section className="ios-slide-up scroll-fade-in-delay-1">
          <div className="glass-card p-4">
            <div className="flex items-center space-x-3 bg-secondary-system-fill rounded-xl px-4 py-3">
              <Search className="w-5 h-5 text-secondary-label" />
              <input
                type="text"
                placeholder="Поиск по справке..."
                className="flex-1 bg-transparent border-none outline-none ios-body"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
              />
            </div>
          </div>
        </section>

        {/* FAQ Categories */}
        <section className="ios-slide-up scroll-fade-in-delay-2">
          <div className="glass-card p-4">
            <div className="overflow-x-auto no-scrollbar">
              <div className="flex space-x-2 min-w-max">
                {faqCategories.map((category) => {
                  const IconComponent = category.icon;
                  return (
                    <button
                      key={category.id}
                      className={`flex items-center space-x-2 px-4 py-2 rounded-lg whitespace-nowrap transition-all duration-200 ${
                        activeCategory === category.id
                          ? 'bg-system-blue text-white'
                          : 'bg-secondary-system-fill text-secondary-label hover:bg-tertiary-system-fill'
                      }`}
                      onClick={() => setActiveCategory(category.id)}
                    >
                      <IconComponent className="w-4 h-4" />
                      <span className="ios-footnote font-medium">{category.name}</span>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        </section>

        {/* FAQ Items */}
        <section className="ios-slide-up scroll-fade-in-delay-3">
          <div className="glass-card p-4">
            <h3 className="ios-headline font-semibold mb-4">
              {activeCategory === 'all' ? 'Все вопросы' : faqCategories.find(c => c.id === activeCategory)?.name}
              <span className="ios-footnote text-secondary-label ml-2">({filteredFAQs.length})</span>
            </h3>
            
            <div className="space-y-3">
              {filteredFAQs.map((item) => {
                const IconComponent = item.icon;
                const isExpanded = expandedFAQ === item.id;
                
                return (
                  <div key={item.id} className="glass-card overflow-hidden">
                    <button
                      className="w-full p-4 text-left transition-colors hover:bg-secondary-system-fill/50"
                      onClick={() => toggleFAQ(item.id)}
                    >
                      <div className="flex items-start space-x-3">
                        <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                          item.color === 'text-system-blue' ? 'bg-system-blue/10' :
                          item.color === 'text-system-green' ? 'bg-system-green/10' :
                          item.color === 'text-system-purple' ? 'bg-system-purple/10' :
                          item.color === 'text-system-orange' ? 'bg-system-orange/10' :
                          item.color === 'text-system-red' ? 'bg-system-red/10' :
                          'bg-system-teal/10'
                        }`}>
                          <IconComponent className={`w-4 h-4 ${item.color}`} />
                        </div>
                        <div className="flex-1">
                          <h4 className="ios-body font-semibold">{item.question}</h4>
                        </div>
                        <div className="flex-shrink-0">
                          {isExpanded ? (
                            <ChevronUp className="w-5 h-5 text-secondary-label" />
                          ) : (
                            <ChevronDown className="w-5 h-5 text-secondary-label" />
                          )}
                        </div>
                      </div>
                    </button>
                    
                    {isExpanded && (
                      <div className="px-4 pb-4">
                        <div className="ml-11 pl-3 border-l-2 border-secondary-system-fill">
                          <div className="ios-footnote text-secondary-label leading-relaxed whitespace-pre-line">
                            {item.answer}
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
            
            {filteredFAQs.length === 0 && (
              <div className="text-center py-8">
                <div className="w-16 h-16 bg-quaternary-system-fill rounded-full flex items-center justify-center mx-auto mb-4">
                  <Search className="w-8 h-8 text-quaternary-label" />
                </div>
                <h3 className="ios-body font-semibold mb-2">Ничего не найдено</h3>
                <p className="ios-footnote text-secondary-label">
                  Попробуйте изменить запрос или выберите другую категорию
                </p>
              </div>
            )}
          </div>
        </section>

        {/* Contact Methods */}
        <section className="ios-slide-up scroll-fade-in-delay-4">
          <div className="glass-card p-4">
            <h3 className="ios-headline font-semibold mb-4">Не нашли ответ?</h3>
            <div className="space-y-3">
              {contactMethods.map((method) => {
                const IconComponent = method.icon;
                return (
                  <div 
                    key={method.id} 
                    className="glass-card p-4 cursor-pointer transition-all duration-200 hover:glass-floating"
                    onClick={method.action}
                  >
                    <div className="flex items-center space-x-4">
                      <div className={`w-12 h-12 rounded-full flex items-center justify-center ${method.color}`}>
                        <IconComponent className="w-6 h-6" />
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center space-x-2">
                          <div className="ios-body font-semibold">{method.title}</div>
                          {method.urgent && (
                            <div className="px-2 py-1 bg-system-red/10 rounded-full">
                              <span className="ios-caption2 text-system-red font-semibold">Быстро</span>
                            </div>
                          )}
                        </div>
                        <div className="ios-footnote text-secondary-label">{method.description}</div>
                        <div className="ios-caption2 text-tertiary-label">{method.detail}</div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </section>

        {/* Service Features */}
        <section className="ios-slide-up scroll-fade-in">
          <div className="glass-card p-4">
            <h3 className="ios-headline font-semibold mb-4">Почему выбирают нас</h3>
            <div className="space-y-4">
              {serviceFeatures.map((feature, index) => {
                const IconComponent = feature.icon;
                return (
                  <div key={index} className="glass-card p-4">
                    <div className="flex items-start space-x-3">
                      <div className={`w-10 h-10 rounded-full flex items-center justify-center ${
                        feature.color === 'text-system-green' ? 'bg-system-green/10' :
                        feature.color === 'text-system-orange' ? 'bg-system-orange/10' :
                        feature.color === 'text-system-blue' ? 'bg-system-blue/10' :
                        feature.color === 'text-system-purple' ? 'bg-system-purple/10' :
                        feature.color === 'text-system-red' ? 'bg-system-red/10' :
                        'bg-quaternary-system-fill'
                      }`}>
                        <IconComponent className={`w-5 h-5 ${feature.color}`} />
                      </div>
                      <div className="flex-1">
                        <div className="ios-body font-semibold mb-1">{feature.title}</div>
                        <div className="ios-footnote text-secondary-label">{feature.description}</div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </section>

        {/* Documentation Links */}
        <section className="ios-slide-up scroll-fade-in-delay-1">
          <div className="glass-card p-4">
            <h3 className="ios-headline font-semibold mb-4">Полезные материалы</h3>
            <div className="space-y-3">
              <div className="glass-card p-4 cursor-pointer hover:glass-floating transition-all duration-200">
                <div className="flex items-center space-x-3">
                  <FileText className="w-5 h-5 text-system-blue" />
                  <div className="flex-1">
                    <div className="ios-body font-semibold">Техническая документация</div>
                    <div className="ios-footnote text-secondary-label">API, интеграции, настройки</div>
                  </div>
                  <Download className="w-4 h-4 text-tertiary-label" />
                </div>
              </div>
              
              <div className="glass-card p-4 cursor-pointer hover:glass-floating transition-all duration-200">
                <div className="flex items-center space-x-3">
                  <Globe className="w-5 h-5 text-system-green" />
                  <div className="flex-1">
                    <div className="ios-body font-semibold">Примеры проектов</div>
                    <div className="ios-footnote text-secondary-label">Портфолио готовых решений</div>
                  </div>
                  <Download className="w-4 h-4 text-tertiary-label" />
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* Emergency */}
        <section className="ios-slide-up scroll-fade-in-delay-2">
          <div className="glass-card p-4 bg-system-red/5 border-system-red/20">
            <div className="flex items-start space-x-3">
              <AlertCircle className="w-6 h-6 text-system-red flex-shrink-0 mt-1" />
              <div>
                <div className="ios-body font-semibold text-system-red mb-2">Экстренная поддержка</div>
                <div className="ios-footnote text-secondary-label leading-relaxed">
                  Если ваше приложение не работает или произошла критическая ошибка, 
                  немедленно напишите нам в Telegram <span className="font-semibold">@web4tgs</span>.
                  
                  <br/><br/>
                  
                  <span className="font-semibold">Время реакции:</span>
                  <br/>• Критические ошибки — 15 минут
                  <br/>• Проблемы с платежами — 30 минут  
                  <br/>• Обычные вопросы — 2 часа
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  );
});

export default HelpPage;```

### components/InlineValidation.tsx
```tsx
import { CheckCircle2, XCircle, AlertCircle } from 'lucide-react';
import { cn } from '@/lib/utils';

export type ValidationStatus = 'idle' | 'validating' | 'valid' | 'invalid' | 'warning';

interface InlineValidationProps {
  status: ValidationStatus;
  message?: string;
  className?: string;
}

export function InlineValidation({ status, message, className = '' }: InlineValidationProps) {
  if (status === 'idle') return null;

  const getStatusConfig = () => {
    switch (status) {
      case 'validating':
        return {
          icon: null,
          color: 'text-white/40',
          bgColor: 'bg-white/5',
          message: message || 'Проверка...',
          animation: 'animate-pulse',
        };
      case 'valid':
        return {
          icon: CheckCircle2,
          color: 'text-emerald-400',
          bgColor: 'bg-emerald-500/10',
          message: message || 'Проверено',
          animation: 'animate-fade-in-up',
        };
      case 'invalid':
        return {
          icon: XCircle,
          color: 'text-rose-400',
          bgColor: 'bg-rose-500/10',
          message: message || 'Ошибка валидации',
          animation: 'animate-shake',
        };
      case 'warning':
        return {
          icon: AlertCircle,
          color: 'text-amber-400',
          bgColor: 'bg-amber-500/10',
          message: message || 'Предупреждение',
          animation: 'animate-wiggle',
        };
      default:
        return null;
    }
  };

  const config = getStatusConfig();
  if (!config) return null;

  const Icon = config.icon;

  return (
    <div
      className={cn(
        'flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium transition-all',
        config.bgColor,
        config.color,
        config.animation,
        className
      )}
      data-testid={`validation-${status}`}
    >
      {status === 'validating' ? (
        <div className="spinner w-4 h-4" />
      ) : Icon ? (
        <Icon className="w-4 h-4" />
      ) : null}
      <span>{config.message}</span>
    </div>
  );
}

interface ValidationInputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  validationStatus?: ValidationStatus;
  validationMessage?: string;
  label?: string;
  hint?: string;
}

export function ValidationInput({
  validationStatus = 'idle',
  validationMessage,
  label,
  hint,
  className = '',
  ...props
}: ValidationInputProps) {
  const getBorderColor = () => {
    switch (validationStatus) {
      case 'valid':
        return 'border-emerald-500/50 focus:border-emerald-500';
      case 'invalid':
        return 'border-rose-500/50 focus:border-rose-500';
      case 'warning':
        return 'border-amber-500/50 focus:border-amber-500';
      default:
        return 'border-white/20 focus:border-emerald-500';
    }
  };

  return (
    <div className="space-y-2">
      {label && (
        <label className="block text-sm font-medium text-white">
          {label}
        </label>
      )}

      <div className="relative">
        <input
          className={cn(
            'w-full px-4 py-3 rounded-xl bg-white/5 backdrop-blur-sm border-2 text-white placeholder-white/40 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-500/20',
            getBorderColor(),
            validationStatus === 'invalid' && 'animate-shake',
            className
          )}
          data-testid="input-validation"
          {...props}
        />

        {validationStatus === 'valid' && (
          <CheckCircle2 className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-emerald-400 animate-scale-in" />
        )}
        {validationStatus === 'invalid' && (
          <XCircle className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-rose-400 animate-shake" />
        )}
        {validationStatus === 'warning' && (
          <AlertCircle className="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-amber-400 animate-wiggle" />
        )}
      </div>

      {hint && validationStatus === 'idle' && (
        <p className="text-xs text-white/50">
          {hint}
        </p>
      )}

      {validationMessage && validationStatus !== 'idle' && (
        <InlineValidation
          status={validationStatus}
          message={validationMessage}
        />
      )}
    </div>
  );
}

interface ValidationTextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  validationStatus?: ValidationStatus;
  validationMessage?: string;
  label?: string;
  hint?: string;
}

export function ValidationTextarea({
  validationStatus = 'idle',
  validationMessage,
  label,
  hint,
  className = '',
  ...props
}: ValidationTextareaProps) {
  const getBorderColor = () => {
    switch (validationStatus) {
      case 'valid':
        return 'border-emerald-500/50 focus:border-emerald-500';
      case 'invalid':
        return 'border-rose-500/50 focus:border-rose-500';
      case 'warning':
        return 'border-amber-500/50 focus:border-amber-500';
      default:
        return 'border-white/20 focus:border-emerald-500';
    }
  };

  return (
    <div className="space-y-2">
      {label && (
        <label className="block text-sm font-medium text-white">
          {label}
        </label>
      )}

      <div className="relative">
        <textarea
          className={cn(
            'w-full px-4 py-3 rounded-xl bg-white/5 backdrop-blur-sm border-2 text-white placeholder-white/40 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 resize-none',
            getBorderColor(),
            validationStatus === 'invalid' && 'animate-shake',
            className
          )}
          data-testid="textarea-validation"
          {...props}
        />
      </div>

      {hint && validationStatus === 'idle' && (
        <p className="text-xs text-white/50">
          {hint}
        </p>
      )}

      {validationMessage && validationStatus !== 'idle' && (
        <InlineValidation
          status={validationStatus}
          message={validationMessage}
        />
      )}
    </div>
  );
}
```

### components/LazyImage.tsx
```tsx
import { useState, useEffect, useRef, ImgHTMLAttributes } from 'react';

interface LazyImageProps extends ImgHTMLAttributes<HTMLImageElement> {
  src: string;
  alt: string;
  fallback?: string;
  className?: string;
  threshold?: number;
  eager?: boolean; // Force eager loading for above-the-fold images
}

export function LazyImage({ 
  src, 
  alt, 
  fallback = '/placeholder.jpg', 
  className = '', 
  threshold = 0.1,
  eager = false,
  ...props 
}: LazyImageProps) {
  const [isLoaded, setIsLoaded] = useState(false);
  const [isInView, setIsInView] = useState(eager);
  const [error, setError] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);

  useEffect(() => {
    setIsLoaded(false);
    setError(false);
  }, [src]);

  useEffect(() => {
    if (!imgRef.current || eager) return;

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsInView(true);
          observer.disconnect();
        }
      },
      { 
        threshold,
        rootMargin: '200px', // Start loading 200px before viewport (instant feel)
      }
    );

    observer.observe(imgRef.current);

    return () => observer.disconnect();
  }, [threshold, eager]);

  const handleLoad = () => {
    setIsLoaded(true);
  };

  const handleError = () => {
    setError(true);
  };

  return (
    <div ref={imgRef} className={`relative overflow-hidden ${className}`}>
      {/* Instant CSS-only placeholder - no network request */}
      {!isLoaded && (
        <div 
          className="absolute inset-0 bg-gradient-to-br from-white/5 to-white/10 backdrop-blur-sm animate-pulse"
          style={{
            backgroundImage: 'linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.05) 75%)',
            backgroundSize: '20px 20px',
          }}
        />
      )}
      
      {/* Only load image when in view */}
      {isInView && (
        <img
          {...props}
          src={error ? fallback : src}
          alt={alt}
          onLoad={handleLoad}
          onError={handleError}
          decoding="async"
          className={`transition-opacity duration-300 ${
            isLoaded ? 'opacity-100' : 'opacity-0'
          } ${className}`}
          loading={eager ? "eager" : "lazy"}
          fetchPriority={eager ? "high" : "auto"}
        />
      )}
    </div>
  );
}
```

### components/LazyVideo.tsx
```tsx
import { useEffect, useRef, useState } from 'react';

interface LazyVideoProps {
  src: string;
  poster?: string;
  className?: string;
  autoPlay?: boolean;
  loop?: boolean;
  muted?: boolean;
  playsInline?: boolean;
  preload?: 'none' | 'metadata' | 'auto';
}

export function LazyVideo({
  src,
  poster,
  className = '',
  autoPlay = true,
  loop = true,
  muted = true,
  playsInline = true,
  preload = 'none'
}: LazyVideoProps) {
  const videoRef = useRef<HTMLVideoElement>(null);
  const [isLoaded, setIsLoaded] = useState(false);

  useEffect(() => {
    const video = videoRef.current;
    if (!video) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && !isLoaded) {
            const source = video.querySelector('source[data-src]');
            if (source) {
              const htmlSource = source as HTMLSourceElement;
              htmlSource.src = htmlSource.dataset.src || '';
              video.load();
              
              if (autoPlay) {
                video.play().catch(() => {
                });
              }
              
              setIsLoaded(true);
            }
          }
        });
      },
      {
        rootMargin: '50px',
        threshold: 0.1
      }
    );

    observer.observe(video);

    return () => {
      observer.disconnect();
    };
  }, [autoPlay, isLoaded]);

  return (
    <video
      ref={videoRef}
      className={className}
      loop={loop}
      muted={muted}
      playsInline={playsInline}
      preload={preload}
      poster={poster}
    >
      <source data-src={src} type="video/mp4" />
    </video>
  );
}
```

### components/ModernAnimatedIcons.tsx
```tsx
import React from 'react';
import { motion, useReducedMotion } from '@/utils/LazyMotionProvider';
import {
  ShoppingBag,
  Laptop,
  Sparkle,
  ForkKnife,
  Coffee,
  Watch,
  Armchair,
  Lightning,
  DiamondsFour,
  Disc,
  Heart,
  Coffee as TeaCup,
  Cpu,
  Barbell,
  FlowerLotus,
  Car,
  Buildings,
  AirplaneTilt,
  GraduationCap,
  PawPrint,
  Books,
  Flower,
  GameController,
  FirstAidKit,
  Suitcase,
  Scales,
} from 'phosphor-react';

// Animation presets for modern micro-interactions
const iconAnimations = {
  // Gentle swing animation (for fashion/shopping)
  swing: {
    initial: { rotate: 0 },
    animate: {
      rotate: [-2, 2, -2],
      transition: {
        duration: 3,
        repeat: Infinity,
        ease: 'easeInOut',
      },
    },
  },
  
  // Shimmer effect (for electronics/tech)
  shimmer: {
    initial: { opacity: 0.8 },
    animate: {
      opacity: [0.8, 1, 0.8],
      scale: [1, 1.05, 1],
      transition: {
        duration: 2.5,
        repeat: Infinity,
        ease: 'easeInOut',
      },
    },
  },
  
  // Glow pulse (for beauty/luxury)
  glowPulse: {
    initial: { filter: 'drop-shadow(0 0 0px rgba(255,255,255,0))' },
    animate: {
      filter: [
        'drop-shadow(0 0 0px rgba(255,255,255,0))',
        'drop-shadow(0 0 12px rgba(255,255,255,0.6))',
        'drop-shadow(0 0 0px rgba(255,255,255,0))',
      ],
      transition: {
        duration: 2,
        repeat: Infinity,
        ease: 'easeInOut',
      },
    },
  },
  
  // Float animation (for restaurants/food)
  float: {
    initial: { y: 0 },
    animate: {
      y: [-3, 3, -3],
      transition: {
        duration: 3,
        repeat: Infinity,
        ease: 'easeInOut',
      },
    },
  },
  
  // Rotation (for vinyl/records/car wheels)
  rotate: {
    initial: { rotate: 0 },
    animate: {
      rotate: 360,
      transition: {
        duration: 20,
        repeat: Infinity,
        ease: 'linear',
      },
    },
  },
  
  // Scale pulse (for fitness/health)
  scalePulse: {
    initial: { scale: 1 },
    animate: {
      scale: [1, 1.1, 1],
      transition: {
        duration: 2,
        repeat: Infinity,
        ease: 'easeInOut',
      },
    },
  },
  
  // Breathing (for yoga/wellness)
  breathing: {
    initial: { scale: 1, opacity: 0.9 },
    animate: {
      scale: [1, 1.15, 1],
      opacity: [0.9, 1, 0.9],
      transition: {
        duration: 4,
        repeat: Infinity,
        ease: 'easeInOut',
      },
    },
  },
};

interface AnimatedIconWrapperProps {
  children: React.ReactNode;
  animation?: keyof typeof iconAnimations;
  color?: string;
  glowColor?: string;
}

const AnimatedIconWrapper: React.FC<AnimatedIconWrapperProps> = ({
  children,
  animation = 'shimmer',
  color = 'white',
  glowColor = 'rgba(255, 255, 255, 0.5)',
}) => {
  const prefersReducedMotion = useReducedMotion();
  const animationConfig = iconAnimations[animation];

  // If user prefers reduced motion, disable animations
  const shouldAnimate = !prefersReducedMotion;

  return (
    <motion.div
      className="relative flex items-center justify-center"
      initial={shouldAnimate ? animationConfig.initial : {}}
      animate={shouldAnimate ? animationConfig.animate : {}}
      style={{
        color,
        filter: 'drop-shadow(0 4px 20px rgba(255, 255, 255, 0.15))',
      }}
    >
      {/* Glow background effect */}
      <motion.div
        className="absolute inset-0 rounded-full blur-2xl"
        style={{ backgroundColor: glowColor }}
        animate={shouldAnimate ? {
          opacity: [0.2, 0.4, 0.2],
          scale: [0.8, 1.2, 0.8],
        } : { opacity: 0.3 }}
        transition={shouldAnimate ? {
          duration: 3,
          repeat: Infinity,
          ease: 'easeInOut',
        } : {}}
      />
      
      {/* Icon */}
      <div className="relative z-10">
        {children}
      </div>
    </motion.div>
  );
};

// === MODERN BUSINESS ICONS (2025 DESIGN) ===

// 1. Fashion / Clothing Store
export const ModernClothingIcon = () => (
  <AnimatedIconWrapper animation="swing" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(168, 85, 247, 0.4)">
    <ShoppingBag size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 2. Electronics Store
export const ModernElectronicsIcon = () => (
  <AnimatedIconWrapper animation="shimmer" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(59, 130, 246, 0.4)">
    <Laptop size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 3. Beauty Salon
export const ModernBeautyIcon = () => (
  <AnimatedIconWrapper animation="glowPulse" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(236, 72, 153, 0.4)">
    <Sparkle size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 4. Restaurant
export const ModernRestaurantIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(251, 191, 36, 0.4)">
    <ForkKnife size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 5. Coffee Shop
export const ModernCoffeeIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(217, 119, 6, 0.4)">
    <Coffee size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 6. Luxury Watches
export const ModernWatchIcon = () => (
  <AnimatedIconWrapper animation="shimmer" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(250, 204, 21, 0.4)">
    <Watch size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 7. Home Decor
export const ModernHomeDecorIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(16, 185, 129, 0.4)">
    <Armchair size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 8. Sneaker Store
export const ModernSneakerIcon = () => (
  <AnimatedIconWrapper animation="swing" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(239, 68, 68, 0.4)">
    <Lightning size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 9. Jewelry Boutique
export const ModernJewelryIcon = () => (
  <AnimatedIconWrapper animation="glowPulse" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(147, 51, 234, 0.4)">
    <DiamondsFour size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 10. Vinyl Records
export const ModernVinylIcon = () => (
  <AnimatedIconWrapper animation="rotate" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(99, 102, 241, 0.4)">
    <Disc size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 11. Artisan Market
export const ModernArtisanIcon = () => (
  <AnimatedIconWrapper animation="scalePulse" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(34, 197, 94, 0.4)">
    <Heart size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 12. Premium Tea
export const ModernTeaIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(20, 184, 166, 0.4)">
    <TeaCup size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 13. Tech Gadgets
export const ModernGadgetIcon = () => (
  <AnimatedIconWrapper animation="shimmer" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(6, 182, 212, 0.4)">
    <Cpu size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 14. Fitness Club
export const ModernFitnessIcon = () => (
  <AnimatedIconWrapper animation="scalePulse" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(132, 204, 22, 0.4)">
    <Barbell size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 15. Yoga Studio
export const ModernYogaIcon = () => (
  <AnimatedIconWrapper animation="breathing" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(167, 139, 250, 0.4)">
    <FlowerLotus size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 16. Car Service
export const ModernCarServiceIcon = () => (
  <AnimatedIconWrapper animation="shimmer" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(59, 130, 246, 0.4)">
    <Car size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 17. Real Estate
export const ModernRealEstateIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(100, 116, 139, 0.4)">
    <Buildings size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 18. Travel Agency
export const ModernTravelIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(14, 165, 233, 0.4)">
    <AirplaneTilt size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 19. Online Education
export const ModernEducationIcon = () => (
  <AnimatedIconWrapper animation="swing" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(79, 70, 229, 0.4)">
    <GraduationCap size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 20. Pet Shop
export const ModernPetShopIcon = () => (
  <AnimatedIconWrapper animation="scalePulse" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(251, 146, 60, 0.4)">
    <PawPrint size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 21. Bookstore
export const ModernBookstoreIcon = () => (
  <AnimatedIconWrapper animation="float" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(234, 179, 8, 0.4)">
    <Books size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// 22. Flower Delivery
export const ModernFlowerIcon = () => (
  <AnimatedIconWrapper animation="breathing" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(244, 114, 182, 0.4)">
    <Flower size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

// Additional business icons
export const ModernGamingIcon = () => (
  <AnimatedIconWrapper animation="shimmer" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(168, 85, 247, 0.4)">
    <GameController size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

export const ModernMedicalIcon = () => (
  <AnimatedIconWrapper animation="scalePulse" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(239, 68, 68, 0.4)">
    <FirstAidKit size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

export const ModernLuggageIcon = () => (
  <AnimatedIconWrapper animation="swing" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(14, 165, 233, 0.4)">
    <Suitcase size={80} weight="duotone" />
  </AnimatedIconWrapper>
);

export const ModernLegalIcon = () => (
  <AnimatedIconWrapper animation="shimmer" color="rgba(255, 255, 255, 0.95)" glowColor="rgba(100, 116, 139, 0.4)">
    <Scales size={80} weight="duotone" />
  </AnimatedIconWrapper>
);
```

### components/ModernDrawerDemo.tsx
```tsx
import { ModernDrawer, ConfirmDrawer, SelectDrawer } from './ui/modern-drawer';
import { HapticButton } from './ui/haptic-button';
import { Page, PageHeader, PageSection } from './ui/page';
import { Trash2, Package, Shirt, ShoppingBag, Star, Settings, Bell, User } from 'lucide-react';
import { useState } from 'react';

/**
 * Демонстрация Modern Drawer компонентов
 * Показывает современную Bottom Sheet навигацию (UX 2025)
 */
export function ModernDrawerDemo() {
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [isDeleted, setIsDeleted] = useState(false);

  return (
    <Page withPadding withSafeArea>
      <PageHeader 
        title="Modern Drawer"
        subtitle="Bottom Sheet навигация - стандарт UX 2025"
      />

      {/* Базовый ModernDrawer */}
      <PageSection>
        <h2 className="text-xl font-bold text-white mb-4">ModernDrawer</h2>
        
        <div className="space-y-3">
          {/* Простой Drawer */}
          <ModernDrawer
            trigger={
              <HapticButton variant="primary" size="lg" className="w-full">
                Открыть простой Drawer
              </HapticButton>
            }
            height="50%"
            title="Информация о товаре"
            description="Детали и характеристики"
            showCloseButton
          >
            <div className="space-y-4">
              <div className="p-4 bg-white/5 rounded-xl">
                <h3 className="text-white font-bold mb-2">Характеристики</h3>
                <ul className="text-white/70 text-sm space-y-1">
                  <li>• Материал: 100% хлопок</li>
                  <li>• Цвет: Черный</li>
                  <li>• Страна: Россия</li>
                  <li>• Уход: Машинная стирка 30°</li>
                </ul>
              </div>
              
              <div className="p-4 bg-blue-500/10 rounded-xl border border-blue-500/20">
                <p className="text-blue-400 text-sm">
                  ✨ Бесплатная доставка при заказе от 3000₽
                </p>
              </div>
            </div>
          </ModernDrawer>

          {/* Drawer с разной высотой */}
          <ModernDrawer
            trigger={
              <HapticButton variant="secondary" size="md" className="w-full">
                Полноэкранный Drawer
              </HapticButton>
            }
            height="full"
            title="Полное описание"
            showCloseButton
          >
            <div className="space-y-6">
              <div>
                <h3 className="text-white font-bold mb-2">О товаре</h3>
                <p className="text-white/70 text-sm leading-relaxed">
                  Премиальная футболка из 100% органического хлопка. 
                  Идеальная посадка, устойчивые к выцветанию краски, 
                  и невероятная мягкость материала.
                </p>
              </div>
              
              <div>
                <h3 className="text-white font-bold mb-2">Размерная сетка</h3>
                <div className="grid grid-cols-4 gap-2">
                  {['XS', 'S', 'M', 'L'].map((size) => (
                    <div key={size} className="p-3 bg-white/5 rounded-lg text-center">
                      <div className="text-white font-bold">{size}</div>
                    </div>
                  ))}
                </div>
              </div>
              
              <div>
                <h3 className="text-white font-bold mb-2">Отзывы</h3>
                <div className="space-y-3">
                  {[1, 2, 3].map((i) => (
                    <div key={i} className="p-3 bg-white/5 rounded-lg">
                      <div className="flex items-center gap-2 mb-1">
                        <div className="flex">
                          {[1,2,3,4,5].map((s) => (
                            <Star key={s} className="w-4 h-4 fill-yellow-500 text-yellow-500" />
                          ))}
                        </div>
                        <span className="text-white/60 text-xs">5.0</span>
                      </div>
                      <p className="text-white/70 text-sm">
                        Отличное качество! Рекомендую!
                      </p>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </ModernDrawer>
        </div>
      </PageSection>

      {/* ConfirmDrawer */}
      <PageSection delay={0.1}>
        <h2 className="text-xl font-bold text-white mb-4">ConfirmDrawer</h2>
        
        <div className="space-y-3">
          {/* Обычное подтверждение */}
          <ConfirmDrawer
            trigger={
              <HapticButton variant="primary" size="md" className="w-full">
                Добавить в корзину
              </HapticButton>
            }
            title="Добавить в корзину?"
            description="Товар будет добавлен в вашу корзину"
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={() => alert('✅ Добавлено в корзину!')}
            onCancel={() => console.log('Отменено')}
          />

          {/* Деструктивное действие */}
          {!isDeleted ? (
            <ConfirmDrawer
              trigger={
                <HapticButton 
                  variant="destructive" 
                  size="md" 
                  className="w-full"
                >
                  <Trash2 className="w-4 h-4 mr-2" />
                  Удалить товар
                </HapticButton>
              }
              title="Удалить товар?"
              description="Это действие нельзя отменить. Товар будет удален навсегда."
              confirmText="Удалить"
              cancelText="Отмена"
              variant="destructive"
              onConfirm={() => {
                setIsDeleted(true);
                setTimeout(() => setIsDeleted(false), 2000);
              }}
            />
          ) : (
            <div className="p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-center">
              <p className="text-red-400 font-medium">✓ Товар удален</p>
            </div>
          )}
        </div>
      </PageSection>

      {/* SelectDrawer */}
      <PageSection delay={0.2}>
        <h2 className="text-xl font-bold text-white mb-4">SelectDrawer</h2>
        
        <div className="space-y-3">
          {/* Выбор размера */}
          <SelectDrawer
            trigger={
              <HapticButton variant="secondary" size="lg" className="w-full">
                <Shirt className="w-5 h-5 mr-2" />
                {selectedSize ? `Размер: ${selectedSize}` : 'Выбрать размер'}
              </HapticButton>
            }
            title="Выберите размер"
            description="Размеры соответствуют европейской сетке"
            selectedValue={selectedSize}
            options={[
              { 
                value: 'xs', 
                label: 'XS', 
                description: 'Обхват груди: 84-88 см',
                icon: <Shirt className="w-5 h-5" />
              },
              { 
                value: 's', 
                label: 'S', 
                description: 'Обхват груди: 88-92 см',
                icon: <Shirt className="w-5 h-5" />
              },
              { 
                value: 'm', 
                label: 'M', 
                description: 'Обхват груди: 92-96 см',
                icon: <Shirt className="w-5 h-5" />
              },
              { 
                value: 'l', 
                label: 'L', 
                description: 'Обхват груди: 96-100 см',
                icon: <Shirt className="w-5 h-5" />
              },
              { 
                value: 'xl', 
                label: 'XL', 
                description: 'Обхват груди: 100-104 см',
                icon: <Shirt className="w-5 h-5" />,
                disabled: true // Пример disabled опции
              }
            ]}
            onSelect={(value) => setSelectedSize(value.toUpperCase())}
          />

          {/* Выбор способа доставки */}
          <SelectDrawer
            trigger={
              <HapticButton variant="ghost" size="md" className="w-full">
                <Package className="w-5 h-5 mr-2" />
                Способ доставки
              </HapticButton>
            }
            title="Выберите способ доставки"
            options={[
              { 
                value: 'pickup', 
                label: 'Самовывоз', 
                description: 'Бесплатно • Завтра',
                icon: <ShoppingBag className="w-5 h-5" />
              },
              { 
                value: 'courier', 
                label: 'Курьер', 
                description: '300₽ • 1-2 дня',
                icon: <Package className="w-5 h-5" />
              },
              { 
                value: 'express', 
                label: 'Экспресс', 
                description: '600₽ • Сегодня',
                icon: <Star className="w-5 h-5" />
              }
            ]}
            onSelect={(value) => alert(`Выбрано: ${value}`)}
          />

          {/* Выбор настроек */}
          <SelectDrawer
            trigger={
              <HapticButton variant="ghost" size="sm" className="w-full">
                <Settings className="w-5 h-5 mr-2" />
                Настройки
              </HapticButton>
            }
            title="Настройки профиля"
            description="Выберите раздел для настройки"
            options={[
              { value: 'profile', label: 'Профиль', icon: <User className="w-5 h-5" /> },
              { value: 'notifications', label: 'Уведомления', icon: <Bell className="w-5 h-5" /> },
              { value: 'settings', label: 'Настройки', icon: <Settings className="w-5 h-5" /> }
            ]}
            onSelect={(value) => alert(`Открыть: ${value}`)}
          />
        </div>
      </PageSection>

      {/* Преимущества */}
      <PageSection delay={0.3}>
        <div className="p-6 bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl">
          <h3 className="text-white font-bold mb-3">✨ Преимущества Modern Drawer</h3>
          <ul className="text-white/80 text-sm space-y-2">
            <li>📱 <strong>Нативный UX</strong> - Как в iOS/Android приложениях</li>
            <li>🎯 <strong>Drag-to-close</strong> - Жест закрытия свайпом вниз</li>
            <li>📳 <strong>Haptic Feedback</strong> - Вибрация при взаимодействии</li>
            <li>🎨 <strong>Backdrop blur</strong> - Размытие фона</li>
            <li>⚡ <strong>Адаптивная высота</strong> - 30%, 50%, 75%, full, auto</li>
            <li>🔒 <strong>Safe area</strong> - Учет безопасных зон Telegram</li>
            <li>♿ <strong>Accessibility</strong> - ARIA атрибуты и keyboard navigation</li>
          </ul>
        </div>
      </PageSection>
    </Page>
  );
}
```

### components/MotionWrapper.tsx
```tsx
import { m as motion } from '@/utils/LazyMotionProvider';
import { ReactNode } from 'react';

// Spring animation presets (kept for HoverScale/TapScale)
export const springPresets = {
  gentle: { type: 'spring', stiffness: 100, damping: 15, mass: 0.5 },
  bouncy: { type: 'spring', stiffness: 200, damping: 10, mass: 0.8 },
  snappy: { type: 'spring', stiffness: 300, damping: 20, mass: 0.5 },
  smooth: { type: 'spring', stiffness: 120, damping: 18, mass: 0.6 },
} as const;

// Reusable Motion Components
interface MotionBoxProps {
  children: ReactNode;
  variant?: string;
  delay?: number;
  className?: string;
}

export function MotionBox({ 
  children, 
  variant = 'fadeInUp', 
  delay = 0,
  className = '',
  ...props 
}: MotionBoxProps) {
  return (
    <div className={className} {...props}>
      {children}
    </div>
  );
}

export function MotionStagger({ children, className = '' }: { children: ReactNode; className?: string }) {
  return (
    <div className={className}>
      {children}
    </div>
  );
}

// Hover animation wrapper
interface HoverScaleProps {
  children: ReactNode;
  scale?: number;
  className?: string;
}

export function HoverScale({ children, scale = 1.05, className = '' }: HoverScaleProps) {
  return (
    <motion.div
      whileHover={{ scale }}
      whileTap={{ scale: scale - 0.02 }}
      transition={springPresets.bouncy}
      className={className}
    >
      {children}
    </motion.div>
  );
}

// Tap animation wrapper
interface TapScaleProps {
  children: ReactNode;
  className?: string;
}

export function TapScale({ children, className = '' }: TapScaleProps) {
  return (
    <motion.div
      whileTap={{ scale: 0.95 }}
      transition={springPresets.snappy}
      className={className}
    >
      {children}
    </motion.div>
  );
}
```

### components/NFTCarousel.tsx
```tsx
import { useState, useEffect } from "react";
import { demoApps } from "@/data/demoApps";

interface NFTCarouselProps {
  onOpenDemo: (demoId: string) => void;
}

export default function NFTCarousel({ onOpenDemo }: NFTCarouselProps) {
  const [activeIndex, setActiveIndex] = useState(0);

  const getCardGradient = (category: string): string => {
    const gradients: Record<string, string> = {
      'БИЗНЕС ПРИЛОЖЕНИЕ': 'rgba(99, 102, 241, 0.8), rgba(139, 92, 246, 0.4)',
      'ЭЛЕКТРОННАЯ КОММЕРЦИЯ': 'rgba(236, 72, 153, 0.8), rgba(251, 113, 133, 0.4)',
      'ОБРАЗОВАНИЕ': 'rgba(16, 185, 129, 0.8), rgba(52, 211, 153, 0.4)',
      'ЗДОРОВЬЕ': 'rgba(245, 101, 101, 0.8), rgba(248, 113, 113, 0.4)',
      'РАЗВЛЕЧЕНИЯ': 'rgba(168, 85, 247, 0.8), rgba(196, 181, 253, 0.4)',
      'ФИНАНСЫ': 'rgba(251, 191, 36, 0.8), rgba(252, 211, 77, 0.4)',
      'СОЦИАЛЬНЫЕ СЕТИ': 'rgba(14, 165, 233, 0.8), rgba(59, 130, 246, 0.4)',
      'ПУТЕШЕСТВИЯ': 'rgba(34, 197, 94, 0.8), rgba(74, 222, 128, 0.4)',
      'СПОРТ': 'rgba(239, 68, 68, 0.8), rgba(248, 113, 113, 0.4)',
      'МУЗЫКА': 'rgba(147, 51, 234, 0.8), rgba(167, 139, 250, 0.4)'
    };
    return gradients[category] || 'rgba(99, 102, 241, 0.8), rgba(139, 92, 246, 0.4)';
  };

  // Auto-rotate carousel
  useEffect(() => {
    const interval = setInterval(() => {
      setActiveIndex((prev) => (prev + 1) % demoApps.length);
    }, 4000);
    return () => clearInterval(interval);
  }, []);

  const getCardClass = (index: number) => {
    const diff = index - activeIndex;
    const total = demoApps.length;
    
    if (diff === 0) return "active";
    if (diff === 1 || diff === -(total - 1)) return "next";
    if (diff === -1 || diff === total - 1) return "prev";
    if (diff === 2 || diff === -(total - 2)) return "far-next";
    if (diff === -2 || diff === total - 2) return "far-prev";
    return "hidden";
  };

  const getGradient = (index: number) => {
    const gradients = [
      'linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%)',
      'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%)',
      'linear-gradient(135deg, rgba(245, 101, 101, 0.1) 0%, rgba(190, 24, 93, 0.1) 100%)',
      'linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%)',
      'linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(126, 34, 206, 0.1) 100%)',
      'linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%)',
      'linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(21, 128, 61, 0.1) 100%)',
      'linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(190, 24, 93, 0.1) 100%)',
      'linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(8, 145, 178, 0.1) 100%)',
      'linear-gradient(135deg, rgba(139, 69, 19, 0.1) 0%, rgba(120, 53, 15, 0.1) 100%)'
    ];
    return gradients[index % gradients.length];
  };

  return (
    <div className="relative w-full h-[500px] flex justify-center items-center max-w-md mx-auto">
      <style>{`
        .carousel {
          position: relative;
          width: 100%;
          height: 500px;
          transform-style: preserve-3d;
          perspective: 800px;
        }

        .nft-card {
          position: absolute;
          width: 280px;
          height: 400px;
          left: 50%;
          margin-left: -140px;
          border-radius: 24px;
          border: 1px solid rgba(255, 255, 255, 0.2);
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          text-align: center;
          color: #000000;
          cursor: pointer;
          transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
          transform-style: preserve-3d;
          box-shadow: 
            0 25px 50px rgba(0, 0, 0, 0.15),
            0 10px 20px rgba(0, 0, 0, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.4);
          will-change: transform, opacity;
          backface-visibility: hidden;
          overflow: hidden;
        }

        .nft-card.active {
          transform: translate3d(0, 0, 50px) rotateY(0deg) scale3d(1, 1, 1);
          opacity: 1;
          z-index: 10;
          box-shadow: 
            0 20px 40px rgba(0, 0, 0, 0.15),
            0 8px 16px rgba(0, 0, 0, 0.1),
            0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .nft-card.next {
          transform: translate3d(200px, 0, -100px) rotateY(-25deg) scale3d(0.8, 0.8, 0.3);
          opacity: 0.7;
          z-index: 5;
        }

        .nft-card.prev {
          transform: translate3d(-200px, 0, -100px) rotateY(25deg) scale3d(0.8, 0.8, 0.3);
          opacity: 0.7;
          z-index: 5;
        }

        .nft-card.far-next {
          transform: translate3d(300px, 0, -200px) rotateY(-40deg) scale3d(0.6, 0.6, 0.1);
          opacity: 0.4;
          z-index: 1;
        }

        .nft-card.far-prev {
          transform: translate3d(-300px, 0, -200px) rotateY(40deg) scale3d(0.6, 0.6, 0.1);
          opacity: 0.4;
          z-index: 1;
        }

        .nft-card.hidden {
          transform: translate3d(0, 0, -400px) rotateY(0deg) scale3d(0.3, 0.3, 0.01);
          opacity: 0;
          z-index: 0;
          pointer-events: none;
        }

        .cosmic-bg {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: 
            radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.08) 1px, transparent 1px),
            radial-gradient(circle at 80% 30%, rgba(255, 255, 255, 0.06) 1px, transparent 1px),
            radial-gradient(circle at 40% 70%, rgba(255, 255, 255, 0.04) 1px, transparent 1px);
          animation: twinkle 4s ease-in-out infinite alternate;
          border-radius: 20px;
        }

        @keyframes twinkle {
          0% { opacity: 0.4; }
          100% { opacity: 0.8; }
        }

        .card-glow {
          position: absolute;
          top: -50%;
          left: -50%;
          width: 200%;
          height: 200%;
          background: linear-gradient(45deg, 
            transparent 40%, 
            rgba(255, 255, 255, 0.1) 50%, 
            transparent 60%);
          animation: shimmer 8s linear infinite;
          border-radius: 20px;
        }

        @keyframes shimmer {
          0% { transform: translate3d(-100%, -100%, 0) rotate(45deg); }
          100% { transform: translate3d(100%, 100%, 0) rotate(45deg); }
        }

        .indicators {
          position: absolute;
          bottom: 40px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 10px;
          z-index: 100;
        }

        .indicator {
          width: 8px;
          height: 8px;
          border-radius: 50%;
          background: rgba(255, 165, 0, 0.4);
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .indicator.active {
          background: rgba(255, 140, 0, 0.9);
          transform: scale(1.4);
        }
      `}</style>

      <div className="carousel">
        {demoApps.map((app, index) => (
          <div
            key={app.id}
            className={`nft-card ${getCardClass(index)}`}
            style={{ 
              background: `linear-gradient(135deg, ${getCardGradient(app.category)})`
            }}
            onClick={() => onOpenDemo(app.id)}
          >
            <div className="cosmic-bg"></div>
            <div className="card-glow"></div>
            
            <div className="card-content relative z-10 p-6">
              <div className="inline-block px-3 py-1 text-xs font-bold text-white bg-black/30 backdrop-blur-sm rounded-full mb-4" 
                   style={{fontFamily: 'Montserrat, sans-serif'}}>
                {app.category}
              </div>
              
              <h3 className="text-2xl font-bold mb-4 leading-tight text-black" 
                  style={{fontFamily: 'Montserrat, sans-serif', fontWeight: '700'}}>
                {app.title}
              </h3>
              
              <div className="w-16 h-px bg-black/20 my-4 mx-auto"></div>
              
              <div className="text-sm font-semibold mb-3 text-black"
                   style={{fontFamily: 'Montserrat, sans-serif', fontWeight: '600'}}>
                {app.description}
              </div>
              
              <div className="text-xs text-black mb-4 font-medium"
                   style={{fontFamily: 'Montserrat, sans-serif', fontWeight: '500'}}>
                Современное решение для бизнеса
              </div>
              
              <div className="text-lg font-bold text-black bg-white/60 px-3 py-1 rounded-full inline-block"
                   style={{fontFamily: 'Montserrat, sans-serif', fontWeight: '700'}}>
                2024
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Indicators */}
      <div className="indicators">
        {demoApps.map((_, index) => (
          <div
            key={index}
            className={`indicator ${index === activeIndex ? 'active' : ''}`}
            onClick={() => setActiveIndex(index)}
          />
        ))}
      </div>
    </div>
  );
}```

### components/ObjectUploader.tsx
```tsx
// Referenced from javascript_object_storage blueprint
import { useState } from "react";
import type { ReactNode } from "react";
import Uppy from "@uppy/core";
import { DashboardModal } from "@uppy/react";
import "@uppy/core/dist/style.min.css";
import "@uppy/dashboard/dist/style.min.css";
import AwsS3 from "@uppy/aws-s3";
import type { UploadResult } from "@uppy/core";
import { Button } from "@/components/ui/button";

interface ObjectUploaderProps {
  maxNumberOfFiles?: number;
  maxFileSize?: number;
  onGetUploadParameters: () => Promise<{
    method: "PUT";
    url: string;
  }>;
  onComplete?: (
    result: UploadResult<Record<string, unknown>, Record<string, unknown>>
  ) => void;
  buttonClassName?: string;
  children: ReactNode;
}

/**
 * Компонент для загрузки файлов с мгновенным превью
 * 
 * Особенности:
 * - Рендерится как кнопка, открывающая модальное окно
 * - Предпросмотр файлов перед загрузкой
 * - Отслеживание прогресса загрузки
 * - Прямая загрузка в Object Storage через presigned URLs
 */
export function ObjectUploader({
  maxNumberOfFiles = 1,
  maxFileSize = 10485760, // 10MB default
  onGetUploadParameters,
  onComplete,
  buttonClassName,
  children,
}: ObjectUploaderProps) {
  const [showModal, setShowModal] = useState(false);
  const [uppy] = useState(() =>
    new Uppy({
      restrictions: {
        maxNumberOfFiles,
        maxFileSize,
        allowedFileTypes: ['image/*'], // Только изображения
      },
      autoProceed: false,
    })
      .use(AwsS3, {
        shouldUseMultipart: false,
        getUploadParameters: onGetUploadParameters,
      })
      .on("complete", (result) => {
        onComplete?.(result);
        setShowModal(false);
      })
  );

  return (
    <div>
      <Button 
        onClick={() => setShowModal(true)} 
        className={buttonClassName}
        data-testid="button-upload-photo"
      >
        {children}
      </Button>

      <DashboardModal
        uppy={uppy}
        open={showModal}
        onRequestClose={() => setShowModal(false)}
        proudlyDisplayPoweredByUppy={false}
      />
    </div>
  );
}
```

### components/OptimizedImage.tsx
```tsx
import { useState, useEffect, useRef, ImgHTMLAttributes } from 'react';

interface OptimizedImageProps extends Omit<ImgHTMLAttributes<HTMLImageElement>, 'src' | 'srcSet' | 'sizes'> {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  priority?: boolean;
  blurDataURL?: string;
  sizes?: string;
  onLoad?: () => void;
  fallbackColor?: string;
}

export function OptimizedImage({
  src,
  alt,
  width = 800,
  height,
  priority = false,
  blurDataURL,
  sizes = '100vw',
  className = '',
  onLoad,
  fallbackColor = 'bg-gradient-to-br from-gray-800 to-gray-900',
  ...props
}: OptimizedImageProps) {
  const [isLoaded, setIsLoaded] = useState(false);
  const [currentSrc, setCurrentSrc] = useState(blurDataURL || '');
  const [error, setError] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);
  
  const generateSrcSet = (url: string) => {
    if (!url.includes('unsplash.com')) return '';
    
    const widths = [320, 640, 750, 828, 1080, 1200, 1920];
    return widths
      .filter(w => w <= width * 2)
      .map(w => `${url}&w=${w}&q=75&fm=webp&auto=format ${w}w`)
      .join(', ');
  };
  
  const optimizedSrc = src.includes('unsplash.com')
    ? `${src}&w=${width}&h=${height || Math.round(width * 1.5)}&q=75&fm=webp&auto=format,compress&fit=crop`
    : src;
  
  const lowQualitySrc = src.includes('unsplash.com')
    ? `${src}&w=20&q=10&blur=200&fm=jpg`
    : blurDataURL;
  
  useEffect(() => {
    if (!imgRef.current) return;
    
    if (!priority && 'IntersectionObserver' in window) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              setCurrentSrc(optimizedSrc);
              observer.disconnect();
            }
          });
        },
        {
          rootMargin: '50px'
        }
      );
      
      observer.observe(imgRef.current);
      
      return () => observer.disconnect();
    } else {
      setCurrentSrc(optimizedSrc);
    }
  }, [optimizedSrc, priority]);
  
  const handleLoad = () => {
    setIsLoaded(true);
    onLoad?.();
  };
  
  const handleError = () => {
    setError(true);
  };
  
  if (error) {
    return (
      <div 
        className={`${className} ${fallbackColor} flex items-center justify-center text-white/40`}
        {...props}
      >
        <span className="text-xs font-semibold">{alt.slice(0, 2)}</span>
      </div>
    );
  }
  
  return (
    <div className={`relative overflow-hidden ${className}`}>
      {!isLoaded && (
        <div className={`absolute inset-0 ${fallbackColor} overflow-hidden`}>
          <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent shimmer-animation" />
        </div>
      )}
      
      {lowQualitySrc && !isLoaded && (
        <img
          src={lowQualitySrc}
          alt=""
          className="absolute inset-0 w-full h-full object-cover blur-xl scale-110"
          aria-hidden="true"
        />
      )}
      
      <img
        ref={imgRef}
        src={currentSrc}
        srcSet={currentSrc ? generateSrcSet(src) : undefined}
        sizes={sizes}
        alt={alt}
        width={width}
        height={height}
        loading={priority ? 'eager' : 'lazy'}
        decoding={priority ? 'sync' : 'async'}
        onLoad={handleLoad}
        onError={handleError}
        className={`
          w-full h-full object-cover transition-opacity duration-300
          ${isLoaded ? 'opacity-100' : 'opacity-0'}
        `}
        {...props}
      />
    </div>
  );
}

export async function getBlurDataURL(imageUrl: string): Promise<string> {
  if (imageUrl.includes('unsplash.com')) {
    return `${imageUrl}&w=10&q=10&blur=10&fm=jpg`;
  }
  return '';
}
```

### components/PageTransition.tsx
```tsx
import { ReactNode } from 'react';

interface PageTransitionProps {
  children: ReactNode;
  routeKey: string;
}

export function PageTransition({ children }: PageTransitionProps) {
  return (
    <div className="h-full w-full">
      {children}
    </div>
  );
}
```

### components/ParticleBackground.tsx
```tsx
import { useEffect, useRef } from 'react';

interface ParticleBackgroundProps {
  particleCount?: number;
  speed?: number;
  className?: string;
}

export function ParticleBackground({ 
  particleCount = 100, // Reduced from 500 for mobile performance
  speed = 0.0005, 
  className = '' 
}: ParticleBackgroundProps) {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const animationIdRef = useRef<number>();

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    // Check for reduced motion preference
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if (prefersReducedMotion) {
      return; // Don't animate if user prefers reduced motion
    }

    // Set canvas size
    const setCanvasSize = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };
    setCanvasSize();

    // Particle class
    class Particle {
      x: number;
      y: number;
      z: number;
      vx: number;
      vy: number;
      vz: number;
      color: string;
      size: number;

      constructor() {
        this.x = (Math.random() - 0.5) * canvas.width;
        this.y = (Math.random() - 0.5) * canvas.height;
        this.z = Math.random() * 1000;
        this.vx = (Math.random() - 0.5) * 0.5;
        this.vy = (Math.random() - 0.5) * 0.5;
        this.vz = Math.random() * 0.5 + 0.1;
        
        // Emerald gradient colors
        const hue = 150 + Math.random() * 30; // 150-180 (emerald to cyan)
        this.color = `hsl(${hue}, 70%, ${50 + Math.random() * 20}%)`;
        this.size = Math.random() * 2 + 0.5;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.z -= this.vz;

        // Wrap around
        if (this.z < 1) {
          this.z = 1000;
          this.x = (Math.random() - 0.5) * canvas.width;
          this.y = (Math.random() - 0.5) * canvas.height;
        }
      }

      draw(ctx: CanvasRenderingContext2D) {
        const scale = 1000 / (1000 + this.z);
        const x2d = this.x * scale + canvas.width / 2;
        const y2d = this.y * scale + canvas.height / 2;
        const size = this.size * scale;

        if (x2d < 0 || x2d > canvas.width || y2d < 0 || y2d > canvas.height) {
          return;
        }

        const opacity = 1 - this.z / 1000;
        ctx.fillStyle = this.color;
        ctx.globalAlpha = opacity * 0.8;
        
        // Draw particle
        ctx.beginPath();
        ctx.arc(x2d, y2d, size, 0, Math.PI * 2);
        ctx.fill();
        
        // Add glow effect for nearby particles
        if (this.z < 300) {
          ctx.globalAlpha = opacity * 0.3;
          ctx.beginPath();
          ctx.arc(x2d, y2d, size * 2, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }

    // Create particles
    const particles: Particle[] = [];
    for (let i = 0; i < particleCount; i++) {
      particles.push(new Particle());
    }

    // Animation loop
    let mouseX = 0;
    let mouseY = 0;
    let targetMouseX = 0;
    let targetMouseY = 0;

    const handleMouseMove = (e: MouseEvent) => {
      targetMouseX = (e.clientX - window.innerWidth / 2) * 0.05;
      targetMouseY = (e.clientY - window.innerHeight / 2) * 0.05;
    };

    window.addEventListener('mousemove', handleMouseMove);

    const animate = () => {
      // Smooth mouse follow
      mouseX += (targetMouseX - mouseX) * 0.05;
      mouseY += (targetMouseY - mouseY) * 0.05;

      // Clear canvas with fade effect
      ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Translate based on mouse
      ctx.save();
      ctx.translate(mouseX, mouseY);

      // Update and draw particles
      particles.forEach(particle => {
        particle.update();
        particle.draw(ctx);
      });

      ctx.restore();

      // Connection lines between nearby particles (optimized)
      // Limit to max 3 connections per particle to reduce O(n²) complexity
      ctx.globalAlpha = 0.1;
      const maxConnections = 3;
      const connectionDistance = 100; // Reduced from 150
      const connectionDistanceSq = connectionDistance * connectionDistance;

      particles.forEach((p1, i) => {
        let connectionCount = 0;
        
        // Check only nearby particles, early break after max connections
        for (let j = i + 1; j < particles.length && connectionCount < maxConnections; j++) {
          const p2 = particles[j];
          const dx = p1.x - p2.x;
          const dy = p1.y - p2.y;
          const dz = p1.z - p2.z;
          
          // Use squared distance to avoid expensive sqrt
          const distanceSq = dx * dx + dy * dy + dz * dz;

          if (distanceSq < connectionDistanceSq) {
            const scale1 = 1000 / (1000 + p1.z);
            const scale2 = 1000 / (1000 + p2.z);
            const x1 = p1.x * scale1 + canvas.width / 2 + mouseX;
            const y1 = p1.y * scale1 + canvas.height / 2 + mouseY;
            const x2 = p2.x * scale2 + canvas.width / 2 + mouseX;
            const y2 = p2.y * scale2 + canvas.height / 2 + mouseY;

            ctx.strokeStyle = '#10B981';
            ctx.lineWidth = 0.5;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            
            connectionCount++;
          }
        }
      });

      animationIdRef.current = requestAnimationFrame(animate);
    };

    animate();

    // Resize handler
    window.addEventListener('resize', setCanvasSize);

    return () => {
      window.removeEventListener('resize', setCanvasSize);
      window.removeEventListener('mousemove', handleMouseMove);
      if (animationIdRef.current) {
        cancelAnimationFrame(animationIdRef.current);
      }
    };
  }, [particleCount, speed]);

  return (
    <canvas
      ref={canvasRef}
      className={`fixed inset-0 -z-10 ${className}`}
      style={{ background: '#000000' }}
    />
  );
}
```

### components/PremiumBusinessIcons.tsx
```tsx
import { motion } from '@/utils/LazyMotionProvider';

// Профессиональные анимированные SVG иконки для каждого бизнеса

// 1. Магазин одежды
export const ClothingStoreIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ 
        y: [0, -3, 0],
        rotate: [0, 2, 0, -2, 0]
      }}
      transition={{ duration: 3, repeat: Infinity, ease: "easeInOut" }}
    >
      {/* Вешалка */}
      <motion.path
        d="M30 25 L50 15 L70 25"
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
        fill="none"
        initial={{ pathLength: 0 }}
        animate={{ pathLength: 1 }}
        transition={{ duration: 1.5, repeat: Infinity, repeatDelay: 2 }}
      />
      {/* Платье */}
      <motion.path
        d="M35 30 L35 75 L45 80 L55 80 L65 75 L65 30 Z"
        fill="url(#clothingGrad)"
        stroke="white"
        strokeWidth="2"
        animate={{ opacity: [0.8, 1, 0.8] }}
        transition={{ duration: 2, repeat: Infinity }}
      />
      {/* Пояс */}
      <rect x="33" y="50" width="34" height="3" fill="white" opacity="0.6" rx="1.5"/>
    </motion.g>
    <defs>
      <linearGradient id="clothingGrad" x1="35" y1="30" x2="65" y2="80">
        <stop offset="0%" stopColor="#E0F7FA" />
        <stop offset="100%" stopColor="#80DEEA" />
      </linearGradient>
    </defs>
  </svg>
);

// 2. Электроника
export const ElectronicsIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ scale: [1, 1.05, 1] }}
      transition={{ duration: 2, repeat: Infinity }}
    >
      {/* Смартфон */}
      <rect x="30" y="20" width="40" height="60" rx="4" fill="url(#phoneGrad)" stroke="white" strokeWidth="2.5"/>
      {/* Экран */}
      <motion.rect 
        x="34" y="28" width="32" height="44" rx="2" 
        fill="white" 
        opacity="0.9"
        animate={{ opacity: [0.7, 0.9, 0.7] }}
        transition={{ duration: 1.5, repeat: Infinity }}
      />
      {/* Кнопка */}
      <circle cx="50" cy="75" r="2.5" fill="white" opacity="0.8"/>
      {/* Волны сигнала */}
      {[0, 1, 2].map((i) => (
        <motion.path
          key={i}
          d={`M ${75 + i * 5} ${35 - i * 5} Q ${80 + i * 5} ${40 - i * 5} ${75 + i * 5} ${45 - i * 5}`}
          stroke="white"
          strokeWidth="2"
          fill="none"
          opacity="0.6"
          animate={{ opacity: [0, 0.8, 0] }}
          transition={{ duration: 2, repeat: Infinity, delay: i * 0.3 }}
        />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="phoneGrad" x1="30" y1="20" x2="70" y2="80">
        <stop offset="0%" stopColor="#1E3A8A" />
        <stop offset="100%" stopColor="#3B82F6" />
      </linearGradient>
    </defs>
  </svg>
);

// 3. Салон красоты
export const BeautyIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    {/* Помада */}
    <motion.g
      animate={{ rotate: [0, 5, 0, -5, 0] }}
      transition={{ duration: 3, repeat: Infinity }}
      style={{ originX: '50%', originY: '50%' }}
    >
      <rect x="42" y="60" width="16" height="25" rx="2" fill="url(#lipstickGrad)" stroke="white" strokeWidth="2"/>
      <motion.path
        d="M42 60 L46 45 L54 45 L58 60"
        fill="#E91E63"
        stroke="white"
        strokeWidth="2"
        animate={{ y: [0, -2, 0] }}
        transition={{ duration: 1.5, repeat: Infinity }}
      />
    </motion.g>
    {/* Сияние */}
    {[0, 1, 2, 3].map((i) => (
      <motion.circle
        key={i}
        cx={35 + i * 10}
        cy={25 + (i % 2) * 8}
        r="2"
        fill="white"
        opacity="0.8"
        animate={{ 
          scale: [0, 1.5, 0],
          opacity: [0, 0.8, 0]
        }}
        transition={{ duration: 2, repeat: Infinity, delay: i * 0.2 }}
      />
    ))}
    <defs>
      <linearGradient id="lipstickGrad" x1="42" y1="60" x2="58" y2="85">
        <stop offset="0%" stopColor="#F06292" />
        <stop offset="100%" stopColor="#EC407A" />
      </linearGradient>
    </defs>
  </svg>
);

// 4. Ресторан
export const RestaurantIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ rotate: [0, 3, 0, -3, 0] }}
      transition={{ duration: 4, repeat: Infinity }}
      style={{ originX: '50%', originY: '60%' }}
    >
      {/* Крышка */}
      <motion.ellipse
        cx="50" cy="35" rx="25" ry="8"
        fill="url(#clocheGrad)"
        stroke="white"
        strokeWidth="2.5"
        animate={{ y: [0, -5, 0] }}
        transition={{ duration: 2, repeat: Infinity }}
      />
      {/* Купол */}
      <path
        d="M25 35 Q25 20 50 20 Q75 20 75 35"
        fill="url(#clocheGrad)"
        stroke="white"
        strokeWidth="2.5"
        opacity="0.9"
      />
      {/* Ручка */}
      <circle cx="50" cy="18" r="3" fill="white" opacity="0.9"/>
      {/* Блюдо */}
      <ellipse cx="50" cy="70" rx="30" ry="5" fill="white" opacity="0.3" stroke="white" strokeWidth="2"/>
    </motion.g>
    {/* Пар */}
    {[0, 1, 2].map((i) => (
      <motion.path
        key={i}
        d={`M ${45 + i * 5} 30 Q ${47 + i * 5} 20 ${45 + i * 5} 10`}
        stroke="white"
        strokeWidth="2"
        fill="none"
        opacity="0.5"
        animate={{ 
          y: [-5, -15],
          opacity: [0.5, 0]
        }}
        transition={{ duration: 2, repeat: Infinity, delay: i * 0.4 }}
      />
    ))}
    <defs>
      <linearGradient id="clocheGrad" x1="25" y1="20" x2="75" y2="35">
        <stop offset="0%" stopColor="#FFEB3B" />
        <stop offset="100%" stopColor="#FFC107" />
      </linearGradient>
    </defs>
  </svg>
);

// 5. Кофейня
export const CoffeeIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ y: [0, -2, 0] }}
      transition={{ duration: 2, repeat: Infinity }}
    >
      {/* Чашка */}
      <path
        d="M30 40 L35 70 Q35 75 40 75 L60 75 Q65 75 65 70 L70 40 Z"
        fill="url(#coffeeGrad)"
        stroke="white"
        strokeWidth="2.5"
      />
      {/* Ручка */}
      <path
        d="M70 45 Q80 45 80 55 Q80 65 70 65"
        stroke="white"
        strokeWidth="2.5"
        fill="none"
      />
      {/* Кофе */}
      <motion.ellipse
        cx="50" cy="42" rx="18" ry="4"
        fill="#6D4C41"
        opacity="0.8"
        animate={{ opacity: [0.6, 0.9, 0.6] }}
        transition={{ duration: 1.5, repeat: Infinity }}
      />
    </motion.g>
    {/* Пар */}
    {[0, 1, 2].map((i) => (
      <motion.path
        key={i}
        d={`M ${42 + i * 8} 35 Q ${44 + i * 8} 25 ${42 + i * 8} 15`}
        stroke="white"
        strokeWidth="2.5"
        strokeLinecap="round"
        fill="none"
        opacity="0.7"
        animate={{ 
          y: [-3, -10],
          opacity: [0.7, 0]
        }}
        transition={{ duration: 2, repeat: Infinity, delay: i * 0.3 }}
      />
    ))}
    <defs>
      <linearGradient id="coffeeGrad" x1="30" y1="40" x2="70" y2="75">
        <stop offset="0%" stopColor="#D7CCC8" />
        <stop offset="100%" stopColor="#A1887F" />
      </linearGradient>
    </defs>
  </svg>
);

// 6. Премиум часы
export const WatchIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ rotate: 360 }}
      transition={{ duration: 60, repeat: Infinity, ease: "linear" }}
      style={{ originX: '50%', originY: '50%' }}
    >
      {/* Циферблат */}
      <circle cx="50" cy="50" r="25" fill="url(#watchGrad)" stroke="white" strokeWidth="3"/>
      {/* Метки */}
      {[0, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330].map((angle, i) => (
        <line
          key={i}
          x1="50"
          y1="28"
          x2="50"
          y2="32"
          stroke="white"
          strokeWidth={i % 3 === 0 ? "2.5" : "1.5"}
          transform={`rotate(${angle} 50 50)`}
          opacity="0.9"
        />
      ))}
    </motion.g>
    {/* Стрелка часовая */}
    <motion.line
      x1="50" y1="50" x2="50" y2="38"
      stroke="white"
      strokeWidth="2.5"
      strokeLinecap="round"
      animate={{ rotate: [0, 360] }}
      transition={{ duration: 43200, repeat: Infinity, ease: "linear" }}
      style={{ originX: '50%', originY: '50%' }}
    />
    {/* Стрелка минутная */}
    <motion.line
      x1="50" y1="50" x2="50" y2="32"
      stroke="white"
      strokeWidth="2"
      strokeLinecap="round"
      animate={{ rotate: [0, 360] }}
      transition={{ duration: 3600, repeat: Infinity, ease: "linear" }}
      style={{ originX: '50%', originY: '50%' }}
    />
    {/* Центр */}
    <circle cx="50" cy="50" r="3" fill="white"/>
    <defs>
      <radialGradient id="watchGrad">
        <stop offset="0%" stopColor="#424242" />
        <stop offset="100%" stopColor="#212121" />
      </radialGradient>
    </defs>
  </svg>
);

// 7. Дизайн интерьера (AR)
export const InteriorDesignIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ scale: [1, 1.1, 1] }}
      transition={{ duration: 3, repeat: Infinity }}
    >
      {/* 3D Куб */}
      <path d="M50 25 L70 35 L70 55 L50 65 L30 55 L30 35 Z" fill="url(#cubeGrad1)" stroke="white" strokeWidth="2"/>
      <path d="M50 25 L50 45 L70 55 L70 35 Z" fill="url(#cubeGrad2)" stroke="white" strokeWidth="2"/>
      <path d="M50 25 L30 35 L30 55 L50 45 Z" fill="url(#cubeGrad3)" stroke="white" strokeWidth="2"/>
      {/* AR маркеры */}
      {[[25, 25], [75, 25], [25, 75], [75, 75]].map(([x, y], i) => (
        <motion.g key={i}>
          <rect x={x - 3} y={y - 3} width="6" height="6" fill="none" stroke="white" strokeWidth="1.5"/>
          <motion.circle
            cx={x} cy={y} r="1.5"
            fill="#00E5FF"
            animate={{ scale: [1, 1.5, 1], opacity: [0.5, 1, 0.5] }}
            transition={{ duration: 2, repeat: Infinity, delay: i * 0.2 }}
          />
        </motion.g>
      ))}
    </motion.g>
    <defs>
      <linearGradient id="cubeGrad1" x1="30" y1="35" x2="70" y2="55">
        <stop offset="0%" stopColor="#FFE082" />
        <stop offset="100%" stopColor="#FFB300" />
      </linearGradient>
      <linearGradient id="cubeGrad2" x1="50" y1="25" x2="70" y2="55">
        <stop offset="0%" stopColor="#FFCA28" />
        <stop offset="100%" stopColor="#FF8F00" />
      </linearGradient>
      <linearGradient id="cubeGrad3" x1="30" y1="35" x2="50" y2="55">
        <stop offset="0%" stopColor="#FFF59D" />
        <stop offset="100%" stopColor="#FFCA28" />
      </linearGradient>
    </defs>
  </svg>
);

// 8. Магазин кроссовок
export const SneakerIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ 
        x: [0, 3, 0],
        rotate: [0, -2, 0]
      }}
      transition={{ duration: 2, repeat: Infinity }}
    >
      {/* Кроссовок */}
      <path
        d="M20 55 L25 45 L35 40 L50 38 L65 40 L75 45 L80 55 L75 65 L25 65 Z"
        fill="url(#sneakerGrad)"
        stroke="white"
        strokeWidth="2.5"
      />
      {/* Подошва */}
      <path d="M25 65 L75 65 L78 70 L22 70 Z" fill="white" opacity="0.9" stroke="white" strokeWidth="2"/>
      {/* Логотип */}
      <motion.path
        d="M40 50 L45 48 L50 50 L55 48 L60 50"
        stroke="white"
        strokeWidth="2"
        fill="none"
        animate={{ pathLength: [0, 1, 0] }}
        transition={{ duration: 2, repeat: Infinity }}
      />
      {/* Шнурки */}
      {[0, 1, 2].map((i) => (
        <line
          key={i}
          x1={35 + i * 10} y1="45"
          x2={40 + i * 10} y2="42"
          stroke="white"
          strokeWidth="1.5"
          opacity="0.8"
        />
      ))}
    </motion.g>
    {/* Скорость */}
    {[0, 1, 2].map((i) => (
      <motion.line
        key={i}
        x1={15 - i * 5} y1={50 + i * 3}
        x2={20 - i * 5} y2={50 + i * 3}
        stroke="white"
        strokeWidth="2"
        opacity="0.6"
        animate={{ x: [0, -10], opacity: [0.6, 0] }}
        transition={{ duration: 1, repeat: Infinity, delay: i * 0.2 }}
      />
    ))}
    <defs>
      <linearGradient id="sneakerGrad" x1="20" y1="38" x2="80" y2="65">
        <stop offset="0%" stopColor="#EF5350" />
        <stop offset="100%" stopColor="#E53935" />
      </linearGradient>
    </defs>
  </svg>
);

// 9. Ювелирный бутик
export const JewelryIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ rotate: [0, 5, -5, 0] }}
      transition={{ duration: 4, repeat: Infinity }}
      style={{ originX: '50%', originY: '50%' }}
    >
      {/* Бриллиант */}
      <path d="M50 20 L70 40 L50 75 L30 40 Z" fill="url(#diamondGrad)" stroke="white" strokeWidth="2.5"/>
      <path d="M30 40 L50 40 L70 40" stroke="white" strokeWidth="2" opacity="0.7"/>
      <path d="M50 20 L50 75" stroke="white" strokeWidth="2" opacity="0.7"/>
      <path d="M40 30 L60 30" stroke="white" strokeWidth="1.5" opacity="0.5"/>
    </motion.g>
    {/* Блики */}
    {[0, 1, 2, 3, 4].map((i) => (
      <motion.circle
        key={i}
        cx={40 + i * 5}
        cy={25 + (i % 2) * 10}
        r="2"
        fill="white"
        opacity="0.9"
        animate={{ 
          scale: [0, 1.5, 0],
          opacity: [0, 1, 0]
        }}
        transition={{ duration: 3, repeat: Infinity, delay: i * 0.3 }}
      />
    ))}
    <defs>
      <linearGradient id="diamondGrad" x1="30" y1="20" x2="70" y2="75">
        <stop offset="0%" stopColor="#E1F5FE" />
        <stop offset="50%" stopColor="#81D4FA" />
        <stop offset="100%" stopColor="#29B6F6" />
      </linearGradient>
    </defs>
  </svg>
);

// 10. Виниловый магазин
export const VinylIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g
      animate={{ rotate: 360 }}
      transition={{ duration: 4, repeat: Infinity, ease: "linear" }}
      style={{ originX: '50%', originY: '50%' }}
    >
      {/* Пластинка */}
      <circle cx="50" cy="50" r="28" fill="url(#vinylGrad)" stroke="white" strokeWidth="2.5"/>
      {/* Канавки */}
      {[22, 18, 14, 10].map((r, i) => (
        <circle
          key={i}
          cx="50"
          cy="50"
          r={r}
          fill="none"
          stroke="white"
          strokeWidth="0.5"
          opacity="0.4"
        />
      ))}
      {/* Центр */}
      <circle cx="50" cy="50" r="8" fill="#424242" stroke="white" strokeWidth="2"/>
      <circle cx="50" cy="50" r="3" fill="white"/>
    </motion.g>
    {/* Нота */}
    <motion.g
      animate={{ y: [0, -5, 0], opacity: [0.7, 1, 0.7] }}
      transition={{ duration: 2, repeat: Infinity }}
    >
      <circle cx="75" cy="30" r="4" fill="white"/>
      <rect x="78" y="20" width="2" height="14" fill="white"/>
    </motion.g>
    <defs>
      <radialGradient id="vinylGrad">
        <stop offset="0%" stopColor="#212121" />
        <stop offset="100%" stopColor="#000000" />
      </radialGradient>
    </defs>
  </svg>
);

// 11. Крафтовый маркет
export const ArtisanIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotate: [0, 5, -5, 0] }} transition={{ duration: 4, repeat: Infinity }}>
      {/* Молоток */}
      <rect x="35" y="50" width="8" height="30" rx="2" fill="#8D6E63" stroke="white" strokeWidth="2"/>
      <rect x="28" y="42" width="22" height="12" rx="2" fill="#6D4C41" stroke="white" strokeWidth="2"/>
      {/* Искры */}
      {[0, 1, 2].map((i) => (
        <motion.circle key={i} cx={50 + i * 10} cy={35 - i * 5} r="2" fill="#FFD54F"
          animate={{ scale: [0, 1.5, 0], opacity: [0, 1, 0] }}
          transition={{ duration: 1.5, repeat: Infinity, delay: i * 0.3 }} />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="hammerGrad" x1="28" y1="42" x2="50" y2="80">
        <stop offset="0%" stopColor="#A1887F" /><stop offset="100%" stopColor="#795548" />
      </linearGradient>
    </defs>
  </svg>
);

// 12. Чайный клуб
export const TeaIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ y: [0, -2, 0] }} transition={{ duration: 3, repeat: Infinity }}>
      {/* Чайник */}
      <ellipse cx="50" cy="65" rx="20" ry="8" fill="#4CAF50" opacity="0.3"/>
      <path d="M35 50 L35 65 Q35 70 40 70 L60 70 Q65 70 65 65 L65 50 Q65 45 60 45 L40 45 Q35 45 35 50 Z" fill="url(#teapotGrad)" stroke="white" strokeWidth="2.5"/>
      {/* Носик */}
      <path d="M65 55 L75 50" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
      {/* Крышка */}
      <ellipse cx="50" cy="45" rx="12" ry="4" fill="#388E3C" stroke="white" strokeWidth="2"/>
      <circle cx="50" cy="42" r="2" fill="white"/>
      {/* Пар */}
      {[0, 1].map((i) => (
        <motion.path key={i} d={`M ${45 + i * 10} 40 Q ${47 + i * 10} 30 ${45 + i * 10} 20`} stroke="white" strokeWidth="2" fill="none" opacity="0.6"
          animate={{ y: [-3, -10], opacity: [0.6, 0] }} transition={{ duration: 2, repeat: Infinity, delay: i * 0.4 }} />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="teapotGrad" x1="35" y1="45" x2="65" y2="70">
        <stop offset="0%" stopColor="#66BB6A" /><stop offset="100%" stopColor="#43A047" />
      </linearGradient>
    </defs>
  </svg>
);

// 13. Магазин гаджетов
export const GadgetIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotateY: [0, 180, 360] }} transition={{ duration: 4, repeat: Infinity }} style={{ transformOrigin: 'center' }}>
      {/* Умные часы */}
      <rect x="35" y="35" width="30" height="35" rx="8" fill="url(#gadgetGrad)" stroke="white" strokeWidth="2.5"/>
      <motion.rect x="39" y="40" width="22" height="15" rx="2" fill="white" opacity="0.8" animate={{ opacity: [0.6, 1, 0.6] }} transition={{ duration: 2, repeat: Infinity }}/>
      {/* Пульс */}
      <motion.path d="M42 48 L45 45 L48 51 L51 45 L54 48" stroke="#4CAF50" strokeWidth="2" fill="none" strokeLinecap="round"
        animate={{ pathLength: [0, 1], opacity: [0, 1, 0] }} transition={{ duration: 2, repeat: Infinity }} />
    </motion.g>
    <defs>
      <linearGradient id="gadgetGrad" x1="35" y1="35" x2="65" y2="70">
        <stop offset="0%" stopColor="#424242" /><stop offset="100%" stopColor="#212121" />
      </linearGradient>
    </defs>
  </svg>
);

// 14. Фитнес клуб
export const FitnessIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotate: [0, 45, 0] }} transition={{ duration: 2, repeat: Infinity }} style={{ originX: '50%', originY: '50%' }}>
      {/* Гантель */}
      <circle cx="30" cy="50" r="8" fill="url(#dumbbellGrad)" stroke="white" strokeWidth="2.5"/>
      <rect x="36" y="47" width="28" height="6" rx="3" fill="#424242" stroke="white" strokeWidth="2"/>
      <circle cx="70" cy="50" r="8" fill="url(#dumbbellGrad)" stroke="white" strokeWidth="2.5"/>
      {/* Блики */}
      <circle cx="32" cy="48" r="2" fill="white" opacity="0.7"/>
      <circle cx="72" cy="48" r="2" fill="white" opacity="0.7"/>
    </motion.g>
    <defs>
      <radialGradient id="dumbbellGrad">
        <stop offset="0%" stopColor="#78909C" /><stop offset="100%" stopColor="#455A64" />
      </radialGradient>
    </defs>
  </svg>
);

// 15. Студия йоги
export const YogaIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ scale: [1, 1.05, 1] }} transition={{ duration: 3, repeat: Infinity }}>
      {/* Человек в позе лотоса */}
      <circle cx="50" cy="30" r="8" fill="url(#yogaGrad)" stroke="white" strokeWidth="2"/>
      <path d="M50 38 L50 55" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
      <path d="M50 45 L35 50 L30 60" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
      <path d="M50 45 L65 50 L70 60" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
      <path d="M50 55 L40 65 L30 70" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
      <path d="M50 55 L60 65 L70 70" stroke="white" strokeWidth="2.5" strokeLinecap="round"/>
      {/* Аура */}
      {[0, 1, 2].map((i) => (
        <motion.circle key={i} cx="50" cy="30" r={15 + i * 8} stroke="#9C27B0" strokeWidth="1.5" fill="none" opacity="0.4"
          animate={{ scale: [1, 1.3], opacity: [0.4, 0] }} transition={{ duration: 3, repeat: Infinity, delay: i * 0.5 }} />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="yogaGrad">
        <stop offset="0%" stopColor="#CE93D8" /><stop offset="100%" stopColor="#AB47BC" />
      </linearGradient>
    </defs>
  </svg>
);

// 16. Автосервис
export const CarServiceIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ y: [0, -3, 0] }} transition={{ duration: 2, repeat: Infinity }}>
      {/* Гаечный ключ */}
      <path d="M60 30 L70 20 L75 25 L65 35 L60 40 L50 50 L35 65 L30 60 L45 45 Z" fill="url(#wrenchGrad)" stroke="white" strokeWidth="2.5"/>
      <circle cx="72" cy="23" r="3" fill="white" opacity="0.8"/>
      {/* Искры */}
      {[0, 1, 2].map((i) => (
        <motion.line key={i} x1={35 - i * 3} y1={65 + i * 3} x2={30 - i * 3} y2={70 + i * 3} stroke="#FF9800" strokeWidth="2" strokeLinecap="round"
          animate={{ opacity: [0, 1, 0] }} transition={{ duration: 1.5, repeat: Infinity, delay: i * 0.2 }} />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="wrenchGrad" x1="30" y1="20" x2="75" y2="65">
        <stop offset="0%" stopColor="#90A4AE" /><stop offset="100%" stopColor="#607D8B" />
      </linearGradient>
    </defs>
  </svg>
);

// 17. Агентство недвижимости (VR)
export const RealEstateIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ scale: [1, 1.08, 1] }} transition={{ duration: 3, repeat: Infinity }}>
      {/* Дом */}
      <path d="M50 25 L75 45 L75 70 L25 70 L25 45 Z" fill="url(#houseGrad)" stroke="white" strokeWidth="2.5"/>
      <rect x="42" y="52" width="16" height="18" fill="#3E2723" stroke="white" strokeWidth="2"/>
      <rect x="30" y="48" width="10" height="10" fill="#81C784" stroke="white" strokeWidth="1.5"/>
      <rect x="60" y="48" width="10" height="10" fill="#81C784" stroke="white" strokeWidth="1.5"/>
      {/* VR маркеры */}
      {[[20, 35], [80, 35], [50, 75]].map(([x, y], i) => (
        <motion.circle key={i} cx={x} cy={y} r="3" fill="#00BCD4" stroke="white" strokeWidth="1.5"
          animate={{ scale: [1, 1.5, 1], opacity: [0.5, 1, 0.5] }} transition={{ duration: 2, repeat: Infinity, delay: i * 0.3 }} />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="houseGrad" x1="25" y1="25" x2="75" y2="70">
        <stop offset="0%" stopColor="#FFCCBC" /><stop offset="100%" stopColor="#FF8A65" />
      </linearGradient>
    </defs>
  </svg>
);

// 18-28 (оставшиеся иконки)
export const TravelIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ x: [0, 10, 0], y: [0, -5, 0] }} transition={{ duration: 3, repeat: Infinity }}>
      <path d="M30 50 L50 30 L70 50 L60 50 L60 70 L40 70 L40 50 Z" fill="url(#planeGrad)" stroke="white" strokeWidth="2.5"/>
      <circle cx="50" cy="40" r="5" fill="white" opacity="0.8"/>
    </motion.g>
    <defs><linearGradient id="planeGrad"><stop offset="0%" stopColor="#42A5F5"/><stop offset="100%" stopColor="#1E88E5"/></linearGradient></defs>
  </svg>
);

export const EducationIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotateY: [0, 180, 360] }} transition={{ duration: 5, repeat: Infinity }}>
      <path d="M30 40 L50 30 L70 40 L70 60 L50 70 L30 60 Z" fill="url(#bookGrad)" stroke="white" strokeWidth="2.5"/>
      <line x1="50" y1="30" x2="50" y2="70" stroke="white" strokeWidth="2"/>
    </motion.g>
    <defs><linearGradient id="bookGrad"><stop offset="0%" stopColor="#7E57C2"/><stop offset="100%" stopColor="#5E35B1"/></linearGradient></defs>
  </svg>
);

export const PetShopIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotate: [0, 10, -10, 0] }} transition={{ duration: 2, repeat: Infinity }} style={{ originX: '50%', originY: '65%' }}>
      <ellipse cx="50" cy="55" rx="18" ry="22" fill="url(#pawGrad)" stroke="white" strokeWidth="2.5"/>
      {[[38, 40], [50, 35], [62, 40]].map(([x, y], i) => (
        <ellipse key={i} cx={x} cy={y} rx="6" ry="8" fill="url(#pawGrad)" stroke="white" strokeWidth="2"/>
      ))}
    </motion.g>
    <defs><linearGradient id="pawGrad"><stop offset="0%" stopColor="#FF7043"/><stop offset="100%" stopColor="#F4511E"/></linearGradient></defs>
  </svg>
);

export const BookstoreIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ y: [0, -2, 0] }} transition={{ duration: 2, repeat: Infinity }}>
      {[0, 1, 2].map((i) => (
        <rect key={i} x={32 + i * 12} y={35 - i * 3} width="10" height="40" rx="1" fill={`url(#book${i}Grad)`} stroke="white" strokeWidth="2"/>
      ))}
    </motion.g>
    <defs>
      <linearGradient id="book0Grad"><stop offset="0%" stopColor="#EF5350"/><stop offset="100%" stopColor="#E53935"/></linearGradient>
      <linearGradient id="book1Grad"><stop offset="0%" stopColor="#66BB6A"/><stop offset="100%" stopColor="#43A047"/></linearGradient>
      <linearGradient id="book2Grad"><stop offset="0%" stopColor="#42A5F5"/><stop offset="100%" stopColor="#1E88E5"/></linearGradient>
    </defs>
  </svg>
);

export const FlowerIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotate: [0, 5, -5, 0], scale: [1, 1.05, 1] }} transition={{ duration: 3, repeat: Infinity }}>
      {[0, 60, 120, 180, 240, 300].map((angle) => (
        <ellipse key={angle} cx="50" cy="35" rx="8" ry="14" fill="url(#petalGrad)" stroke="white" strokeWidth="1.5" transform={`rotate(${angle} 50 50)`}/>
      ))}
      <circle cx="50" cy="50" r="8" fill="#FDD835" stroke="white" strokeWidth="2"/>
      <rect x="48" y="50" width="4" height="30" rx="2" fill="#4CAF50" stroke="white" strokeWidth="1.5"/>
    </motion.g>
    <defs><linearGradient id="petalGrad"><stop offset="0%" stopColor="#F48FB1"/><stop offset="100%" stopColor="#EC407A"/></linearGradient></defs>
  </svg>
);

export const PerfumeIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ y: [0, -2, 0] }} transition={{ duration: 2, repeat: Infinity }}>
      <rect x="40" y="30" width="20" height="8" rx="2" fill="url(#capGrad)" stroke="white" strokeWidth="2"/>
      <rect x="38" y="38" width="24" height="35" rx="3" fill="url(#bottleGrad)" stroke="white" strokeWidth="2.5"/>
      <rect x="42" y="45" width="16" height="3" fill="white" opacity="0.6"/>
      {/* Спрей */}
      {[0, 1, 2].map((i) => (
        <motion.circle key={i} cx={35 - i * 3} cy={25 - i * 5} r="1.5" fill="#D1C4E9" opacity="0.7"
          animate={{ y: [-5, -15], opacity: [0.7, 0] }} transition={{ duration: 1.5, repeat: Infinity, delay: i * 0.2 }} />
      ))}
    </motion.g>
    <defs>
      <linearGradient id="bottleGrad"><stop offset="0%" stopColor="#CE93D8"/><stop offset="100%" stopColor="#AB47BC"/></linearGradient>
      <linearGradient id="capGrad"><stop offset="0%" stopColor="#FFD54F"/><stop offset="100%" stopColor="#FFC107"/></linearGradient>
    </defs>
  </svg>
);

export const GamingIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotate: [0, 3, -3, 0] }} transition={{ duration: 2, repeat: Infinity }}>
      <path d="M30 45 Q30 35 40 35 L60 35 Q70 35 70 45 L70 60 Q70 70 60 70 L40 70 Q30 70 30 60 Z" fill="url(#controllerGrad)" stroke="white" strokeWidth="2.5"/>
      <circle cx="42" cy="52" r="5" stroke="white" strokeWidth="2" fill="none"/>
      <circle cx="58" cy="50" r="3" fill="#4CAF50" stroke="white" strokeWidth="1.5"/>
      <circle cx="63" cy="55" r="3" fill="#F44336" stroke="white" strokeWidth="1.5"/>
    </motion.g>
    <defs><linearGradient id="controllerGrad"><stop offset="0%" stopColor="#424242"/><stop offset="100%" stopColor="#212121"/></linearGradient></defs>
  </svg>
);

export const MedicalIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ scale: [1, 1.1, 1] }} transition={{ duration: 2, repeat: Infinity }}>
      <rect x="35" y="45" width="30" height="10" rx="2" fill="url(#crossGrad)" stroke="white" strokeWidth="2.5"/>
      <rect x="45" y="35" width="10" height="30" rx="2" fill="url(#crossGrad)" stroke="white" strokeWidth="2.5"/>
      {/* Пульс */}
      <motion.circle cx="50" cy="50" r="20" stroke="#4CAF50" strokeWidth="2" fill="none" opacity="0.5"
        animate={{ scale: [1, 1.3], opacity: [0.5, 0] }} transition={{ duration: 2, repeat: Infinity }} />
    </motion.g>
    <defs><linearGradient id="crossGrad"><stop offset="0%" stopColor="#EF5350"/><stop offset="100%" stopColor="#E53935"/></linearGradient></defs>
  </svg>
);

export const CarRentalIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ x: [0, 5, 0] }} transition={{ duration: 2, repeat: Infinity }}>
      <path d="M25 55 L30 45 L40 45 L45 40 L55 40 L60 45 L70 45 L75 55 L75 65 L25 65 Z" fill="url(#carGrad)" stroke="white" strokeWidth="2.5"/>
      <circle cx="35" cy="65" r="5" fill="#424242" stroke="white" strokeWidth="2"/>
      <circle cx="65" cy="65" r="5" fill="#424242" stroke="white" strokeWidth="2"/>
      <rect x="42" y="47" width="7" height="6" fill="white" opacity="0.7"/>
      <rect x="51" y="47" width="7" height="6" fill="white" opacity="0.7"/>
    </motion.g>
    <defs><linearGradient id="carGrad"><stop offset="0%" stopColor="#42A5F5"/><stop offset="100%" stopColor="#1E88E5"/></linearGradient></defs>
  </svg>
);

export const LegalIcon = () => (
  <svg width="80" height="80" viewBox="0 0 100 100" fill="none">
    <motion.g animate={{ rotateY: [0, 15, 0] }} transition={{ duration: 3, repeat: Infinity }}>
      <path d="M30 30 L70 30 L70 75 L30 75 Z" fill="url(#docGrad)" stroke="white" strokeWidth="2.5"/>
      {[42, 50, 58, 66].map((y, i) => (
        <line key={i} x1="35" y1={y} x2="65" y2={y} stroke="white" strokeWidth="2" opacity="0.7"/>
      ))}
      <circle cx="58" cy="72" r="8" fill="#FDD835" stroke="white" strokeWidth="2"/>
    </motion.g>
    <defs><linearGradient id="docGrad"><stop offset="0%" stopColor="#FFEB3B"/><stop offset="100%" stopColor="#FBC02D"/></linearGradient></defs>
  </svg>
);

export const getBusinessIcon = (appId: string) => {
  const icons: Record<string, JSX.Element> = {
    'clothing-store': <ClothingStoreIcon />,
    'electronics': <ElectronicsIcon />,
    'beauty': <BeautyIcon />,
    'restaurant': <RestaurantIcon />,
    'coffee': <CoffeeIcon />,
    'luxury-watches': <WatchIcon />,
    'home-decor': <InteriorDesignIcon />,
    'sneaker-store': <SneakerIcon />,
    'premium-tea': <TeaIcon />,
    'tech-gadgets': <GadgetIcon />,
    'fitness-club': <FitnessIcon />,
    'yoga-studio': <YogaIcon />,
    'car-service': <CarServiceIcon />,
    'online-education': <EducationIcon />,
    'pet-shop': <PetShopIcon />,
    'bookstore': <BookstoreIcon />,
    'flower-delivery': <FlowerIcon />,
    'luxury-perfume': <PerfumeIcon />,
    'gaming-gear': <GamingIcon />,
    'medical': <MedicalIcon />,
    'car-rental': <CarRentalIcon />,
  };
  
  return icons[appId] || <ClothingStoreIcon />;
};
```

### components/PremiumTasksEarningPage.tsx
```tsx
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { useState, useEffect, useMemo, memo, useCallback, useRef } from 'react';
import { 
  Coins, CheckCircle, Heart, Share2, Eye, Users, MessageCircle, 
  ArrowLeft, Sparkles, Award, Youtube, Send, Gift, Zap, 
  Trophy, Star, Flame, Target, Clock, TrendingUp
} from 'lucide-react';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { useTelegram } from '@/hooks/useTelegram';
import { deepLinker } from '@/lib/deepLinks';
import { useRewards } from '@/contexts/RewardsContext';
import { useAwardXP, useCompleteTask } from '@/hooks/useGamification';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { apiRequest } from '@/lib/queryClient';
import { useToast } from '@/hooks/use-toast';

interface Task {
  id: string;
  platform: 'tiktok' | 'instagram' | 'youtube' | 'telegram' | 'referral' | 'daily' | 'special';
  type: 'like' | 'follow' | 'share' | 'view' | 'comment' | 'subscribe' | 'join' | 'invite' | 'checkin' | 'streak';
  title: string;
  description: string;
  coins: number;
  url?: string;
  username?: string;
  completed: boolean;
  featured?: boolean;
  streak?: number;
  expiresIn?: number;
}

interface UserBalance {
  totalCoins: number;
  availableCoins: number;
  tasksCompleted: number;
  currentStreak: number;
  dailyCheckInStreak: number;
}

const premiumTasks: Task[] = [
  // Featured Daily Tasks
  {
    id: 'daily_checkin',
    platform: 'daily',
    type: 'checkin',
    title: 'Ежедневный вход',
    description: 'Заходите каждый день и получайте бонус',
    coins: 50,
    completed: false,
    featured: true,
    streak: 3
  },
  {
    id: 'daily_bonus',
    platform: 'special',
    type: 'checkin',
    title: 'Бонус недели',
    description: 'Войдите 7 дней подряд',
    coins: 500,
    completed: false,
    featured: true,
    streak: 7
  },
  
  // TikTok Tasks
  {
    id: 'tiktok_follow',
    platform: 'tiktok',
    type: 'follow',
    title: 'Подпишитесь на TikTok',
    description: 'Подписка на @web4tg',
    coins: 150,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'tiktok_like_1',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк видео о МиниАппах',
    description: 'Поставьте лайк популярному видео',
    coins: 50,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'tiktok_like_2',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк видео про AI',
    description: 'Оцените обзор AI технологий',
    coins: 50,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'tiktok_share',
    platform: 'tiktok',
    type: 'share',
    title: 'Репост в TikTok',
    description: 'Поделитесь с друзьями',
    coins: 100,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'tiktok_comment',
    platform: 'tiktok',
    type: 'comment',
    title: 'Комментарий в TikTok',
    description: 'Оставьте комментарий',
    coins: 75,
    username: 'web4tg',
    completed: false
  },
  
  // Instagram Tasks
  {
    id: 'instagram_follow',
    platform: 'instagram',
    type: 'follow',
    title: 'Подпишитесь на Instagram',
    description: 'Подписка на @web4tg',
    coins: 120,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'instagram_like_1',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк поста в Instagram',
    description: 'Лайк нашего последнего поста',
    coins: 40,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'instagram_like_2',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Reels',
    description: 'Поставьте лайк Reels',
    coins: 40,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'instagram_story',
    platform: 'instagram',
    type: 'share',
    title: 'Stories репост',
    description: 'Поделитесь в Stories',
    coins: 80,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'instagram_comment',
    platform: 'instagram',
    type: 'comment',
    title: 'Комментарий в Instagram',
    description: 'Оставьте комментарий',
    coins: 60,
    username: 'web4tg',
    completed: false
  },
  
  // YouTube Tasks
  {
    id: 'youtube_subscribe',
    platform: 'youtube',
    type: 'subscribe',
    title: 'Подпишитесь на YouTube',
    description: 'Подписка на канал WEB4TG',
    coins: 100,
    url: 'UC_WEB4TG_CHANNEL',
    completed: false,
    featured: true
  },
  {
    id: 'youtube_like',
    platform: 'youtube',
    type: 'like',
    title: 'Лайк видео YouTube',
    description: 'Лайкните обучающее видео',
    coins: 40,
    url: 'dQw4w9WgXcQ',
    completed: false
  },
  {
    id: 'youtube_comment',
    platform: 'youtube',
    type: 'comment',
    title: 'Комментарий YouTube',
    description: 'Напишите комментарий',
    coins: 60,
    url: 'dQw4w9WgXcQ',
    completed: false
  },
  {
    id: 'youtube_watch',
    platform: 'youtube',
    type: 'view',
    title: 'Просмотр туториала',
    description: 'Досмотрите до конца',
    coins: 30,
    url: 'dQw4w9WgXcQ',
    completed: false
  },
  
  // Telegram Tasks
  {
    id: 'telegram_channel_1',
    platform: 'telegram',
    type: 'join',
    title: 'Канал новостей WEB4TG',
    description: 'Присоединитесь к каналу',
    coins: 100,
    url: 'web4tg_news',
    completed: false,
    featured: true
  },
  {
    id: 'telegram_channel_2',
    platform: 'telegram',
    type: 'join',
    title: 'Канал обучения',
    description: 'Бесплатные уроки по Telegram',
    coins: 100,
    url: 'web4tg_education',
    completed: false
  },
  {
    id: 'telegram_group',
    platform: 'telegram',
    type: 'join',
    title: 'Чат разработчиков',
    description: 'Присоединитесь к сообществу',
    coins: 80,
    url: 'web4tg_dev_chat',
    completed: false
  },
  
  // Referral Tasks
  {
    id: 'referral_1',
    platform: 'referral',
    type: 'invite',
    title: 'Пригласите друга',
    description: 'Получите 200 монет за каждого',
    coins: 200,
    completed: false,
    featured: true
  },
  {
    id: 'referral_5',
    platform: 'referral',
    type: 'invite',
    title: 'Пригласите 5 друзей',
    description: 'Бонус за активность',
    coins: 1500,
    completed: false
  },
  {
    id: 'referral_10',
    platform: 'referral',
    type: 'invite',
    title: 'Пригласите 10 друзей',
    description: 'Эксклюзивная награда',
    coins: 3500,
    completed: false
  },
  
  // Special Tasks
  {
    id: 'week_streak',
    platform: 'special',
    type: 'streak',
    title: '7 дней подряд',
    description: 'Войдите 7 дней подряд',
    coins: 300,
    completed: false,
    streak: 7
  },
  {
    id: 'month_streak',
    platform: 'special',
    type: 'streak',
    title: '30 дней подряд',
    description: 'Легендарная серия',
    coins: 2000,
    completed: false,
    featured: true,
    streak: 30
  },
  {
    id: 'complete_all_social',
    platform: 'special',
    type: 'checkin',
    title: 'Все соцсети',
    description: 'Завершите все задания соцсетей',
    coins: 500,
    completed: false,
    featured: true
  },
  
  // Additional TikTok Tasks
  {
    id: 'tiktok_watch_1',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр TikTok #1',
    description: 'Посмотрите видео о боте',
    coins: 35,
    username: 'web4tg',
    completed: false
  },
  {
    id: 'tiktok_watch_2',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр TikTok #2',
    description: 'Посмотрите обзор функций',
    coins: 35,
    username: 'web4tg',
    completed: false
  },
  
  // Additional Instagram Tasks
  {
    id: 'instagram_save',
    platform: 'instagram',
    type: 'like',
    title: 'Сохранить пост Instagram',
    description: 'Сохраните в коллекцию',
    coins: 45,
    username: 'web4tg',
    completed: false
  },
  
  // Additional YouTube Tasks
  {
    id: 'youtube_share',
    platform: 'youtube',
    type: 'share',
    title: 'Поделиться YouTube видео',
    description: 'Поделитесь с друзьями',
    coins: 70,
    url: 'dQw4w9WgXcQ',
    completed: false
  },
  {
    id: 'youtube_playlist',
    platform: 'youtube',
    type: 'subscribe',
    title: 'Добавить в плейлист',
    description: 'Сохраните в плейлист',
    coins: 50,
    url: 'dQw4w9WgXcQ',
    completed: false
  },
  {
    id: 'youtube_notification',
    platform: 'youtube',
    type: 'subscribe',
    title: 'Включить уведомления',
    description: 'Нажмите колокольчик',
    coins: 60,
    url: 'UC_WEB4TG_CHANNEL',
    completed: false
  },
  
  // Additional Telegram Tasks
  {
    id: 'telegram_bot_start',
    platform: 'telegram',
    type: 'join',
    title: 'Запустить бота',
    description: 'Запустите официального бота',
    coins: 50,
    url: 'web4tg_bot',
    completed: false
  },
  
  // Additional Referral Tasks
  {
    id: 'referral_3',
    platform: 'referral',
    type: 'invite',
    title: 'Пригласите 3 друзей',
    description: 'Получите бонус',
    coins: 700,
    completed: false
  },
  
  // Additional Special/Daily Tasks
  {
    id: 'three_day_streak',
    platform: 'special',
    type: 'streak',
    title: '3 дня подряд',
    description: 'Войдите 3 дня подряд',
    coins: 100,
    completed: false,
    streak: 3
  },
  {
    id: 'complete_10_tasks',
    platform: 'special',
    type: 'checkin',
    title: 'Завершите 10 заданий',
    description: 'Выполните любые 10 заданий',
    coins: 250,
    completed: false
  }
];

interface TasksEarningPageProps {
  onNavigate: (section: string) => void;
}

// Premium Liquid Glass Task Card
const PremiumTaskCard = memo(({ task, onTaskClick, isVerifying }: { 
  task: Task, 
  onTaskClick: (task: Task) => void,
  isVerifying: boolean 
}) => {
  const getTaskIcon = () => {
    switch (task.platform) {
      case 'youtube': return <Youtube className="w-5 h-5" />;
      case 'telegram': return <Send className="w-5 h-5" />;
      case 'referral': return <Users className="w-5 h-5" />;
      case 'daily': return <Clock className="w-5 h-5" />;
      case 'special': return <Trophy className="w-5 h-5" />;
      default:
        switch (task.type) {
          case 'like': return <Heart className="w-5 h-5" />;
          case 'follow': return <Users className="w-5 h-5" />;
          case 'share': return <Share2 className="w-5 h-5" />;
          case 'view': return <Eye className="w-5 h-5" />;
          case 'comment': return <MessageCircle className="w-5 h-5" />;
          default: return <Sparkles className="w-5 h-5" />;
        }
    }
  };

  const getPlatformGradient = () => {
    switch (task.platform) {
      case 'tiktok': return 'from-pink-500/20 to-purple-500/20 border-pink-500/40';
      case 'instagram': return 'from-purple-500/20 to-pink-500/20 border-purple-500/40';
      case 'youtube': return 'from-red-500/20 to-orange-500/20 border-red-500/40';
      case 'telegram': return 'from-blue-500/20 to-cyan-500/20 border-blue-500/40';
      case 'referral': return 'from-emerald-500/20 to-teal-500/20 border-emerald-500/40';
      case 'daily': return 'from-amber-500/20 to-yellow-500/20 border-amber-500/40';
      case 'special': return 'from-violet-500/20 to-fuchsia-500/20 border-violet-500/40';
      default: return 'from-white/10 to-white/5 border-white/20';
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={{ y: task.completed ? 0 : -2 }}
      whileTap={{ scale: task.completed ? 1 : 0.99 }}
      transition={{ duration: 0.15, ease: 'easeOut' }}
      className={cn(
        'relative rounded-2xl p-5 cursor-pointer',
        'backdrop-blur-[40px] saturate-150 border',
        'will-change-transform',
        'hover:shadow-lg hover:shadow-white/10 transition-shadow duration-150',
        task.completed
          ? 'bg-emerald-500/10 border-emerald-500/30'
          : `bg-gradient-to-br ${getPlatformGradient()}`,
        task.featured && !task.completed && 'ring-2 ring-amber-400/30 shadow-xl shadow-amber-400/10'
      )}
      onClick={() => !task.completed && !isVerifying && onTaskClick(task)}
      data-testid={`task-${task.id}`}
    >
      {/* Premium Glass Overlay */}
      <div className="absolute inset-0 bg-gradient-to-br from-white/[0.08] to-transparent rounded-2xl pointer-events-none" />

      <div className="relative z-10 flex items-center justify-between gap-4">
        <div className="flex items-center gap-4 flex-1 min-w-0">
          <div className={cn(
            'w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0',
            'bg-gradient-to-br backdrop-blur-xl border transition-all duration-300',
            getPlatformGradient(),
            'shadow-lg'
          )}>
            {getTaskIcon()}
          </div>
          
          <div className="flex-1 min-w-0">
            <div className="flex items-center gap-2 mb-1">
              <h3 className="text-white font-semibold text-base truncate">
                {task.title}
              </h3>
              {task.featured && !task.completed && (
                <Star className="w-4 h-4 text-amber-400 flex-shrink-0 animate-pulse" fill="currentColor" />
              )}
            </div>
            <p className="text-white/60 text-sm truncate">{task.description}</p>
            {task.streak && (
              <div className="flex items-center gap-1.5 mt-1">
                <Flame className="w-3.5 h-3.5 text-orange-400" />
                <span className="text-orange-400 text-xs font-medium">{task.streak} дней подряд</span>
              </div>
            )}
          </div>
        </div>
        
        <div className="flex flex-col items-end gap-2 flex-shrink-0">
          <div className="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-amber-400/20 backdrop-blur-xl border border-amber-400/30">
            <Coins className="w-4 h-4 text-amber-400" />
            <span className="text-amber-400 font-bold text-sm">+{task.coins}</span>
          </div>
          
          {task.completed ? (
            <Badge variant="outline" className="text-xs bg-emerald-500/20 text-emerald-400 border-emerald-500/50 backdrop-blur-xl">
              <CheckCircle className="w-3 h-3 mr-1" />
              Готово
            </Badge>
          ) : isVerifying ? (
            <Badge variant="outline" className="text-xs bg-blue-500/20 text-blue-400 border-blue-500/50 backdrop-blur-xl">
              <motion.div
                animate={{ rotate: 360 }}
                transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
              >
                <Sparkles className="w-3 h-3 mr-1" />
              </motion.div>
              Проверка...
            </Badge>
          ) : null}
        </div>
      </div>
    </motion.div>
  );
});
PremiumTaskCard.displayName = 'PremiumTaskCard';

export function PremiumTasksEarningPage({ onNavigate }: TasksEarningPageProps) {
  const { user, initData, hapticFeedback } = useTelegram();
  const { userStats, updateStats } = useRewards();
  const awardXP = useAwardXP();
  const completeTaskGamification = useCompleteTask();
  const queryClient = useQueryClient();
  const { toast } = useToast();
  
  const [tasks, setTasks] = useState<Task[]>(premiumTasks);
  const [verifyingTasks, setVerifyingTasks] = useState<Set<string>>(new Set());
  
  // Использовать ref вместо state для хранения timeouts (не вызывает re-render)
  const verificationTimeoutsRef = useRef<Map<string, ReturnType<typeof setTimeout>>>(new Map());

  // Cleanup timeouts только при unmount
  useEffect(() => {
    return () => {
      verificationTimeoutsRef.current.forEach(timeout => clearTimeout(timeout));
      verificationTimeoutsRef.current.clear();
    };
  }, []);

  // Загрузить баланс монет из API
  const { data: balanceData, refetch: refetchBalance } = useQuery({
    queryKey: ['/api/tasks/balance'],
    queryFn: async () => {
      if (!initData) return null;
      const res = await fetch('/api/tasks/balance', {
        headers: { 'x-telegram-init-data': initData }
      });
      if (!res.ok) throw new Error('Failed to load balance');
      return await res.json();
    },
    enabled: !!initData && !!user?.id,
  });

  // Загрузить прогресс заданий из API
  const { data: tasksProgressData, refetch: refetchProgress } = useQuery({
    queryKey: ['/api/tasks/progress'],
    queryFn: async () => {
      if (!initData) return [];
      const res = await fetch('/api/tasks/progress', {
        headers: { 'x-telegram-init-data': initData }
      });
      if (!res.ok) throw new Error('Failed to load tasks');
      return await res.json();
    },
    enabled: !!initData && !!user?.id,
  });

  // Синхронизировать состояние completed из БД
  useEffect(() => {
    if (tasksProgressData && Array.isArray(tasksProgressData)) {
      setTasks(prev => prev.map(task => {
        const progress = tasksProgressData.find((p: any) => p.taskId === task.id);
        return progress ? { ...task, completed: progress.completed } : task;
      }));
    }
  }, [tasksProgressData]);

  const balance = balanceData || {
    totalCoins: userStats?.totalCoins || 0,
    availableCoins: userStats?.totalCoins || 0,
    tasksCompleted: userStats?.tasksCompleted || 0,
    currentStreak: userStats?.currentStreak || 0,
    dailyCheckInStreak: 0
  };

  const handleTaskClick = useCallback(async (task: Task) => {
    if (!user?.id || task.completed || !initData || verifyingTasks.has(task.id)) {
      hapticFeedback.heavy();
      return;
    }

    hapticFeedback.light();
    setVerifyingTasks(prev => new Set(prev).add(task.id));

    try {
      // Вызов /api/tasks/start
      const startRes = await fetch('/api/tasks/start', {
        method: 'POST',
        headers: {
          'x-telegram-init-data': initData,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          task_id: task.id,
          platform: task.platform,
          task_type: task.type,
          coins_reward: task.coins,
        }),
      });

      if (!startRes.ok) {
        const error = await startRes.json();
        throw new Error(error.error || 'Failed to start task');
      }

      // Открыть соответствующее приложение
      if (task.platform === 'tiktok' && task.username) {
        deepLinker.openTikTok(task.username);
      } else if (task.platform === 'instagram' && task.username) {
        deepLinker.openInstagram(task.username);
      } else if (task.platform === 'youtube' && task.url) {
        deepLinker.openYouTube(task.url);
      } else if (task.platform === 'telegram' && task.url) {
        deepLinker.openTelegramChannel(task.url);
      } else if (task.platform === 'referral') {
        const shareText = `Присоединяйся к WEB4TG и получи бонусные монеты!`;
        deepLinker.shareViaMessenger(shareText, window.location.href);
      } else if (task.platform === 'daily' || task.platform === 'special') {
        hapticFeedback.selection();
      }

      // Через 5.5 секунд вызвать /api/tasks/verify (минимум 5s требуется на бэкенде)
      const timeoutId = setTimeout(async () => {
        try {
          const verifyRes = await fetch('/api/tasks/verify', {
            method: 'POST',
            headers: {
              'x-telegram-init-data': initData,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ task_id: task.id }),
          });

          const verifyData = await verifyRes.json();

          if (verifyData.success && verifyData.verified) {
            hapticFeedback.selection();
            
            // Обновить локальное состояние
            setTasks(prev => prev.map(t =>
              t.id === task.id ? { ...t, completed: true } : t
            ));
            
            // Обновить баланс из нового API response
            refetchBalance();
            refetchProgress();
            
            // Обновить геймификацию
            const xpReward = Math.floor(task.coins / 2);
            awardXP(xpReward);
            completeTaskGamification();

            toast({
              title: '✅ Задание выполнено!',
              description: `Вы заработали ${task.coins} монет`,
            });
          } else {
            throw new Error(verifyData.reason || 'Verification failed');
          }
        } catch (error) {
          console.error('Verification error:', error);
          const errorMessage = error instanceof Error ? error.message : 'Попробуйте еще раз';
          toast({
            title: '❌ Ошибка проверки',
            description: errorMessage,
            variant: 'destructive',
          });
        } finally {
          setVerifyingTasks(prev => {
            const next = new Set(prev);
            next.delete(task.id);
            return next;
          });
          verificationTimeoutsRef.current.delete(task.id);
        }
      }, 5500);

      // Сохранить timeout в ref для cleanup при unmount
      verificationTimeoutsRef.current.set(task.id, timeoutId);
    } catch (error) {
      console.error('Task start error:', error);
      toast({
        title: '❌ Ошибка',
        description: error instanceof Error ? error.message : 'Не удалось начать задание',
        variant: 'destructive',
      });
      setVerifyingTasks(prev => {
        const next = new Set(prev);
        next.delete(task.id);
        return next;
      });
    }
  }, [user?.id, initData, hapticFeedback, awardXP, completeTaskGamification, refetchBalance, refetchProgress, toast, verifyingTasks]);

  const totalPossibleCoins = useMemo(() => premiumTasks.reduce((sum, t) => sum + t.coins, 0), []);
  const earnedCoins = useMemo(() => tasks.filter(t => t.completed).reduce((sum, t) => sum + t.coins, 0), [tasks]);
  const progressPercent = useMemo(() => totalPossibleCoins > 0 ? (earnedCoins / totalPossibleCoins) * 100 : 0, [earnedCoins, totalPossibleCoins]);
  
  const featuredTasks = useMemo(() => tasks.filter(t => t.featured && !t.completed), [tasks]);
  const tiktokTasks = useMemo(() => tasks.filter(t => t.platform === 'tiktok'), [tasks]);
  const instagramTasks = useMemo(() => tasks.filter(t => t.platform === 'instagram'), [tasks]);
  const youtubeTasks = useMemo(() => tasks.filter(t => t.platform === 'youtube'), [tasks]);
  const telegramTasks = useMemo(() => tasks.filter(t => t.platform === 'telegram'), [tasks]);
  const specialTasks = useMemo(() => tasks.filter(t => t.platform === 'special' || t.platform === 'referral'), [tasks]);

  return (
    <div className="min-h-screen bg-black text-white" style={{ paddingTop: '140px' }}>
      <div className="max-w-md mx-auto px-4 py-6 space-y-5 pb-24">
        
        {/* Premium Glass Header */}
        <div className="flex items-center justify-between">
          <button 
            onClick={() => {
              hapticFeedback.light();
              onNavigate('profile');
            }}
            className="flex items-center gap-2 text-white/70 hover:text-white transition-colors"
            data-testid="button-back"
          >
            <ArrowLeft className="w-5 h-5" />
            <span className="text-sm font-medium">Назад</span>
          </button>
          
          <div className="flex items-center gap-2 px-4 py-2 rounded-full backdrop-blur-[40px] bg-white/10 border border-white/20">
            <Coins className="w-5 h-5 text-amber-400" />
            <span className="text-white font-bold text-lg">{balance.totalCoins}</span>
          </div>
        </div>

        {/* Hero Section */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center py-8"
        >
          <motion.div
            animate={{ rotate: [0, 5, -5, 0] }}
            transition={{ duration: 4, repeat: Infinity }}
            className="inline-block mb-4"
          >
            <div className="w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-2xl shadow-amber-400/30">
              <Coins className="w-10 h-10 text-white" />
            </div>
          </motion.div>
          
          <h1 className="text-4xl font-bold text-white mb-3 bg-gradient-to-r from-white via-white to-white/80 bg-clip-text">
            Зарабатывайте монеты
          </h1>
          <p className="text-white/60 text-base max-w-xs mx-auto">
            Выполняйте задания и получайте эксклюзивные скидки до 25%
          </p>
        </motion.div>

        {/* Progress Bar */}
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ delay: 0.2 }}
          className="relative rounded-2xl p-5 backdrop-blur-[40px] bg-gradient-to-br from-amber-500/10 to-orange-500/10 border border-amber-500/30"
        >
          <div className="flex items-center justify-between mb-3">
            <div className="flex items-center gap-2">
              <TrendingUp className="w-5 h-5 text-amber-400" />
              <span className="text-white font-semibold">Прогресс заработка</span>
            </div>
            <span className="text-amber-400 font-bold text-sm">{Math.round(progressPercent)}%</span>
          </div>
          
          <div className="relative h-2 bg-white/10 rounded-full overflow-hidden backdrop-blur-sm">
            <motion.div
              initial={{ width: 0 }}
              animate={{ width: `${progressPercent}%` }}
              transition={{ duration: 0.8, ease: 'easeOut' }}
              className="absolute inset-y-0 left-0 bg-gradient-to-r from-amber-400 to-orange-500 rounded-full"
            />
          </div>
          
          <div className="flex items-center justify-between mt-3 text-xs">
            <span className="text-white/60">
              Заработано: <span className="text-white font-semibold">{earnedCoins}</span>
            </span>
            <span className="text-white/60">
              Доступно: <span className="text-amber-400 font-semibold">{totalPossibleCoins}</span>
            </span>
          </div>
        </motion.div>

        {/* Featured Tasks */}
        {featuredTasks.length > 0 && (
          <div className="space-y-3">
            <div className="flex items-center gap-2">
              <Sparkles className="w-5 h-5 text-amber-400" />
              <h2 className="text-white font-bold text-lg">Избранные задания</h2>
            </div>
            
            {featuredTasks.map((task, index) => (
              <motion.div
                key={task.id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1 }}
              >
                <PremiumTaskCard 
                  task={task}
                  onTaskClick={handleTaskClick}
                  isVerifying={verifyingTasks.has(task.id)}
                />
              </motion.div>
            ))}
          </div>
        )}

        {/* TikTok Tasks */}
        {tiktokTasks.some(t => !t.completed) && (
          <div className="space-y-3">
            <h2 className="text-white/80 font-semibold text-sm uppercase tracking-wider flex items-center gap-2">
              <div className="w-6 h-6 rounded-lg bg-gradient-to-br from-pink-500/30 to-purple-500/30 flex items-center justify-center">
                <span className="text-xs">🎵</span>
              </div>
              TikTok
            </h2>
            
            {tiktokTasks.filter(t => !t.completed).map(task => (
              <PremiumTaskCard 
                key={task.id}
                task={task}
                onTaskClick={handleTaskClick}
                isVerifying={verifyingTasks.has(task.id)}
              />
            ))}
          </div>
        )}

        {/* Instagram Tasks */}
        {instagramTasks.some(t => !t.completed) && (
          <div className="space-y-3">
            <h2 className="text-white/80 font-semibold text-sm uppercase tracking-wider flex items-center gap-2">
              <div className="w-6 h-6 rounded-lg bg-gradient-to-br from-purple-500/30 to-pink-500/30 flex items-center justify-center">
                <span className="text-xs">📸</span>
              </div>
              Instagram
            </h2>
            
            {instagramTasks.filter(t => !t.completed).map(task => (
              <PremiumTaskCard 
                key={task.id}
                task={task}
                onTaskClick={handleTaskClick}
                isVerifying={verifyingTasks.has(task.id)}
              />
            ))}
          </div>
        )}

        {/* YouTube Tasks */}
        {youtubeTasks.some(t => !t.completed) && (
          <div className="space-y-3">
            <h2 className="text-white/80 font-semibold text-sm uppercase tracking-wider flex items-center gap-2">
              <div className="w-6 h-6 rounded-lg bg-gradient-to-br from-red-500/30 to-orange-500/30 flex items-center justify-center">
                <Youtube className="w-3.5 h-3.5 text-red-400" />
              </div>
              YouTube
            </h2>
            
            {youtubeTasks.filter(t => !t.completed).map(task => (
              <PremiumTaskCard 
                key={task.id}
                task={task}
                onTaskClick={handleTaskClick}
                isVerifying={verifyingTasks.has(task.id)}
              />
            ))}
          </div>
        )}

        {/* Telegram Tasks */}
        {telegramTasks.some(t => !t.completed) && (
          <div className="space-y-3">
            <h2 className="text-white/80 font-semibold text-sm uppercase tracking-wider flex items-center gap-2">
              <div className="w-6 h-6 rounded-lg bg-gradient-to-br from-blue-500/30 to-cyan-500/30 flex items-center justify-center">
                <Send className="w-3.5 h-3.5 text-blue-400" />
              </div>
              Telegram
            </h2>
            
            {telegramTasks.filter(t => !t.completed).map(task => (
              <PremiumTaskCard 
                key={task.id}
                task={task}
                onTaskClick={handleTaskClick}
                isVerifying={verifyingTasks.has(task.id)}
              />
            ))}
          </div>
        )}

        {/* Special Tasks */}
        {specialTasks.some(t => !t.completed) && (
          <div className="space-y-3">
            <h2 className="text-white/80 font-semibold text-sm uppercase tracking-wider flex items-center gap-2">
              <Trophy className="w-5 h-5 text-violet-400" />
              Специальные задания
            </h2>
            
            {specialTasks.filter(t => !t.completed).map(task => (
              <PremiumTaskCard 
                key={task.id}
                task={task}
                onTaskClick={handleTaskClick}
                isVerifying={verifyingTasks.has(task.id)}
              />
            ))}
          </div>
        )}

        {/* Completion Message */}
        {tasks.every(t => t.completed) && (
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="text-center py-12 px-6 rounded-3xl backdrop-blur-[40px] bg-gradient-to-br from-emerald-500/20 to-teal-500/20 border border-emerald-500/30"
          >
            <Trophy className="w-16 h-16 text-emerald-400 mx-auto mb-4" />
            <h3 className="text-2xl font-bold text-white mb-2">Все задания выполнены!</h3>
            <p className="text-white/70 text-sm">
              Вы заработали {balance.totalCoins} монет. Ожидайте новые задания скоро!
            </p>
          </motion.div>
        )}
      </div>
    </div>
  );
}
```

### components/ProfilePage.tsx
```tsx
import { useState, useEffect, useCallback, useMemo, memo, startTransition, useRef } from "react";
import { useVirtualizer } from '@tanstack/react-virtual';
import { 
  User, 
  Settings, 
  MessageCircle, 
  FileText, 
  CreditCard, 
  Home, 
  Calculator, 
  Wrench, 
  Edit, 
  Crown, 
  Star, 
  Smartphone, 
  CheckCircle,
  ChevronRight,
  Phone,
  Mail,
  Building,
  Bell,
  Shield,
  HelpCircle,
  ExternalLink,
  Package,
  Clock,
  TrendingUp,
  Send,
  Instagram,
  Music,
  Sparkles,
  Rocket,
  UserCircle2,
  Plus,
  Users,
  Gift,
  Coins
} from "lucide-react";
import { useTelegram } from "../hooks/useTelegram";
import { useToast } from "@/hooks/use-toast";

interface ProfilePageProps {
  onNavigate: (section: string) => void;
}

// Memoized Status Icon Component
const StatusIcon = memo(({ status }: { status: string }) => {
  switch (status) {
    case 'Готово':
    case 'Завершен':
      return <CheckCircle className="w-4 h-4 text-system-green" />;
    case 'В разработке':
    case 'Разработка':
      return <Clock className="w-4 h-4 text-system-orange" />;
    case 'Планирование':
    case 'Оплачено':
      return <Package className="w-4 h-4 text-system-blue" />;
    default:
      return <Clock className="w-4 h-4 text-secondary-label" />;
  }
});
StatusIcon.displayName = 'StatusIcon';

// Helper function to get user initials
const getUserInitials = (name: string): string => {
  if (!name || name.trim().length === 0) return '?';
  const words = name.trim().split(' ').filter(Boolean);
  if (words.length === 0) return '?';
  if (words.length === 1) return words[0][0].toUpperCase();
  return (words[0][0] + words[words.length - 1][0]).toUpperCase();
};

// Helper function to generate gradient color based on user ID
const getGradientForUser = (userId: number | null): string => {
  if (!userId) return 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
  
  const gradients = [
    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', // Purple
    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', // Pink
    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', // Blue
    'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', // Green
    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', // Pink-Yellow
    'linear-gradient(135deg, #30cfd0 0%, #330867 100%)', // Cyan-Purple
    'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', // Pastel
    'linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%)', // Orange-Pink
  ];
  
  return gradients[userId % gradients.length];
};

// Memoized User Card Component
const UserCard = memo(({ profileData, isAvailable, telegramUser }: { profileData: any, isAvailable: boolean, telegramUser: any }) => {
  const hasValidUser = !!telegramUser && !!telegramUser.first_name;
  const initials = getUserInitials(profileData.name);
  const gradient = getGradientForUser(profileData.telegramId);
  
  return (
    <section className="liquid-glass-card-elevated rounded-2xl p-6 text-center liquid-glass-shimmer">
      {/* User Avatar with Initials */}
      <div className="relative w-24 h-24 mx-auto mb-4" data-testid="user-avatar">
        {hasValidUser ? (
          <div 
            className="w-full h-full rounded-full flex items-center justify-center shadow-lg border-2 border-white/20"
            style={{ background: gradient }}
            data-testid="avatar-initials"
          >
            <span className="text-3xl font-bold text-white">{initials}</span>
          </div>
        ) : (
          <div className="w-full h-full bg-system-blue/10 rounded-full flex items-center justify-center">
            <User className="w-10 h-10 text-system-blue" />
          </div>
        )}
        
        {/* Telegram Status Badge */}
        {isAvailable && hasValidUser && (
          <div 
            className="absolute bottom-0 right-0 w-7 h-7 bg-system-green rounded-full border-2 border-background flex items-center justify-center"
            data-testid="telegram-status-badge"
          >
            <CheckCircle className="w-4 h-4 text-white" />
          </div>
        )}
      </div>
      
      <h2 className="ios-title2 mb-2 text-white" data-testid="user-name">
        {profileData.name}
      </h2>
      
      {profileData.username && (
        <div className="ios-footnote text-system-blue mb-3" data-testid="user-username">
          {profileData.username}
        </div>
      )}
      
      <div className="flex items-center justify-center space-x-2 mb-4" data-testid="connection-status">
        {isAvailable && hasValidUser ? (
          <>
            <CheckCircle className="w-4 h-4 text-system-green" />
            <span className="ios-footnote text-system-green">Подключен к Telegram</span>
          </>
        ) : (
          <>
            <Smartphone className="w-4 h-4 text-system-blue" />
            <span className="ios-footnote text-system-blue">WEB4TG Client</span>
          </>
        )}
      </div>

      {profileData.telegramId && (
        <div className="bg-system-blue/10 backdrop-blur-xl rounded-xl border border-system-blue/30 p-3" data-testid="user-telegram-id">
          <div className="ios-caption1 text-white/70 mb-1 font-medium">ID пользователя</div>
          <div className="ios-footnote font-mono text-system-blue font-semibold">#{profileData.telegramId}</div>
        </div>
      )}
    </section>
  );
});
UserCard.displayName = 'UserCard';

// Memoized Stats Card Component
const StatsCard = memo(({ stats }: { stats: { total: number, completed: number, inProgress: number } }) => (
  <div className="liquid-glass-card rounded-2xl p-4">
    <div className="grid grid-cols-3 gap-4">
      <div className="text-center">
        <div className="w-12 h-12 bg-system-blue/10 rounded-full flex items-center justify-center mx-auto mb-2">
          <Package className="w-6 h-6 text-system-blue" />
        </div>
        <div className="ios-title3 font-bold text-system-blue">{stats.total}</div>
        <div className="ios-caption2 text-white/70">Проектов</div>
      </div>
      <div className="text-center">
        <div className="w-12 h-12 bg-system-green/10 rounded-full flex items-center justify-center mx-auto mb-2">
          <CheckCircle className="w-6 h-6 text-system-green" />
        </div>
        <div className="ios-title3 font-bold text-system-green">{stats.completed}</div>
        <div className="ios-caption2 text-white/70">Завершено</div>
      </div>
      <div className="text-center">
        <div className="w-12 h-12 bg-system-orange/10 rounded-full flex items-center justify-center mx-auto mb-2">
          <Clock className="w-6 h-6 text-system-orange" />
        </div>
        <div className="ios-title3 font-bold text-system-orange">{stats.inProgress}</div>
        <div className="ios-caption2 text-white/70">В работе</div>
      </div>
    </div>
  </div>
));
StatsCard.displayName = 'StatsCard';

// Memoized Project Item Component
const ProjectItem = memo(({ project, isLast }: { project: any, isLast: boolean }) => (
  <div className={`p-4 ${!isLast ? 'border-b border-white/10' : ''}`}>
    <div className="flex items-center space-x-3">
      <StatusIcon status={project.status} />
      <div className="flex-1">
        <div className="ios-body font-bold text-white">{project.name}</div>
        <div className="flex items-center space-x-2">
          <span className={`ios-caption2 font-semibold ${
            project.status === 'Готово' || project.status === 'Завершен' ? 'text-system-green' :
            project.status === 'В разработке' || project.status === 'Разработка' ? 'text-system-orange' :
            'text-system-blue'
          }`}>
            {project.status}
          </span>
          <span className="ios-caption2 text-white/40">•</span>
          <span className="ios-caption2 text-white/70 font-medium">{project.progress || 0}%</span>
        </div>
        <div className="w-full bg-white/20 rounded-full h-1.5 mt-2">
          <div 
            className={`h-1.5 rounded-full transition-all duration-300 ${
              project.status === 'Готово' || project.status === 'Завершен' ? 'bg-system-green' : 
              project.status === 'В разработке' || project.status === 'Разработка' ? 'bg-system-orange' : 
              'bg-system-blue'
            }`}
            style={{ width: `${project.progress || 0}%` }}
          />
        </div>
      </div>
      <ChevronRight className="w-5 h-5 text-white/40" />
    </div>
  </div>
));
ProjectItem.displayName = 'ProjectItem';

// Virtualized Projects List Component
const ProjectsVirtualList = memo(({ projects, onNavigateConstructor }: { 
  projects: any[], 
  onNavigateConstructor: () => void 
}) => {
  const parentRef = useRef<HTMLDivElement>(null);
  
  const rowVirtualizer = useVirtualizer({
    count: projects.length + 1,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 100,
    overscan: 3,
  });

  return (
    <section>
      <div className="space-y-3">
        <div className="ios-list-header text-white/70 font-medium px-2">Мои проекты</div>
        
        <div 
          ref={parentRef}
          className="liquid-glass-card rounded-2xl overflow-auto"
          style={{ maxHeight: '400px' }}
        >
          <div
            style={{
              height: `${rowVirtualizer.getTotalSize()}px`,
              width: '100%',
              position: 'relative',
            }}
          >
            {rowVirtualizer.getVirtualItems().map((virtualRow) => {
              const isLast = virtualRow.index === projects.length;
              
              if (isLast) {
                return (
                  <div
                    key="add-project"
                    style={{
                      position: 'absolute',
                      top: 0,
                      left: 0,
                      width: '100%',
                      transform: `translateY(${virtualRow.start}px)`,
                    }}
                  >
                    <div className="p-4 border-t border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={onNavigateConstructor}>
                      <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-system-blue/20 rounded-xl flex items-center justify-center">
                          <Wrench className="w-5 h-5 text-system-blue" />
                        </div>
                        <div className="flex-1">
                          <div className="ios-body font-bold text-system-blue">Создать новый проект</div>
                          <div className="ios-footnote text-white/70">Запустите еще одно приложение</div>
                        </div>
                        <ChevronRight className="w-5 h-5 text-white/40" />
                      </div>
                    </div>
                  </div>
                );
              }
              
              const project = projects[virtualRow.index];
              return (
                <div
                  key={project.id}
                  style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: '100%',
                    transform: `translateY(${virtualRow.start}px)`,
                  }}
                >
                  <ProjectItem project={project} isLast={virtualRow.index === projects.length - 1} />
                </div>
              );
            })}
          </div>
        </div>
      </div>
    </section>
  );
});
ProjectsVirtualList.displayName = 'ProjectsVirtualList';

// Profile Page Component
function ProfilePage({ onNavigate }: ProfilePageProps) {
  const { user, isAvailable, homeScreen } = useTelegram();
  const { toast } = useToast();
  const [userProjects, setUserProjects] = useState<any[]>([]);
  const [isLoadingProjects, setIsLoadingProjects] = useState(true);
  const [autoSave, setAutoSave] = useState(true);
  const [backupEnabled, setBackupEnabled] = useState(true);
  const [notificationsEnabled, setNotificationsEnabled] = useState(true);

  // Memoized profile data
  const profileData = useMemo(() => ({
    name: user ? `${user.first_name}${user.last_name ? ` ${user.last_name}` : ''}` : 'Пользователь',
    username: user?.username ? `@${user.username}` : null,
    telegramId: user?.id || null,
    language: user?.language_code || 'ru',
    joinedAt: user ? 'Активен в Telegram' : 'Не подключен'
  }), [user]);

  // Fetch projects with transition for smooth UI
  useEffect(() => {
    const fetchUserProjects = async () => {
      if (!profileData.telegramId) {
        setIsLoadingProjects(false);
        return;
      }

      try {
        const response = await fetch(`/api/user-projects/${profileData.telegramId}`);
        if (response.ok) {
          const projects = await response.json();
          startTransition(() => {
            setUserProjects(projects);
          });
        } else {
          setUserProjects([]);
        }
      } catch (error) {
        console.log('Проекты не найдены, пользователь новый');
        setUserProjects([]);
      } finally {
        setIsLoadingProjects(false);
      }
    };

    fetchUserProjects();
  }, [profileData.telegramId]);

  // Memoized stats
  const stats = useMemo(() => ({
    total: userProjects.length,
    completed: userProjects.filter(p => p.status === 'Готово' || p.status === 'Завершен' || p.progress === 100).length,
    inProgress: userProjects.filter(p => p.status !== 'Готово' && p.status !== 'Завершен' && p.progress !== 100).length
  }), [userProjects]);

  // Memoized language display
  const languageDisplay = useMemo(() => {
    switch (profileData.language) {
      case 'ru': return 'Русский';
      case 'en': return 'English';
      default: return profileData.language || 'Русский';
    }
  }, [profileData.language]);

  // Memoized navigation callbacks
  const handleNavigateConstructor = useCallback(() => onNavigate('constructor'), [onNavigate]);
  const handleNavigatePricing = useCallback(() => onNavigate('constructor'), [onNavigate]);
  const handleNavigateHelp = useCallback(() => onNavigate('help'), [onNavigate]);
  const handleNavigateReview = useCallback(() => onNavigate('review'), [onNavigate]);
  const handleNavigateReferral = useCallback(() => onNavigate('referral'), [onNavigate]);
  const handleNavigateRewards = useCallback(() => onNavigate('rewards'), [onNavigate]);
  const handleNavigateEarning = useCallback(() => onNavigate('earning'), [onNavigate]);

  // Memoized external link handlers
  const handleTelegramClick = useCallback(() => window.open('https://t.me/web4tgs', '_blank'), []);
  const handleInstagramClick = useCallback(() => window.open('https://instagram.com/web4tg', '_blank'), []);
  const handleTikTokClick = useCallback(() => window.open('https://tiktok.com/@web4tg', '_blank'), []);
  
  // Toggle handlers
  const toggleAutoSave = useCallback(() => setAutoSave(prev => !prev), []);
  const toggleBackup = useCallback(() => setBackupEnabled(prev => !prev), []);
  const toggleNotifications = useCallback(() => setNotificationsEnabled(prev => !prev), []);

  return (
    <div className="min-h-screen bg-black text-white pb-24" style={{ paddingTop: '140px' }}>
      <div className="max-w-md mx-auto px-4 pt-4 pb-6 space-y-6">
        
        {/* User Profile Card */}
        <div className="scroll-fade-in">
          <UserCard profileData={profileData} isAvailable={isAvailable} telegramUser={user} />
        </div>

        {/* Statistics */}
        <section className="scroll-fade-in-delay-1">
          <div className="space-y-3">
            <div className="ios-list-header text-white/70 font-medium px-2">Статистика активности</div>
            
            {isLoadingProjects ? (
              <div className="liquid-glass-card rounded-2xl p-6 text-center">
                <div className="w-8 h-8 border-2 border-system-blue/30 border-t-system-blue rounded-full animate-spin mx-auto mb-3"></div>
                <div className="ios-footnote text-white/70">Загружаем ваши проекты...</div>
              </div>
            ) : userProjects.length > 0 ? (
              <StatsCard stats={stats} />
            ) : (
              <div className="liquid-glass-card rounded-2xl p-6 text-center">
                <div className="w-16 h-16 bg-system-blue/20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <Package className="w-8 h-8 text-system-blue" />
                </div>
                <h3 className="ios-body font-bold mb-2 text-white">Пора создать первое приложение!</h3>
                <p className="ios-footnote text-white/70 mb-4 leading-relaxed">
                  У вас пока нет проектов. Создайте свое первое Telegram приложение и начните зарабатывать уже сегодня!
                </p>
                <button 
                  className="ios-button-filled w-full mb-3"
                  onClick={handleNavigateConstructor}
                >
                  Создать приложение
                </button>
                <button 
                  className="ios-button-plain w-full"
                  onClick={handleNavigatePricing}
                >
                  Выбрать шаблон
                </button>
              </div>
            )}
          </div>
        </section>

        {/* Telegram Integration */}
        <section className="scroll-fade-in-delay-2">
          <div className="space-y-3">
            <div className="ios-list-header text-white/70 font-medium px-2">Интеграция с Telegram</div>
            
            <div className="liquid-glass-card rounded-2xl overflow-hidden">
            <div className="p-4 border-b border-white/10">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-blue/20 rounded-xl flex items-center justify-center">
                  <Send className="w-5 h-5 text-system-blue" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Язык интерфейса</div>
                  <div className="ios-footnote text-white/70">{languageDisplay}</div>
                </div>
              </div>
            </div>

            <div className="p-4">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-green/20 rounded-xl flex items-center justify-center">
                  <Smartphone className="w-5 h-5 text-system-green" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Статус подключения</div>
                  <div className="ios-footnote text-white/70">{profileData.joinedAt}</div>
                </div>
                {isAvailable && <CheckCircle className="w-5 h-5 text-system-green" />}
              </div>
            </div>
            </div>
          </div>
        </section>

        {/* Bonuses & Rewards Section */}
        <section className="scroll-fade-in-delay-3">
          <div className="space-y-3">
            <div className="ios-list-header text-white/70 font-medium px-2">Бонусы и награды</div>
            
            <div className="liquid-glass-card rounded-2xl overflow-hidden">
              <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleNavigateReferral}>
                <div className="flex items-center space-x-3">
                  <div className="w-10 h-10 bg-emerald-500/20 rounded-xl flex items-center justify-center">
                    <Users className="w-5 h-5 text-emerald-400" />
                  </div>
                  <div className="flex-1">
                    <div className="ios-body text-white font-semibold">Реферальная программа</div>
                    <div className="ios-footnote text-white/70">Приглашайте друзей и зарабатывайте</div>
                  </div>
                  <ChevronRight className="w-5 h-5 text-white/40" />
                </div>
              </div>

              <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleNavigateRewards}>
                <div className="flex items-center space-x-3">
                  <div className="w-10 h-10 bg-amber-500/20 rounded-xl flex items-center justify-center">
                    <Gift className="w-5 h-5 text-amber-400" />
                  </div>
                  <div className="flex-1">
                    <div className="ios-body text-white font-semibold">Цифровые награды</div>
                    <div className="ios-footnote text-white/70">Достижения, уровни и бонусы</div>
                  </div>
                  <ChevronRight className="w-5 h-5 text-white/40" />
                </div>
              </div>

              <div className="p-4 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleNavigateEarning}>
                <div className="flex items-center space-x-3">
                  <div className="w-10 h-10 bg-yellow-500/20 rounded-xl flex items-center justify-center">
                    <Coins className="w-5 h-5 text-yellow-400" />
                  </div>
                  <div className="flex-1">
                    <div className="ios-body text-white font-semibold">Заработок монет</div>
                    <div className="ios-footnote text-white/70">Выполняйте задания и зарабатывайте</div>
                  </div>
                  <ChevronRight className="w-5 h-5 text-white/40" />
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* My Projects */}
        {!isLoadingProjects && userProjects.length > 0 && (
          <ProjectsVirtualList 
            projects={userProjects} 
            onNavigateConstructor={handleNavigateConstructor}
          />
        )}

        {/* Smart Features */}
        <section className="scroll-fade-in-delay-4">
          <div className="space-y-3">
            <div className="ios-list-header text-white/70 font-medium px-2">Умные функции</div>
            
            <div className="liquid-glass-card rounded-2xl overflow-hidden">
            <div className="p-4 border-b border-white/10">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-green/20 rounded-xl flex items-center justify-center">
                  <CheckCircle className="w-5 h-5 text-system-green" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Автосохранение</div>
                  <div className="ios-footnote text-white/70">Проекты сохраняются каждые 30 секунд</div>
                </div>
                <div 
                  className={`ios-switch ${autoSave ? 'ios-switch-active' : ''} cursor-pointer`}
                  onClick={toggleAutoSave}
                >
                  <div className="ios-switch-thumb"></div>
                </div>
              </div>
            </div>
            
            <div className="p-4 border-b border-white/10">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-blue/20 rounded-xl flex items-center justify-center">
                  <Shield className="w-5 h-5 text-system-blue" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Резервные копии</div>
                  <div className="ios-footnote text-white/70">Автоматическое резервирование в облако</div>
                </div>
                <div 
                  className={`ios-switch ${backupEnabled ? 'ios-switch-active' : ''} cursor-pointer`}
                  onClick={toggleBackup}
                >
                  <div className="ios-switch-thumb"></div>
                </div>
              </div>
            </div>
            
            <div className="p-4 border-b border-white/10">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-purple/20 rounded-xl flex items-center justify-center">
                  <Bell className="w-5 h-5 text-system-purple" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Уведомления о статусе</div>
                  <div className="ios-footnote text-white/70">Получать обновления о ходе разработки</div>
                </div>
                <div 
                  className={`ios-switch ${notificationsEnabled ? 'ios-switch-active' : ''} cursor-pointer`}
                  onClick={toggleNotifications}
                >
                  <div className="ios-switch-thumb"></div>
                </div>
              </div>
            </div>

            <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors">
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-orange/20 rounded-xl flex items-center justify-center">
                  <Settings className="w-5 h-5 text-system-orange" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Тема оформления</div>
                  <div className="ios-footnote text-white/70">Темная тема (автоматически)</div>
                </div>
                <ChevronRight className="w-5 h-5 text-white/40" />
              </div>
            </div>

            <div 
              className="p-4 cursor-pointer hover:bg-white/5 transition-colors"
              onClick={() => {
                if (homeScreen) {
                  try {
                    homeScreen.add();
                    toast({
                      title: "Добавление на главный экран",
                      description: "Следуйте инструкциям браузера для добавления ярлыка приложения",
                    });
                  } catch (error) {
                    toast({
                      title: "Функция недоступна",
                      description: "Ваша версия Telegram не поддерживает эту функцию",
                      variant: "destructive",
                    });
                  }
                } else {
                  toast({
                    title: "Функция недоступна",
                    description: "Ваш браузер не поддерживает добавление на главный экран",
                    variant: "destructive",
                  });
                }
              }}
            >
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-emerald-500/20 rounded-xl flex items-center justify-center">
                  <Smartphone className="w-5 h-5 text-emerald-500" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Добавить на главный экран</div>
                  <div className="ios-footnote text-white/70">Быстрый доступ к приложению</div>
                </div>
                <ChevronRight className="w-5 h-5 text-white/40" />
              </div>
            </div>
            </div>
          </div>
        </section>

        {/* Support */}
        <section>
          <div className="space-y-3">
            <div className="ios-list-header text-white/70 font-medium px-2">Поддержка</div>
            
            <div className="liquid-glass-card rounded-2xl overflow-hidden">
            <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleTelegramClick}>
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-blue/20 rounded-xl flex items-center justify-center">
                  <MessageCircle className="w-5 h-5 text-system-blue" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Связаться с нами</div>
                  <div className="ios-footnote text-white/70">Техподдержка 24/7</div>
                </div>
                <ChevronRight className="w-5 h-5 text-white/40" />
              </div>
            </div>
            
            <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleTelegramClick}>
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-blue/20 rounded-xl flex items-center justify-center">
                  <Send className="w-5 h-5 text-system-blue" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Telegram</div>
                  <div className="ios-footnote text-white/70">@web4tgs</div>
                </div>
                <ExternalLink className="w-4 h-4 text-white/40" />
              </div>
            </div>
            
            <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleInstagramClick}>
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                  <Instagram className="w-5 h-5 text-white/90" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Instagram</div>
                  <div className="ios-footnote text-white/70">@web4tg</div>
                </div>
                <ExternalLink className="w-4 h-4 text-white/40" />
              </div>
            </div>
            
            <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleTikTokClick}>
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center border border-white/20">
                  <Music className="w-5 h-5 text-white/90" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">TikTok</div>
                  <div className="ios-footnote text-white/70">@web4tg</div>
                </div>
                <ExternalLink className="w-4 h-4 text-white/40" />
              </div>
            </div>
            
            <div className="p-4 border-b border-white/10 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleNavigateHelp}>
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-green/20 rounded-xl flex items-center justify-center">
                  <HelpCircle className="w-5 h-5 text-system-green" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Справка</div>
                  <div className="ios-footnote text-white/70">FAQ и инструкции</div>
                </div>
                <ChevronRight className="w-5 h-5 text-white/40" />
              </div>
            </div>
            
            <div className="p-4 cursor-pointer hover:bg-white/5 transition-colors" onClick={handleNavigateReview}>
              <div className="flex items-center space-x-3">
                <div className="w-10 h-10 bg-system-orange/20 rounded-xl flex items-center justify-center">
                  <Star className="w-5 h-5 text-system-orange" />
                </div>
                <div className="flex-1">
                  <div className="ios-body text-white font-semibold">Оставить отзыв</div>
                  <div className="ios-footnote text-white/70">Оцените наш сервис</div>
                </div>
                <ChevronRight className="w-5 h-5 text-white/40" />
              </div>
            </div>
            </div>
          </div>
        </section>

        {/* App Info */}
        <section className="text-center space-y-2 pb-4">
          <div className="ios-footnote text-white/40 font-medium">WEB4TG Platform</div>
          <div className="ios-footnote text-white/40">Версия 1.0.0</div>
        </section>
      </div>
    </div>
  );
}

export default memo(ProfilePage);
```

### components/ProjectCard.tsx
```tsx
import { ArrowRight, Star, Heart } from "lucide-react";

interface ProjectCardProps {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  likes: string;
  badge?: boolean;
  onClick: () => void;
}

export default function ProjectCard({ 
  id, 
  title, 
  description, 
  category, 
  image, 
  likes, 
  badge, 
  onClick 
}: ProjectCardProps) {
  return (
    <button
      className="group relative overflow-hidden rounded-2xl bg-white/10 backdrop-blur-xl border border-white/20 hover:border-system-blue/30 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-system-blue/20 shadow-sm hover:shadow-lg w-full"
      onClick={onClick}
      data-testid={`card-demo-${id}`}
      aria-label={`Open ${title} demo - ${description}`}
    >
      <div className="flex items-center p-4 space-x-4">
        {/* Project Image */}
        <div className="relative flex-shrink-0">
          <div className="w-16 h-16 rounded-xl overflow-hidden bg-gradient-to-br from-system-blue/10 to-system-purple/10">
            <img 
              src={image} 
              alt={title}
              className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"
              loading="lazy"
            />
          </div>
          {badge && (
            <div className="absolute -top-1 -right-1 w-5 h-5 bg-system-blue rounded-full flex items-center justify-center">
              <span className="text-white text-xs font-bold">!</span>
            </div>
          )}
        </div>
        
        {/* Project Info */}
        <div className="flex-1 min-w-0 text-left">
          <div className="flex items-center justify-between mb-1">
            <h4 className="ios-body font-semibold text-label truncate" data-testid={`text-demo-title-${id}`}>
              {title}
            </h4>
            <div className="flex items-center space-x-1 ml-2">
              <Star className="w-3 h-3 text-system-yellow fill-current" />
              <span className="ios-caption2 font-medium text-label">4.9</span>
            </div>
          </div>
          
          <p className="ios-caption1 text-system-blue font-medium mb-2">
            {category}
          </p>
          
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-3">
              <div className="flex items-center space-x-1">
                <Heart className="w-3 h-3 text-system-red fill-current" />
                <span className="ios-caption2 font-medium text-secondary-label" data-testid={`text-likes-${id}`}>
                  {likes}
                </span>
              </div>
              <span className="ios-caption2 text-secondary-label">•</span>
              <span className="ios-caption2 text-secondary-label">Демо доступно</span>
            </div>
            
            <div className="flex items-center text-system-blue group-hover:translate-x-1 transition-transform">
              <ArrowRight className="w-4 h-4" />
            </div>
          </div>
        </div>
      </div>
    </button>
  );
}```

### components/ProjectsPage.tsx
```tsx
import { demoApps } from "../data/demoApps";
import { ArrowRight } from "lucide-react";

interface ProjectsPageProps {
  onNavigate: (section: string) => void;
  onOpenDemo: (demoId: string) => void;
}

export default function ProjectsPage({ onNavigate, onOpenDemo }: ProjectsPageProps) {
  const topApps = demoApps; // All 13 apps

  return (
    <div 
      className="min-h-screen pb-32"
      style={{ 
        background: '#09090B',
        color: '#E4E4E7',
        paddingTop: '140px'
      }}
    >
      <div className="max-w-md mx-auto">
        
        {/* ═══════════════════════════════════════════════════════
            TIER 1: HERO — Authority-Led, Understated
        ═══════════════════════════════════════════════════════ */}
        <header className="px-7 pt-8 pb-16">
          {/* Eyebrow */}
          <p 
            className="scroll-fade-in"
            style={{
              fontSize: '11px',
              fontWeight: 500,
              letterSpacing: '0.18em',
              color: '#71717A',
              textTransform: 'uppercase',
              marginBottom: '24px'
            }}
          >
            Web4TG Studio
          </p>
          
          {/* Headline */}
          <h1 
            className="scroll-fade-in-delay-1"
            style={{
              fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, sans-serif',
              fontSize: '28px',
              fontWeight: 600,
              letterSpacing: '-0.025em',
              lineHeight: '1.3',
              color: '#FAFAFA'
            }}
          >
            Ваш следующий клиент
            <br />
            напишет через 4 минуты.
            <br />
            <span style={{ color: '#FFFFFF' }}>
              Кто ему ответит?
            </span>
          </h1>
          
          {/* Subtext */}
          <p 
            className="scroll-fade-in-delay-2"
            style={{
              fontSize: '15px',
              fontWeight: 400,
              letterSpacing: '-0.01em',
              lineHeight: '1.6',
              color: '#71717A',
              marginTop: '20px',
              maxWidth: '320px'
            }}
          >
            Telegram Mini App отвечает мгновенно, консультирует и закрывает сделки — пока вы занимаетесь чем угодно. 50+ бизнесов уже продают на автомате.
          </p>
          
          {/* Competitive FOMO Statement */}
          <div 
            className="scroll-fade-in-delay-3"
            style={{
              marginTop: '36px',
              padding: '24px',
              borderRadius: '16px',
              background: 'linear-gradient(135deg, rgba(139,92,246,0.08) 0%, rgba(59,130,246,0.04) 100%)',
              border: '1px solid rgba(139, 92, 246, 0.2)'
            }}
          >
            <p style={{
              fontSize: '15px',
              fontWeight: 500,
              letterSpacing: '-0.01em',
              color: '#E4E4E7',
              lineHeight: '1.6'
            }}>
              Через 14 дней у вас будет
              <br />
              <span style={{ 
                color: '#A78BFA',
                fontWeight: 600
              }}>
                своё приложение.
              </span>
              <br />
              <span style={{ color: '#71717A' }}>
                Или у вашего конкурента.
              </span>
            </p>
          </div>
          
          {/* Exclusivity Block */}
          <div 
            className="scroll-fade-in-delay-4"
            style={{
              marginTop: '12px',
              display: 'flex',
              gap: '12px'
            }}
          >
            {/* Left: What you get */}
            <div style={{
              flex: 1,
              padding: '20px 16px',
              borderRadius: '12px',
              background: 'rgba(255, 255, 255, 0.02)',
              border: '1px solid rgba(255, 255, 255, 0.04)'
            }}>
              <p style={{
                fontSize: '11px',
                fontWeight: 600,
                letterSpacing: '0.08em',
                color: '#52525B',
                textTransform: 'uppercase',
                marginBottom: '12px'
              }}>
                Не шаблон
              </p>
              <p style={{
                fontSize: '14px',
                fontWeight: 500,
                color: '#FAFAFA',
                lineHeight: '1.4'
              }}>
                Ваш бренд.
                <br />
                Ваш стиль.
                <br />
                Ваши правила.
              </p>
            </div>
            
            {/* Right: Availability */}
            <div style={{
              flex: 1,
              padding: '20px 16px',
              borderRadius: '12px',
              background: 'rgba(255, 255, 255, 0.02)',
              border: '1px solid rgba(255, 255, 255, 0.04)'
            }}>
              <p style={{
                fontSize: '11px',
                fontWeight: 600,
                letterSpacing: '0.08em',
                color: '#52525B',
                textTransform: 'uppercase',
                marginBottom: '12px'
              }}>
                Декабрь
              </p>
              <p style={{
                fontSize: '28px',
                fontWeight: 700,
                color: '#FAFAFA',
                letterSpacing: '-0.03em'
              }}>
                3
              </p>
              <p style={{
                fontSize: '12px',
                color: '#71717A',
                marginTop: '4px'
              }}>
                слота осталось
              </p>
            </div>
          </div>
        </header>

        {/* Hairline */}
        <div 
          className="mx-7"
          style={{ height: '1px', background: '#27272A' }}
        />

        {/* ═══════════════════════════════════════════════════════
            TIER 2: CURATED SHOWCASE INTRO
        ═══════════════════════════════════════════════════════ */}
        <section className="px-7 py-10">
          <div className="flex items-baseline justify-between">
            <p 
              style={{
                fontSize: '12px',
                fontWeight: 500,
                letterSpacing: '0.12em',
                color: '#52525B',
                textTransform: 'uppercase'
              }}
            >
              Коллекция приложений
            </p>
            <p 
              style={{
                fontSize: '13px',
                color: '#52525B'
              }}
            >
              {topApps.length} проектов
            </p>
          </div>
        </section>

        {/* ═══════════════════════════════════════════════════════
            APP CARDS — ОРИГИНАЛЬНЫЕ, БЕЗ ИЗМЕНЕНИЙ
        ═══════════════════════════════════════════════════════ */}
        <div className="px-5 space-y-3">
          {topApps.map((app, index) => (
            <div
              key={app.id}
              onClick={() => onOpenDemo(app.id)}
              className={`premium-card group scroll-fade-in-delay-${Math.min(index + 1, 4)}`}
              data-testid={`card-app-${app.id}`}
              style={{
                position: 'relative',
                cursor: 'pointer',
                borderRadius: '16px',
                padding: '20px 20px 20px 24px',
                background: 'rgba(255, 255, 255, 0.03)',
                backdropFilter: 'blur(40px) saturate(180%)',
                border: '1px solid rgba(255, 255, 255, 0.06)',
                transition: 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)',
                opacity: 0,
                animationDelay: `${0.05 + index * 0.04}s`,
              }}
            >
              <div className="flex items-center justify-between gap-4">
                <div className="flex-1 min-w-0">
                  <h3 
                    data-testid={`text-title-${app.id}`}
                    style={{
                      fontSize: '17px',
                      fontWeight: 600,
                      letterSpacing: '-0.02em',
                      color: '#FFFFFF',
                      marginBottom: '4px'
                    }}
                  >
                    {app.title}
                  </h3>
                  <p 
                    data-testid={`text-description-${app.id}`}
                    style={{
                      fontSize: '14px',
                      lineHeight: '1.4',
                      color: 'rgba(255, 255, 255, 0.45)',
                      letterSpacing: '-0.005em',
                      overflow: 'hidden',
                      textOverflow: 'ellipsis',
                      whiteSpace: 'nowrap'
                    }}
                  >
                    {app.description}
                  </p>
                </div>
                
                <button
                  className="open-button flex items-center gap-1.5 px-4 py-2 rounded-full transition-all duration-300"
                  style={{
                    background: 'rgba(255, 255, 255, 0.1)',
                    border: '1px solid rgba(255, 255, 255, 0.15)',
                    color: '#FFFFFF',
                    fontSize: '13px',
                    fontWeight: 600,
                    letterSpacing: '0.01em',
                    flexShrink: 0
                  }}
                  data-testid={`button-open-${app.id}`}
                >
                  <span>Открыть</span>
                  <ArrowRight 
                    className="w-3.5 h-3.5 transition-transform duration-300 group-hover:translate-x-0.5" 
                    strokeWidth={2.5}
                  />
                </button>
              </div>
            </div>
          ))}
        </div>

        {/* ═══════════════════════════════════════════════════════
            TIER 3: INSIGHT BAND — Discreet Metrics
        ═══════════════════════════════════════════════════════ */}
        <section className="px-7 mt-12">
          <div 
            style={{ 
              height: '1px', 
              background: '#27272A',
              marginBottom: '32px'
            }}
          />
          
          <div className="grid grid-cols-3 gap-6 text-center">
            <div>
              <p 
                style={{
                  fontSize: '20px',
                  fontWeight: 600,
                  color: '#FAFAFA',
                  letterSpacing: '-0.02em'
                }}
              >
                50+
              </p>
              <p 
                style={{
                  fontSize: '11px',
                  color: '#52525B',
                  marginTop: '4px',
                  letterSpacing: '0.05em',
                  textTransform: 'uppercase'
                }}
              >
                проектов
              </p>
            </div>
            <div>
              <p 
                style={{
                  fontSize: '20px',
                  fontWeight: 600,
                  color: '#FAFAFA',
                  letterSpacing: '-0.02em'
                }}
              >
                6
              </p>
              <p 
                style={{
                  fontSize: '11px',
                  color: '#52525B',
                  marginTop: '4px',
                  letterSpacing: '0.05em',
                  textTransform: 'uppercase'
                }}
              >
                отраслей
              </p>
            </div>
            <div>
              <p 
                style={{
                  fontSize: '20px',
                  fontWeight: 600,
                  color: '#FAFAFA',
                  letterSpacing: '-0.02em'
                }}
              >
                14
              </p>
              <p 
                style={{
                  fontSize: '11px',
                  color: '#52525B',
                  marginTop: '4px',
                  letterSpacing: '0.05em',
                  textTransform: 'uppercase'
                }}
              >
                дней запуск
              </p>
            </div>
          </div>

          <div 
            style={{ 
              height: '1px', 
              background: '#27272A',
              marginTop: '32px'
            }}
          />
        </section>

        {/* ═══════════════════════════════════════════════════════
            TIER 4: EXECUTIVE CTA — Refined & Confident
        ═══════════════════════════════════════════════════════ */}
        <section className="px-7 mt-12">
          <div className="text-center">
            {/* Pull Quote */}
            <p 
              style={{
                fontFamily: 'Georgia, serif',
                fontSize: '18px',
                fontStyle: 'italic',
                fontWeight: 400,
                color: '#A1A1AA',
                lineHeight: '1.5',
                marginBottom: '24px'
              }}
            >
              "Обсудим, как Telegram станет
              <br />
              вашим каналом продаж"
            </p>

            {/* CTA Button */}
            <a
              href="https://t.me/web4tgs"
              target="_blank"
              rel="noopener noreferrer"
              className="cta-button inline-flex items-center justify-center gap-2.5 w-full py-4 rounded-xl font-medium transition-all duration-300"
              style={{
                background: '#FAFAFA',
                color: '#09090B',
                fontSize: '15px',
                letterSpacing: '-0.01em',
                textDecoration: 'none'
              }}
              data-testid="button-order-cta"
            >
              Запросить консультацию
              <ArrowRight className="w-4 h-4" />
            </a>
            
            {/* Micro-copy */}
            <p 
              style={{
                fontSize: '12px',
                color: '#52525B',
                marginTop: '16px',
                letterSpacing: '0.01em'
              }}
            >
              Бесплатно · Ответим в течение часа
            </p>
          </div>
        </section>

        {/* ═══════════════════════════════════════════════════════
            FOOTER — Minimal Signature
        ═══════════════════════════════════════════════════════ */}
        <footer className="px-7 mt-16 text-center">
          <div 
            style={{ 
              height: '1px', 
              background: '#18181B',
              marginBottom: '24px'
            }}
          />
          <p 
            style={{
              fontSize: '10px',
              letterSpacing: '0.25em',
              color: '#3F3F46',
              textTransform: 'uppercase'
            }}
          >
            Web4TG · Telegram Mini Apps · 2025
          </p>
        </footer>

      </div>

      <style>{`
        .premium-card:hover {
          background: rgba(255, 255, 255, 0.06);
          border-color: rgba(255, 255, 255, 0.12);
          transform: translateX(4px);
        }

        .premium-card:hover .open-button {
          background: rgba(255, 255, 255, 0.18);
          border-color: rgba(255, 255, 255, 0.25);
        }

        .premium-card:active {
          transform: translateX(2px);
          opacity: 0.9;
        }

        .cta-button:hover {
          background: #FFFFFF;
          transform: translateY(-1px);
          box-shadow: 0 8px 24px rgba(250, 250, 250, 0.1);
        }

        .cta-button:active {
          transform: translateY(0);
          box-shadow: none;
        }

        @keyframes fadeSlideIn {
          from {
            opacity: 0;
            transform: translateY(8px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .scroll-fade-in,
        .scroll-fade-in-delay-1,
        .scroll-fade-in-delay-2,
        .scroll-fade-in-delay-3,
        .scroll-fade-in-delay-4 {
          animation: fadeSlideIn 0.6s ease-out forwards;
        }

        .scroll-fade-in { animation-delay: 0.05s; }
        .scroll-fade-in-delay-1 { animation-delay: 0.1s; }
        .scroll-fade-in-delay-2 { animation-delay: 0.18s; }
        .scroll-fade-in-delay-3 { animation-delay: 0.26s; }
        .scroll-fade-in-delay-4 { animation-delay: 0.34s; }
      `}</style>
    </div>
  );
}
```

### components/PullToRefreshIndicator.tsx
```tsx
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { RefreshCw } from 'lucide-react';

interface PullToRefreshIndicatorProps {
  pullDistance: number;
  isRefreshing: boolean;
  shouldShow: boolean;
  progress: number;
}

export function PullToRefreshIndicator({
  pullDistance,
  isRefreshing,
  shouldShow,
  progress
}: PullToRefreshIndicatorProps) {
  return (
    <AnimatePresence>
      {shouldShow && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="fixed top-0 left-0 right-0 z-50 flex justify-center pointer-events-none"
          style={{
            transform: `translateY(${Math.min(pullDistance * 0.5, 60)}px)`
          }}
        >
          <div className="mt-4 bg-white/10 backdrop-blur-xl border border-white/20 rounded-full p-3 shadow-lg">
            <motion.div
              animate={{
                rotate: isRefreshing ? 360 : progress * 360
              }}
              transition={{
                duration: isRefreshing ? 1 : 0,
                repeat: isRefreshing ? Infinity : 0,
                ease: "linear"
              }}
            >
              <RefreshCw 
                className={`w-5 h-5 ${isRefreshing ? 'text-emerald-400' : 'text-white'}`}
              />
            </motion.div>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

### components/ReferralProgram.tsx
```tsx
import { motion } from '@/utils/LazyMotionProvider';
import { Copy, Check, Users, Gift, TrendingUp, Share2, X } from 'lucide-react';
import { useState, useEffect, useMemo, useCallback, memo } from 'react';
import { cn } from '@/lib/utils';
import { BronzeMedal, SilverMedal, GoldMedal, PlatinumMedal } from '@/components/icons/GamificationIcons';
import { useTelegram } from '@/hooks/useTelegram';
import { useQuery } from '@tanstack/react-query';
import { useToast } from '@/hooks/use-toast';

interface ReferralStats {
  referralCode: string;
  totalReferrals: number;
  activeReferrals: number;
  totalEarnings: number;
  pendingRewards: number;
  tier: 'Bronze' | 'Silver' | 'Gold' | 'Platinum';
}

interface ReferralProgramProps {
  className?: string;
}

// Memoized Tier Level Component
const TierLevel = memo(({ level, isActive }: { level: any, isActive: boolean }) => {
  const getTierMedalSmall = useCallback((tier: string) => {
    switch (tier) {
      case 'Bronze':
        return <BronzeMedal className="w-10 h-10" />;
      case 'Silver':
        return <SilverMedal className="w-10 h-10" />;
      case 'Gold':
        return <GoldMedal className="w-10 h-10" />;
      case 'Platinum':
        return <PlatinumMedal className="w-10 h-10" />;
      default:
        return <BronzeMedal className="w-10 h-10" />;
    }
  }, []);

  return (
    <div
      className={cn(
        'flex items-center justify-between p-3 rounded-xl transition-all',
        isActive
          ? 'bg-emerald-500/20 border-2 border-emerald-500/50'
          : 'bg-white/5 border border-white/10'
      )}
      data-testid={`tier-${level.tier.toLowerCase()}`}
    >
      <div className="flex items-center gap-3">
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          whileHover={{ scale: 1.1, rotate: 5 }}
        >
          {getTierMedalSmall(level.tier)}
        </motion.div>
        <div>
          <div className="text-white font-semibold">{level.tier}</div>
          <div className="text-white/60 text-xs">{level.referrals} рефералов</div>
        </div>
      </div>
      <div className="text-emerald-400 font-bold">
        {level.commission}
      </div>
    </div>
  );
});
TierLevel.displayName = 'TierLevel';

// Memoized Stats Card Component
const StatsCard = memo(({ icon: Icon, value, label, subtext, iconBg, textColor }: {
  icon: any,
  value: string | number,
  label: string,
  subtext: string,
  iconBg: string,
  textColor: string
}) => (
  <div className="glass-medium rounded-2xl p-4 border border-white/10">
    <div className="flex items-center gap-3 mb-2">
      <div className={cn('w-10 h-10 rounded-xl flex items-center justify-center', iconBg)}>
        <Icon className={cn('w-5 h-5', textColor)} />
      </div>
      <div>
        <div className="text-2xl font-bold text-white">
          {value}
        </div>
        <div className="text-xs text-white/60">
          {label}
        </div>
      </div>
    </div>
    <div className={cn('text-xs font-medium', textColor)}>
      {subtext}
    </div>
  </div>
));
StatsCard.displayName = 'StatsCard';

export function ReferralProgram({ className = '' }: ReferralProgramProps) {
  const { user, initData } = useTelegram();
  const { toast } = useToast();
  const [copied, setCopied] = useState(false);
  const [showReferralInput, setShowReferralInput] = useState(false);
  const [referralCodeInput, setReferralCodeInput] = useState('');

  // Загрузить статистику из API
  const { data: statsData, isLoading, refetch } = useQuery({
    queryKey: ['/api/referrals/stats', user?.id],
    queryFn: async () => {
      if (!user?.id || !initData) return null;
      const res = await fetch(`/api/referrals/stats/${user.id}`, {
        headers: { 'x-telegram-init-data': initData }
      });
      if (!res.ok) throw new Error('Failed to load stats');
      return await res.json();
    },
    enabled: !!user?.id && !!initData,
  });

  const stats: ReferralStats = statsData ? {
    referralCode: statsData.referralCode || '',
    totalReferrals: statsData.totalReferrals || 0,
    activeReferrals: statsData.activeReferrals || 0,
    totalEarnings: parseFloat(statsData.totalEarnings || '0'),
    pendingRewards: parseFloat(statsData.pendingRewards || '0'),
    tier: (statsData.tier || 'Bronze') as 'Bronze' | 'Silver' | 'Gold' | 'Platinum'
  } : {
    referralCode: '',
    totalReferrals: 0,
    activeReferrals: 0,
    totalEarnings: 0,
    pendingRewards: 0,
    tier: 'Bronze'
  };

  // Проверить, есть ли код в URL (Telegram start parameter)
  useEffect(() => {
    if (!statsData && user?.id) {
      const urlParams = new URLSearchParams(window.location.search);
      const startParam = urlParams.get('tgWebAppStartParam');
      if (startParam && startParam.startsWith('WEB4TG')) {
        setReferralCodeInput(startParam);
        setShowReferralInput(true);
      }
    }
  }, [statsData, user?.id]);

  // Применить реферальный код
  const applyReferralCode = useCallback(async () => {
    if (!user?.id || !referralCodeInput || !initData) return;

    try {
      const res = await fetch('/api/referrals/user/init', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'x-telegram-init-data': initData 
        },
        body: JSON.stringify({
          referred_by_code: referralCodeInput,
        }),
      });

      if (!res.ok) {
        throw new Error('Failed to apply referral code');
      }

      setShowReferralInput(false);
      refetch();
      toast({
        title: '✅ Реферальный код применен!',
        description: 'Вы получили приветственный бонус',
      });
    } catch (error) {
      console.error('Error applying referral code:', error);
      toast({
        title: '❌ Ошибка',
        description: 'Не удалось применить код',
        variant: 'destructive',
      });
    }
  }, [user, referralCodeInput, initData, refetch, toast]);

  // Memoized handlers
  const copyReferralCode = useCallback(() => {
    navigator.clipboard.writeText(stats.referralCode);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  }, [stats.referralCode]);

  const shareReferralLink = useCallback(() => {
    const link = `https://t.me/web4tg_bot?start=${stats.referralCode}`;
    if (navigator.share) {
      navigator.share({
        title: 'WEB4TG - Telegram Mini Apps',
        text: 'Присоединяйся к WEB4TG и получи бонусы!',
        url: link
      });
    } else {
      navigator.clipboard.writeText(link);
      setCopied(true);
      setTimeout(() => setCopied(false), 2000);
    }
  }, [stats.referralCode]);

  // Memoized tier color
  const tierColor = useMemo(() => {
    switch (stats.tier) {
      case 'Bronze':
        return 'from-amber-700 to-amber-800';
      case 'Silver':
        return 'from-gray-400 to-gray-500';
      case 'Gold':
        return 'from-amber-400 to-amber-500';
      case 'Platinum':
        return 'from-purple-500 to-purple-600';
    }
  }, [stats.tier]);

  // Memoized tier benefits
  const benefits = useMemo(() => {
    switch (stats.tier) {
      case 'Bronze':
        return { commission: 10, bonus: 100 };
      case 'Silver':
        return { commission: 15, bonus: 200 };
      case 'Gold':
        return { commission: 20, bonus: 500 };
      case 'Platinum':
        return { commission: 30, bonus: 1000 };
    }
  }, [stats.tier]);

  // Memoized tier medal
  const tierMedal = useMemo(() => {
    switch (stats.tier) {
      case 'Bronze':
        return <BronzeMedal className="w-16 h-16" />;
      case 'Silver':
        return <SilverMedal className="w-16 h-16" />;
      case 'Gold':
        return <GoldMedal className="w-16 h-16" />;
      case 'Platinum':
        return <PlatinumMedal className="w-16 h-16" />;
    }
  }, [stats.tier]);

  // Memoized tier levels
  const tierLevels = useMemo(() => [
    { tier: 'Bronze', referrals: '0-9', commission: '10%', color: 'amber-700' },
    { tier: 'Silver', referrals: '10-29', commission: '15%', color: 'gray-400' },
    { tier: 'Gold', referrals: '30-99', commission: '20%', color: 'amber-400' },
    { tier: 'Platinum', referrals: '100+', commission: '30%', color: 'purple-500' },
  ], []);

  // Loading state
  if (isLoading) {
    return (
      <div className="min-h-screen bg-black text-white pb-24 flex items-center justify-center" style={{ paddingTop: '140px' }}>
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mx-auto mb-4"></div>
          <div className="text-white/60">Загрузка...</div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-black text-white pb-24" style={{ paddingTop: '140px' }}>
      <div className={cn('max-w-md mx-auto px-4 py-6 space-y-6', className)} data-testid="referral-program">
        {/* Header */}
        <div className="text-center">
        <motion.div
          initial={{ scale: 0.9, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          className="inline-flex items-center gap-2 mb-3"
        >
          <Users className="w-6 h-6 text-emerald-400" />
          <h2 className="text-2xl font-bold text-white">
            Реферальная программа
          </h2>
        </motion.div>
        <p className="text-white/60 text-sm">
          Приглашайте друзей и зарабатывайте вместе
        </p>
      </div>

      {/* Tier Badge */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className={cn(
          'glass-medium rounded-2xl p-6 border border-white/20 bg-gradient-to-br',
          tierColor
        )}
      >
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-4">
            <motion.div
              initial={{ scale: 0, rotate: -180 }}
              animate={{ scale: 1, rotate: 0 }}
              transition={{ type: "spring", stiffness: 200, damping: 15, delay: 0.2 }}
            >
              {tierMedal}
            </motion.div>
            <div>
              <div className="text-xs font-semibold text-white/80 uppercase tracking-wider mb-1">
                Ваш уровень
              </div>
              <div className="text-2xl font-bold text-white">
                {stats.tier}
              </div>
            </div>
          </div>
          <div className="text-right">
            <div className="text-xs font-semibold text-white/80 uppercase tracking-wider mb-1">
              Комиссия
            </div>
            <div className="text-2xl font-bold text-white">
              {benefits.commission}%
            </div>
          </div>
        </div>

        <div className="grid grid-cols-2 gap-3 text-sm">
          <div className="glass-subtle rounded-xl p-3 text-center">
            <div className="text-white/70 text-xs mb-1">Вы получаете</div>
            <div className="text-white font-bold">100 🪙</div>
          </div>
          <div className="glass-subtle rounded-xl p-3 text-center">
            <div className="text-white/70 text-xs mb-1">Друг получает</div>
            <div className="text-white font-bold">50 🪙</div>
          </div>
        </div>
      </motion.div>

      {/* Referral Code */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.1 }}
        className="glass-medium rounded-2xl p-6 border border-emerald-500/30"
      >
        <div className="text-center mb-4">
          <h3 className="text-lg font-bold text-white mb-1">
            Ваш реферальный код
          </h3>
          <p className="text-sm text-white/60">
            Поделитесь кодом с друзьями
          </p>
        </div>

        <div className="flex items-center gap-3 mb-4">
          <div className="flex-1 glass-subtle rounded-xl px-4 py-4 text-center">
            <div className="text-2xl font-mono font-bold text-emerald-400 tracking-wider">
              {stats.referralCode}
            </div>
          </div>
          <button
            onClick={copyReferralCode}
            className={cn(
              'w-14 h-14 rounded-xl flex items-center justify-center transition-all duration-300 hover:scale-105 active:scale-95',
              copied
                ? 'bg-emerald-500 text-white'
                : 'bg-white/10 text-white hover:bg-white/15'
            )}
            data-testid="button-copy-code"
          >
            {copied ? (
              <Check className="w-6 h-6" />
            ) : (
              <Copy className="w-6 h-6" />
            )}
          </button>
        </div>

        <button
          onClick={shareReferralLink}
          className="w-full px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 transition-all duration-300 hover:scale-105 active:scale-95 flex items-center justify-center gap-2"
          data-testid="button-share-link"
        >
          <Share2 className="w-5 h-5" />
          Поделиться ссылкой
        </button>
      </motion.div>

      {/* Stats Grid */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.2 }}
        className="grid grid-cols-2 gap-3"
      >
        <StatsCard
          icon={Users}
          value={stats.totalReferrals}
          label="Всего рефералов"
          subtext={`${stats.activeReferrals} активных`}
          iconBg="bg-emerald-500/20"
          textColor="text-emerald-400"
        />
        <StatsCard
          icon={Gift}
          value={`${stats.totalEarnings.toLocaleString()} 🪙`}
          label="Всего заработано"
          subtext={`От ${stats.totalReferrals} рефералов`}
          iconBg="bg-amber-500/20"
          textColor="text-amber-400"
        />
      </motion.div>

      {/* How it Works */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.3 }}
        className="glass-subtle rounded-2xl p-6"
      >
        <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
          <TrendingUp className="w-5 h-5 text-emerald-400" />
          Как это работает
        </h3>
        
        <div className="space-y-4">
          <div className="flex gap-4">
            <div className="w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0 text-emerald-400 font-bold text-sm">
              1
            </div>
            <div>
              <div className="text-white font-semibold mb-1">
                Поделитесь кодом
              </div>
              <div className="text-white/60 text-sm">
                Отправьте друзьям ваш уникальный реферальный код
              </div>
            </div>
          </div>

          <div className="flex gap-4">
            <div className="w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0 text-emerald-400 font-bold text-sm">
              2
            </div>
            <div>
              <div className="text-white font-semibold mb-1">
                Друг регистрируется
              </div>
              <div className="text-white/60 text-sm">
                Ваш друг вводит код при регистрации и получает 50 🪙
              </div>
            </div>
          </div>

          <div className="flex gap-4">
            <div className="w-8 h-8 rounded-full bg-emerald-500/20 flex items-center justify-center flex-shrink-0 text-emerald-400 font-bold text-sm">
              3
            </div>
            <div>
              <div className="text-white font-semibold mb-1">
                Получайте вознаграждения
              </div>
              <div className="text-white/60 text-sm">
                Вы получаете 100 🪙 за каждого друга
              </div>
            </div>
          </div>
        </div>
      </motion.div>

      {/* Tier Levels */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ delay: 0.4 }}
        className="glass-subtle rounded-2xl p-6"
      >
        <h3 className="text-lg font-bold text-white mb-4">
          Уровни партнёра
        </h3>
        
        <div className="space-y-3">
          {tierLevels.map((level) => (
            <TierLevel
              key={level.tier}
              level={level}
              isActive={stats.tier === level.tier}
            />
          ))}
        </div>
      </motion.div>

      {/* Кнопка для ввода реферального кода (для пользователей без кода) */}
      {!statsData?.referredByCode && stats.totalReferrals === 0 && (
        <motion.button
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          onClick={() => setShowReferralInput(true)}
          className="w-full px-6 py-3 rounded-xl font-semibold text-white bg-white/10 border border-white/20 hover:bg-white/15 transition-all duration-300 hover:scale-105 active:scale-95"
          data-testid="button-enter-code"
        >
          Есть реферальный код?
        </motion.button>
      )}
    </div>

    {/* Модальное окно для ввода реферального кода */}
    {showReferralInput && (
      <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <motion.div
          initial={{ scale: 0.9, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          className="glass-medium rounded-2xl p-6 border border-white/20 max-w-md w-full"
        >
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-xl font-bold text-white">
              Введите реферальный код
            </h3>
            <button
              onClick={() => setShowReferralInput(false)}
              className="w-8 h-8 rounded-lg bg-white/10 hover:bg-white/20 flex items-center justify-center transition-colors"
              data-testid="button-close-modal"
            >
              <X className="w-5 h-5 text-white" />
            </button>
          </div>

          <p className="text-white/60 text-sm mb-4">
            Если у вас есть реферальный код от друга, введите его ниже, чтобы получить приветственный бонус!
          </p>

          <div className="space-y-4">
            <input
              type="text"
              value={referralCodeInput}
              onChange={(e) => setReferralCodeInput(e.target.value.toUpperCase())}
              placeholder="WEB4TG..."
              className="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder:text-white/40 focus:outline-none focus:border-emerald-500/50 font-mono text-lg tracking-wider"
              data-testid="input-referral-code"
            />

            <div className="flex gap-3">
              <button
                onClick={() => setShowReferralInput(false)}
                className="flex-1 px-6 py-3 rounded-xl font-semibold text-white bg-white/10 border border-white/20 hover:bg-white/15 transition-all duration-300"
                data-testid="button-skip"
              >
                Пропустить
              </button>
              <button
                onClick={applyReferralCode}
                disabled={!referralCodeInput}
                className="flex-1 px-6 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                data-testid="button-apply-code"
              >
                Применить
              </button>
            </div>
          </div>
        </motion.div>
      </div>
    )}
  </div>
  );
}
```

### components/ReviewPage.tsx
```tsx
import { useState, memo } from "react";
import { 
  Star,
  Send,
  CheckCircle,
  User,
  Heart,
  ThumbsUp,
  MessageCircle,
  Award,
  Sparkles,
  TrendingUp,
  Users,
  Clock
} from "lucide-react";
import { BackHeader } from "./BackHeader";

interface ReviewPageProps {
  onBack: () => void;
}

const existingReviews = [
  {
    id: 1,
    name: "Анна Козлова",
    rating: 5,
    date: "3 дня назад",
    comment: "Потрясающий результат! Приложение для моего бутика превзошло все ожидания. Продажи выросли на 180% за первый месяц работы. Клиенты в восторге от удобства заказов прямо в Telegram. Команда работала профессионально, все сроки соблюдены. Однозначно рекомендую!",
    project: "Бутик женской одежды",
    avatar: "https://images.unsplash.com/photo-1494790108755-2616b36b8739?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100&q=80",
    location: "Москва"
  },
  {
    id: 2,
    name: "Михаил Петров",
    rating: 5,
    date: "1 неделю назад", 
    comment: "Заказывал приложение для ресторана доставки. Результат превосходный! Теперь принимаем заказы 24/7 через Telegram, клиенты довольны, персонал тоже. Интеграция с платежами работает без сбоев. Техподдержка отвечает моментально. Планирую заказать ещё одно приложение для второго ресторана.",
    project: "Ресторан \"Вкусная Азия\"",
    avatar: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100&q=80",
    location: "Санкт-Петербург"
  },
  {
    id: 3,
    name: "Елена Смирнова",
    rating: 5,
    date: "2 недели назад",
    comment: "Фитнес-центр получил отличное приложение! Запись на тренировки стала проще, клиенты могут видеть расписание и бронировать места. Очень удобная система уведомлений. Разработчики учли все наши пожелания. Качество на высшем уровне!",
    project: "Фитнес-центр \"Энергия\"",
    avatar: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100&q=80",
    location: "Екатеринбург"
  },
  {
    id: 4,
    name: "Дмитрий Волков",
    rating: 4,
    date: "3 недели назад",
    comment: "Хорошая работа команды! Интернет-магазин электроники работает стабильно. Единственное пожелание - хотелось бы больше возможностей для кастомизации дизайна. В остальном всё отлично - сроки соблюдены, функционал полный, поддержка оперативная.",
    project: "Магазин электроники \"ТехноМир\"",
    avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100&q=80",
    location: "Новосибирск"
  },
  {
    id: 5,
    name: "Ольга Тихонова",
    rating: 5,
    date: "1 месяц назад",
    comment: "Заказывала приложение для салона красоты. Девочки в восторге! Клиенты теперь сами записываются на процедуры, видят свободные окна, получают напоминания. Работа стала намного организованнее. Спасибо за профессионализм!",
    project: "Салон красоты \"Афродита\"",
    avatar: "https://images.unsplash.com/photo-1489424731084-a5d8b219a5bb?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&h=100&q=80",
    location: "Краснодар"
  }
];

const ReviewPage = memo(function ReviewPage({ onBack }: ReviewPageProps) {
  const [rating, setRating] = useState(0);
  const [hoveredRating, setHoveredRating] = useState(0);
  const [comment, setComment] = useState("");
  const [name, setName] = useState("");
  const [company, setCompany] = useState("");
  const [submitted, setSubmitted] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmitReview = async () => {
    if (isFormValid) {
      setIsSubmitting(true);
      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 2000));
      setIsSubmitting(false);
      setSubmitted(true);
    }
  };

  const isFormValid = rating > 0 && comment.trim().length >= 10 && name.trim().length >= 2;

  const renderStars = (currentRating: number, interactive = false, size = "w-6 h-6") => {
    return Array.from({ length: 5 }, (_, index) => {
      const starValue = index + 1;
      const isActive = interactive 
        ? starValue <= (hoveredRating || rating)
        : starValue <= currentRating;
      
      return (
        <button
          key={index}
          className={`transition-all duration-200 ${
            interactive ? 'cursor-pointer' : 'cursor-default'
          }`}
          onClick={interactive ? () => setRating(starValue) : undefined}
          onMouseEnter={interactive ? () => setHoveredRating(starValue) : undefined}
          onMouseLeave={interactive ? () => setHoveredRating(0) : undefined}
          disabled={!interactive}
        >
          <Star
            className={`${size} transition-all duration-200 ${
              isActive
                ? 'text-system-orange fill-current'
                : 'text-quaternary-label'
            } ${interactive && hoveredRating >= starValue ? 'scale-110' : ''}`}
          />
        </button>
      );
    });
  };

  const getRatingText = (rating: number) => {
    switch (rating) {
      case 5: return "Превосходно! ⭐";
      case 4: return "Очень хорошо! 👍";
      case 3: return "Хорошо 👌";
      case 2: return "Удовлетворительно 😐";
      case 1: return "Плохо 😞";
      default: return "";
    }
  };

  if (submitted) {
    return (
      <div className="min-h-screen bg-black text-white safe-area-top">
        <div className="flex items-center justify-center min-h-screen px-4">
          <div className="max-w-sm mx-auto">
            <div className="glass-card p-8 text-center">
              <div className="w-20 h-20 bg-system-green/10 rounded-full flex items-center justify-center mx-auto mb-6">
                <CheckCircle className="w-10 h-10 text-system-green" />
              </div>
              <h2 className="ios-title2 mb-4 text-center">Спасибо за отзыв!</h2>
              <p className="ios-body text-secondary-label mb-6 text-center leading-relaxed">
                Ваша оценка очень важна для нас. Мы учтем ваши комментарии для улучшения сервиса.
              </p>
              <div className="glass-card p-4 bg-system-blue/5 border-system-blue/20 mb-6">
                <div className="flex items-center justify-center space-x-2 text-system-blue">
                  <Sparkles className="w-4 h-4" />
                  <span className="ios-footnote font-semibold">Скидка 10% на следующий проект активирована!</span>
                </div>
              </div>
              <button 
                className="ios-button-filled w-full"
                onClick={onBack}
              >
                Вернуться в профиль
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-black text-white pb-32" style={{ paddingTop: '140px' }}>
      <BackHeader onBack={onBack} title="Оставить отзыв" />

      <div className="max-w-md mx-auto px-4 space-y-6 mt-4">
        {/* Hero Section */}
        <section className="ios-slide-up">
          <div className="glass-card p-6 text-center">
            <div className="w-16 h-16 bg-system-orange/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <Star className="w-8 h-8 text-system-orange" />
            </div>
            <h2 className="ios-title3 mb-2">Расскажите о вашем опыте</h2>
            <p className="ios-body text-secondary-label leading-relaxed">
              Ваше мнение поможет нам стать лучше и поможет другим клиентам сделать выбор
            </p>
          </div>
        </section>

        {/* Rating Section */}
        <section className="ios-slide-up">
          <div className="glass-card p-6">
            <div className="text-center mb-6">
              <h3 className="ios-headline font-semibold mb-4">Оцените качество работы</h3>
              
              {/* Rating Stars */}
              <div className="flex justify-center space-x-2 mb-4">
                {renderStars(rating, true, "w-8 h-8")}
              </div>

              {/* Rating Description */}
              {rating > 0 && (
                <div className="glass-card p-3 bg-system-orange/5 border-system-orange/20">
                  <p className="ios-body font-semibold text-system-orange">
                    {getRatingText(rating)}
                  </p>
                </div>
              )}
            </div>
          </div>
        </section>

        {/* Form Section */}
        <section className="ios-slide-up">
          <div className="glass-card p-6 space-y-6">
            <h3 className="ios-headline font-semibold text-center">Расскажите подробнее</h3>
            
            {/* Name Field */}
            <div className="space-y-2">
              <label className="ios-footnote text-secondary-label font-medium block">
                Ваше имя *
              </label>
              <input
                type="text"
                className="w-full px-4 py-3 border border-white/20 rounded-xl bg-white/10 text-white ios-body transition-all duration-200 focus:border-system-blue focus:ring-1 focus:ring-system-blue/20 focus:outline-none"
                placeholder="Как к вам обращаться?"
                value={name}
                onChange={(e) => setName(e.target.value)}
                maxLength={50}
              />
              <div className="flex justify-between">
                <span className={`ios-caption2 ${name.length >= 2 || name.length === 0 ? 'text-secondary-label' : 'text-system-red'}`}>
                  {name.length > 0 && name.length < 2 ? 'Слишком короткое имя' : 'Минимум 2 символа'}
                </span>
                <span className="ios-caption2 text-secondary-label">{name.length}/50</span>
              </div>
            </div>

            {/* Company Field */}
            <div className="space-y-2">
              <label className="ios-footnote text-secondary-label font-medium block">
                Название компании/проекта
              </label>
              <input
                type="text"
                className="w-full px-4 py-3 border border-white/20 rounded-xl bg-white/10 text-white ios-body transition-all duration-200 focus:border-system-blue focus:ring-1 focus:ring-system-blue/20 focus:outline-none"
                placeholder="Опционально"
                value={company}
                onChange={(e) => setCompany(e.target.value)}
                maxLength={100}
              />
              <div className="text-right">
                <span className="ios-caption2 text-secondary-label">{company.length}/100</span>
              </div>
            </div>

            {/* Comment Field */}
            <div className="space-y-2">
              <label className="ios-footnote text-secondary-label font-medium block">
                Ваш отзыв *
              </label>
              <textarea
                className="w-full px-4 py-3 border border-separator rounded-xl bg-white ios-body transition-all duration-200 focus:border-system-blue focus:ring-1 focus:ring-system-blue/20 focus:outline-none resize-none"
                rows={5}
                placeholder="Поделитесь впечатлениями о работе с нами, качестве результата, соблюдении сроков..."
                value={comment}
                onChange={(e) => setComment(e.target.value)}
                maxLength={500}
              />
              <div className="flex justify-between">
                <span className={`ios-caption2 ${comment.length >= 10 || comment.length === 0 ? 'text-secondary-label' : 'text-system-red'}`}>
                  {comment.length > 0 && comment.length < 10 ? 'Слишком короткий отзыв' : 'Минимум 10 символов'}
                </span>
                <span className="ios-caption2 text-secondary-label">{comment.length}/500</span>
              </div>
            </div>

            {/* Submit Button */}
            <div className="pt-4">
              <button
                className={`w-full py-4 rounded-xl font-semibold ios-body transition-all duration-200 flex items-center justify-center space-x-2 ${
                  isFormValid
                    ? 'bg-system-blue text-white hover:bg-system-blue/90 active:bg-system-blue/80'
                    : 'bg-quaternary-system-fill text-quaternary-label cursor-not-allowed'
                }`}
                onClick={handleSubmitReview}
                disabled={!isFormValid || isSubmitting}
              >
                {isSubmitting ? (
                  <>
                    <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                    <span>Отправляем...</span>
                  </>
                ) : (
                  <>
                    <Send className="w-5 h-5" />
                    <span>Отправить отзыв</span>
                  </>
                )}
              </button>
              
              {!isFormValid && (
                <p className="ios-caption2 text-secondary-label text-center mt-2">
                  Заполните все обязательные поля
                </p>
              )}
            </div>
          </div>
        </section>

        {/* Statistics */}
        <section className="ios-slide-up">
          <div className="glass-card p-6">
            <h3 className="ios-headline font-semibold mb-4 text-center">Доверие клиентов</h3>
            <div className="grid grid-cols-3 gap-4">
              <div className="glass-card p-4 text-center">
                <div className="flex items-center justify-center space-x-1 mb-2">
                  <Star className="w-5 h-5 text-system-orange fill-current" />
                  <span className="ios-title3 font-bold">4.9</span>
                </div>
                <p className="ios-caption1 text-secondary-label font-medium">Средний рейтинг</p>
              </div>
              <div className="glass-card p-4 text-center">
                <div className="flex items-center justify-center space-x-1 mb-2">
                  <MessageCircle className="w-5 h-5 text-system-blue" />
                  <span className="ios-title3 font-bold">127</span>
                </div>
                <p className="ios-caption1 text-secondary-label font-medium">Отзывов</p>
              </div>
              <div className="glass-card p-4 text-center">
                <div className="flex items-center justify-center space-x-1 mb-2">
                  <TrendingUp className="w-5 h-5 text-system-green" />
                  <span className="ios-title3 font-bold">96%</span>
                </div>
                <p className="ios-caption1 text-secondary-label font-medium">Рекомендуют</p>
              </div>
            </div>
          </div>
        </section>

        {/* Recent Reviews */}
        <section className="ios-slide-up">
          <div className="glass-card p-6">
            <h3 className="ios-headline font-semibold mb-6 text-center">Отзывы клиентов</h3>
            <div className="space-y-6">
              {existingReviews.map((review) => (
                <div key={review.id} className="glass-card p-5">
                  <div className="flex items-start space-x-4">
                    <img
                      src={review.avatar}
                      alt={review.name}
                      className="w-12 h-12 rounded-full object-cover border-2 border-white shadow-md"
                    />
                    <div className="flex-1">
                      <div className="flex items-center justify-between mb-2">
                        <div>
                          <div className="ios-body font-semibold">{review.name}</div>
                          <div className="ios-caption1 text-secondary-label">
                            {review.project} • {review.location}
                          </div>
                        </div>
                        <div className="flex items-center space-x-1">
                          <div className="flex space-x-1">
                            {renderStars(review.rating, false, "w-3 h-3")}
                          </div>
                        </div>
                      </div>
                      <p className="ios-footnote text-secondary-label leading-relaxed mb-3">
                        {review.comment}
                      </p>
                      <div className="flex items-center justify-between">
                        <span className="ios-caption2 text-tertiary-label">{review.date}</span>
                        <div className="flex items-center space-x-3">
                          <button className="flex items-center space-x-1 text-tertiary-label hover:text-system-blue transition-colors">
                            <ThumbsUp className="w-3 h-3" />
                            <span className="ios-caption2">Полезно</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </section>

        {/* Incentive */}
        <section className="ios-slide-up">
          <div className="glass-card p-6 bg-gradient-to-r from-system-blue/5 to-system-purple/5 border-system-blue/20">
            <div className="flex items-center space-x-4">
              <div className="w-12 h-12 bg-system-blue/10 rounded-full flex items-center justify-center flex-shrink-0">
                <Sparkles className="w-6 h-6 text-system-blue" />
              </div>
              <div className="flex-1">
                <div className="ios-body font-semibold text-system-blue mb-1">
                  Получите скидку 10%
                </div>
                <div className="ios-footnote text-secondary-label">
                  На следующий проект за честный отзыв
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  );
});

export default ReviewPage;```

### components/SEOHelmet.tsx
```tsx
import { Helmet } from 'react-helmet-async';

interface SEOHelmetProps {
  title?: string;
  description?: string;
  keywords?: string[];
  image?: string;
  url?: string;
  type?: 'website' | 'article' | 'product';
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    section?: string;
    tags?: string[];
  };
  product?: {
    price?: number;
    currency?: string;
    availability?: 'in stock' | 'out of stock' | 'preorder';
    brand?: string;
  };
  jsonLd?: Record<string, any>;
}

export function SEOHelmet({
  title = 'WEB4TG - Telegram Mini Apps для вашего бизнеса',
  description = 'Создайте свой бизнес в Telegram за 24 часа. Более 2,453 успешных предпринимателей уже запустили свои приложения. Рейтинг 4.9/5 ⭐',
  keywords = ['telegram mini app', 'telegram bot', 'веб приложение', 'бизнес в telegram', 'tma', 'web app'],
  image = 'https://web4tg.com/og-image.jpg',
  url,
  type = 'website',
  article,
  product,
  jsonLd
}: SEOHelmetProps) {
  const siteUrl = 'https://web4tg.com';
  const fullUrl = url ? `${siteUrl}${url}` : siteUrl;
  const fullImage = image.startsWith('http') ? image : `${siteUrl}${image}`;

  // Default JSON-LD for Organization
  const defaultJsonLd = {
    '@context': 'https://schema.org',
    '@type': 'Organization',
    name: 'WEB4TG',
    description: 'Платформа для создания Telegram Mini Apps',
    url: siteUrl,
    logo: `${siteUrl}/logo.png`,
    contactPoint: {
      '@type': 'ContactPoint',
      contactType: 'customer support',
      availableLanguage: ['Russian', 'English']
    },
    sameAs: [
      'https://t.me/web4tg',
      'https://github.com/web4tg'
    ]
  };

  // Article JSON-LD
  const articleJsonLd = article ? {
    '@context': 'https://schema.org',
    '@type': 'Article',
    headline: title,
    description: description,
    image: fullImage,
    datePublished: article.publishedTime,
    dateModified: article.modifiedTime || article.publishedTime,
    author: {
      '@type': 'Person',
      name: article.author || 'WEB4TG Team'
    },
    publisher: {
      '@type': 'Organization',
      name: 'WEB4TG',
      logo: {
        '@type': 'ImageObject',
        url: `${siteUrl}/logo.png`
      }
    },
    articleSection: article.section,
    keywords: article.tags?.join(', ')
  } : null;

  // Product JSON-LD
  const productJsonLd = product ? {
    '@context': 'https://schema.org',
    '@type': 'Product',
    name: title,
    description: description,
    image: fullImage,
    brand: {
      '@type': 'Brand',
      name: product.brand || 'WEB4TG'
    },
    offers: {
      '@type': 'Offer',
      price: product.price,
      priceCurrency: product.currency || 'RUB',
      availability: `https://schema.org/${product.availability === 'in stock' ? 'InStock' : 'OutOfStock'}`
    }
  } : null;

  const finalJsonLd = jsonLd || articleJsonLd || productJsonLd || defaultJsonLd;

  return (
    <Helmet>
      {/* Basic Meta Tags */}
      <title>{title}</title>
      <meta name="description" content={description} />
      {keywords.length > 0 && (
        <meta name="keywords" content={keywords.join(', ')} />
      )}
      <meta name="author" content="WEB4TG" />
      <link rel="canonical" href={fullUrl} />

      {/* Open Graph / Facebook */}
      <meta property="og:type" content={type} />
      <meta property="og:url" content={fullUrl} />
      <meta property="og:title" content={title} />
      <meta property="og:description" content={description} />
      <meta property="og:image" content={fullImage} />
      <meta property="og:image:width" content="1200" />
      <meta property="og:image:height" content="630" />
      <meta property="og:site_name" content="WEB4TG" />
      <meta property="og:locale" content="ru_RU" />
      <meta property="og:locale:alternate" content="en_US" />

      {/* Article specific OG tags */}
      {article && (
        <>
          {article.publishedTime && (
            <meta property="article:published_time" content={article.publishedTime} />
          )}
          {article.modifiedTime && (
            <meta property="article:modified_time" content={article.modifiedTime} />
          )}
          {article.author && (
            <meta property="article:author" content={article.author} />
          )}
          {article.section && (
            <meta property="article:section" content={article.section} />
          )}
          {article.tags && article.tags.map((tag, index) => (
            <meta key={index} property="article:tag" content={tag} />
          ))}
        </>
      )}

      {/* Twitter Card */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:url" content={fullUrl} />
      <meta name="twitter:title" content={title} />
      <meta name="twitter:description" content={description} />
      <meta name="twitter:image" content={fullImage} />
      <meta name="twitter:site" content="@web4tg" />
      <meta name="twitter:creator" content="@web4tg" />

      {/* Additional Meta Tags */}
      <meta name="robots" content="index, follow" />
      <meta name="googlebot" content="index, follow" />
      <meta name="revisit-after" content="7 days" />
      <meta httpEquiv="Content-Language" content="ru" />
      
      {/* Mobile App Meta Tags */}
      <meta name="mobile-web-app-capable" content="yes" />
      <meta name="apple-mobile-web-app-capable" content="yes" />
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
      <meta name="apple-mobile-web-app-title" content="WEB4TG" />
      
      {/* Theme Color */}
      <meta name="theme-color" content="#10b981" />
      <meta name="msapplication-navbutton-color" content="#10b981" />
      <meta name="apple-mobile-web-app-status-bar-style" content="#10b981" />

      {/* JSON-LD Structured Data */}
      <script type="application/ld+json">
        {JSON.stringify(finalJsonLd)}
      </script>
    </Helmet>
  );
}

// Preset SEO configurations
export const SEOPresets = {
  home: {
    title: 'WEB4TG - Запустите бизнес в Telegram за 24 часа',
    description: 'Создайте свой бизнес в Telegram за 24 часа. Более 2,453 успешных предпринимателей уже запустили свои приложения. Рейтинг 4.9/5 ⭐',
    keywords: ['telegram mini app', 'telegram бизнес', 'создать приложение telegram', 'tma', 'web app telegram'],
  },
  
  showcases: {
    title: 'Демо-приложения - WEB4TG',
    description: 'Изучите 30+ готовых демо-приложений для различных бизнесов: магазины одежды, рестораны, фитнес-центры и многое другое. Получите вдохновение для своего проекта.',
    keywords: ['демо приложения telegram', 'примеры tma', 'шаблоны telegram bot', 'готовые решения'],
  },
  
  projects: {
    title: 'Портфолио проектов - WEB4TG',
    description: 'Посмотрите реальные кейсы наших клиентов. 1200+ успешных проектов, +340% средний рост прибыли. Ваш проект может быть следующим!',
    keywords: ['портфолио telegram', 'кейсы tma', 'успешные проекты telegram', 'примеры работ'],
  },
  
  aiAgent: {
    title: 'AI Агент для бизнеса - WEB4TG',
    description: 'Умный AI ассистент для вашего бизнеса в Telegram. Автоматизация продаж, 24/7 поддержка, персонализация и аналитика. Увеличьте конверсию на 85%!',
    keywords: ['ai agent telegram', 'telegram chatbot', 'ai ассистент', 'автоматизация продаж', 'бизнес бот'],
  }
};
```

### components/ShowcasePage.tsx
```tsx
import { Smartphone, ShoppingCart, Code, Star, Users, ArrowRight, Zap, TrendingUp } from "lucide-react";
import React, { useState, useRef, useEffect, useCallback, memo, useMemo } from "react";
import { m } from 'framer-motion';
import { MotionStagger, MotionBox, HoverScale } from './MotionWrapper';
import { useTelegram } from '../hooks/useTelegram';
import { useHaptic } from '../hooks/useHaptic';
import { useTrackInteraction } from '@/hooks/useAIRecommendations';
import { LazyVideo } from './LazyVideo';
import { useVideoLazyLoad } from '../hooks/useVideoLazyLoad';
import { useVideoPreload } from '../hooks/useVideoPreload';
import { preloadDemo } from './demos/DemoRegistry';
import nikeDestinyImage from "@assets/1a589b27fba1af47b8e9957accf246dd_1763654490139.jpg";
import nikeGreenImage from "@assets/f4f7105a6604aa1ca214f4fb48a515ac_1763654563855.jpg";
import nikeAcgImage from "@assets/acc835fff3bb452f0c3b534056fbe1ea_1763719574494.jpg";
import rascalImage from "@assets/e81eb2add9c19398a4711b33670141ec_1763720062375.jpg";

const fashionVideo = "/videos/4e4993d0ac079a607a0bee301af06749_1761775010830.mp4";
const sneakerVideo = "/videos/ae01958370d099047455d799eba60389_1762352751328.mp4";
const watchesVideo = "/videos/ac56ea9bc8429fb2f0ffacfac0abe74d_1762353025450.mp4";
const heroVideo = "/videos/1341996d8f73172cbc77930dc818d88e_t4_1763643600785.mp4";

interface ShowcasePageProps {
  onNavigate: (section: string) => void;
  onOpenDemo: (demoId: string) => void;
}

function ShowcasePage({ onNavigate, onOpenDemo }: ShowcasePageProps) {
  const { hapticFeedback, isDark, colorScheme, devicePerformance } = useTelegram();
  const haptic = useHaptic();
  const trackInteraction = useTrackInteraction();
  
  const videoRef2 = useVideoPreload();
  const videoRef3 = useVideoLazyLoad();
  
  const handleOpenDemo = useCallback((demoId: string) => {
    haptic.light();
    onOpenDemo(demoId);
  }, [haptic, onOpenDemo]);

  return (
    <div className="min-h-screen bg-black text-white overflow-x-hidden relative">
      <div className="max-w-md mx-auto min-h-screen px-3 pb-4 relative z-10" style={{ paddingTop: '120px' }}>
        
        <div className="relative rounded-2xl overflow-hidden mb-6"
          style={{ boxShadow: '0 20px 60px rgba(0, 0, 0, 0.4)' }}
        >
          <div className="relative rounded-2xl overflow-hidden" style={{ background: '#000000' }}>
            <LazyVideo
              src={heroVideo}
              className="absolute inset-0 w-full h-full object-cover opacity-80"
              autoPlay
              loop
              muted
              playsInline
              preload="none"
            />
            
            <div className="absolute inset-0"
              style={{ background: 'linear-gradient(to bottom, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.5) 100%)' }}
            />
          
            <div className="relative px-4 py-10 text-center flex items-center justify-center min-h-[38vh]">
              <div 
                className="relative rounded-2xl px-5 py-5 mx-auto w-full max-w-[260px]"
                style={{
                  background: 'rgba(0, 0, 0, 0.25)',
                  backdropFilter: 'blur(12px)',
                  WebkitBackdropFilter: 'blur(12px)',
                  border: '1px solid rgba(255, 255, 255, 0.1)'
                }}
              >
                <div 
                  className="inline-block px-3 py-1 rounded-full mb-3 text-[10px] font-bold tracking-wider"
                  style={{
                    background: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
                    color: '#FFFFFF'
                  }}
                >
                  +300% К ПРОДАЖАМ
                </div>
                
                <h1 className="text-xl font-black mb-1.5" style={{ color: '#FFFFFF', letterSpacing: '-0.02em' }}>
                  ВАШИ КЛИЕНТЫ
                </h1>
                
                <div 
                  className="text-base font-bold tracking-wide mb-2"
                  style={{
                    background: 'linear-gradient(135deg, #10B981 0%, #34D399 100%)',
                    WebkitBackgroundClip: 'text',
                    WebkitTextFillColor: 'transparent',
                    backgroundClip: 'text'
                  }}
                >
                  УЖЕ В TELEGRAM
                </div>
                
                <p className="text-[11px] font-medium" style={{ color: 'rgba(255, 255, 255, 0.7)' }}>
                  Получайте заказы 24/7 без сайта
                </p>
              </div>
            </div>
          </div>
        </div>

        <div className="space-y-3 mb-8">
          
          {/* Main Hero Card - White/Light style like T-P67 */}
          <div 
            className="relative rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
            onClick={() => handleOpenDemo('clothing-store')}
            onMouseEnter={() => preloadDemo('clothing-store')}
            onTouchStart={() => preloadDemo('clothing-store')}
            data-testid="demo-card-clothing"
            style={{ 
              background: 'linear-gradient(180deg, #F5F5F7 0%, #E8E8ED 100%)',
              boxShadow: '0 4px 20px rgba(0, 0, 0, 0.15)'
            }}
          >
            <div className="p-5 pb-4">
              {/* Header with logo */}
              <div className="flex items-start justify-between mb-4">
                <div className="text-2xl font-black tracking-tight" style={{ color: '#1D1D1F' }}>
                  ALURE
                </div>
                {/* Decorative tribal-style icon */}
                <svg width="40" height="32" viewBox="0 0 40 32" fill="none" className="opacity-80">
                  <path d="M20 4C20 4 12 8 8 16C4 24 8 28 8 28M20 4C20 4 28 8 32 16C36 24 32 28 32 28M20 4V12M14 20C14 20 17 24 20 24C23 24 26 20 26 20" stroke="#1D1D1F" strokeWidth="1.5" strokeLinecap="round"/>
                  <circle cx="20" cy="16" r="2" fill="#1D1D1F"/>
                </svg>
              </div>
              
              {/* Warning section */}
              <div className="text-center mb-4">
                <div className="text-[10px] font-bold tracking-[0.2em] mb-2" style={{ color: '#1D1D1F' }}>
                  МАГАЗИН В TELEGRAM
                </div>
                <p className="text-[9px] leading-relaxed px-2" style={{ color: 'rgba(29, 29, 31, 0.6)' }}>
                  АВТОМАТИЧЕСКИЕ ПРОДАЖИ. КАТАЛОГ ТОВАРОВ. КОРЗИНА И ОПЛАТА. 
                  ИНТЕГРАЦИЯ С CRM. УВЕДОМЛЕНИЯ О ЗАКАЗАХ. БЕЗ САЙТА И ПРИЛОЖЕНИЯ.
                </p>
              </div>
              
              {/* Price and CTA */}
              <div 
                className="flex items-center justify-between rounded-full px-4 py-2.5 mt-3"
                style={{ background: 'rgba(29, 29, 31, 0.08)' }}
              >
                <span className="text-sm font-semibold" style={{ color: '#1D1D1F' }}>от 9 990 ₽</span>
                <div className="flex items-center gap-1.5 text-[11px] font-bold" style={{ color: '#1D1D1F' }}>
                  <span>ОТКРЫТЬ</span>
                  <ArrowRight className="w-3.5 h-3.5" />
                </div>
              </div>
            </div>
          </div>

          {/* 2x2 Grid - Dark cards with images */}
          <div className="grid grid-cols-2 gap-3">
            {/* ART STORE style card */}
            <div 
              className="relative h-[180px] rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
              onClick={() => handleOpenDemo('sneaker-store')}
              onMouseEnter={() => preloadDemo('sneaker-store')}
              onTouchStart={() => preloadDemo('sneaker-store')}
              data-testid="demo-card-sneaker"
              style={{ background: '#1C1C1E' }}
            >
              <video
                ref={videoRef2}
                src={sneakerVideo}
                loop muted playsInline preload="none"
                className="absolute inset-0 w-full h-full object-cover opacity-90 transition-transform duration-500 group-hover:scale-105"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent" />
              
              <div className="absolute bottom-0 left-0 right-0 p-4">
                <div className="text-[10px] font-medium tracking-[0.15em] uppercase" style={{ color: 'rgba(255,255,255,0.7)' }}>
                  SNEAKER STORE
                </div>
              </div>
            </div>

            {/* SOUND SHOP style card - Blue tinted */}
            <div 
              className="relative h-[180px] rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
              onClick={() => handleOpenDemo('luxury-watches')}
              onMouseEnter={() => preloadDemo('luxury-watches')}
              onTouchStart={() => preloadDemo('luxury-watches')}
              data-testid="demo-card-watches"
              style={{ background: '#4A5568' }}
            >
              <video
                ref={videoRef3}
                src={watchesVideo}
                loop muted playsInline preload="none"
                className="absolute inset-0 w-full h-full object-cover opacity-80 transition-transform duration-500 group-hover:scale-105"
                style={{ filter: 'saturate(0.8) brightness(0.9)' }}
              />
              <div className="absolute inset-0" style={{ background: 'rgba(59, 130, 246, 0.15)' }} />
              <div className="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent" />
              
              <div className="absolute bottom-0 left-0 right-0 p-4">
                <div className="text-[10px] font-medium tracking-[0.15em] uppercase" style={{ color: 'rgba(255,255,255,0.7)' }}>
                  LUXURY WATCHES
                </div>
              </div>
            </div>
          </div>

          {/* Bottom Row - Colored cards */}
          <div className="grid grid-cols-2 gap-3">
            {/* Olive/Khaki card like T-P67 DISCOVER */}
            <div 
              className="relative h-[180px] rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
              onClick={() => handleOpenDemo('futuristic-fashion-1')}
              onMouseEnter={() => preloadDemo('futuristic-fashion-1')}
              onTouchStart={() => preloadDemo('futuristic-fashion-1')}
              data-testid="demo-card-outdoor"
              style={{ background: 'linear-gradient(180deg, #6B7B5C 0%, #5A6A4D 100%)' }}
            >
              <div className="absolute inset-0 flex flex-col items-center justify-center p-4">
                <div className="text-xl font-black tracking-tight mb-2 text-white">
                  RASCAL
                </div>
                {/* Star icon */}
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" className="mb-4 opacity-80">
                  <path d="M12 2L14 10H22L16 14L18 22L12 18L6 22L8 14L2 10H10L12 2Z" stroke="white" strokeWidth="1.5" fill="none"/>
                </svg>
                
                {/* DISCOVER button */}
                <div 
                  className="px-6 py-2 rounded-full text-[10px] font-bold tracking-wider transition-all duration-200 active:scale-95"
                  style={{ 
                    background: 'rgba(0, 0, 0, 0.25)',
                    color: '#FFFFFF',
                    border: '1px solid rgba(255, 255, 255, 0.2)'
                  }}
                >
                  ОТКРЫТЬ
                </div>
              </div>
            </div>

            {/* Dark gray card like MUSIC CLUB */}
            <div 
              className="relative h-[180px] rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
              onClick={() => handleOpenDemo('futuristic-fashion-2')}
              onMouseEnter={() => preloadDemo('futuristic-fashion-2')}
              onTouchStart={() => preloadDemo('futuristic-fashion-2')}
              data-testid="demo-card-minimal"
              style={{ background: 'linear-gradient(180deg, #3A3A3C 0%, #2C2C2E 100%)' }}
            >
              {/* Arrow icon in top right */}
              <div 
                className="absolute top-4 right-4 w-8 h-8 rounded-full flex items-center justify-center"
                style={{ background: 'rgba(255, 255, 255, 0.1)', border: '1px solid rgba(255, 255, 255, 0.15)' }}
              >
                <ArrowRight className="w-3.5 h-3.5 text-white -rotate-45" />
              </div>
              
              <div className="absolute bottom-0 left-0 right-0 p-4">
                <div className="text-sm font-bold text-white mb-0.5">FASHION STORE</div>
                <div className="text-sm font-bold text-white mb-0.5">CATALOG</div>
                <div className="text-[10px] font-medium tracking-wider" style={{ color: 'rgba(255,255,255,0.5)' }}>
                  MOSCOW/DUBAI
                </div>
              </div>
            </div>
          </div>

          {/* Additional row - More cards */}
          <div className="grid grid-cols-2 gap-3">
            {/* Brand card */}
            <div 
              className="relative h-[180px] rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
              onClick={() => handleOpenDemo('futuristic-fashion-3')}
              onMouseEnter={() => preloadDemo('futuristic-fashion-3')}
              onTouchStart={() => preloadDemo('futuristic-fashion-3')}
              data-testid="demo-card-brand"
              style={{ background: '#1C1C1E' }}
            >
              <img
                src={nikeGreenImage}
                alt="Brand"
                loading="lazy"
                className="absolute inset-0 w-full h-full object-cover opacity-85 transition-transform duration-500 group-hover:scale-105"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent" />
              
              <div className="absolute bottom-0 left-0 right-0 p-4">
                <div className="text-[10px] font-medium tracking-[0.15em] uppercase" style={{ color: 'rgba(255,255,255,0.7)' }}>
                  BRAND STORE
                </div>
              </div>
            </div>

            {/* Catalog card */}
            <div 
              className="relative h-[180px] rounded-3xl overflow-hidden group cursor-pointer transition-transform duration-300 active:scale-[0.98]"
              onClick={() => handleOpenDemo('futuristic-fashion-4')}
              onMouseEnter={() => preloadDemo('futuristic-fashion-4')}
              onTouchStart={() => preloadDemo('futuristic-fashion-4')}
              data-testid="demo-card-catalog"
              style={{ background: '#1C1C1E' }}
            >
              <img
                src={nikeAcgImage}
                alt="Catalog"
                loading="lazy"
                className="absolute inset-0 w-full h-full object-cover opacity-85 transition-transform duration-500 group-hover:scale-105"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent" />
              
              <div className="absolute bottom-0 left-0 right-0 p-4">
                <div className="text-[10px] font-medium tracking-[0.15em] uppercase" style={{ color: 'rgba(255,255,255,0.7)' }}>
                  OUTDOOR GEAR
                </div>
              </div>
            </div>
          </div>

        </div>

        <MotionStagger className="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-6 px-1">
          
          <MotionBox variant="fadeInScale">
            <HoverScale scale={1.02}>
              <div 
                className="sm:col-span-2 relative rounded-2xl p-4 sm:p-6 cursor-pointer overflow-hidden group tg-interactive"
                style={{
                  background: 'linear-gradient(135deg, #10B981 0%, #059669 100%)',
                  boxShadow: '0 8px 32px rgba(16, 185, 129, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.1)'
                }}
                onClick={() => onNavigate('projects')}
                data-testid="card-main-services"
              >
                <div className="absolute inset-0 opacity-20"
                  style={{ background: 'radial-gradient(circle at 30% 30%, rgba(59, 130, 246, 0.4) 0%, transparent 70%)' }}
                />
                
                <div className="absolute top-3 sm:top-4 left-3 sm:left-4 z-10">
                  <div className="w-7 sm:w-9 h-7 sm:h-9 text-black" style={{ filter: 'drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2))' }}>
                    <Star className="w-full h-full" fill="currentColor" />
                  </div>
                </div>
                
                <div className="relative text-black text-[72px] sm:text-[96px] font-black leading-none mb-1 sm:mb-2 tracking-tighter"
                  style={{ textShadow: '2px 2px 0px rgba(0, 0, 0, 0.1)' }}
                >
                  24ч
                </div>
                
                <div className="relative text-black font-black text-xl sm:text-2xl mb-0.5 sm:mb-1 tracking-tight">
                  ДО ЗАПУСКА
                </div>
                
                <div className="relative text-black/70 text-xs sm:text-sm font-medium">
                  Пока конкуренты думают - вы продаете
                </div>
                
                <div className="absolute bottom-3 sm:bottom-4 left-3 sm:left-4 px-2.5 sm:px-3 py-1 sm:py-1.5 rounded-full"
                  style={{ background: 'rgba(0, 0, 0, 0.2)', backdropFilter: 'blur(10px)' }}
                >
                  <span className="text-white text-[10px] sm:text-xs font-bold tracking-wide whitespace-nowrap">WEB4TG.AGENCY</span>
                </div>
              </div>
            </HoverScale>
          </MotionBox>

          <MotionBox variant="fadeInUp">
            <HoverScale scale={1.05}>
              <div 
                className="relative rounded-3xl p-4 cursor-pointer overflow-hidden group tg-interactive"
                style={{
                  background: 'linear-gradient(135deg, #3B82F6 0%, #2563EB 100%)',
                  boxShadow: '0 4px 20px rgba(59, 130, 246, 0.3)'
                }}
                onClick={() => handleOpenDemo('clothing-store')}
                data-testid="card-telegram-apps"
              >
                <div className="absolute top-3 right-3 px-2 py-1 rounded-full"
                  style={{ background: 'rgba(255, 255, 255, 0.2)', backdropFilter: 'blur(10px)' }}
                >
                  <span className="text-white text-[10px] font-bold tracking-wide">УДАЛЕННО</span>
                </div>
                
                <div className="text-black text-3xl font-thin mb-2" style={{ fontFamily: 'Inter, sans-serif', letterSpacing: '3px' }}>1/4</div>
                
                <div className="w-8 h-8 bg-black rounded-lg flex items-center justify-center mb-3">
                  <Smartphone className="w-5 h-5" style={{ color: '#10B981' }} />
                </div>
                
                <div className="space-y-2">
                  <h3 className="text-black text-lg font-bold leading-tight">Магазин в Telegram</h3>
                  <p className="text-black/70 text-xs leading-tight mb-2">Клиенты покупают прямо в чате. Без сайта, без приложения</p>
                  <p className="text-black/60 text-sm font-medium">ОТ 49 000 Р</p>
                </div>
              </div>
            </HoverScale>
          </MotionBox>

          <MotionBox variant="fadeInUp" delay={0.1}>
            <HoverScale scale={1.05}>
              <div 
                className="relative bg-white/15 border border-white/20 rounded-3xl p-4 cursor-pointer tg-interactive"
                style={{ boxShadow: '0 8px 24px rgba(0, 0, 0, 0.3)' }}
                onClick={() => handleOpenDemo('electronics')}
              >
                <div className="absolute top-3 right-3 bg-white/20 text-white text-xs px-2 py-1 rounded-full font-medium">
                  ХИТ
                </div>
                
                <div className="text-white text-2xl font-black mb-2">x3</div>
                
                <div className="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center mb-3">
                  <ShoppingCart className="w-5 h-5 text-white" />
                </div>
                
                <div className="space-y-2">
                  <h3 className="text-white text-lg font-bold leading-tight">Рост продаж</h3>
                  <p className="text-white/70 text-xs leading-tight mb-2">Автоматические продажи пока вы спите</p>
                  <p className="text-white/60 text-sm font-medium">ГАРАНТИЯ</p>
                </div>
              </div>
            </HoverScale>
          </MotionBox>

          <MotionBox variant="fadeInUp" delay={0.15}>
            <HoverScale scale={1.05}>
              <div 
                className="relative bg-white/15 border border-white/20 rounded-3xl p-4 cursor-pointer tg-interactive"
                style={{ boxShadow: '0 8px 24px rgba(0, 0, 0, 0.3)' }}
                onClick={() => handleOpenDemo('beauty')}
              >
                <div className="absolute top-3 right-3 bg-white/20 text-white text-xs px-2 py-1 rounded-full font-medium">
                  AI
                </div>
                
                <div className="text-white text-2xl font-black mb-2">24/7</div>
                
                <div className="w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center mb-3">
                  <Code className="w-5 h-5 text-white" />
                </div>
                
                <div className="space-y-2">
                  <h3 className="text-white text-lg font-bold leading-tight">AI-Ассистент</h3>
                  <p className="text-white/70 text-xs leading-tight mb-2">Отвечает клиентам, принимает заказы за вас</p>
                  <p className="text-white/60 text-sm font-medium">ВКЛЮЧЕНО</p>
                </div>
              </div>
            </HoverScale>
          </MotionBox>

          <MotionBox variant="fadeInUp" delay={0.2}>
            <HoverScale scale={1.05}>
              <div 
                className="relative rounded-3xl p-4 cursor-pointer tg-interactive"
                style={{ backgroundColor: '#10B981' }}
                onClick={() => onNavigate('projects')}
              >
                <div className="absolute top-3 right-3 bg-black/20 text-black text-xs px-2 py-1 rounded-full font-medium">
                  КЕЙСЫ
                </div>
                
                <div className="text-black text-3xl font-thin mb-2" style={{ fontFamily: 'Inter, sans-serif', letterSpacing: '3px' }}>127+</div>
                
                <div className="w-8 h-8 bg-black rounded-lg flex items-center justify-center mb-3">
                  <Users className="w-5 h-5" style={{ color: '#10B981' }} />
                </div>
                
                <div className="space-y-2">
                  <h3 className="text-black text-lg font-bold leading-tight">Довольных клиентов</h3>
                  <p className="text-black/70 text-xs leading-tight mb-2">Реальные результаты. Смотрите сами</p>
                  <p className="text-black/60 text-sm font-medium">ОТЗЫВЫ</p>
                </div>
              </div>
            </HoverScale>
          </MotionBox>

        </MotionStagger>
        
      </div>
    </div>
  );
}

export default React.memo(ShowcasePage);
```

### components/SkipToContent.tsx
```tsx
export function SkipToContent() {
  return (
    <a
      href="#main-content"
      className="sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[9999] focus:px-4 focus:py-2 focus:bg-emerald-500 focus:text-white focus:rounded-lg focus:shadow-lg"
      tabIndex={0}
    >
      Skip to main content
    </a>
  );
}
```

### components/SmartSearch.tsx
```tsx
import { useState, useEffect, useRef, useCallback } from 'react';
import { Search, X, Clock } from 'lucide-react';

interface SearchSuggestion {
  id: string;
  text: string;
  category?: string;
}

interface SmartSearchProps {
  value: string;
  onChange: (value: string) => void;
  suggestions?: SearchSuggestion[];
  placeholder?: string;
  onSuggestionClick?: (suggestion: SearchSuggestion) => void;
  className?: string;
}

export function SmartSearch({
  value,
  onChange,
  suggestions = [],
  placeholder = 'Поиск...',
  onSuggestionClick,
  className = ''
}: SmartSearchProps) {
  const [isFocused, setIsFocused] = useState(false);
  const [recentSearches, setRecentSearches] = useState<string[]>([]);
  const inputRef = useRef<HTMLInputElement>(null);
  const debounceRef = useRef<NodeJS.Timeout>();

  // Load recent searches from localStorage
  useEffect(() => {
    const saved = localStorage.getItem('recentSearches');
    if (saved) {
      try {
        setRecentSearches(JSON.parse(saved));
      } catch (e) {
        console.error('Failed to load recent searches:', e);
      }
    }
  }, []);

  // Debounced onChange
  const handleInputChange = useCallback((newValue: string) => {
    if (debounceRef.current) {
      clearTimeout(debounceRef.current);
    }

    debounceRef.current = setTimeout(() => {
      onChange(newValue);
    }, 300);
  }, [onChange]);

  const handleClear = () => {
    onChange('');
    inputRef.current?.focus();
  };

  const handleSuggestionClick = (suggestion: SearchSuggestion) => {
    onChange(suggestion.text);
    
    // Save to recent searches
    const updated = [
      suggestion.text,
      ...recentSearches.filter(s => s !== suggestion.text)
    ].slice(0, 5);
    
    setRecentSearches(updated);
    localStorage.setItem('recentSearches', JSON.stringify(updated));
    
    if (onSuggestionClick) {
      onSuggestionClick(suggestion);
    }
    
    setIsFocused(false);
  };

  const handleRecentSearchClick = (search: string) => {
    onChange(search);
    setIsFocused(false);
  };

  const clearRecentSearches = () => {
    setRecentSearches([]);
    localStorage.removeItem('recentSearches');
  };

  const showDropdown = isFocused && (suggestions.length > 0 || recentSearches.length > 0);

  return (
    <div className={`relative ${className}`}>
      {/* Search Input */}
      <div className="relative glass-medium rounded-2xl overflow-hidden">
        <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" />
        <input
          ref={inputRef}
          type="text"
          placeholder={placeholder}
          className="w-full pl-12 pr-12 py-4 bg-transparent text-white placeholder-white/40 focus:outline-none text-base"
          value={value}
          onChange={(e) => {
            onChange(e.target.value);
            handleInputChange(e.target.value);
          }}
          onFocus={() => setIsFocused(true)}
          onBlur={() => setTimeout(() => setIsFocused(false), 200)}
          data-testid="input-smart-search"
        />
        {value && (
          <button
            onClick={handleClear}
            className="absolute right-4 top-1/2 -translate-y-1/2 text-white/40 hover:text-white transition-colors"
            data-testid="button-clear-search"
          >
            <X className="w-5 h-5" />
          </button>
        )}
      </div>

      {/* Dropdown with Suggestions */}
      {showDropdown && (
        <div className="absolute top-full left-0 right-0 mt-2 glass-strong rounded-2xl p-2 max-h-80 overflow-y-auto z-50">
          {/* Suggestions */}
          {suggestions.length > 0 && (
            <div className="mb-2">
              <div className="px-3 py-2 text-white/60 text-xs font-medium">
                Предложения
              </div>
              {suggestions.map((suggestion) => (
                <button
                  key={suggestion.id}
                  onClick={() => handleSuggestionClick(suggestion)}
                  className="w-full px-3 py-3 text-left hover-elevate active-elevate-2 rounded-xl transition-colors"
                  data-testid={`suggestion-${suggestion.id}`}
                >
                  <div className="flex items-center gap-3">
                    <Search className="w-4 h-4 text-emerald-400" />
                    <div className="flex-1">
                      <div className="text-white text-sm font-medium">
                        {suggestion.text}
                      </div>
                      {suggestion.category && (
                        <div className="text-white/50 text-xs">
                          {suggestion.category}
                        </div>
                      )}
                    </div>
                  </div>
                </button>
              ))}
            </div>
          )}

          {/* Recent Searches */}
          {recentSearches.length > 0 && (
            <div>
              <div className="flex items-center justify-between px-3 py-2">
                <div className="text-white/60 text-xs font-medium">
                  Недавние поиски
                </div>
                <button
                  onClick={clearRecentSearches}
                  className="text-white/40 hover:text-white text-xs"
                  data-testid="button-clear-recent"
                >
                  Очистить
                </button>
              </div>
              {recentSearches.map((search, index) => (
                <button
                  key={index}
                  onClick={() => handleRecentSearchClick(search)}
                  className="w-full px-3 py-3 text-left hover-elevate active-elevate-2 rounded-xl transition-colors"
                  data-testid={`recent-search-${index}`}
                >
                  <div className="flex items-center gap-3">
                    <Clock className="w-4 h-4 text-white/40" />
                    <div className="text-white text-sm">
                      {search}
                    </div>
                  </div>
                </button>
              ))}
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

### components/TasksEarningPage.tsx
```tsx
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { useState, useEffect, useMemo, useCallback, memo } from 'react';
import { Coins, CheckCircle, Heart, Share2, Eye, Users, MessageCircle, ArrowLeft, Sparkles, Award } from 'lucide-react';
import { Progress } from '@/components/ui/progress';
import { Badge } from '@/components/ui/badge';
import { cn } from '@/lib/utils';
import { useTelegram } from '@/hooks/useTelegram';

interface Task {
  id: string;
  platform: 'tiktok' | 'instagram';
  type: 'like' | 'follow' | 'share' | 'view' | 'comment';
  title: string;
  description: string;
  coins: number;
  url: string;
  completed: boolean;
  verificationStatus?: 'pending' | 'verifying' | 'verified' | 'failed';
  attempts?: number;
  minimumTime?: number;
}

interface UserBalance {
  totalCoins: number;
  availableCoins: number;
  tasksCompleted: number;
  currentStreak: number;
}

const discountTiers = [
  { coins: 500, discount: 5, label: '5% скидка' },
  { coins: 1000, discount: 10, label: '10% скидка' },
  { coins: 2000, discount: 15, label: '15% скидка' },
  { coins: 3500, discount: 20, label: '20% скидка' },
  { coins: 5000, discount: 25, label: '25% скидка' }
];

// Расширенный список заданий - 20 штук
const allTasks: Task[] = [
  // TikTok задания
  {
    id: 'tiktok_follow',
    platform: 'tiktok',
    type: 'follow',
    title: 'Подписка на TikTok',
    description: 'Подпишитесь на наш TikTok аккаунт',
    coins: 150,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 5
  },
  {
    id: 'tiktok_like_1',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк видео о МиниАппах',
    description: 'Поставьте лайк нашему видео про создание Telegram приложений',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 8
  },
  {
    id: 'tiktok_like_2',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк видео про AI',
    description: 'Лайкните видео о возможностях искусственного интеллекта',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 8
  },
  {
    id: 'tiktok_like_3',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк туториала',
    description: 'Поставьте лайк обучающему видео по созданию ботов',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 8
  },
  {
    id: 'tiktok_share_1',
    platform: 'tiktok',
    type: 'share',
    title: 'Репост в TikTok',
    description: 'Поделитесь нашим видео о заработке с ТГ ботами',
    coins: 100,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 10
  },
  {
    id: 'tiktok_comment_1',
    platform: 'tiktok',
    type: 'comment',
    title: 'Комментарий в TikTok',
    description: 'Оставьте комментарий под любым нашим видео',
    coins: 75,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 15
  },
  {
    id: 'tiktok_comment_2',
    platform: 'tiktok',
    type: 'comment',
    title: 'Второй комментарий TikTok',
    description: 'Прокомментируйте еще одно наше видео',
    coins: 75,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 15
  },
  {
    id: 'tiktok_view_1',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр TikTok',
    description: 'Досмотрите до конца видео про разработку',
    coins: 30,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 10
  },
  {
    id: 'tiktok_view_2',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр лайфхаков',
    description: 'Посмотрите видео с лайфхаками по Telegram',
    coins: 30,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 10
  },
  {
    id: 'tiktok_view_3',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр кейсов',
    description: 'Изучите наши успешные кейсы в видео',
    coins: 30,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 10
  },
  
  // Instagram задания
  {
    id: 'instagram_follow',
    platform: 'instagram',
    type: 'follow',
    title: 'Подписка на Instagram',
    description: 'Подпишитесь на наш Instagram аккаунт',
    coins: 120,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 4
  },
  {
    id: 'instagram_like_1',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк поста в Instagram',
    description: 'Лайкните наш пост про новые функции',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 6
  },
  {
    id: 'instagram_like_2',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Reels',
    description: 'Поставьте лайк нашему Reels',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 6
  },
  {
    id: 'instagram_like_3',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк фото проекта',
    description: 'Лайкните фото одного из наших проектов',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 6
  },
  {
    id: 'instagram_share_1',
    platform: 'instagram',
    type: 'share',
    title: 'Stories репост',
    description: 'Поделитесь нашим постом в своих Stories',
    coins: 80,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 8
  },
  {
    id: 'instagram_comment_1',
    platform: 'instagram',
    type: 'comment',
    title: 'Комментарий в Instagram',
    description: 'Прокомментируйте наш пост',
    coins: 60,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 12
  },
  {
    id: 'instagram_comment_2',
    platform: 'instagram',
    type: 'comment',
    title: 'Второй комментарий',
    description: 'Оставьте комментарий под другим постом',
    coins: 60,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 12
  },
  {
    id: 'instagram_view_1',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр Instagram Reels',
    description: 'Посмотрите наш Reels о МиниАппах',
    coins: 25,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 8
  },
  {
    id: 'instagram_view_2',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр портфолио',
    description: 'Посмотрите нашу галерею работ в Stories',
    coins: 25,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 8
  },
  {
    id: 'instagram_view_3',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр обзора',
    description: 'Изучите обзор наших услуг в Reels',
    coins: 25,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 8
  }
];

interface TasksEarningPageProps {
  onNavigate: (section: string) => void;
}

// Минималистичная Task Card с черным жидким стеклом
const MinimalTaskCard = memo(({ task, onTaskClick, isVerifying }: { 
  task: Task, 
  onTaskClick: (task: Task) => void,
  isVerifying: boolean 
}) => {
  const getTaskIcon = () => {
    switch (task.type) {
      case 'like': return <Heart className="w-4 h-4" />;
      case 'follow': return <Users className="w-4 h-4" />;
      case 'share': return <Share2 className="w-4 h-4" />;
      case 'view': return <Eye className="w-4 h-4" />;
      case 'comment': return <MessageCircle className="w-4 h-4" />;
      default: return <Sparkles className="w-4 h-4" />;
    }
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      className={cn(
        'group relative rounded-xl p-4 cursor-pointer transition-all duration-300',
        'backdrop-blur-xl border',
        task.completed
          ? 'bg-emerald-500/10 border-emerald-500/30'
          : 'bg-black/40 border-white/10 hover:border-white/30 hover:bg-black/60'
      )}
      onClick={() => !task.completed && !isVerifying && onTaskClick(task)}
      data-testid={`task-${task.id}`}
    >
      <div className="flex items-center justify-between gap-3">
        <div className="flex items-center gap-3 flex-1 min-w-0">
          <div className={cn(
            'w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 transition-all',
            task.platform === 'tiktok' 
              ? 'bg-gradient-to-br from-pink-500/20 to-purple-500/20 border border-pink-500/30 text-pink-400'
              : 'bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30 text-purple-400'
          )}>
            {getTaskIcon()}
          </div>
          
          <div className="flex-1 min-w-0">
            <h3 className="text-white font-medium text-sm mb-0.5 truncate">{task.title}</h3>
            <p className="text-white/50 text-xs truncate">{task.description}</p>
          </div>
        </div>
        
        <div className="flex flex-col items-end gap-1.5 flex-shrink-0">
          <div className="flex items-center gap-1">
            <Coins className="w-3.5 h-3.5 text-amber-400" />
            <span className="text-amber-400 font-bold text-sm">+{task.coins}</span>
          </div>
          
          {task.completed ? (
            <Badge variant="outline" className="text-[10px] h-5 bg-emerald-500/20 text-emerald-400 border-emerald-500/50">
              <CheckCircle className="w-2.5 h-2.5 mr-1" />
              Готово
            </Badge>
          ) : task.verificationStatus === 'failed' ? (
            <Badge variant="outline" className="text-[10px] h-5 bg-red-500/20 text-red-400 border-red-500/50">
              Ошибка
            </Badge>
          ) : isVerifying ? (
            <Badge variant="outline" className="text-[10px] h-5 bg-blue-500/20 text-blue-400 border-blue-500/50">
              Проверка...
            </Badge>
          ) : null}
        </div>
      </div>
    </motion.div>
  );
});
MinimalTaskCard.displayName = 'MinimalTaskCard';

// Анимированный прогресс-бар
const AnimatedProgressBar = memo(({ value, max, label }: { value: number, max: number, label: string }) => {
  const percentage = Math.min((value / max) * 100, 100);
  
  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between text-xs">
        <span className="text-white/60">{label}</span>
        <span className="text-emerald-400 font-semibold">{value} / {max}</span>
      </div>
      
      <div className="relative h-2 bg-white/5 rounded-full overflow-hidden backdrop-blur-sm">
        <motion.div
          className="absolute inset-y-0 left-0 bg-gradient-to-r from-emerald-500 to-teal-400 rounded-full"
          initial={{ width: 0 }}
          animate={{ width: `${percentage}%` }}
          transition={{ duration: 1, ease: "easeOut" }}
        >
          <motion.div
            className="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent"
            animate={{
              x: ['-100%', '200%'],
            }}
            transition={{
              duration: 1.5,
              repeat: Infinity,
              ease: "linear",
            }}
          />
        </motion.div>
      </div>
    </div>
  );
});
AnimatedProgressBar.displayName = 'AnimatedProgressBar';

export function TasksEarningPage({ onNavigate }: TasksEarningPageProps) {
  const { user, initData, hapticFeedback } = useTelegram();
  const [balance, setBalance] = useState<UserBalance>({
    totalCoins: 0,
    availableCoins: 0,
    tasksCompleted: 0,
    currentStreak: 0
  });
  const [tasks, setTasks] = useState<Task[]>(allTasks);
  const [loading, setLoading] = useState(true);
  const [verifyingTask, setVerifyingTask] = useState<string | null>(null);

  useEffect(() => {
    const loadUserData = async () => {
      if (!user?.id || !initData) {
        setLoading(false);
        return;
      }

      try {
        const balanceRes = await fetch('/api/tasks/balance', {
          headers: { 'X-Telegram-Init-Data': initData }
        });
        const balanceData = await balanceRes.json();
        setBalance({
          totalCoins: balanceData.totalCoins || 0,
          availableCoins: balanceData.availableCoins || 0,
          tasksCompleted: balanceData.tasksCompleted || 0,
          currentStreak: balanceData.currentStreak || 0
        });

        const progressRes = await fetch('/api/tasks/progress', {
          headers: { 'X-Telegram-Init-Data': initData }
        });
        const progressData = await progressRes.json();

        setTasks(prev => prev.map(task => {
          const progress = progressData.find((p: any) => p.taskId === task.id);
          if (progress) {
            return {
              ...task,
              completed: progress.completed,
              verificationStatus: progress.verificationStatus,
              attempts: progress.attempts
            };
          }
          return task;
        }));
      } catch (error) {
        console.error('Error loading user data:', error);
      } finally {
        setLoading(false);
      }
    };

    loadUserData();
  }, [user?.id, initData]);

  const handleTaskClick = async (task: Task) => {
    if (!user?.id || !initData || task.completed || task.verificationStatus === 'failed') {
      hapticFeedback.heavy();
      return;
    }

    hapticFeedback.light();
    
    try {
      const startRes = await fetch('/api/tasks/start', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'X-Telegram-Init-Data': initData
        },
        body: JSON.stringify({
          task_id: task.id,
          platform: task.platform,
          task_type: task.type,
          coins_reward: task.coins
        })
      });

      if (!startRes.ok) {
        const error = await startRes.json();
        console.error('Error starting task:', error);
        if (startRes.status === 429) {
          hapticFeedback.heavy();
          alert(`Подождите ${error.retry_after} секунд.`);
        }
        return;
      }

      setTasks(prev => prev.map(t => 
        t.id === task.id ? { ...t, verificationStatus: 'verifying' } : t
      ));

      window.open(task.url, '_blank');

      const minimumTime = task.minimumTime || 5;
      setVerifyingTask(task.id);

      setTimeout(async () => {
        try {
          const verifyRes = await fetch('/api/tasks/verify', {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'X-Telegram-Init-Data': initData
            },
            body: JSON.stringify({ task_id: task.id })
          });

          const verifyData = await verifyRes.json();

          if (verifyData.verified) {
            hapticFeedback.selection();
            
            setTasks(prev => prev.map(t =>
              t.id === task.id ? { ...t, completed: true, verificationStatus: 'verified' } : t
            ));

            setBalance(prev => ({
              ...prev,
              totalCoins: verifyData.new_balance,
              availableCoins: verifyData.new_balance,
              tasksCompleted: prev.tasksCompleted + 1
            }));
          } else {
            hapticFeedback.heavy();
            setTasks(prev => prev.map(t=>
              t.id === task.id ? { ...t, verificationStatus: 'failed' } : t
            ));
          }
        } catch (error) {
          console.error('Error verifying task:', error);
          hapticFeedback.heavy();
        } finally {
          setVerifyingTask(null);
        }
      }, minimumTime * 1000 + 2000);

    } catch (error) {
      console.error('Error handling task click:', error);
      hapticFeedback.heavy();
    }
  };

  const tiktokTasks = useMemo(() => tasks.filter(t => t.platform === 'tiktok'), [tasks]);
  const instagramTasks = useMemo(() => tasks.filter(t => t.platform === 'instagram'), [tasks]);
  
  const nextTier = useMemo(() => 
    discountTiers.find(tier => balance.totalCoins < tier.coins),
    [balance.totalCoins]
  );
  
  const currentDiscount = useMemo(() => 
    [...discountTiers].reverse().find(tier => balance.totalCoins >= tier.coins),
    [balance.totalCoins]
  );

  if (loading) {
    return (
      <div className="min-h-screen bg-black text-white flex items-center justify-center">
        <div className="text-center">
          <div className="w-12 h-12 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-4" />
          <p className="text-white/60">Загрузка...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-black text-white">
      <div className="max-w-md mx-auto px-4 py-6 space-y-4 pb-24">
        
        {/* Back Button */}
        <button 
          onClick={() => {
            hapticFeedback.light();
            onNavigate('profile');
          }}
          className="flex items-center gap-2 text-white/70 hover:text-white transition-colors"
          data-testid="button-back"
        >
          <ArrowLeft className="w-5 h-5" />
          <span className="text-sm">Назад</span>
        </button>

        {/* Header */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="text-center"
        >
          <h1 className="text-3xl font-bold text-white mb-2 flex items-center justify-center gap-2">
            <Coins className="w-8 h-8 text-amber-400" />
            Заработок монет
          </h1>
          <p className="text-white/60 text-sm">
            Выполняйте задания и получайте скидки до 25%
          </p>
        </motion.div>

        {/* Balance Card - Минималистичное черное жидкое стекло */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="relative rounded-2xl overflow-hidden backdrop-blur-xl bg-black/40 border border-white/10 p-6"
          data-testid="balance-card"
        >
          {/* Gradient Glow */}
          <div className="absolute inset-0 bg-gradient-to-br from-emerald-500/10 via-transparent to-transparent pointer-events-none" />
          
          <div className="relative z-10">
            <div className="flex items-center justify-between mb-6">
              <div>
                <div className="text-xs text-white/50 uppercase tracking-wider mb-1">Баланс</div>
                <div className="flex items-baseline gap-2">
                  <span className="text-4xl font-bold text-white">{balance.totalCoins}</span>
                  <Coins className="w-6 h-6 text-amber-400" />
                </div>
              </div>
              
              <motion.div
                className="w-14 h-14 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center"
                animate={{ rotate: [0, 5, -5, 0] }}
                transition={{ duration: 2, repeat: Infinity, repeatDelay: 1 }}
              >
                <Coins className="w-7 h-7 text-white" />
              </motion.div>
            </div>

            <div className="grid grid-cols-3 gap-2 mb-4">
              <div className="bg-white/5 backdrop-blur-sm rounded-lg p-2.5 border border-white/10 text-center">
                <div className="text-white/50 text-[10px] mb-0.5">Заработано</div>
                <div className="text-white font-bold text-sm">{balance.totalCoins}</div>
              </div>
              <div className="bg-white/5 backdrop-blur-sm rounded-lg p-2.5 border border-white/10 text-center">
                <div className="text-white/50 text-[10px] mb-0.5">Выполнено</div>
                <div className="text-white font-bold text-sm">{balance.tasksCompleted}</div>
              </div>
              <div className="bg-white/5 backdrop-blur-sm rounded-lg p-2.5 border border-white/10 text-center">
                <div className="text-white/50 text-[10px] mb-0.5">Стрик</div>
                <div className="text-white font-bold text-sm">{balance.currentStreak} 🔥</div>
              </div>
            </div>

            {/* Animated Progress to Next Tier */}
            {nextTier && (
              <div className="bg-white/5 backdrop-blur-sm rounded-lg p-3 border border-white/10">
                <AnimatedProgressBar 
                  value={balance.totalCoins}
                  max={nextTier.coins}
                  label={`До ${nextTier.label}`}
                />
              </div>
            )}
          </div>
        </motion.div>

        {/* How it Works - Минималистично */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="backdrop-blur-xl bg-black/40 border border-white/10 rounded-xl p-4"
        >
          <h3 className="text-sm font-bold text-white mb-3 flex items-center gap-2">
            <Sparkles className="w-4 h-4 text-emerald-400" />
            Как это работает
          </h3>
          
          <div className="space-y-2.5">
            <div className="flex items-center gap-2.5">
              <div className="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center flex-shrink-0 border border-blue-500/30">
                <span className="text-sm">⚡</span>
              </div>
              <div>
                <div className="text-xs font-medium text-white">Выполняйте задания</div>
                <div className="text-[10px] text-white/50">TikTok и Instagram</div>
              </div>
            </div>
            
            <div className="flex items-center gap-2.5">
              <div className="w-8 h-8 bg-amber-500/20 rounded-lg flex items-center justify-center flex-shrink-0 border border-amber-500/30">
                <Coins className="w-4 h-4 text-amber-400" />
              </div>
              <div>
                <div className="text-xs font-medium text-white">Получайте монеты</div>
                <div className="text-[10px] text-white/50">25-150 за задание</div>
              </div>
            </div>
            
            <div className="flex items-center gap-2.5">
              <div className="w-8 h-8 bg-emerald-500/20 rounded-lg flex items-center justify-center flex-shrink-0 border border-emerald-500/30">
                <Award className="w-4 h-4 text-emerald-400" />
              </div>
              <div>
                <div className="text-xs font-medium text-white">Получайте скидки</div>
                <div className="text-[10px] text-white/50">До 25% на разработку</div>
              </div>
            </div>
          </div>
        </motion.div>

        {/* TikTok Tasks */}
        {tiktokTasks.length > 0 && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="backdrop-blur-xl bg-black/40 border border-white/10 rounded-xl p-4"
          >
            <h3 className="text-sm font-bold text-white mb-3 flex items-center gap-2">
              <span className="text-lg">🎵</span>
              TikTok задания
            </h3>
            
            <div className="space-y-2">
              {tiktokTasks.map((task) => (
                <MinimalTaskCard
                  key={task.id}
                  task={task}
                  onTaskClick={handleTaskClick}
                  isVerifying={verifyingTask === task.id}
                />
              ))}
            </div>
          </motion.div>
        )}

        {/* Instagram Tasks */}
        {instagramTasks.length > 0 && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="backdrop-blur-xl bg-black/40 border border-white/10 rounded-xl p-4"
          >
            <h3 className="text-sm font-bold text-white mb-3 flex items-center gap-2">
              <span className="text-lg">📷</span>
              Instagram задания
            </h3>
            
            <div className="space-y-2">
              {instagramTasks.map((task) => (
                <MinimalTaskCard
                  key={task.id}
                  task={task}
                  onTaskClick={handleTaskClick}
                  isVerifying={verifyingTask === task.id}
                />
              ))}
            </div>
          </motion.div>
        )}

        {/* Discount Tiers - Минималистично */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="backdrop-blur-xl bg-black/40 border border-white/10 rounded-xl p-4"
        >
          <h3 className="text-sm font-bold text-white mb-3 flex items-center gap-2">
            <Award className="w-4 h-4 text-emerald-400" />
            Скидки
          </h3>
          <div className="space-y-1.5">
            {discountTiers.map((tier, index) => (
              <div 
                key={index}
                className={cn(
                  'flex items-center justify-between p-2.5 rounded-lg transition-all text-xs',
                  balance.totalCoins >= tier.coins 
                    ? 'bg-emerald-500/20 border border-emerald-500/30' 
                    : 'bg-white/5 border border-white/10'
                )}
              >
                <span className="text-white/60">{tier.coins} монет</span>
                <span className={cn(
                  'font-bold',
                  balance.totalCoins >= tier.coins ? 'text-emerald-400' : 'text-white/40'
                )}>
                  {tier.label}
                  {balance.totalCoins >= tier.coins && ' ✓'}
                </span>
              </div>
            ))}
          </div>
        </motion.div>

      </div>
    </div>
  );
}
```

### components/TasksPage.tsx
```tsx
import { useState } from "react";
import { 
  Coins, 
  Heart, 
  Share2, 
  Eye, 
  Play,
  Gift,
  Instagram,
  Target,
  Sparkles,
  Trophy,
  CheckCircle,
  ArrowLeft,
  Star,
  TrendingUp,
  Users,
  MessageCircle,
  Clock,
  Shield,
  Zap,
  DollarSign,
  Award
} from "lucide-react";
import StickyGlassHeader from "./ui/StickyGlassHeader";
import { useRewards } from "../contexts/RewardsContext";

interface TasksPageProps {
  onNavigate: (section: string) => void;
}

const discountTiers = [
  { coins: 500, discount: 5, label: '5% скидка' },
  { coins: 1000, discount: 10, label: '10% скидка' },
  { coins: 2000, discount: 15, label: '15% скидка' },
  { coins: 3500, discount: 20, label: '20% скидка' },
  { coins: 5000, discount: 25, label: '25% скидка' }
];

export default function TasksPage({ onNavigate }: TasksPageProps) {
  const { userStats, tasks, completeTask, startTask, verifyTask } = useRewards();
  const [selectedTab, setSelectedTab] = useState<'tasks' | 'rewards'>('tasks');
  const [activeTask, setActiveTask] = useState<string | null>(null);
  const [showExchangeModal, setShowExchangeModal] = useState(false);
  const [verificationMessage, setVerificationMessage] = useState<string>('');

  const handleTaskClick = async (task: any) => {
    if (task.completed || task.verificationStatus === 'failed') return;
    
    // Check cooldown
    if (task.lastAttempt && Date.now() - task.lastAttempt < 30000) {
      setVerificationMessage('Слишком частые попытки. Подождите 30 секунд.');
      return;
    }
    
    // Check attempt limit
    if ((task.attempts || 0) >= 3) {
      setVerificationMessage('Превышен лимит попыток для этого задания.');
      return;
    }
    
    setActiveTask(task.id);
    startTask(task.id);
    setVerificationMessage('Задание началось. Выполните действие и вернитесь сюда...');
    
    // Open social media link
    window.open(task.url, '_blank');
    
    // Start verification timer
    const verificationTimer = setTimeout(async () => {
      const success = await verifyTask(task.id);
      setActiveTask(null);
      
      if (success) {
        setVerificationMessage(`Отлично! Вы получили ${task.coins} монет за выполнение задания.`);
      } else {
        const currentTask = tasks.find(t => t.id === task.id);
        if (currentTask?.verificationStatus === 'failed') {
          if ((currentTask.attempts || 0) >= 3) {
            setVerificationMessage('Задание заблокировано из-за превышения лимита попыток.');
          } else {
            setVerificationMessage('Задание не выполнено. Убедитесь, что провели достаточно времени на странице.');
          }
        }
      }
      
      // Clear message after 5 seconds
      setTimeout(() => setVerificationMessage(''), 5000);
    }, (task.minimumTime || 5) * 1000 + 2000); // Add 2 seconds buffer
    
    // Handle user returning early
    const handleVisibilityChange = () => {
      if (!document.hidden && activeTask === task.id) {
        // User returned to tab, trigger verification
        clearTimeout(verificationTimer);
        setTimeout(async () => {
          const success = await verifyTask(task.id);
          setActiveTask(null);
          
          if (success) {
            setVerificationMessage(`Отлично! Вы получили ${task.coins} монет за выполнение задания.`);
          } else {
            setVerificationMessage('Задание не выполнено. Проведите больше времени на странице.');
          }
          
          setTimeout(() => setVerificationMessage(''), 5000);
        }, 1000);
      }
    };
    
    document.addEventListener('visibilitychange', handleVisibilityChange);
    
    // Cleanup
    setTimeout(() => {
      document.removeEventListener('visibilitychange', handleVisibilityChange);
    }, 60000); // Remove listener after 1 minute
  };

  const getTaskIcon = (type: string, platform: string) => {
    if (platform === 'instagram') {
      switch (type) {
        case 'like': return <Heart className="w-5 h-5" />;
        case 'follow': return <Users className="w-5 h-5" />;
        case 'share': return <Share2 className="w-5 h-5" />;
        case 'comment': return <MessageCircle className="w-5 h-5" />;
        case 'view': return <Eye className="w-5 h-5" />;
        default: return <Eye className="w-5 h-5" />;
      }
    } else {
      switch (type) {
        case 'like': return <Heart className="w-5 h-5" />;
        case 'follow': return <Users className="w-5 h-5" />;
        case 'share': return <Share2 className="w-5 h-5" />;
        case 'comment': return <MessageCircle className="w-5 h-5" />;
        case 'view': return <Play className="w-5 h-5" />;
        default: return <Eye className="w-5 h-5" />;
      }
    }
  };

  const getAvailableDiscount = () => {
    const tier = discountTiers
      .slice()
      .reverse()
      .find(tier => userStats.totalCoins >= tier.coins);
    return tier || null;
  };

  const getNextTier = () => {
    const nextTier = discountTiers.find(tier => userStats.totalCoins < tier.coins);
    return nextTier;
  };

  return (
    <div className="min-h-screen bg-black text-white relative">
      {/* Mobile Container */}
      <div className="max-w-md mx-auto bg-black min-h-screen relative pb-32">
        <StickyGlassHeader />
        
        {/* Header */}
        <div className="pt-24 px-6 pb-6">
          <button 
            onClick={() => onNavigate('')}
            className="flex items-center text-gray-600 hover:text-gray-900 transition-colors mb-6"
          >
            <ArrowLeft className="w-5 h-5 mr-2" />
            <span className="font-medium">Назад</span>
          </button>
          
          <div className="text-center mb-8">
            <div className="inline-flex items-center bg-green-50 rounded-full px-4 py-2 mb-6">
              <Gift className="w-4 h-4 text-green-600 mr-2" />
              <span className="text-sm font-medium text-green-600">Заработайте скидку до 25%</span>
            </div>
            
            <h1 className="text-3xl font-bold text-gray-900 mb-4">
              Задания за монеты
            </h1>
            
            <p className="text-lg text-gray-600 mb-6">
              Выполняйте простые действия в социальных сетях и получайте реальные скидки на разработку
            </p>
          </div>
        </div>

        {/* How it works */}
        <div className="px-6 py-6 bg-gray-50 mx-6 rounded-3xl mb-8">
          <h2 className="text-xl font-bold text-gray-900 mb-4 text-center">Как это работает</h2>
          
          <div className="space-y-4">
            <div className="flex items-center space-x-4">
              <div className="w-10 h-10 bg-blue-100 rounded-2xl flex items-center justify-center">
                <Zap className="w-5 h-5 text-blue-600" />
              </div>
              <div>
                <h3 className="font-semibold text-gray-900">Выполняйте задания</h3>
                <p className="text-sm text-gray-600">Лайки, подписки, просмотры в TikTok и Instagram</p>
              </div>
            </div>
            
            <div className="flex items-center space-x-4">
              <div className="w-10 h-10 bg-yellow-100 rounded-2xl flex items-center justify-center">
                <Coins className="w-5 h-5 text-yellow-600" />
              </div>
              <div>
                <h3 className="font-semibold text-gray-900">Получайте монеты</h3>
                <p className="text-sm text-gray-600">От 40 до 300 монет за каждое задание</p>
              </div>
            </div>
            
            <div className="flex items-center space-x-4">
              <div className="w-10 h-10 bg-green-100 rounded-2xl flex items-center justify-center">
                <DollarSign className="w-5 h-5 text-green-600" />
              </div>
              <div>
                <h3 className="font-semibold text-gray-900">Обменивайте на скидки</h3>
                <p className="text-sm text-gray-600">До 25% скидки на разработку приложений</p>
              </div>
            </div>
          </div>
        </div>

        {/* Current Status */}
        <div className="px-6 mb-8">
          <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-3xl p-6">
            <div className="text-center mb-4">
              <h3 className="text-lg font-bold text-gray-900 mb-2">Ваша статистика</h3>
            </div>
            
            <div className="grid grid-cols-2 gap-4 mb-4">
              <div className="text-center bg-white rounded-2xl py-4">
                <div className="text-2xl font-bold text-gray-900">{userStats.totalCoins}</div>
                <div className="text-sm text-gray-600">Монет заработано</div>
              </div>
              <div className="text-center bg-white rounded-2xl py-4">
                <div className="text-2xl font-bold text-gray-900">{userStats.tasksCompleted}</div>
                <div className="text-sm text-gray-600">Заданий выполнено</div>
              </div>
            </div>
            
            <button 
              onClick={() => setShowExchangeModal(true)}
              className="w-full bg-black text-white py-3 rounded-2xl font-semibold hover:bg-gray-800 transition-colors flex items-center justify-center"
            >
              <Award className="w-5 h-5 mr-2" />
              Обменять на скидку
            </button>
          </div>
        </div>

        {/* Available Discounts Preview */}
        {userStats.totalCoins >= 500 && (
          <div className="px-6 mb-8">
            <div className="bg-green-50 border border-green-200 rounded-2xl p-4">
              <div className="flex items-center justify-between">
                <div>
                  <h3 className="font-semibold text-green-800">У вас достаточно монет!</h3>
                  <p className="text-sm text-green-600">Обменяйте на скидку до {getAvailableDiscount()?.discount}%</p>
                </div>
                <Trophy className="w-8 h-8 text-green-600" />
              </div>
            </div>
          </div>
        )}

        {/* Verification Message */}
        {verificationMessage && (
          <div className="mx-6 mb-6 p-4 bg-blue-50 border border-blue-200 rounded-2xl">
            <p className="text-blue-800 text-center font-medium">{verificationMessage}</p>
          </div>
        )}

        {/* Tasks List */}
        <div className="px-6 space-y-4 mb-8">
          <h2 className="text-xl font-bold text-gray-900 text-center mb-6">Доступные задания</h2>
          
          {tasks.map((task, index) => {
            const isBlocked = task.verificationStatus === 'failed' && (task.attempts || 0) >= 3;
            const isOnCooldown = task.lastAttempt && Date.now() - task.lastAttempt < 30000;
            
            return (
              <div key={task.id} className={`relative bg-white border-2 border-gray-100 rounded-2xl p-5 transition-all ${
                task.completed ? 'bg-green-50 border-green-200' : 
                isBlocked ? 'opacity-40 cursor-not-allowed' :
                isOnCooldown ? 'opacity-70 cursor-wait' :
                'cursor-pointer hover:border-gray-200 hover:shadow-lg'
              }`} onClick={() => !task.completed && !isBlocked && !isOnCooldown && handleTaskClick(task)}>
                
                {/* Status Badge */}
                <div className="absolute top-4 right-4">
                  {isBlocked && (
                    <div className="bg-red-100 text-red-700 text-xs px-3 py-1 rounded-full font-medium">
                      Заблокировано
                    </div>
                  )}
                  
                  {isOnCooldown && !task.completed && (
                    <div className="bg-yellow-100 text-yellow-700 text-xs px-3 py-1 rounded-full font-medium">
                      Ожидание
                    </div>
                  )}
                  
                  {task.verificationStatus === 'verifying' && (
                    <div className="bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full font-medium animate-pulse">
                      Проверка
                    </div>
                  )}

                  {task.completed && (
                    <div className="bg-green-100 text-green-700 text-xs px-3 py-1 rounded-full font-medium flex items-center">
                      <CheckCircle className="w-3 h-3 mr-1" />
                      Выполнено
                    </div>
                  )}
                  
                  {!task.completed && !isBlocked && !isOnCooldown && task.verificationStatus !== 'verifying' && (
                    <div className="bg-yellow-100 text-yellow-700 text-xs px-3 py-1 rounded-full font-medium flex items-center">
                      <Coins className="w-3 h-3 mr-1" />
                      +{task.coins}
                    </div>
                  )}
                </div>

                {/* Task Content */}
                <div className="pr-20">
                  <div className="flex items-center space-x-4 mb-3">
                    {/* Platform Icon */}
                    <div className={`w-12 h-12 rounded-2xl flex items-center justify-center ${
                      task.completed ? 'bg-green-500' :
                      task.platform === 'instagram' ? 'bg-pink-500' : 
                      'bg-gray-900'
                    } text-white`}>
                      {task.completed ? <CheckCircle className="w-6 h-6" /> : getTaskIcon(task.type, task.platform)}
                    </div>
                    
                    {/* Task Info */}
                    <div className="flex-1">
                      <h3 className="text-lg font-semibold text-gray-900 mb-1">{task.title}</h3>
                      <p className="text-gray-600 text-sm">{task.description}</p>
                    </div>
                  </div>

                  {/* Task Meta */}
                  <div className="flex items-center space-x-4 text-sm text-gray-500">
                    {task.timeLimit && (
                      <span className="flex items-center">
                        <Clock className="w-3 h-3 mr-1" />
                        {task.timeLimit} мин
                      </span>
                    )}
                    {task.minimumTime && !task.completed && (
                      <span className="flex items-center">
                        <Shield className="w-3 h-3 mr-1" />
                        Мин. {task.minimumTime}с
                      </span>
                    )}
                    {(task.attempts || 0) > 0 && !task.completed && (
                      <span className="flex items-center">
                        <Target className="w-3 h-3 mr-1" />
                        {task.attempts}/3 попыток
                      </span>
                    )}
                    {activeTask === task.id && (
                      <span className="text-blue-600 font-medium animate-pulse">
                        Выполняется...
                      </span>
                    )}
                  </div>
                </div>
              </div>
            );
          })}
        </div>

        {/* Exchange Modal */}
        {showExchangeModal && (
          <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div className="bg-white rounded-3xl p-6 max-w-sm w-full max-h-[80vh] overflow-y-auto">
              <div className="text-center mb-6">
                <h3 className="text-2xl font-bold text-gray-900 mb-2">Обменять монеты</h3>
                <p className="text-gray-600">У вас есть {userStats.totalCoins} монет</p>
              </div>
              
              <div className="space-y-4 mb-6">
                {discountTiers.map((tier, index) => {
                  const canAfford = userStats.totalCoins >= tier.coins;
                  return (
                    <div key={index} className={`p-4 rounded-2xl border-2 transition-all ${
                      canAfford ? 'border-green-500 bg-green-50' : 'border-gray-200 bg-gray-50 opacity-60'
                    }`}>
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="font-bold text-lg">{tier.label}</div>
                          <div className="text-sm text-gray-600">{tier.coins} монет</div>
                        </div>
                        <button 
                          disabled={!canAfford}
                          className={`px-4 py-2 rounded-xl font-bold transition-all ${
                            canAfford ? 'bg-green-500 text-white hover:bg-green-600' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                          }`}
                        >
                          {canAfford ? 'Обменять' : 'Недостаточно'}
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
              
              <button 
                onClick={() => setShowExchangeModal(false)}
                className="w-full bg-gray-500 text-white py-3 rounded-2xl font-bold hover:bg-gray-600 transition-all"
              >
                Закрыть
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}```

### components/UserAvatar.tsx
```tsx
import { memo } from 'react';
import { CircleUser } from 'lucide-react';

interface UserAvatarProps {
  photoUrl?: string;
  firstName?: string;
  size?: 'sm' | 'md' | 'lg';
  className?: string;
}

const UserAvatar = memo<UserAvatarProps>(({ photoUrl, firstName, size = 'md', className = '' }) => {
  const sizeClasses = {
    sm: 'w-8 h-8 text-xs',
    md: 'w-10 h-10 text-sm',
    lg: 'w-12 h-12 text-base',
  };

  const iconSizes = {
    sm: 'w-4 h-4',
    md: 'w-5 h-5',
    lg: 'w-6 h-6',
  };

  // If we have a photo URL, show the image
  if (photoUrl) {
    return (
      <div className={`${sizeClasses[size]} rounded-full overflow-hidden border-2 border-white/30 ${className}`}>
        <img 
          src={photoUrl} 
          alt={firstName || 'User'} 
          className="w-full h-full object-cover"
          loading="lazy"
        />
      </div>
    );
  }

  // If we have a first name, show initials
  if (firstName) {
    const initial = firstName.charAt(0).toUpperCase();
    return (
      <div 
        className={`${sizeClasses[size]} rounded-full flex items-center justify-center font-bold text-white ${className}`}
        style={{
          background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',
          border: '2px solid rgba(255, 255, 255, 0.3)',
        }}
      >
        {initial}
      </div>
    );
  }

  // Fallback to icon
  return (
    <div className={`${sizeClasses[size]} rounded-full flex items-center justify-center ${className}`}>
      <CircleUser className={`${iconSizes[size]} text-white/70`} strokeWidth={2} />
    </div>
  );
});

UserAvatar.displayName = 'UserAvatar';

export default UserAvatar;
```

### components/VoiceSearch.tsx
```tsx
import { useState, useEffect, useCallback, useRef } from 'react';
import { Mic, MicOff, Loader2 } from 'lucide-react';
import { useTelegram } from '../hooks/useTelegram';

interface VoiceSearchProps {
  onResult: (transcript: string) => void;
  placeholder?: string;
  className?: string;
}

export function VoiceSearch({ onResult, placeholder = "Поиск по голосу...", className = '' }: VoiceSearchProps) {
  const { hapticFeedback } = useTelegram();
  const [isListening, setIsListening] = useState(false);
  const [isSupported, setIsSupported] = useState(false);
  const [transcript, setTranscript] = useState('');
  const recognitionRef = useRef<any>(null);

  // Check Web Speech API support
  useEffect(() => {
    const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;
    setIsSupported(!!SpeechRecognition);

    if (SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = true;
      recognition.lang = 'ru-RU';
      recognition.maxAlternatives = 1;

      recognition.onresult = (event: any) => {
        const current = event.resultIndex;
        const result = event.results[current];
        const transcriptText = result[0].transcript;
        
        setTranscript(transcriptText);
        
        // Final result
        if (result.isFinal) {
          hapticFeedback.medium();
          onResult(transcriptText);
          setIsListening(false);
        }
      };

      recognition.onerror = (event: any) => {
        console.error('Speech recognition error:', event.error);
        hapticFeedback.heavy();
        setIsListening(false);
      };

      recognition.onend = () => {
        setIsListening(false);
      };

      recognitionRef.current = recognition;
    }

    return () => {
      if (recognitionRef.current) {
        recognitionRef.current.abort();
      }
    };
  }, [onResult, hapticFeedback]);

  const startListening = useCallback(() => {
    if (!recognitionRef.current || isListening) return;
    
    hapticFeedback.light();
    setTranscript('');
    setIsListening(true);
    
    try {
      recognitionRef.current.start();
    } catch (error) {
      console.error('Failed to start recognition:', error);
      setIsListening(false);
    }
  }, [isListening, hapticFeedback]);

  const stopListening = useCallback(() => {
    if (!recognitionRef.current || !isListening) return;
    
    hapticFeedback.light();
    recognitionRef.current.stop();
    setIsListening(false);
  }, [isListening, hapticFeedback]);

  const toggleListening = useCallback(() => {
    if (isListening) {
      stopListening();
    } else {
      startListening();
    }
  }, [isListening, startListening, stopListening]);

  if (!isSupported) {
    return null; // Don't show if not supported
  }

  return (
    <button
      onClick={toggleListening}
      disabled={!isSupported}
      className={`relative group ${className}`}
      data-testid="button-voice-search"
      aria-label={isListening ? "Остановить голосовой поиск" : "Начать голосовой поиск"}
      aria-pressed={isListening}
      role="button"
      tabIndex={0}
    >
      <div className={`
        relative flex items-center justify-center
        w-12 h-12 rounded-full
        transition-all duration-300
        ${isListening 
          ? 'bg-emerald-500 scale-110 shadow-lg shadow-emerald-500/50' 
          : 'bg-white/10 hover:bg-white/15 backdrop-blur-xl'
        }
      `}>
        {isListening ? (
          <>
            {/* Pulsing animation */}
            <div className="absolute inset-0 rounded-full bg-emerald-400 animate-ping opacity-75" />
            <MicOff className="relative w-5 h-5 text-white z-10" />
          </>
        ) : (
          <Mic className="w-5 h-5 text-white" />
        )}
      </div>

      {/* Transcript display */}
      {isListening && transcript && (
        <div className="absolute top-full mt-2 left-1/2 -translate-x-1/2 whitespace-nowrap">
          <div className="bg-black/80 backdrop-blur-xl rounded-lg px-4 py-2 border border-white/20">
            <p className="text-sm text-white font-medium">{transcript}</p>
          </div>
        </div>
      )}

      {/* Listening indicator */}
      {isListening && (
        <div className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse" />
      )}
    </button>
  );
}
```

### components/XPNotification.tsx
```tsx
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { Zap, Star, Trophy } from 'lucide-react';
import { useEffect, useState } from 'react';

interface XPNotificationProps {
  amount: number;
  message: string;
  show: boolean;
  onClose: () => void;
}

export function XPNotification({ amount, message, show, onClose }: XPNotificationProps) {
  useEffect(() => {
    if (show) {
      const timer = setTimeout(() => {
        onClose();
      }, 3000);
      return () => clearTimeout(timer);
    }
  }, [show, onClose]);

  return (
    <AnimatePresence>
      {show && (
        <motion.div
          initial={{ opacity: 0, y: -50, scale: 0.3 }}
          animate={{ opacity: 1, y: 0, scale: 1 }}
          exit={{ opacity: 0, scale: 0.5, transition: { duration: 0.2 } }}
          className="fixed top-24 left-1/2 -translate-x-1/2 z-50 pointer-events-none"
        >
          <motion.div
            className="relative bg-gradient-to-br from-emerald-500/90 to-cyan-500/90 backdrop-blur-xl rounded-2xl p-4 shadow-2xl border border-white/30"
            animate={{
              boxShadow: [
                '0 0 20px rgba(16, 185, 129, 0.3)',
                '0 0 40px rgba(16, 185, 129, 0.6)',
                '0 0 20px rgba(16, 185, 129, 0.3)'
              ]
            }}
            transition={{ duration: 1.5, repeat: Infinity }}
          >
            {/* Sparkles Effect */}
            <div className="absolute inset-0 overflow-hidden rounded-2xl">
              {[...Array(6)].map((_, i) => (
                <motion.div
                  key={i}
                  className="absolute w-1 h-1 bg-yellow-300 rounded-full"
                  initial={{
                    x: Math.random() * 100 + '%',
                    y: Math.random() * 100 + '%',
                    scale: 0
                  }}
                  animate={{
                    scale: [0, 1, 0],
                    opacity: [0, 1, 0]
                  }}
                  transition={{
                    duration: 1.5,
                    delay: i * 0.1,
                    repeat: Infinity
                  }}
                />
              ))}
            </div>

            <div className="relative flex items-center gap-3">
              <motion.div
                className="w-12 h-12 rounded-full bg-yellow-400/30 flex items-center justify-center"
                animate={{ rotate: 360 }}
                transition={{ duration: 2, repeat: Infinity, ease: "linear" }}
              >
                <Zap className="w-6 h-6 text-yellow-300" fill="currentColor" />
              </motion.div>

              <div>
                <div className="flex items-center gap-2 mb-1">
                  <motion.div
                    initial={{ scale: 0 }}
                    animate={{ scale: [0, 1.2, 1] }}
                    transition={{ duration: 0.5 }}
                    className="text-2xl font-bold text-white"
                  >
                    +{amount} XP
                  </motion.div>
                  <Star className="w-5 h-5 text-yellow-300" fill="currentColor" />
                </div>
                <div className="text-sm text-white/90 font-medium">
                  {message}
                </div>
              </div>
            </div>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}

interface AchievementNotificationProps {
  name: string;
  description: string;
  icon: React.ReactNode;
  show: boolean;
  onClose: () => void;
}

export function AchievementNotification({ 
  name, 
  description, 
  icon, 
  show, 
  onClose 
}: AchievementNotificationProps) {
  useEffect(() => {
    if (show) {
      const timer = setTimeout(() => {
        onClose();
      }, 4000);
      return () => clearTimeout(timer);
    }
  }, [show, onClose]);

  return (
    <AnimatePresence>
      {show && (
        <motion.div
          initial={{ opacity: 0, scale: 0.3, y: -50 }}
          animate={{ opacity: 1, scale: 1, y: 0 }}
          exit={{ opacity: 0, scale: 0.5 }}
          className="fixed top-24 left-1/2 -translate-x-1/2 z-50 pointer-events-none"
        >
          <motion.div
            className="relative bg-gradient-to-br from-amber-500/90 via-orange-500/90 to-yellow-500/90 backdrop-blur-xl rounded-2xl p-6 shadow-2xl border border-white/40"
            animate={{
              boxShadow: [
                '0 0 30px rgba(245, 158, 11, 0.4)',
                '0 0 60px rgba(245, 158, 11, 0.8)',
                '0 0 30px rgba(245, 158, 11, 0.4)'
              ]
            }}
            transition={{ duration: 2, repeat: Infinity }}
          >
            {/* Confetti Effect */}
            <div className="absolute inset-0 overflow-hidden rounded-2xl">
              {[...Array(20)].map((_, i) => (
                <motion.div
                  key={i}
                  className="absolute w-2 h-2 rounded-full"
                  style={{
                    backgroundColor: ['#fbbf24', '#f59e0b', '#ef4444', '#8b5cf6'][i % 4]
                  }}
                  initial={{
                    x: '50%',
                    y: '50%',
                    scale: 0
                  }}
                  animate={{
                    x: `${50 + (Math.random() - 0.5) * 200}%`,
                    y: `${50 + (Math.random() - 0.5) * 200}%`,
                    scale: [0, 1, 0],
                    opacity: [0, 1, 0]
                  }}
                  transition={{
                    duration: 1.5,
                    delay: i * 0.05
                  }}
                />
              ))}
            </div>

            <div className="relative text-center">
              <div className="flex justify-center mb-3">
                <motion.div
                  className="w-20 h-20 rounded-full bg-white/20 flex items-center justify-center"
                  animate={{
                    scale: [1, 1.1, 1],
                    rotate: [0, 5, -5, 0]
                  }}
                  transition={{ duration: 2, repeat: Infinity }}
                >
                  {icon}
                </motion.div>
              </div>

              <div className="flex items-center justify-center gap-2 mb-2">
                <Trophy className="w-6 h-6 text-white" fill="currentColor" />
                <h3 className="text-xl font-bold text-white">
                  Достижение разблокировано!
                </h3>
              </div>

              <h4 className="text-lg font-semibold text-white mb-1">
                {name}
              </h4>
              <p className="text-sm text-white/90">
                {description}
              </p>
            </div>
          </motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

## UI КОМПОНЕНТЫ

### ui/accordion.tsx
```tsx
import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const Accordion = AccordionPrimitive.Root

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item
    ref={ref}
    className={cn("border-b", className)}
    {...props}
  />
))
AccordionItem.displayName = "AccordionItem"

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
))
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
))

AccordionContent.displayName = AccordionPrimitive.Content.displayName

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }
```

### ui/alert-dialog.tsx
```tsx
import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

const AlertDialog = AlertDialogPrimitive.Root

const AlertDialogTrigger = AlertDialogPrimitive.Trigger

const AlertDialogPortal = AlertDialogPrimitive.Portal

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    />
  </AlertDialogPortal>
))
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName

const AlertDialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
AlertDialogHeader.displayName = "AlertDialogHeader"

const AlertDialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
AlertDialogFooter.displayName = "AlertDialogFooter"

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold", className)}
    {...props}
  />
))
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
AlertDialogDescription.displayName =
  AlertDialogPrimitive.Description.displayName

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action
    ref={ref}
    className={cn(buttonVariants(), className)}
    {...props}
  />
))
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(
      buttonVariants({ variant: "outline" }),
      "mt-2 sm:mt-0",
      className
    )}
    {...props}
  />
))
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}
```

### ui/alert.tsx
```tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
))
Alert.displayName = "Alert"

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
))
AlertTitle.displayName = "AlertTitle"

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
))
AlertDescription.displayName = "AlertDescription"

export { Alert, AlertTitle, AlertDescription }
```

### ui/aspect-ratio.tsx
```tsx
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }
```

### ui/avatar.tsx
```tsx
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      "flex h-full w-full items-center justify-center rounded-full bg-muted",
      className
    )}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }
```

### ui/badge.tsx
```tsx
import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  )
}

export { Badge, badgeVariants }
```

### ui/breadcrumb.tsx
```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      className={cn("transition-colors hover:text-foreground", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-foreground", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:w-3.5 [&>svg]:h-3.5", className)}
    {...props}
  >
    {children ?? <ChevronRight />}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}
```

### ui/button.tsx
```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }
```

### ui/calendar.tsx
```tsx
import * as React from "react"
import { ChevronLeft, ChevronRight } from "lucide-react"
import { DayPicker } from "react-day-picker"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

export type CalendarProps = React.ComponentProps<typeof DayPicker>

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  ...props
}: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell:
          "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(
          buttonVariants({ variant: "ghost" }),
          "h-9 w-9 p-0 font-normal aria-selected:opacity-100"
        ),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle:
          "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ className, ...props }) => (
          <ChevronLeft className={cn("h-4 w-4", className)} {...props} />
        ),
        IconRight: ({ className, ...props }) => (
          <ChevronRight className={cn("h-4 w-4", className)} {...props} />
        ),
      }}
      {...props}
    />
  )
}
Calendar.displayName = "Calendar"

export { Calendar }
```

### ui/card.tsx
```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "rounded-2xl border border-white/20 bg-white/10 backdrop-blur-xl text-white shadow-sm",
      className
    )}
    {...props}
  />
))
Card.displayName = "Card"

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
))
CardHeader.displayName = "CardHeader"

const CardTitle = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
CardTitle.displayName = "CardTitle"

const CardDescription = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
CardDescription.displayName = "CardDescription"

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
))
CardContent.displayName = "CardContent"

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
))
CardFooter.displayName = "CardFooter"

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }
```

### ui/carousel.tsx
```tsx
import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

const Carousel = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & CarouselProps
>(
  (
    {
      orientation = "horizontal",
      opts,
      setApi,
      plugins,
      className,
      children,
      ...props
    },
    ref
  ) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins
    )
    const [canScrollPrev, setCanScrollPrev] = React.useState(false)
    const [canScrollNext, setCanScrollNext] = React.useState(false)

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return
      }

      setCanScrollPrev(api.canScrollPrev())
      setCanScrollNext(api.canScrollNext())
    }, [])

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev()
    }, [api])

    const scrollNext = React.useCallback(() => {
      api?.scrollNext()
    }, [api])

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault()
          scrollPrev()
        } else if (event.key === "ArrowRight") {
          event.preventDefault()
          scrollNext()
        }
      },
      [scrollPrev, scrollNext]
    )

    React.useEffect(() => {
      if (!api || !setApi) {
        return
      }

      setApi(api)
    }, [api, setApi])

    React.useEffect(() => {
      if (!api) {
        return
      }

      onSelect(api)
      api.on("reInit", onSelect)
      api.on("select", onSelect)

      return () => {
        api?.off("select", onSelect)
      }
    }, [api, onSelect])

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation:
            orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    )
  }
)
Carousel.displayName = "Carousel"

const CarouselContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div ref={carouselRef} className="overflow-hidden">
      <div
        ref={ref}
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
})
CarouselContent.displayName = "CarouselContent"

const CarouselItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const { orientation } = useCarousel()

  return (
    <div
      ref={ref}
      role="group"
      aria-roledescription="slide"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
})
CarouselItem.displayName = "CarouselItem"

const CarouselPrevious = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute  h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft className="h-4 w-4" />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
})
CarouselPrevious.displayName = "CarouselPrevious"

const CarouselNext = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<typeof Button>
>(({ className, variant = "outline", size = "icon", ...props }, ref) => {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      ref={ref}
      variant={variant}
      size={size}
      className={cn(
        "absolute h-8 w-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight className="h-4 w-4" />
      <span className="sr-only">Next slide</span>
    </Button>
  )
})
CarouselNext.displayName = "CarouselNext"

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}
```

### ui/chart.tsx
```tsx
"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig
    children: React.ComponentProps<
      typeof RechartsPrimitive.ResponsiveContainer
    >["children"]
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
})
ChartContainer.displayName = "Chart"

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean
      hideIndicator?: boolean
      indicator?: "line" | "dot" | "dashed"
      nameKey?: string
      labelKey?: string
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref
  ) => {
    const { config } = useChart()

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null
      }

      const [item] = payload
      const key = `${labelKey || item?.dataKey || item?.name || "value"}`
      const itemConfig = getPayloadConfigFromPayload(config, item, key)
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label

      if (labelFormatter) {
        return (
          <div className={cn("font-medium", labelClassName)}>
            {labelFormatter(value, payload)}
          </div>
        )
      }

      if (!value) {
        return null
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>
    }, [
      label,
      labelFormatter,
      payload,
      hideLabel,
      labelClassName,
      config,
      labelKey,
    ])

    if (!active || !payload?.length) {
      return null
    }

    const nestLabel = payload.length === 1 && indicator !== "dot"

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`
            const itemConfig = getPayloadConfigFromPayload(config, item, key)
            const indicatorColor = color || item.payload.fill || item.color

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center"
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn(
                            "shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",
                            {
                              "h-2.5 w-2.5": indicator === "dot",
                              "w-1": indicator === "line",
                              "w-0 border-[1.5px] border-dashed bg-transparent":
                                indicator === "dashed",
                              "my-0.5": nestLabel && indicator === "dashed",
                            }
                          )}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center"
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">
                          {itemConfig?.label || item.name}
                        </span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            )
          })}
        </div>
      </div>
    )
  }
)
ChartTooltipContent.displayName = "ChartTooltip"

const ChartLegend = RechartsPrimitive.Legend

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean
      nameKey?: string
    }
>(
  (
    { className, hideIcon = false, payload, verticalAlign = "bottom", nameKey },
    ref
  ) => {
    const { config } = useChart()

    if (!payload?.length) {
      return null
    }

    return (
      <div
        ref={ref}
        className={cn(
          "flex items-center justify-center gap-4",
          verticalAlign === "top" ? "pb-3" : "pt-3",
          className
        )}
      >
        {payload.map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)

          return (
            <div
              key={item.value}
              className={cn(
                "flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"
              )}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          )
        })}
      </div>
    )
  }
)
ChartLegendContent.displayName = "ChartLegend"

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}
```

### ui/checkbox.tsx
```tsx
import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"

import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("flex items-center justify-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }
```

### ui/CoinButton.tsx
```tsx
import { Coins, Sparkles } from "lucide-react";

interface CoinButtonProps {
  coins: number;
  onClick: () => void;
  pulse?: boolean;
}

export default function CoinButton({ coins, onClick, pulse = false }: CoinButtonProps) {
  return (
    <button
      onClick={onClick}
      className={`fixed top-20 right-4 z-50 group ${pulse ? 'animate-pulse' : ''}`}
    >
      {/* Glow effect */}
      <div className="absolute inset-0 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl blur-lg opacity-75 group-hover:opacity-100 transition-opacity duration-300"></div>
      
      {/* Button */}
      <div className="relative bg-gradient-to-r from-yellow-400 to-orange-500 px-4 py-3 rounded-2xl shadow-lg transform transition-all duration-300 group-hover:scale-105 group-active:scale-95">
        <div className="flex items-center gap-2">
          <Coins className="w-5 h-5 text-white animate-bounce" />
          <span className="font-bold text-white text-sm">{coins}</span>
          <Sparkles className="w-4 h-4 text-white opacity-80" />
        </div>
      </div>
      
      {/* Floating text */}
      <div className="absolute -bottom-8 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
        <div className="bg-black/80 text-white text-xs px-2 py-1 rounded-lg whitespace-nowrap">
          Заработать скидку!
        </div>
      </div>
    </button>
  );
}```

### ui/collapsible.tsx
```tsx
"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

const Collapsible = CollapsiblePrimitive.Root

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent

export { Collapsible, CollapsibleTrigger, CollapsibleContent }
```

### ui/command.tsx
```tsx
import * as React from "react"
import { type DialogProps } from "@radix-ui/react-dialog"
import { Command as CommandPrimitive } from "cmdk"
import { Search } from "lucide-react"

import { cn } from "@/lib/utils"
import { Dialog, DialogContent } from "@/components/ui/dialog"

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className
    )}
    {...props}
  />
))
Command.displayName = CommandPrimitive.displayName

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    />
  </div>
))

CommandInput.displayName = CommandPrimitive.Input.displayName

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
))

CommandList.displayName = CommandPrimitive.List.displayName

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => (
  <CommandPrimitive.Empty
    ref={ref}
    className="py-6 text-center text-sm"
    {...props}
  />
))

CommandEmpty.displayName = CommandPrimitive.Empty.displayName

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className
    )}
    {...props}
  />
))

CommandGroup.displayName = CommandPrimitive.Group.displayName

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 h-px bg-border", className)}
    {...props}
  />
))
CommandSeparator.displayName = CommandPrimitive.Separator.displayName

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      className
    )}
    {...props}
  />
))

CommandItem.displayName = CommandPrimitive.Item.displayName

const CommandShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
CommandShortcut.displayName = "CommandShortcut"

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}
```

### ui/context-menu.tsx
```tsx
import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const ContextMenu = ContextMenuPrimitive.Root

const ContextMenuTrigger = ContextMenuPrimitive.Trigger

const ContextMenuGroup = ContextMenuPrimitive.Group

const ContextMenuPortal = ContextMenuPrimitive.Portal

const ContextMenuSub = ContextMenuPrimitive.Sub

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
))
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",
      className
    )}
    {...props}
  />
))
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]",
        className
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
))
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
))
ContextMenuCheckboxItem.displayName =
  ContextMenuPrimitive.CheckboxItem.displayName

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
))
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold text-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-border", className)}
    {...props}
  />
))
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName

const ContextMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
ContextMenuShortcut.displayName = "ContextMenuShortcut"

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}
```

### ui/dialog.tsx
```tsx
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Dialog = DialogPrimitive.Root

const DialogTrigger = DialogPrimitive.Trigger

const DialogPortal = DialogPrimitive.Portal

const DialogClose = DialogPrimitive.Close

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
))
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
))
DialogContent.displayName = DialogPrimitive.Content.displayName

const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
DialogHeader.displayName = "DialogHeader"

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
DialogFooter.displayName = "DialogFooter"

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DialogTitle.displayName = DialogPrimitive.Title.displayName

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DialogDescription.displayName = DialogPrimitive.Description.displayName

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
}
```

### ui/drawer.tsx
```tsx
"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

const Drawer = ({
  shouldScaleBackground = true,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root
    shouldScaleBackground={shouldScaleBackground}
    {...props}
  />
)
Drawer.displayName = "Drawer"

const DrawerTrigger = DrawerPrimitive.Trigger

const DrawerPortal = DrawerPrimitive.Portal

const DrawerClose = DrawerPrimitive.Close

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay
    ref={ref}
    className={cn("fixed inset-0 z-50 bg-black/80", className)}
    {...props}
  />
))
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
))
DrawerContent.displayName = "DrawerContent"

const DrawerHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)}
    {...props}
  />
)
DrawerHeader.displayName = "DrawerHeader"

const DrawerFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn("mt-auto flex flex-col gap-2 p-4", className)}
    {...props}
  />
)
DrawerFooter.displayName = "DrawerFooter"

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
))
DrawerTitle.displayName = DrawerPrimitive.Title.displayName

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
DrawerDescription.displayName = DrawerPrimitive.Description.displayName

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}
```

### ui/dropdown-menu.tsx
```tsx
import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const DropdownMenu = DropdownMenuPrimitive.Root

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger

const DropdownMenuGroup = DropdownMenuPrimitive.Group

const DropdownMenuPortal = DropdownMenuPrimitive.Portal

const DropdownMenuSub = DropdownMenuPrimitive.Sub

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto" />
  </DropdownMenuPrimitive.SubTrigger>
))
DropdownMenuSubTrigger.displayName =
  DropdownMenuPrimitive.SubTrigger.displayName

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
      className
    )}
    {...props}
  />
))
DropdownMenuSubContent.displayName =
  DropdownMenuPrimitive.SubContent.displayName

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",
        className
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
))
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
))
DropdownMenuCheckboxItem.displayName =
  DropdownMenuPrimitive.CheckboxItem.displayName

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
))
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName

const DropdownMenuShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn("ml-auto text-xs tracking-widest opacity-60", className)}
      {...props}
    />
  )
}
DropdownMenuShortcut.displayName = "DropdownMenuShortcut"

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
}
```

### ui/form.tsx
```tsx
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState, formState } = useFormContext()

  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

const FormItem = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div ref={ref} className={cn("space-y-2", className)} {...props} />
    </FormItemContext.Provider>
  )
})
FormItem.displayName = "FormItem"

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField()

  return (
    <Label
      ref={ref}
      className={cn(error && "text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
})
FormLabel.displayName = "FormLabel"

const FormControl = React.forwardRef<
  React.ElementRef<typeof Slot>,
  React.ComponentPropsWithoutRef<typeof Slot>
>(({ ...props }, ref) => {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      ref={ref}
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
})
FormControl.displayName = "FormControl"

const FormDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => {
  const { formDescriptionId } = useFormField()

  return (
    <p
      ref={ref}
      id={formDescriptionId}
      className={cn("text-sm text-muted-foreground", className)}
      {...props}
    />
  )
})
FormDescription.displayName = "FormDescription"

const FormMessage = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, children, ...props }, ref) => {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : children

  if (!body) {
    return null
  }

  return (
    <p
      ref={ref}
      id={formMessageId}
      className={cn("text-sm font-medium text-destructive", className)}
      {...props}
    >
      {body}
    </p>
  )
})
FormMessage.displayName = "FormMessage"

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}
```

### ui/GlassCard.tsx
```tsx
import { ReactNode } from "react";

interface Props {
  children: ReactNode;
  className?: string;
  onClick?: () => void;
}

export const GlassCard = ({ children, className = "", onClick }: Props) => {
  return (
    <div 
      onClick={onClick}
      className={`
        relative overflow-hidden
        bg-white/[0.03]
        backdrop-blur-xl
        border border-white/[0.08]
        rounded-[24px]
        p-5
        transition-all duration-300 ease-out
        active:scale-[0.98]
        active:bg-white/[0.06]
        ${className}
      `}
    >
      <div className="absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-white/20 to-transparent" />
      
      {children}
    </div>
  );
};
```

### ui/haptic-button.tsx
```tsx
import { m as motion } from '@/utils/LazyMotionProvider';
import { useHaptic } from '@/hooks/useHaptic';
import { cn } from '@/lib/utils';
import { forwardRef } from 'react';

interface HapticButtonProps {
  variant?: 'primary' | 'secondary' | 'ghost' | 'destructive';
  size?: 'sm' | 'md' | 'lg';
  hapticStyle?: 'light' | 'medium' | 'heavy';
  onClick?: (e: React.MouseEvent<HTMLButtonElement>) => void;
  children: React.ReactNode;
  className?: string;
  disabled?: boolean;
  type?: 'button' | 'submit' | 'reset';
  'data-testid'?: string;
}

/**
 * HapticButton - Кнопка с тактильной отдачей и анимацией сжатия
 * 
 * Особенности:
 * - Вибрация при нажатии (Telegram Haptic Feedback)
 * - Плавная анимация scale при нажатии
 * - 4 варианта дизайна (primary, secondary, ghost, destructive)
 * - 3 размера (sm, md, lg)
 * - 3 стиля вибрации (light, medium, heavy)
 * 
 * Пример использования:
 * ```tsx
 * <HapticButton 
 *   variant="primary" 
 *   size="md"
 *   hapticStyle="light"
 *   onClick={() => console.log('Clicked!')}
 * >
 *   Нажми меня
 * </HapticButton>
 * ```
 */
export const HapticButton = forwardRef<HTMLButtonElement, HapticButtonProps>(
  (
    { 
      className, 
      variant = 'primary', 
      size = 'md',
      hapticStyle = 'light',
      onClick, 
      children,
      disabled,
      ...props 
    }, 
    ref
  ) => {
    const haptic = useHaptic();

    const handlePress = (e: React.MouseEvent<HTMLButtonElement>) => {
      if (disabled) return;
      
      // Вызов тактильной вибрации
      if (hapticStyle === 'light') haptic.light();
      else if (hapticStyle === 'medium') haptic.medium();
      else if (hapticStyle === 'heavy') haptic.heavy();
      
      onClick?.(e);
    };

    const baseStyles = `
      relative inline-flex items-center justify-center
      font-medium transition-all duration-200
      disabled:opacity-50 disabled:cursor-not-allowed
      focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    `;

    const variantStyles = {
      primary: `
        bg-gradient-to-r from-blue-500 to-blue-600 
        text-white shadow-lg shadow-blue-500/30
        hover:from-blue-600 hover:to-blue-700
        active:from-blue-700 active:to-blue-800
        focus-visible:ring-blue-500
      `,
      secondary: `
        bg-white/10 backdrop-blur-md border border-white/20
        text-white shadow-lg
        hover:bg-white/20
        active:bg-white/30
        focus-visible:ring-white
      `,
      ghost: `
        bg-transparent text-white
        hover:bg-white/10
        active:bg-white/20
        focus-visible:ring-white
      `,
      destructive: `
        bg-gradient-to-r from-red-500 to-red-600
        text-white shadow-lg shadow-red-500/30
        hover:from-red-600 hover:to-red-700
        active:from-red-700 active:to-red-800
        focus-visible:ring-red-500
      `
    };

    const sizeStyles = {
      sm: 'px-4 py-2 text-sm rounded-lg min-h-8',
      md: 'px-6 py-3 text-base rounded-xl min-h-10',
      lg: 'px-8 py-4 text-lg rounded-2xl min-h-12'
    };

    return (
      <motion.button
        ref={ref}
        whileTap={{ scale: disabled ? 1 : 0.97 }}
        transition={{ duration: 0.1, ease: 'easeOut' }}
        onClick={handlePress}
        disabled={disabled}
        type={props.type || 'button'}
        data-testid={props['data-testid']}
        className={cn(
          baseStyles,
          variantStyles[variant],
          sizeStyles[size],
          className
        )}
      >
        {children}
      </motion.button>
    );
  }
);

HapticButton.displayName = 'HapticButton';
```

### ui/haptic-card.tsx
```tsx
import { m as motion } from '@/utils/LazyMotionProvider';
import { useHaptic } from '@/hooks/useHaptic';
import { cn } from '@/lib/utils';
import { ReactNode } from 'react';

interface HapticCardProps {
  hapticStyle?: 'light' | 'medium' | 'heavy';
  pressScale?: number;
  children: ReactNode;
  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;
  className?: string;
  'data-testid'?: string;
}

/**
 * HapticCard - Интерактивная карточка с тактильной отдачей
 * 
 * Особенности:
 * - Вибрация при нажатии
 * - Плавная анимация scale при нажатии
 * - Настраиваемая сила вибрации
 * - Настраиваемый scale эффект
 * 
 * Пример использования:
 * ```tsx
 * <HapticCard 
 *   hapticStyle="light"
 *   pressScale={0.98}
 *   onClick={() => navigate('/demo')}
 *   className="p-6 bg-white/10 rounded-2xl"
 * >
 *   <h3>Демо приложение</h3>
 *   <p>Описание...</p>
 * </HapticCard>
 * ```
 */
export const HapticCard = ({
  hapticStyle = 'light',
  pressScale = 0.98,
  onClick,
  className,
  children,
  ...props
}: HapticCardProps) => {
  const haptic = useHaptic();

  const handlePress = (e: React.MouseEvent<HTMLDivElement>) => {
    // Вызов тактильной вибрации
    if (hapticStyle === 'light') haptic.light();
    else if (hapticStyle === 'medium') haptic.medium();
    else if (hapticStyle === 'heavy') haptic.heavy();
    
    onClick?.(e);
  };

  return (
    <motion.div
      whileTap={{ scale: pressScale }}
      transition={{ duration: 0.1, ease: 'easeOut' }}
      onClick={handlePress}
      data-testid={props['data-testid']}
      className={cn(
        'cursor-pointer touch-action-manipulation',
        'user-select-none -webkit-user-select-none',
        '-webkit-tap-highlight-color-transparent',
        'transition-all duration-200',
        className
      )}
    >
      {children}
    </motion.div>
  );
};

/**
 * HapticIconButton - Круглая кнопка с иконкой и тактильной отдачей
 */
interface HapticIconButtonProps {
  hapticStyle?: 'light' | 'medium' | 'heavy';
  icon: ReactNode;
  variant?: 'default' | 'ghost' | 'glass';
  size?: 'sm' | 'md' | 'lg';
  onClick?: (e: React.MouseEvent<HTMLButtonElement>) => void;
  className?: string;
  disabled?: boolean;
  'data-testid'?: string;
  'aria-label'?: string;
}

export const HapticIconButton = ({
  hapticStyle = 'light',
  icon,
  variant = 'default',
  size = 'md',
  onClick,
  className,
  disabled,
  ...props
}: HapticIconButtonProps) => {
  const haptic = useHaptic();

  const handlePress = (e: React.MouseEvent<HTMLButtonElement>) => {
    if (disabled) return;
    
    // Вызов тактильной вибрации
    if (hapticStyle === 'light') haptic.light();
    else if (hapticStyle === 'medium') haptic.medium();
    else if (hapticStyle === 'heavy') haptic.heavy();
    
    onClick?.(e);
  };

  const variantStyles = {
    default: 'bg-white/10 backdrop-blur-md border border-white/20',
    ghost: 'bg-transparent hover:bg-white/10',
    glass: 'bg-white/20 backdrop-blur-xl border border-white/30'
  };

  const sizeStyles = {
    sm: 'w-8 h-8 text-sm',
    md: 'w-10 h-10 text-base',
    lg: 'w-12 h-12 text-lg'
  };

  return (
    <motion.button
      whileTap={{ scale: disabled ? 1 : 0.95 }}
      transition={{ duration: 0.1, ease: 'easeOut' }}
      onClick={handlePress}
      disabled={disabled}
      data-testid={props['data-testid']}
      aria-label={props['aria-label']}
      className={cn(
        'rounded-full flex items-center justify-center',
        'text-white shadow-lg',
        'transition-all duration-200',
        'disabled:opacity-50 disabled:cursor-not-allowed',
        'touch-action-manipulation user-select-none',
        '-webkit-tap-highlight-color-transparent',
        variantStyles[variant],
        sizeStyles[size],
        className
      )}
    >
      {icon}
    </motion.button>
  );
};
```

### ui/hover-card.tsx
```tsx
"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

const HoverCard = HoverCardPrimitive.Root

const HoverCardTrigger = HoverCardPrimitive.Trigger

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]",
      className
    )}
    {...props}
  />
))
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName

export { HoverCard, HoverCardTrigger, HoverCardContent }
```

### ui/input-otp.tsx
```tsx
import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { Dot } from "lucide-react"

import { cn } from "@/lib/utils"

const InputOTP = React.forwardRef<
  React.ElementRef<typeof OTPInput>,
  React.ComponentPropsWithoutRef<typeof OTPInput>
>(({ className, containerClassName, ...props }, ref) => (
  <OTPInput
    ref={ref}
    containerClassName={cn(
      "flex items-center gap-2 has-[:disabled]:opacity-50",
      containerClassName
    )}
    className={cn("disabled:cursor-not-allowed", className)}
    {...props}
  />
))
InputOTP.displayName = "InputOTP"

const InputOTPGroup = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("flex items-center", className)} {...props} />
))
InputOTPGroup.displayName = "InputOTPGroup"

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="h-4 w-px animate-caret-blink bg-foreground duration-1000" />
        </div>
      )}
    </div>
  )
})
InputOTPSlot.displayName = "InputOTPSlot"

const InputOTPSeparator = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div">
>(({ ...props }, ref) => (
  <div ref={ref} role="separator" {...props}>
    <Dot />
  </div>
))
InputOTPSeparator.displayName = "InputOTPSeparator"

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }
```

### ui/input.tsx
```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
```

### ui/label.tsx
```tsx
import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }
```

### ui/LazyImage.tsx
```tsx
import React, { useState, useRef, useEffect } from 'react';

interface LazyImageProps {
  src: string;
  alt: string;
  className?: string;
  style?: React.CSSProperties;
  placeholder?: string;
  onLoad?: () => void;
  onError?: () => void;
}

export const LazyImage: React.FC<LazyImageProps> = ({
  src,
  alt,
  className = '',
  style,
  placeholder = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNiAxNkwyNCAyNE0yNCAxNkwxNiAyNCIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K',
  onLoad,
  onError
}) => {
  const [isLoaded, setIsLoaded] = useState(false);
  const [isIntersecting, setIsIntersecting] = useState(false);
  const [hasError, setHasError] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsIntersecting(true);
          observer.disconnect();
        }
      },
      {
        rootMargin: '500px', // Start loading 500px before the image comes into view for instant visibility
        threshold: 0.01
      }
    );

    const currentImg = imgRef.current;
    if (currentImg) {
      observer.observe(currentImg);
    }

    return () => {
      if (currentImg) {
        observer.unobserve(currentImg);
      }
    };
  }, []);

  const handleLoad = () => {
    setIsLoaded(true);
    onLoad?.();
  };

  const handleError = () => {
    setHasError(true);
    onError?.();
  };

  // Convert unsplash URLs to optimized versions
  const getOptimizedSrc = (originalSrc: string): string => {
    if (originalSrc.includes('images.unsplash.com')) {
      // Add optimization parameters for unsplash
      const url = new URL(originalSrc);
      url.searchParams.set('auto', 'format,compress');
      url.searchParams.set('q', '80'); // 80% quality
      url.searchParams.set('w', '400'); // Default width
      url.searchParams.set('dpr', '2'); // Retina displays
      return url.toString();
    }
    return originalSrc;
  };

  const optimizedSrc = getOptimizedSrc(src);

  return (
    <div className={`relative overflow-hidden ${className}`} style={style}>
      {/* Placeholder */}
      <img
        ref={imgRef}
        src={placeholder}
        alt=""
        className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-300 ${
          isLoaded ? 'opacity-0' : 'opacity-100'
        }`}
        style={{ filter: 'blur(5px)' }}
      />
      
      {/* Actual image */}
      {isIntersecting && !hasError && (
        <img
          src={optimizedSrc}
          alt={alt}
          className={`w-full h-full object-cover transition-opacity duration-300 ${
            isLoaded ? 'opacity-100' : 'opacity-0'
          }`}
          onLoad={handleLoad}
          onError={handleError}
          loading="lazy"
          decoding="async"
          fetchPriority="high"
        />
      )}
      
      {/* Error state */}
      {hasError && (
        <div className="absolute inset-0 flex items-center justify-center bg-gray-100">
          <div className="text-center text-gray-500">
            <div className="w-8 h-8 mx-auto mb-2 text-gray-400">
              <svg fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clipRule="evenodd" />
              </svg>
            </div>
            <span className="text-xs">Изображение недоступно</span>
          </div>
        </div>
      )}
    </div>
  );
};

export default LazyImage;```

### ui/liquid-home-button.tsx
```tsx
import { Home } from "lucide-react";
import { m } from "framer-motion";

interface LiquidHomeButtonProps {
  onNavigateHome: () => void;
}

export function LiquidHomeButton({ onNavigateHome }: LiquidHomeButtonProps) {
  return (
    <m.button
      onClick={onNavigateHome}
      className="relative flex items-center justify-center w-14 h-14 rounded-full"
      style={{
        background: 'rgba(255, 255, 255, 0.18)',
        backdropFilter: 'blur(24px)',
        WebkitBackdropFilter: 'blur(24px)',
        border: '1px solid rgba(255, 255, 255, 0.25)',
        boxShadow: `
          0 8px 32px rgba(0, 0, 0, 0.4),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset,
          0 1px 0 rgba(255, 255, 255, 0.2) inset
        `
      }}
      whileHover={{ 
        scale: 1.04,
        backgroundColor: 'rgba(255, 255, 255, 0.25)'
      }}
      whileTap={{ scale: 0.96 }}
      transition={{ type: "spring", stiffness: 400, damping: 25 }}
      data-testid="button-home-main"
    >
      <Home 
        className="text-white w-6 h-6" 
        strokeWidth={2}
      />
    </m.button>
  );
}
```

### ui/menubar.tsx
```tsx
"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { Check, ChevronRight, Circle } from "lucide-react"

import { cn } from "@/lib/utils"

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return <MenubarPrimitive.RadioGroup {...props} />
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn(
      "flex h-10 items-center space-x-1 rounded-md border bg-background p-1",
      className
    )}
    {...props}
  />
))
Menubar.displayName = MenubarPrimitive.Root.displayName

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      className
    )}
    {...props}
  />
))
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",
      inset && "pl-8",
      className
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
))
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]",
      className
    )}
    {...props}
  />
))
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(
  (
    { className, align = "start", alignOffset = -4, sideOffset = 8, ...props },
    ref
  ) => (
    <MenubarPrimitive.Portal>
      <MenubarPrimitive.Content
        ref={ref}
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]",
          className
        )}
        {...props}
      />
    </MenubarPrimitive.Portal>
  )
)
MenubarContent.displayName = MenubarPrimitive.Content.displayName

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarItem.displayName = MenubarPrimitive.Item.displayName

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
))
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
))
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn(
      "px-2 py-1.5 text-sm font-semibold",
      inset && "pl-8",
      className
    )}
    {...props}
  />
))
MenubarLabel.displayName = MenubarPrimitive.Label.displayName

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName

const MenubarShortcut = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLSpanElement>) => {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-muted-foreground",
        className
      )}
      {...props}
    />
  )
}
MenubarShortcut.displayname = "MenubarShortcut"

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
}
```

### ui/modern-drawer.tsx
```tsx
import { ReactNode } from "react";
import { cn } from "@/lib/utils";
import { X } from "lucide-react";
import {
  Drawer,
  DrawerClose,
  DrawerContent,
  DrawerDescription,
  DrawerHeader,
  DrawerTitle,
  DrawerTrigger,
  DrawerFooter
} from "./drawer";
import { HapticButton } from "./haptic-button";
import { useHaptic } from "@/hooks/useHaptic";

/**
 * ModernDrawer - Современная Bottom Sheet навигация (стандарт UX 2025)
 * 
 * Особенности:
 * - Выезжающая шторка снизу вверх
 * - Backdrop с blur эффектом
 * - Drag-to-close жест
 * - Адаптивная высота (30%, 50%, 75%, full)
 * - Haptic feedback при открытии
 * - Безопасные отступы для Telegram
 * 
 * Пример использования:
 * ```tsx
 * <ModernDrawer 
 *   trigger={<button>Открыть</button>}
 *   height="50%"
 *   title="Заголовок"
 * >
 *   <p>Контент...</p>
 * </ModernDrawer>
 * ```
 */

interface ModernDrawerProps {
  trigger: ReactNode;
  children: ReactNode;
  height?: "auto" | "30%" | "50%" | "75%" | "full";
  title?: string;
  description?: string;
  showCloseButton?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}

export const ModernDrawer = ({ 
  trigger, 
  children, 
  height = "50%",
  title,
  description,
  showCloseButton = false,
  open,
  onOpenChange
}: ModernDrawerProps) => {
  const haptic = useHaptic();

  const heightClasses = {
    "auto": "h-auto max-h-[80vh]",
    "30%": "h-[30vh]",
    "50%": "h-[50vh]",
    "75%": "h-[75vh]",
    "full": "h-[90vh]"
  };

  const handleOpenChange = (isOpen: boolean) => {
    if (isOpen) {
      haptic.light(); // Вибрация при открытии
    }
    onOpenChange?.(isOpen);
  };

  return (
    <Drawer open={open} onOpenChange={handleOpenChange}>
      <DrawerTrigger asChild>
        {trigger}
      </DrawerTrigger>
      
      <DrawerContent className={cn(
        "bg-background border-t border-white/10",
        "focus-visible:outline-none",
        heightClasses[height]
      )}>
        <div className="overflow-y-auto flex-1">
          {/* Header */}
          {(title || showCloseButton) && (
            <DrawerHeader className="flex items-start justify-between gap-4">
              <div className="flex-1">
                {title && (
                  <DrawerTitle className="text-xl font-bold text-white text-left">
                    {title}
                  </DrawerTitle>
                )}
                {description && (
                  <DrawerDescription className="text-sm text-white/60 text-left mt-1">
                    {description}
                  </DrawerDescription>
                )}
              </div>
              
              {showCloseButton && (
                <DrawerClose asChild>
                  <button className="p-2 rounded-full hover:bg-white/10 transition-colors -mt-1">
                    <X className="w-5 h-5 text-white" />
                  </button>
                </DrawerClose>
              )}
            </DrawerHeader>
          )}
          
          {/* Content */}
          <div className="px-4 pb-4">
            {children}
          </div>
        </div>
      </DrawerContent>
    </Drawer>
  );
};

/**
 * ConfirmDrawer - Drawer для подтверждения действий (вместо window.confirm)
 * 
 * Пример:
 * ```tsx
 * <ConfirmDrawer
 *   trigger={<button>Удалить</button>}
 *   title="Удалить товар?"
 *   description="Это действие нельзя отменить"
 *   variant="destructive"
 *   onConfirm={() => deleteItem()}
 * />
 * ```
 * 
 * Controlled mode:
 * ```tsx
 * <ConfirmDrawer
 *   open={showSuccess}
 *   onOpenChange={setShowSuccess}
 *   trigger={<span />}
 *   title="Успешно!"
 *   icon={<Check className="w-8 h-8 text-green-400" />}
 *   onConfirm={() => setShowSuccess(false)}
 * />
 * ```
 */
interface ConfirmDrawerProps {
  trigger: ReactNode;
  title: string;
  description?: string;
  confirmText?: string;
  cancelText?: string;
  variant?: "default" | "destructive";
  onConfirm: () => void;
  onCancel?: () => void;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
  icon?: ReactNode;
}

export const ConfirmDrawer = ({
  trigger,
  title,
  description,
  confirmText = "Подтвердить",
  cancelText = "Отмена",
  variant = "default",
  onConfirm,
  onCancel,
  open,
  onOpenChange,
  icon
}: ConfirmDrawerProps) => {
  const haptic = useHaptic();

  const handleConfirm = () => {
    if (variant === "destructive") {
      haptic.heavy();
    } else {
      haptic.medium();
    }
    onConfirm();
  };

  const handleCancel = () => {
    haptic.light();
    onCancel?.();
  };

  return (
    <Drawer open={open} onOpenChange={onOpenChange}>
      <DrawerTrigger asChild>
        {trigger}
      </DrawerTrigger>
      
      <DrawerContent className="bg-background border-t border-white/10 h-auto">
        <div className="p-6">
          <DrawerHeader className="px-0 pt-0">
            {icon && (
              <div className="flex justify-center mb-4">
                {icon}
              </div>
            )}
            <DrawerTitle className={cn(
              "text-xl font-bold text-white",
              icon ? "text-center" : "text-left"
            )}>
              {title}
            </DrawerTitle>
            {description && (
              <DrawerDescription className={cn(
                "text-white/70 text-sm mt-2",
                icon ? "text-center" : "text-left"
              )}>
                {description}
              </DrawerDescription>
            )}
          </DrawerHeader>
          
          <DrawerFooter className="px-0 pb-0 pt-6">
            <div className="flex gap-3">
              {cancelText && (
                <DrawerClose asChild>
                  <HapticButton
                    variant="ghost"
                    size="lg"
                    onClick={handleCancel}
                    className="flex-1"
                    data-testid="button-cancel"
                  >
                    {cancelText}
                  </HapticButton>
                </DrawerClose>
              )}
              
              <DrawerClose asChild>
                <HapticButton
                  variant={variant === "destructive" ? "destructive" : "primary"}
                  size="lg"
                  hapticStyle={variant === "destructive" ? "heavy" : "medium"}
                  onClick={handleConfirm}
                  className="flex-1"
                  data-testid="button-confirm"
                >
                  {confirmText}
                </HapticButton>
              </DrawerClose>
            </div>
          </DrawerFooter>
        </div>
      </DrawerContent>
    </Drawer>
  );
};

/**
 * SelectDrawer - Drawer для выбора опции из списка (вместо select/dropdown)
 * 
 * Пример:
 * ```tsx
 * <SelectDrawer
 *   trigger={<button>Выбрать размер</button>}
 *   title="Выберите размер"
 *   options={[
 *     { value: 'sm', label: 'Small', icon: <Icon /> },
 *     { value: 'md', label: 'Medium' }
 *   ]}
 *   onSelect={(value) => setSize(value)}
 * />
 * ```
 */
interface SelectOption {
  value: string;
  label: string;
  icon?: ReactNode;
  description?: string;
  disabled?: boolean;
}

interface SelectDrawerProps {
  trigger: ReactNode;
  title: string;
  description?: string;
  options: SelectOption[];
  onSelect: (value: string) => void;
  selectedValue?: string;
}

export const SelectDrawer = ({
  trigger,
  title,
  description,
  options,
  onSelect,
  selectedValue
}: SelectDrawerProps) => {
  const haptic = useHaptic();

  const handleSelect = (value: string) => {
    haptic.light(); // Вибрация при выборе
    onSelect(value);
  };

  return (
    <Drawer>
      <DrawerTrigger asChild>
        {trigger}
      </DrawerTrigger>
      
      <DrawerContent className="bg-background border-t border-white/10 h-[60vh]">
        <div className="overflow-y-auto flex-1">
          <DrawerHeader>
            <DrawerTitle className="text-xl font-bold text-white text-left">
              {title}
            </DrawerTitle>
            {description && (
              <DrawerDescription className="text-white/60 text-sm text-left mt-1">
                {description}
              </DrawerDescription>
            )}
          </DrawerHeader>
          
          <div className="px-4 pb-4">
            <div className="space-y-2">
              {options.map((option) => (
                <DrawerClose
                  key={option.value}
                  asChild
                  disabled={option.disabled}
                >
                  <button
                    onClick={() => !option.disabled && handleSelect(option.value)}
                    disabled={option.disabled}
                    className={cn(
                      "w-full p-4 rounded-xl transition-all text-left flex items-center gap-3",
                      "disabled:opacity-50 disabled:cursor-not-allowed",
                      selectedValue === option.value
                        ? "bg-blue-500/20 border-2 border-blue-500/50"
                        : "bg-white/5 hover:bg-white/10 border-2 border-transparent"
                    )}
                    data-testid={`option-${option.value}`}
                  >
                    {option.icon && (
                      <div className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center flex-shrink-0">
                        {option.icon}
                      </div>
                    )}
                    <div className="flex-1 min-w-0">
                      <div className="text-white font-medium truncate">{option.label}</div>
                      {option.description && (
                        <div className="text-white/60 text-sm truncate">{option.description}</div>
                      )}
                    </div>
                    {selectedValue === option.value && (
                      <div className="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0">
                        <div className="w-2 h-2 rounded-full bg-white" />
                      </div>
                    )}
                  </button>
                </DrawerClose>
              ))}
            </div>
          </div>
        </div>
      </DrawerContent>
    </Drawer>
  );
};
```

### ui/navigation-menu.tsx
```tsx
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}
```

### ui/page.tsx
```tsx
import { m as motion } from '@/utils/LazyMotionProvider';
import { ReactNode } from 'react';
import { cn } from '@/lib/utils';

interface PageProps {
  children: ReactNode;
  className?: string;
  withPadding?: boolean;
  withSafeArea?: boolean;
}

/**
 * Page - Обертка для каждой страницы с плавными переходами
 * 
 * Особенности:
 * - Плавная анимация появления (fade + slide up)
 * - Плавная анимация исчезновения (fade + slide down)
 * - Автоматические отступы для безопасной зоны
 * - Поддержка safe area для Telegram
 * 
 * Пример использования:
 * ```tsx
 * <Page withPadding withSafeArea>
 *   <h1>Моя страница</h1>
 *   <p>Контент...</p>
 * </Page>
 * ```
 */
export const Page = ({ 
  children, 
  className,
  withPadding = true,
  withSafeArea = true
}: PageProps) => (
  <motion.div
    initial={{ opacity: 0, y: 20 }}
    animate={{ opacity: 1, y: 0 }}
    exit={{ opacity: 0, y: -20 }}
    transition={{ 
      duration: 0.3, 
      ease: [0.4, 0, 0.2, 1] // easeOut cubic-bezier
    }}
    className={cn(
      'min-h-screen',
      withPadding && 'px-4 pb-20 pt-4',
      withSafeArea && 'tg-safe-top tg-safe-bottom tg-safe-left tg-safe-right',
      className
    )}
  >
    {children}
  </motion.div>
);

/**
 * PageSection - Секция внутри страницы с анимацией
 */
interface PageSectionProps {
  children: ReactNode;
  className?: string;
  delay?: number;
}

export const PageSection = ({ 
  children, 
  className,
  delay = 0 
}: PageSectionProps) => (
  <motion.section
    initial={{ opacity: 0, y: 15 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ 
      duration: 0.4, 
      delay,
      ease: [0.4, 0, 0.2, 1]
    }}
    className={cn('mb-6', className)}
  >
    {children}
  </motion.section>
);

/**
 * PageHeader - Заголовок страницы с анимацией
 */
interface PageHeaderProps {
  title: string;
  subtitle?: string;
  className?: string;
}

export const PageHeader = ({ 
  title, 
  subtitle, 
  className 
}: PageHeaderProps) => (
  <motion.header
    initial={{ opacity: 0, y: -10 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ duration: 0.3, ease: [0.4, 0, 0.2, 1] }}
    className={cn('mb-6', className)}
  >
    <h1 className="text-3xl font-bold text-white mb-2">
      {title}
    </h1>
    {subtitle && (
      <p className="text-white/60 text-sm">
        {subtitle}
      </p>
    )}
  </motion.header>
);
```

### ui/pagination.tsx
```tsx
import * as React from "react"
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"
import { ButtonProps, buttonVariants } from "@/components/ui/button"

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<ButtonProps, "size"> &
  React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    size="default"
    className={cn("gap-1 pl-2.5", className)}
    {...props}
  >
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    size="default"
    className={cn("gap-1 pr-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}
```

### ui/popover.tsx
```tsx
import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent }
```

### ui/progress.tsx
```tsx
"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn(
      "relative h-4 w-full overflow-hidden rounded-full bg-secondary",
      className
    )}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
))
Progress.displayName = ProgressPrimitive.Root.displayName

export { Progress }
```

### ui/radio-group.tsx
```tsx
import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { Circle } from "lucide-react"

import { cn } from "@/lib/utils"

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  )
})
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
})
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName

export { RadioGroup, RadioGroupItem }
```

### ui/resizable.tsx
```tsx
"use client"

import { GripVertical } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

const ResizablePanelGroup = ({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn(
      "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
      className
    )}
    {...props}
  />
)

const ResizablePanel = ResizablePrimitive.Panel

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
)

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }
```

### ui/scroll-area.tsx
```tsx
import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root
    ref={ref}
    className={cn("relative overflow-hidden", className)}
    {...props}
  >
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">
      {children}
    </ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
))
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" &&
        "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" &&
        "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
))
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName

export { ScrollArea, ScrollBar }
```

### ui/select.tsx
```tsx
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"

import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn(
      "flex cursor-default items-center justify-center py-1",
      className
    )}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName =
  SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label
    ref={ref}
    className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)}
    {...props}
  />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator
    ref={ref}
    className={cn("-mx-1 my-1 h-px bg-muted", className)}
    {...props}
  />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}
```

### ui/separator.tsx
```tsx
import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }
```

### ui/sheet.tsx
```tsx
"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const Sheet = SheetPrimitive.Root

const SheetTrigger = SheetPrimitive.Trigger

const SheetClose = SheetPrimitive.Close

const SheetPortal = SheetPrimitive.Portal

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
))
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
)

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(({ side = "right", className, children, ...props }, ref) => (
  <SheetPortal>
    <SheetOverlay />
    <SheetPrimitive.Content
      ref={ref}
      className={cn(sheetVariants({ side }), className)}
      {...props}
    >
      {children}
      <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </SheetPrimitive.Close>
    </SheetPrimitive.Content>
  </SheetPortal>
))
SheetContent.displayName = SheetPrimitive.Content.displayName

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
)
SheetHeader.displayName = "SheetHeader"

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
)
SheetFooter.displayName = "SheetFooter"

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
))
SheetTitle.displayName = SheetPrimitive.Title.displayName

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
))
SheetDescription.displayName = SheetPrimitive.Description.displayName

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}
```

### ui/sidebar.tsx
```tsx
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { VariantProps, cva } from "class-variance-authority"
import { PanelLeft } from "lucide-react"

import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Separator } from "@/components/ui/separator"
import {
  Sheet,
  SheetContent,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet"
import { Skeleton } from "@/components/ui/skeleton"
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip"

const SIDEBAR_COOKIE_NAME = "sidebar_state"
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7
const SIDEBAR_WIDTH = "16rem"
const SIDEBAR_WIDTH_MOBILE = "18rem"
const SIDEBAR_WIDTH_ICON = "3rem"
const SIDEBAR_KEYBOARD_SHORTCUT = "b"

type SidebarContextProps = {
  state: "expanded" | "collapsed"
  open: boolean
  setOpen: (open: boolean) => void
  openMobile: boolean
  setOpenMobile: (open: boolean) => void
  isMobile: boolean
  toggleSidebar: () => void
}

const SidebarContext = React.createContext<SidebarContextProps | null>(null)

function useSidebar() {
  const context = React.useContext(SidebarContext)
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.")
  }

  return context
}

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean
    open?: boolean
    onOpenChange?: (open: boolean) => void
  }
>(
  (
    {
      defaultOpen = true,
      open: openProp,
      onOpenChange: setOpenProp,
      className,
      style,
      children,
      ...props
    },
    ref
  ) => {
    const isMobile = useIsMobile()
    const [openMobile, setOpenMobile] = React.useState(false)

    // This is the internal state of the sidebar.
    // We use openProp and setOpenProp for control from outside the component.
    const [_open, _setOpen] = React.useState(defaultOpen)
    const open = openProp ?? _open
    const setOpen = React.useCallback(
      (value: boolean | ((value: boolean) => boolean)) => {
        const openState = typeof value === "function" ? value(open) : value
        if (setOpenProp) {
          setOpenProp(openState)
        } else {
          _setOpen(openState)
        }

        // This sets the cookie to keep the sidebar state.
        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`
      },
      [setOpenProp, open]
    )

    // Helper to toggle the sidebar.
    const toggleSidebar = React.useCallback(() => {
      return isMobile
        ? setOpenMobile((open) => !open)
        : setOpen((open) => !open)
    }, [isMobile, setOpen, setOpenMobile])

    // Adds a keyboard shortcut to toggle the sidebar.
    React.useEffect(() => {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (
          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&
          (event.metaKey || event.ctrlKey)
        ) {
          event.preventDefault()
          toggleSidebar()
        }
      }

      window.addEventListener("keydown", handleKeyDown)
      return () => window.removeEventListener("keydown", handleKeyDown)
    }, [toggleSidebar])

    // We add a state so that we can do data-state="expanded" or "collapsed".
    // This makes it easier to style the sidebar with Tailwind classes.
    const state = open ? "expanded" : "collapsed"

    const contextValue = React.useMemo<SidebarContextProps>(
      () => ({
        state,
        open,
        setOpen,
        isMobile,
        openMobile,
        setOpenMobile,
        toggleSidebar,
      }),
      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]
    )

    return (
      <SidebarContext.Provider value={contextValue}>
        <TooltipProvider delayDuration={0}>
          <div
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH,
                "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
                ...style,
              } as React.CSSProperties
            }
            className={cn(
              "group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",
              className
            )}
            ref={ref}
            {...props}
          >
            {children}
          </div>
        </TooltipProvider>
      </SidebarContext.Provider>
    )
  }
)
SidebarProvider.displayName = "SidebarProvider"

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right"
    variant?: "sidebar" | "floating" | "inset"
    collapsible?: "offcanvas" | "icon" | "none"
  }
>(
  (
    {
      side = "left",
      variant = "sidebar",
      collapsible = "offcanvas",
      className,
      children,
      ...props
    },
    ref
  ) => {
    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()

    if (collapsible === "none") {
      return (
        <div
          className={cn(
            "flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",
            className
          )}
          ref={ref}
          {...props}
        >
          {children}
        </div>
      )
    }

    if (isMobile) {
      return (
        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
          <SheetContent
            data-sidebar="sidebar"
            data-mobile="true"
            className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
            style={
              {
                "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
              } as React.CSSProperties
            }
            side={side}
          >
            <SheetHeader className="sr-only">
              <SheetTitle>Sidebar</SheetTitle>
              <SheetDescription>Displays the mobile sidebar.</SheetDescription>
            </SheetHeader>
            <div className="flex h-full w-full flex-col">{children}</div>
          </SheetContent>
        </Sheet>
      )
    }

    return (
      <div
        ref={ref}
        className="group peer hidden text-sidebar-foreground md:block"
        data-state={state}
        data-collapsible={state === "collapsed" ? collapsible : ""}
        data-variant={variant}
        data-side={side}
      >
        {/* This is what handles the sidebar gap on desktop */}
        <div
          className={cn(
            "relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear",
            "group-data-[collapsible=offcanvas]:w-0",
            "group-data-[side=right]:rotate-180",
            variant === "floating" || variant === "inset"
              ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]"
          )}
        />
        <div
          className={cn(
            "fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",
            side === "left"
              ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
              : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
            // Adjust the padding for floating and inset variants.
            variant === "floating" || variant === "inset"
              ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
              : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
            className
          )}
          {...props}
        >
          <div
            data-sidebar="sidebar"
            className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
          >
            {children}
          </div>
        </div>
      </div>
    )
  }
)
Sidebar.displayName = "Sidebar"

const SidebarTrigger = React.forwardRef<
  React.ElementRef<typeof Button>,
  React.ComponentProps<typeof Button>
>(({ className, onClick, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <Button
      ref={ref}
      data-sidebar="trigger"
      variant="ghost"
      size="icon"
      className={cn("h-7 w-7", className)}
      onClick={(event) => {
        onClick?.(event)
        toggleSidebar()
      }}
      {...props}
    >
      <PanelLeft />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  )
})
SidebarTrigger.displayName = "SidebarTrigger"

const SidebarRail = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button">
>(({ className, ...props }, ref) => {
  const { toggleSidebar } = useSidebar()

  return (
    <button
      ref={ref}
      data-sidebar="rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className
      )}
      {...props}
    />
  )
})
SidebarRail.displayName = "SidebarRail"

const SidebarInset = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"main">
>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex w-full flex-1 flex-col bg-background",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className
      )}
      {...props}
    />
  )
})
SidebarInset.displayName = "SidebarInset"

const SidebarInput = React.forwardRef<
  React.ElementRef<typeof Input>,
  React.ComponentProps<typeof Input>
>(({ className, ...props }, ref) => {
  return (
    <Input
      ref={ref}
      data-sidebar="input"
      className={cn(
        "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
        className
      )}
      {...props}
    />
  )
})
SidebarInput.displayName = "SidebarInput"

const SidebarHeader = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarHeader.displayName = "SidebarHeader"

const SidebarFooter = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  )
})
SidebarFooter.displayName = "SidebarFooter"

const SidebarSeparator = React.forwardRef<
  React.ElementRef<typeof Separator>,
  React.ComponentProps<typeof Separator>
>(({ className, ...props }, ref) => {
  return (
    <Separator
      ref={ref}
      data-sidebar="separator"
      className={cn("mx-2 w-auto bg-sidebar-border", className)}
      {...props}
    />
  )
})
SidebarSeparator.displayName = "SidebarSeparator"

const SidebarContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarContent.displayName = "SidebarContent"

const SidebarGroup = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  )
})
SidebarGroup.displayName = "SidebarGroup"

const SidebarGroupLabel = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "div"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-label"
      className={cn(
        "flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupLabel.displayName = "SidebarGroupLabel"

const SidebarGroupAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & { asChild?: boolean }
>(({ className, asChild = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="group-action"
      className={cn(
        "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarGroupAction.displayName = "SidebarGroupAction"

const SidebarGroupContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="group-content"
    className={cn("w-full text-sm", className)}
    {...props}
  />
))
SidebarGroupContent.displayName = "SidebarGroupContent"

const SidebarMenu = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu"
    className={cn("flex w-full min-w-0 flex-col gap-1", className)}
    {...props}
  />
))
SidebarMenu.displayName = "SidebarMenu"

const SidebarMenuItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    data-sidebar="menu-item"
    className={cn("group/menu-item relative", className)}
    {...props}
  />
))
SidebarMenuItem.displayName = "SidebarMenuItem"

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    isActive?: boolean
    tooltip?: string | React.ComponentProps<typeof TooltipContent>
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(
  (
    {
      asChild = false,
      isActive = false,
      variant = "default",
      size = "default",
      tooltip,
      className,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button"
    const { isMobile, state } = useSidebar()

    const button = (
      <Comp
        ref={ref}
        data-sidebar="menu-button"
        data-size={size}
        data-active={isActive}
        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
        {...props}
      />
    )

    if (!tooltip) {
      return button
    }

    if (typeof tooltip === "string") {
      tooltip = {
        children: tooltip,
      }
    }

    return (
      <Tooltip>
        <TooltipTrigger asChild>{button}</TooltipTrigger>
        <TooltipContent
          side="right"
          align="center"
          hidden={state !== "collapsed" || isMobile}
          {...tooltip}
        />
      </Tooltip>
    )
  }
)
SidebarMenuButton.displayName = "SidebarMenuButton"

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean
    showOnHover?: boolean
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuAction.displayName = "SidebarMenuAction"

const SidebarMenuBadge = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div">
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    data-sidebar="menu-badge"
    className={cn(
      "pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground",
      "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
      "peer-data-[size=sm]/menu-button:top-1",
      "peer-data-[size=default]/menu-button:top-1.5",
      "peer-data-[size=lg]/menu-button:top-2.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuBadge.displayName = "SidebarMenuBadge"

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`
  }, [])

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && (
        <Skeleton
          className="size-4 rounded-md"
          data-sidebar="menu-skeleton-icon"
        />
      )}
      <Skeleton
        className="h-4 max-w-[--skeleton-width] flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  )
})
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton"

const SidebarMenuSub = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    data-sidebar="menu-sub"
    className={cn(
      "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
      "group-data-[collapsible=icon]:hidden",
      className
    )}
    {...props}
  />
))
SidebarMenuSub.displayName = "SidebarMenuSub"

const SidebarMenuSubItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ ...props }, ref) => <li ref={ref} {...props} />)
SidebarMenuSubItem.displayName = "SidebarMenuSubItem"

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean
    size?: "sm" | "md"
    isActive?: boolean
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className
      )}
      {...props}
    />
  )
})
SidebarMenuSubButton.displayName = "SidebarMenuSubButton"

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
}
```

### ui/skeleton.tsx
```tsx
import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      {...props}
    />
  )
}

export { Skeleton }
```

### ui/slider.tsx
```tsx
import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }
```

### ui/StickyGlassHeader.tsx
```tsx
interface StickyGlassHeaderProps {
  title?: string;
}

export default function StickyGlassHeader({ title = "WEB4TG" }: StickyGlassHeaderProps) {
  return (
    <header className="sticky top-0 z-50 backdrop-blur-3xl bg-white/5 border-b border-white/10 shadow-2xl shadow-black/5">
      <div className="max-w-md mx-auto px-4 py-5 relative">
        <div className="flex items-center justify-center">
          <h1 className="wow-gradient-text text-xl font-black drop-shadow-lg">
            {title}
          </h1>
        </div>
      </div>
      {/* Ultra transparent glass layers */}
      <div className="absolute inset-0 backdrop-blur-2xl bg-gradient-to-r from-white/3 via-white/8 to-white/3 -z-10"></div>
      <div className="absolute inset-0 backdrop-blur-xl bg-gradient-to-b from-white/6 to-white/2 -z-20"></div>
      <div className="absolute inset-0 bg-gradient-to-r from-blue-500/2 via-transparent to-purple-500/2 -z-30"></div>
      <div className="absolute inset-0 bg-gradient-to-t from-transparent via-white/1 to-white/3 -z-40"></div>
    </header>
  );
}```

### ui/switch.tsx
```tsx
import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }
```

### ui/table.tsx
```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Table = React.forwardRef<
  HTMLTableElement,
  React.HTMLAttributes<HTMLTableElement>
>(({ className, ...props }, ref) => (
  <div className="relative w-full overflow-auto">
    <table
      ref={ref}
      className={cn("w-full caption-bottom text-sm", className)}
      {...props}
    />
  </div>
))
Table.displayName = "Table"

const TableHeader = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />
))
TableHeader.displayName = "TableHeader"

const TableBody = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tbody
    ref={ref}
    className={cn("[&_tr:last-child]:border-0", className)}
    {...props}
  />
))
TableBody.displayName = "TableBody"

const TableFooter = React.forwardRef<
  HTMLTableSectionElement,
  React.HTMLAttributes<HTMLTableSectionElement>
>(({ className, ...props }, ref) => (
  <tfoot
    ref={ref}
    className={cn(
      "border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",
      className
    )}
    {...props}
  />
))
TableFooter.displayName = "TableFooter"

const TableRow = React.forwardRef<
  HTMLTableRowElement,
  React.HTMLAttributes<HTMLTableRowElement>
>(({ className, ...props }, ref) => (
  <tr
    ref={ref}
    className={cn(
      "border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",
      className
    )}
    {...props}
  />
))
TableRow.displayName = "TableRow"

const TableHead = React.forwardRef<
  HTMLTableCellElement,
  React.ThHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <th
    ref={ref}
    className={cn(
      "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
      className
    )}
    {...props}
  />
))
TableHead.displayName = "TableHead"

const TableCell = React.forwardRef<
  HTMLTableCellElement,
  React.TdHTMLAttributes<HTMLTableCellElement>
>(({ className, ...props }, ref) => (
  <td
    ref={ref}
    className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)}
    {...props}
  />
))
TableCell.displayName = "TableCell"

const TableCaption = React.forwardRef<
  HTMLTableCaptionElement,
  React.HTMLAttributes<HTMLTableCaptionElement>
>(({ className, ...props }, ref) => (
  <caption
    ref={ref}
    className={cn("mt-4 text-sm text-muted-foreground", className)}
    {...props}
  />
))
TableCaption.displayName = "TableCaption"

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
```

### ui/tabs.tsx
```tsx
import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

const Tabs = TabsPrimitive.Root

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className
    )}
    {...props}
  />
))
TabsList.displayName = TabsPrimitive.List.displayName

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",
      className
    )}
    {...props}
  />
))
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
))
TabsContent.displayName = TabsPrimitive.Content.displayName

export { Tabs, TabsList, TabsTrigger, TabsContent }
```

### ui/textarea.tsx
```tsx
import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }
```

### ui/toaster.tsx
```tsx
import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}
```

### ui/toast.tsx
```tsx
import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"

import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-visible rounded-2xl border p-6 pr-8 backdrop-blur-xl transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full animate-fade-in-up",
  {
    variants: {
      variant: {
        default: "glass-medium border-white/20 text-white shadow-xl",
        success: "glass-medium border-emerald-500/30 text-white shadow-xl shadow-emerald-500/20",
        warning: "glass-medium border-amber-500/30 text-white shadow-xl shadow-amber-500/20",
        error: "glass-medium border-rose-500/30 text-white shadow-xl shadow-rose-500/20",
        info: "glass-medium border-cyan-500/30 text-white shadow-xl shadow-cyan-500/20",
        destructive: "glass-medium border-rose-500/30 text-white shadow-xl shadow-rose-500/20",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &
    VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <ToastPrimitives.Root
      ref={ref}
      className={cn(toastVariants({ variant }), className)}
      {...props}
    />
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-3 top-3 rounded-xl p-1.5 text-white/60 opacity-0 transition-all hover:text-white hover:bg-white/10 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-white/20 group-hover:opacity-100 active-elevate-2",
      className
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title
    ref={ref}
    className={cn("text-base font-bold text-white", className)}
    {...props}
  />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description
    ref={ref}
    className={cn("text-sm text-white/80", className)}
    {...props}
  />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}
```

### ui/toggle-group.tsx
```tsx
"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root
    ref={ref}
    className={cn("flex items-center justify-center gap-1", className)}
    {...props}
  >
    <ToggleGroupContext.Provider value={{ variant, size }}>
      {children}
    </ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
))

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &
    VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
})

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName

export { ToggleGroup, ToggleGroupItem }
```

### ui/toggle.tsx
```tsx
import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3 min-w-10",
        sm: "h-9 px-2.5 min-w-9",
        lg: "h-11 px-5 min-w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &
    VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root
    ref={ref}
    className={cn(toggleVariants({ variant, size, className }))}
    {...props}
  />
))

Toggle.displayName = TogglePrimitive.Root.displayName

export { Toggle, toggleVariants }
```

### ui/tooltip.tsx
```tsx
"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"

import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
```

### ui/VirtualizedList.tsx
```tsx
import React, { useState, useEffect, useRef, useMemo } from 'react';

interface VirtualizedListProps<T> {
  items: T[];
  itemHeight: number;
  containerHeight: number;
  renderItem: (item: T, index: number) => React.ReactNode;
  overscan?: number;
  className?: string;
}

export function VirtualizedList<T>({
  items,
  itemHeight,
  containerHeight,
  renderItem,
  overscan = 5,
  className = ''
}: VirtualizedListProps<T>) {
  const [scrollTop, setScrollTop] = useState(0);
  const containerRef = useRef<HTMLDivElement>(null);

  const visibleRange = useMemo(() => {
    const startIndex = Math.max(0, Math.floor(scrollTop / itemHeight) - overscan);
    const endIndex = Math.min(
      items.length - 1,
      Math.floor((scrollTop + containerHeight) / itemHeight) + overscan
    );
    return { startIndex, endIndex };
  }, [scrollTop, itemHeight, containerHeight, items.length, overscan]);

  const visibleItems = useMemo(() => {
    return items.slice(visibleRange.startIndex, visibleRange.endIndex + 1).map((item, index) => ({
      item,
      index: visibleRange.startIndex + index
    }));
  }, [items, visibleRange]);

  const totalHeight = items.length * itemHeight;
  const offsetY = visibleRange.startIndex * itemHeight;

  const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {
    setScrollTop(e.currentTarget.scrollTop);
  };

  useEffect(() => {
    const container = containerRef.current;
    if (!container) return;

    const handlePassiveScroll = () => {
      setScrollTop(container.scrollTop);
    };

    container.addEventListener('scroll', handlePassiveScroll, { passive: true });
    return () => container.removeEventListener('scroll', handlePassiveScroll);
  }, []);

  return (
    <div
      ref={containerRef}
      className={`overflow-auto ${className}`}
      style={{ height: containerHeight }}
      onScroll={handleScroll}
    >
      <div style={{ height: totalHeight, position: 'relative' }}>
        <div
          style={{
            transform: `translateY(${offsetY}px)`,
            position: 'absolute',
            top: 0,
            left: 0,
            right: 0
          }}
        >
          {visibleItems.map(({ item, index }) => (
            <div key={index} style={{ height: itemHeight }}>
              {renderItem(item, index)}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// Hook for dynamic item heights (more complex but flexible)
export function useDynamicVirtualization<T>(
  items: T[],
  estimatedItemHeight: number,
  containerHeight: number,
  overscan: number = 5
) {
  const [scrollTop, setScrollTop] = useState(0);
  const [itemHeights, setItemHeights] = useState<Map<number, number>>(new Map());
  const itemRefs = useRef<Map<number, HTMLElement>>(new Map());

  const measureItem = (index: number, element: HTMLElement) => {
    const height = element.getBoundingClientRect().height;
    setItemHeights(prev => new Map(prev).set(index, height));
    itemRefs.current.set(index, element);
  };

  const getItemHeight = (index: number) => {
    return itemHeights.get(index) ?? estimatedItemHeight;
  };

  const getTotalHeight = () => {
    let total = 0;
    for (let i = 0; i < items.length; i++) {
      total += getItemHeight(i);
    }
    return total;
  };

  const getVisibleRange = () => {
    let currentTop = 0;
    let startIndex = 0;
    let endIndex = items.length - 1;

    // Find start index
    for (let i = 0; i < items.length; i++) {
      const itemHeight = getItemHeight(i);
      if (currentTop + itemHeight > scrollTop) {
        startIndex = Math.max(0, i - overscan);
        break;
      }
      currentTop += itemHeight;
    }

    // Find end index
    currentTop = 0;
    for (let i = 0; i < items.length; i++) {
      const itemHeight = getItemHeight(i);
      if (currentTop > scrollTop + containerHeight) {
        endIndex = Math.min(items.length - 1, i + overscan);
        break;
      }
      currentTop += itemHeight;
    }

    return { startIndex, endIndex };
  };

  const getOffsetForIndex = (index: number) => {
    let offset = 0;
    for (let i = 0; i < index; i++) {
      offset += getItemHeight(i);
    }
    return offset;
  };

  return {
    scrollTop,
    setScrollTop,
    measureItem,
    getVisibleRange,
    getOffsetForIndex,
    getTotalHeight,
    itemRefs
  };
}```

## ЧАСТЬ 2: 13 ДЕМО-ПРИЛОЖЕНИЙ

### demos/StoreBlack.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Sparkles, TrendingUp, Zap, Search, Menu, Grid, Minus, Plus, Shirt, Check } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { ConfirmDrawer, SelectDrawer } from "../ui/modern-drawer";
import { HapticButton } from "../ui/haptic-button";
import { useFilter } from "@/hooks/useFilter";
import { Skeleton } from "@/components/ui/skeleton";
// Helmet images
import helmetImg1 from '@assets/stock_images/futuristic_motorcycl_4e16eb33.jpg';
import helmetImg2 from '@assets/stock_images/futuristic_motorcycl_37d2a4c0.jpg';
// Watch images
import watchImg1 from '@assets/stock_images/smart_watch_black_pr_82d34457.jpg';
import watchImg2 from '@assets/stock_images/smart_watch_black_pr_9d517dfd.jpg';
// Carabiner images
import carabinerImg1 from '@assets/stock_images/black_carbon_carabin_e6ec5904.jpg';
import carabinerImg2 from '@assets/stock_images/black_carbon_carabin_564cdb4b.jpg';
// Jacket images
import jacketImg1 from '@assets/stock_images/black_urban_tech_jac_a96116f5.jpg';
import jacketImg2 from '@assets/stock_images/black_urban_tech_jac_db5781c2.jpg';
// Pants images
import pantsImg1 from '@assets/stock_images/black_cargo_pants_te_bc6fefb4.jpg';
import pantsImg2 from '@assets/stock_images/black_cargo_pants_te_1bf4e873.jpg';
// Gloves images
import glovesImg1 from '@assets/stock_images/black_tactical_glove_965b310c.jpg';
import glovesImg2 from '@assets/stock_images/black_tactical_glove_18ec3d8b.jpg';
// Boots images
import bootsImg1 from '@assets/stock_images/black_tactical_boots_8ba948bd.jpg';
import bootsImg2 from '@assets/stock_images/black_tactical_boots_fe0be5c1.jpg';
// Backpack images
import backpackImg1 from '@assets/stock_images/black_backpack_tech__ec98b9d5.jpg';
import backpackImg2 from '@assets/stock_images/black_backpack_tech__e021311c.jpg';
// Sunglasses images
import sunglassesImg1 from '@assets/stock_images/black_sunglasses_pre_3ef9a455.jpg';
import sunglassesImg2 from '@assets/stock_images/black_sunglasses_pre_9e5b9b98.jpg';

interface StoreBlackProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  size: string;
  quantity: number;
  image: string;
  color: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Product {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  sizes: string[];
  colors: string[];
  colorHex: string[];
  category: string;
  gender: 'Tech' | 'Premium' | 'Urban';
  inStock: number;
  rating: number;
  brand: string;
  isNew?: boolean;
  isTrending?: boolean;
}

const products: Product[] = [
  { 
    id: 1, 
    name: 'Ludens M1 Helmet', 
    price: 37449, 
    oldPrice: 45900,
    image: helmetImg1, 
    hoverImage: helmetImg2,
    description: 'Футуристический шлем Ludens M1 с LED подсветкой и защитой премиум класса', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Графит'], 
    colorHex: ['#1A1A1A', '#2D2D2D'],
    category: 'Шлемы', 
    gender: 'Tech',
    inStock: 15, 
    rating: 5.0, 
    brand: 'LUDENS',
    isNew: true,
    isTrending: true
  },
  { 
    id: 2, 
    name: 'Ludens M2 Helmet', 
    price: 42999, 
    oldPrice: 52900,
    image: helmetImg2, 
    hoverImage: helmetImg1,
    description: 'Улучшенная версия M2 с расширенными возможностями и голографическим дисплеем', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Карбон'], 
    colorHex: ['#000000', '#1A1A1A'],
    category: 'Шлемы', 
    gender: 'Tech',
    inStock: 8, 
    rating: 5.0, 
    brand: 'LUDENS',
    isNew: true,
    isTrending: true
  },
  { 
    id: 3, 
    name: 'Tech Watch Pro', 
    price: 29900, 
    oldPrice: 37900,
    image: watchImg1, 
    hoverImage: watchImg2,
    description: 'Умные часы с AI ассистентом и расширенными биометрическими датчиками', 
    sizes: ['38mm', '42mm', '45mm'], 
    colors: ['Черный', 'Титан', 'Золото'], 
    colorHex: ['#000000', '#4A5568', '#FFD700'],
    category: 'Аксессуары', 
    gender: 'Tech',
    inStock: 25, 
    rating: 4.9, 
    brand: 'TECH',
    isNew: true,
    isTrending: true
  },
  { 
    id: 4, 
    name: 'Carbon Carabiner', 
    price: 8999, 
    oldPrice: 12900,
    image: carabinerImg1, 
    hoverImage: carabinerImg2,
    description: 'Карабин из углеродного волокна с нано-покрытием и защитой от взлома', 
    sizes: ['One Size'], 
    colors: ['Карбон', 'Матовый Черный'], 
    colorHex: ['#1A1A1A', '#000000'],
    category: 'Аксессуары', 
    gender: 'Urban',
    inStock: 50, 
    rating: 4.8, 
    brand: 'CARBON',
    isNew: true
  },
  { 
    id: 5, 
    name: 'Urban Jacket', 
    price: 54900, 
    oldPrice: 67000,
    image: jacketImg1, 
    hoverImage: jacketImg2,
    description: 'Урбан куртка с умной тканью, водоотталкивающим покрытием и встроенным подогревом', 
    sizes: ['XS', 'S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Графит', 'Midnight'], 
    colorHex: ['#000000', '#2D2D2D', '#1A1A2E'],
    category: 'Одежда', 
    gender: 'Urban',
    inStock: 12, 
    rating: 5.0, 
    brand: 'URBAN',
    isNew: true,
    isTrending: true
  },
  { 
    id: 6, 
    name: 'Tech Pants', 
    price: 34900, 
    oldPrice: 42900,
    image: pantsImg1, 
    hoverImage: pantsImg2,
    description: 'Технологичные штаны с карманами для гаджетов и антистатическим покрытием', 
    sizes: ['XS', 'S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Карго'], 
    colorHex: ['#000000', '#2C3E50'],
    category: 'Одежда', 
    gender: 'Urban',
    inStock: 18, 
    rating: 4.9, 
    brand: 'URBAN',
    isNew: true
  },
  { 
    id: 7, 
    name: 'Cyber Gloves Pro', 
    price: 15900, 
    oldPrice: 19900,
    image: glovesImg1, 
    hoverImage: glovesImg2,
    description: 'Перчатки с тактильной обратной связью для VR и сенсорными панелями', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Графит'], 
    colorHex: ['#000000', '#1A1A1A'],
    category: 'Аксессуары', 
    gender: 'Tech',
    inStock: 30, 
    rating: 4.9, 
    brand: 'CYBER',
    isTrending: true
  },
  { 
    id: 8, 
    name: 'Tactical Backpack X1', 
    price: 27900, 
    oldPrice: 35900,
    image: backpackImg1, 
    hoverImage: backpackImg2,
    description: 'Тактический рюкзак с защитой от воды, RFID блокировкой и USB зарядкой', 
    sizes: ['One Size'], 
    colors: ['Черный', 'Midnight'], 
    colorHex: ['#000000', '#1A1A2E'],
    category: 'Аксессуары', 
    gender: 'Urban',
    inStock: 20, 
    rating: 5.0, 
    brand: 'TACTICAL',
    isNew: true
  },
  { 
    id: 9, 
    name: 'Tactical Boots V2', 
    price: 45900, 
    oldPrice: 59900,
    image: bootsImg1, 
    hoverImage: bootsImg2,
    description: 'Тактические ботинки с усиленной защитой и антискользящей подошвой', 
    sizes: ['39', '40', '41', '42', '43', '44', '45'], 
    colors: ['Черный', 'Карбон', 'Неон'], 
    colorHex: ['#000000', '#1A1A1A', '#FFD700'],
    category: 'Одежда', 
    gender: 'Tech',
    inStock: 15, 
    rating: 4.8, 
    brand: 'TACTICAL',
    isTrending: true
  },
  { 
    id: 10, 
    name: 'Nano Sunglasses', 
    price: 18900, 
    oldPrice: 24900,
    image: sunglassesImg1, 
    hoverImage: sunglassesImg2,
    description: 'Очки с нано-покрытием, защитой от UV и встроенным HUD дисплеем', 
    sizes: ['One Size'], 
    colors: ['Черный', 'Матовый'], 
    colorHex: ['#000000', '#1A1A1A'],
    category: 'Аксессуары', 
    gender: 'Premium',
    inStock: 40, 
    rating: 4.9, 
    brand: 'NANO',
    isNew: true
  },
];

const categories = ['Все', 'Шлемы', 'Аксессуары', 'Одежда'];
const genderFilters = ['All', 'Tech', 'Premium', 'Urban'];

const getDelayClass = (index: number) => {
  const delays = ['scroll-fade-in', 'scroll-fade-in-delay-1', 'scroll-fade-in-delay-2', 'scroll-fade-in-delay-3', 'scroll-fade-in-delay-4', 'scroll-fade-in-delay-5'];
  return delays[index % delays.length];
};

function StoreBlack({ activeTab }: StoreBlackProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [selectedColor, setSelectedColor] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [selectedGender, setSelectedGender] = useState<string>('All');
  const [quantity, setQuantity] = useState(1);
  const [orders, setOrders] = useState<Order[]>([]);
  const [showOrderSuccess, setShowOrderSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: products,
    searchFields: ['name', 'description', 'category', 'brand'] as (keyof Product)[],
  });

  const handleImageLoad = (id: number) => {
    setLoadedImages(prev => new Set([...Array.from(prev), id]));
  };

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedProduct(null);
    }
    if (activeTab !== 'home') {
      setSelectedGender('All');
    }
  }, [activeTab]);

  const filteredProducts = filteredItems.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    
    if (activeTab === 'home') {
      const genderMatch = selectedGender === 'All' || p.gender === selectedGender;
      return categoryMatch && genderMatch;
    }
    
    return categoryMatch;
  });

  const toggleFavorite = (productId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(productId)) {
      newFavorites.delete(productId);
    } else {
      newFavorites.add(productId);
    }
    setFavorites(newFavorites);
  };

  const openProduct = (product: Product) => {
    setSelectedProduct(product);
    setSelectedSize(product.sizes[0]);
    setSelectedColor(product.colors[0]);
    setQuantity(1);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedProduct.name,
      price: selectedProduct.price,
      size: selectedSize,
      quantity: quantity,
      image: selectedProduct.image,
      color: selectedColor
    };
    
    setCart([...cart, cartItem]);
    setSelectedProduct(null);
  };

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0),
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
    setShowOrderSuccess(true);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  // PRODUCT DETAIL PAGE
  if (activeTab === 'catalog' && selectedProduct) {
    const bgColor = selectedProduct.colorHex[selectedProduct.colors.indexOf(selectedColor)] || '#000000';
    
    return (
      <div className="min-h-screen text-white overflow-auto" style={{ backgroundColor: bgColor }}>
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedProduct(null)}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center hover:bg-white/30 transition-all"
            data-testid="button-back"
            aria-label="Назад"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedProduct.id);
            }}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center hover:bg-white/30 transition-all"
            data-testid={`button-favorite-${selectedProduct.id}`}
            aria-label="Избранное"
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedProduct.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh] scroll-fade-in">
          <img
            src={selectedProduct.hoverImage}
            alt={selectedProduct.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
        </div>

        <div className="bg-white/5 backdrop-blur-xl rounded-t-3xl border-t border-white/10 p-6 space-y-6 pb-32 scroll-fade-in-delay-1">
          <div className="text-center">
            <h2 className="text-3xl font-bold mb-2">{selectedProduct.name}</h2>
            <p className="text-sm text-white/60 mb-3">{selectedProduct.brand}</p>
            <div className="flex items-center justify-center gap-3">
              <p className="text-4xl font-bold" style={{ color: '#FFD700' }}>
                {formatPrice(selectedProduct.price)}
              </p>
              {selectedProduct.oldPrice && (
                <p className="text-xl text-white/40 line-through">{formatPrice(selectedProduct.oldPrice)}</p>
              )}
            </div>
          </div>

          <div className="bg-white/5 border border-white/10 rounded-2xl p-4 scroll-fade-in-delay-2">
            <p className="text-sm text-white/80 text-center">{selectedProduct.description}</p>
          </div>

          <div className="scroll-fade-in-delay-3">
            <p className="text-sm mb-3 text-white/80 text-center">Выберите цвет:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedProduct.colors.map((color, idx) => (
                <button
                  key={color}
                  onClick={() => setSelectedColor(color)}
                  className={`w-12 h-12 rounded-full border-2 transition-all ${
                    selectedColor === color
                      ? 'border-[#FFD700] scale-110 shadow-lg shadow-[#FFD700]/50'
                      : 'border-white/30'
                  }`}
                  style={{ backgroundColor: selectedProduct.colorHex[idx] }}
                  data-testid={`button-color-${color}`}
                />
              ))}
            </div>
          </div>

          <div className="scroll-fade-in-delay-4">
            <p className="text-sm mb-3 text-white/80 text-center">Выберите размер:</p>
            <div className="flex items-center justify-center gap-3 flex-wrap">
              {selectedProduct.sizes.map((size) => (
                <button
                  key={size}
                  onClick={() => setSelectedSize(size)}
                  className={`px-4 py-2.5 rounded-full font-semibold transition-all ${
                    selectedSize === size
                      ? 'bg-[#FFD700] text-black shadow-lg shadow-[#FFD700]/30'
                      : 'bg-white/10 text-white hover:bg-white/20 border border-white/20'
                  }`}
                  data-testid={`button-size-${size}`}
                >
                  {size}
                </button>
              ))}
            </div>
          </div>

          <div className="scroll-fade-in-delay-5">
            <p className="text-sm mb-3 text-white/80 text-center">Количество:</p>
            <div className="flex items-center justify-center gap-4 bg-white/5 rounded-full px-6 py-3 border border-white/10 w-fit mx-auto">
              <button
                onClick={() => setQuantity(Math.max(1, quantity - 1))}
                className="text-white/60 hover:text-white transition-colors"
                data-testid="button-decrease-quantity"
                aria-label="Уменьшить количество"
              >
                <Minus className="w-5 h-5" />
              </button>
              <span className="text-2xl font-bold w-16 text-center" style={{ color: '#FFD700' }}>
                {quantity.toString().padStart(2, '0')}
              </span>
              <button
                onClick={() => setQuantity(quantity + 1)}
                className="text-white/60 hover:text-white transition-colors"
                data-testid="button-increase-quantity"
                aria-label="Увеличить количество"
              >
                <Plus className="w-5 h-5" />
              </button>
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full font-bold py-4 rounded-full transition-all hover:scale-105 shadow-lg shadow-[#FFD700]/30"
                style={{ backgroundColor: '#FFD700', color: '#000000' }}
                data-testid={`button-add-to-cart-${selectedProduct.id}`}
              >
                Добавить в корзину • {formatPrice(selectedProduct.price * quantity)}
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedProduct.name} • ${selectedColor} • ${selectedSize} • ${quantity} шт.`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />

          <div className="grid grid-cols-3 gap-3 pt-4">
            <div className="bg-white/5 border border-white/10 rounded-xl p-3 text-center">
              <Star className="w-5 h-5 mx-auto mb-1" style={{ color: '#FFD700' }} />
              <p className="text-xs text-white/60">Рейтинг</p>
              <p className="text-sm font-bold">{selectedProduct.rating}</p>
            </div>
            <div className="bg-white/5 border border-white/10 rounded-xl p-3 text-center">
              <Package className="w-5 h-5 mx-auto mb-1" style={{ color: '#FFD700' }} />
              <p className="text-xs text-white/60">В наличии</p>
              <p className="text-sm font-bold">{selectedProduct.inStock}</p>
            </div>
            <div className="bg-white/5 border border-white/10 rounded-xl p-3 text-center">
              <Zap className="w-5 h-5 mx-auto mb-1" style={{ color: '#FFD700' }} />
              <p className="text-xs text-white/60">Доставка</p>
              <p className="text-sm font-bold">1-2 дня</p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // HOME PAGE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-24">
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-8 scroll-fade-in">
            <div className="flex items-center gap-3">
              <Grid className="w-8 h-8" style={{ color: '#FFD700' }} />
              <h1 className="text-5xl font-black tracking-tighter">STORE</h1>
            </div>
            <div className="flex items-center gap-3">
              <button className="relative" data-testid="button-view-cart" aria-label="Корзина">
                <ShoppingBag className="w-6 h-6" style={{ color: '#FFD700' }} />
                {cart.length > 0 && (
                  <span className="absolute -top-2 -right-2 w-5 h-5 bg-[#FFD700] text-black text-xs font-bold rounded-full flex items-center justify-center">
                    {cart.length}
                  </span>
                )}
              </button>
              <button data-testid="button-view-favorites" aria-label="Избранное">
                <Heart className="w-6 h-6" style={{ color: favorites.size > 0 ? '#FFD700' : 'white' }} />
              </button>
            </div>
          </div>

          <div className="flex items-center gap-4 mb-6 scroll-fade-in">
            <button 
              className="p-2 rounded-full"
              style={{ backgroundColor: '#FFD700' }}
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((gender) => (
              <button
                key={gender}
                onClick={() => setSelectedGender(gender)}
                className={`text-sm font-medium transition-colors ${
                  selectedGender === gender
                    ? 'text-white'
                    : 'text-white/40'
                }`}
                style={selectedGender === gender ? { color: '#FFD700' } : {}}
                data-testid={`button-filter-${gender.toLowerCase()}`}
              >
                {gender}
              </button>
            ))}
          </div>

          <div className="flex items-center gap-3 mb-6 scroll-fade-in">
            <div className="flex-1 bg-white/5 backdrop-blur-xl rounded-full px-4 py-3 flex items-center gap-2 border border-white/10">
              <Search className="w-5 h-5 text-white/50" />
              <input
                type="text"
                placeholder="Поиск товаров..."
                value={searchQuery}
                onChange={(e) => handleSearch(e.target.value)}
                className="bg-transparent text-white placeholder:text-white/50 outline-none flex-1 text-sm"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        <div className="relative mb-6 mx-6 rounded-3xl overflow-hidden bg-white/5 border border-white/10 scroll-fade-in" style={{ height: '500px' }}>
          <img
            src={helmetImg1}
            alt="Hero Banner"
            className="absolute inset-0 w-full h-full object-cover"
          />
          
          <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
          
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <div className="flex items-center gap-2 mb-3">
                <Sparkles className="w-5 h-5" style={{ color: '#FFD700' }} />
                <span className="text-sm font-bold" style={{ color: '#FFD700' }}>NEW COLLECTION</span>
              </div>
              <h2 className="text-6xl font-black mb-3 tracking-tight leading-tight">
                TECH<br/>
                FUTURE
              </h2>
              <p className="text-lg text-white/80 mb-6" style={{ letterSpacing: '0.1em' }}>
                Эксклюзивная коллекция 2025
              </p>
              <button 
                className="px-8 py-4 rounded-full font-bold transition-all hover:scale-105 shadow-lg shadow-[#FFD700]/50"
                style={{ backgroundColor: '#FFD700', color: '#000000' }}
                data-testid="button-view-collection"
              >
                Смотреть коллекцию
              </button>
            </m.div>
          </div>
        </div>

        <div className="px-6 space-y-4">
          {filteredProducts.slice(0, 3).map((product, idx) => (
            <m.div
              key={product.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openProduct(product)}
              className="relative cursor-pointer group rounded-3xl overflow-hidden bg-white/5 border border-white/10 scroll-fade-in"
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`card-product-${product.id}`}
            >
              <div className="absolute inset-0">
                <img
                  src={product.image}
                  alt={product.name}
                  className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
              </div>

              <div className="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent"></div>

              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-white/10 backdrop-blur-xl rounded-full border border-white/20">
                  <span className="text-xs font-semibold" style={{ color: product.isNew ? '#FFD700' : 'white' }}>
                    {product.isNew ? 'New' : product.category}
                  </span>
                </div>
              </div>

              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(product.id);
                }}
                className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/10 backdrop-blur-xl flex items-center justify-center border border-white/20 hover:bg-white/20 transition-all"
                data-testid={`button-favorite-${product.id}`}
                aria-label="Избранное"
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(product.id) ? 'fill-[#FFD700] text-[#FFD700]' : 'text-white'}`}
                />
              </button>

              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <h3 className="text-2xl font-bold mb-2 leading-tight">
                      {product.name}
                    </h3>
                    <p className="text-sm text-white/80 mb-4">{product.gender} Collection</p>
                  </div>

                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openProduct(product);
                    }}
                    className="w-14 h-14 rounded-full flex items-center justify-center transition-all hover:scale-110 shadow-lg shadow-[#FFD700]/30"
                    style={{ backgroundColor: '#FFD700' }}
                    data-testid={`button-add-to-cart-${product.id}`}
                    aria-label="Добавить в корзину"
                  >
                    <ShoppingBag className="w-6 h-6 text-black" />
                  </button>
                </div>

                <div className="mt-3">
                  <p className="text-2xl font-bold" style={{ color: '#FFD700' }}>
                    {formatPrice(product.price)}
                  </p>
                  {product.oldPrice && (
                    <p className="text-sm text-white/40 line-through">{formatPrice(product.oldPrice)}</p>
                  )}
                </div>
              </div>
            </m.div>
          ))}
        </div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <div className="flex items-center gap-3">
              <Grid className="w-6 h-6" style={{ color: '#FFD700' }} />
              <h1 className="text-3xl font-bold">Каталог</h1>
            </div>
            <div className="flex items-center gap-3">
              <button className="p-2" data-testid="button-view-search" aria-label="Поиск">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" data-testid="button-view-filter" aria-label="Фильтр">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide scroll-fade-in">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all border ${
                  selectedCategory === cat
                    ? 'text-black border-[#FFD700]'
                    : 'bg-white/5 text-white/70 hover:bg-white/10 border-white/10'
                }`}
                style={selectedCategory === cat ? { backgroundColor: '#FFD700' } : {}}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-4">
            {filteredProducts.map((product, idx) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer ${idx < 4 ? 'scroll-fade-in' : getDelayClass(idx)}`}
                data-testid={`card-product-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-3xl overflow-hidden mb-3 bg-white/5 border border-white/10 group">
                  <img
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                    loading="lazy"
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/40 backdrop-blur-xl flex items-center justify-center border border-white/20"
                    data-testid={`button-favorite-${product.id}`}
                    aria-label="Избранное"
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-[#FFD700] text-[#FFD700]' : 'text-white'}`}
                    />
                  </button>

                  {product.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 text-black text-xs font-bold rounded-full" style={{ backgroundColor: '#FFD700' }}>
                      NEW
                    </div>
                  )}

                  {product.isTrending && (
                    <div className="absolute bottom-2 left-2 px-2 py-1 bg-white/10 backdrop-blur-xl text-white text-xs font-bold rounded-full border border-white/20 flex items-center gap-1">
                      <TrendingUp className="w-3 h-3" />
                      Trending
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-sm font-semibold mb-1 truncate">{product.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold" style={{ color: '#FFD700' }}>
                      {formatPrice(product.price)}
                    </p>
                    {product.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(product.oldPrice)}</p>
                    )}
                  </div>
                  <div className="flex items-center gap-1 mt-1">
                    <Star className="w-3 h-3 fill-[#FFD700]" style={{ color: '#FFD700' }} />
                    <span className="text-xs text-white/60">{product.rating}</span>
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-32">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <div className="flex items-center gap-3">
              <ShoppingBag className="w-6 h-6" style={{ color: '#FFD700' }} />
              <h1 className="text-3xl font-bold">Корзина</h1>
            </div>
            {cart.length > 0 && (
              <button 
                onClick={() => setCart([])}
                className="text-sm text-white/60 hover:text-white transition-colors"
                data-testid="button-clear-cart"
              >
                Очистить все
              </button>
            )}
          </div>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20 scroll-fade-in-delay-1">
              <div className="w-32 h-32 rounded-full bg-white/5 flex items-center justify-center mb-6 border border-white/10">
                <ShoppingBag className="w-16 h-16 text-white/20" />
              </div>
              <p className="text-white/50 text-center text-lg mb-2">Ваша корзина пуста</p>
              <p className="text-white/30 text-center text-sm">Добавьте товары из каталога</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item, idx) => (
                <div
                  key={item.id}
                  className={`bg-white/5 backdrop-blur-xl rounded-2xl p-4 flex gap-4 border border-white/10 ${idx < 2 ? 'scroll-fade-in' : getDelayClass(idx)}`}
                  data-testid={`cart-item-${item.id}`}
                >
                  <div className="w-24 h-24 rounded-xl overflow-hidden bg-white/5 border border-white/10">
                    <img
                      src={item.image}
                      alt={item.name}
                      className="w-full h-full object-cover"
                      loading="lazy"
                    />
                  </div>
                  <div className="flex-1">
                    <h3 className="font-semibold mb-1">{item.name}</h3>
                    <p className="text-sm text-white/60 mb-2">
                      {item.color} • {item.size} • Кол-во: {item.quantity}
                    </p>
                    <p className="text-lg font-bold" style={{ color: '#FFD700' }}>
                      {formatPrice(item.price * item.quantity)}
                    </p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-8 h-8 hover:bg-white/10 rounded-lg transition-all"
                    data-testid={`button-remove-${item.id}`}
                    aria-label="Удалить"
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-black border-t border-white/10">
                <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10 mb-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-white/60">Товары ({cart.length})</span>
                    <span className="font-semibold">{formatPrice(total)}</span>
                  </div>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-white/60">Доставка</span>
                    <span className="font-semibold" style={{ color: '#FFD700' }}>Бесплатно</span>
                  </div>
                  <div className="h-px bg-white/10 my-3"></div>
                  <div className="flex items-center justify-between">
                    <span className="text-xl font-semibold">Итого:</span>
                    <span className="text-2xl font-bold" style={{ color: '#FFD700' }}>{formatPrice(total)}</span>
                  </div>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full font-bold py-4 rounded-full transition-all hover:scale-105 shadow-lg shadow-[#FFD700]/30"
                      style={{ backgroundColor: '#FFD700', color: '#000000' }}
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(total)}`}
                  confirmText="Подтвердить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>

              <ConfirmDrawer
                open={showOrderSuccess}
                onOpenChange={setShowOrderSuccess}
                trigger={<span />}
                title="Заказ оформлен!"
                description="Ваш заказ успешно создан и передан в обработку. Вы можете отслеживать статус в разделе 'Мои заказы'"
                confirmText="Отлично"
                cancelText=""
                variant="default"
                onConfirm={() => setShowOrderSuccess(false)}
                icon={<Check className="w-8 h-8 text-emerald-400" />}
              />
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-24">
        <div className="p-6 bg-white/5 backdrop-blur-xl border-b border-white/10 scroll-fade-in">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-20 h-20 bg-gradient-to-br rounded-full flex items-center justify-center border-2" 
                 style={{ borderColor: '#FFD700', background: 'linear-gradient(135deg, #FFD700 0%, #000000 100%)' }}>
              <User className="w-10 h-10 text-white" />
            </div>
            <div>
              <h2 className="text-2xl font-bold">Tech User</h2>
              <p className="text-sm text-white/60">tech@store.black</p>
              <p className="text-sm text-white/60">+7 (999) 123-45-67</p>
            </div>
          </div>

          <div className="grid grid-cols-3 gap-3">
            <div className="p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 scroll-fade-in">
              <Package className="w-5 h-5 mb-2" style={{ color: '#FFD700' }} />
              <p className="text-xs text-white/60 mb-1">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 scroll-fade-in">
              <Heart className="w-5 h-5 mb-2" style={{ color: '#FFD700' }} />
              <p className="text-xs text-white/60 mb-1">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
            <div className="p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 scroll-fade-in">
              <Star className="w-5 h-5 mb-2" style={{ color: '#FFD700' }} />
              <p className="text-xs text-white/60 mb-1">Бонусы</p>
              <p className="text-2xl font-bold">1250</p>
            </div>
          </div>
        </div>

        <div className="p-4 scroll-fade-in">
          <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
          {orders.length === 0 ? (
            <div className="text-center py-8 text-white/50">
              <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
              <p>У вас пока нет заказов</p>
            </div>
          ) : (
            <div className="space-y-3">
              {orders.map((order) => (
                <div key={order.id} className="bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10" data-testid={`order-${order.id}`}>
                  <div className="flex justify-between gap-2 mb-2">
                    <span className="text-sm">Заказ #{order.id.toString().slice(-6)}</span>
                    <span className="text-white/60 text-sm">{order.date}</span>
                  </div>
                  <div className="flex justify-between gap-2 mb-2">
                    <span className="text-white/70">{order.items.length} товаров</span>
                    <span className="font-bold" style={{ color: '#FFD700' }}>{formatPrice(order.total)}</span>
                  </div>
                  <div>
                    <span className="text-xs px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded-full">
                      {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        <div className="p-4 space-y-2">
          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-1" data-testid="button-view-orders">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                <Package className="w-5 h-5" style={{ color: '#FFD700' }} />
              </div>
              <div className="text-left">
                <span className="font-medium block">Мои заказы</span>
                <span className="text-xs text-white/50">История покупок</span>
              </div>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-2" data-testid="button-view-favorites">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                <Heart className="w-5 h-5" style={{ color: '#FFD700' }} />
              </div>
              <div className="text-left">
                <span className="font-medium block">Избранное</span>
                <span className="text-xs text-white/50">{favorites.size} товаров</span>
              </div>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-3" data-testid="button-view-payment">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                <CreditCard className="w-5 h-5" style={{ color: '#FFD700' }} />
              </div>
              <div className="text-left">
                <span className="font-medium block">Способы оплаты</span>
                <span className="text-xs text-white/50">Карты и кошельки</span>
              </div>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-4" data-testid="button-view-address">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                <MapPin className="w-5 h-5" style={{ color: '#FFD700' }} />
              </div>
              <div className="text-left">
                <span className="font-medium block">Адреса доставки</span>
                <span className="text-xs text-white/50">Мои адреса</span>
              </div>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-5" data-testid="button-view-settings">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center">
                <Settings className="w-5 h-5" style={{ color: '#FFD700' }} />
              </div>
              <div className="text-left">
                <span className="font-medium block">Настройки</span>
                <span className="text-xs text-white/50">Профиль и безопасность</span>
              </div>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <div className="h-4"></div>

          <button className="w-full p-4 bg-red-500/10 backdrop-blur-xl rounded-xl border border-red-500/20 flex items-center justify-between hover:bg-red-500/20 transition-all" data-testid="button-logout">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center">
                <LogOut className="w-5 h-5 text-red-400" />
              </div>
              <div className="text-left">
                <span className="font-medium text-red-400 block">Выйти</span>
                <span className="text-xs text-red-400/60">Выход из аккаунта</span>
              </div>
            </div>
          </button>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(StoreBlack);
```

### demos/Electronics.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m } from "framer-motion";
import { 
  Smartphone, 
  Heart, 
  Star, 
  ShoppingCart, 
  X,
  Zap,
  TrendingUp,
  Monitor,
  Headphones,
  Camera,
  Sparkles,
  Package,
  User,
  Settings,
  LogOut,
  CreditCard,
  MapPin,
  ChevronLeft,
  Cpu,
  Battery,
  Wifi,
  Search,
  Filter,
  Menu
} from "lucide-react";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { Skeleton } from "../ui/skeleton";
import { useFilter } from "@/hooks/useFilter";

interface ElectronicsProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  quantity: number;
  image: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Product {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  category: string;
  brand: string;
  inStock: number;
  rating: number;
  specs: string[];
  isNew?: boolean;
  isTrending?: boolean;
}

const products: Product[] = [
  { 
    id: 1, 
    name: 'iPhone 15 Pro Max', 
    price: 109900, 
    oldPrice: 129900, 
    image: 'https://images.unsplash.com/photo-1678652197950-37846b632180?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1695048133142-1a20484d2569?w=800&h=1200&fit=crop&q=90',
    description: 'Флагманский смартфон Apple с чипом A17 Pro и титановым корпусом', 
    category: 'Смартфоны', 
    brand: 'Apple', 
    inStock: 15, 
    rating: 4.9, 
    specs: ['6.7" Super Retina XDR', 'A17 Pro чип', '256GB накопитель', '48MP камера', 'Титановый корпус'], 
    isNew: true, 
    isTrending: true 
  },
  { 
    id: 2, 
    name: 'Samsung Galaxy S24 Ultra', 
    price: 99900, 
    oldPrice: 119900, 
    image: 'https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=800&h=1200&fit=crop&q=90',
    description: 'Премиальный Android-смартфон с S Pen и AI-функциями', 
    category: 'Смартфоны', 
    brand: 'Samsung', 
    inStock: 12, 
    rating: 4.8, 
    specs: ['6.8" Dynamic AMOLED', 'Snapdragon 8 Gen 3', '512GB памяти', '200MP камера', 'S Pen в комплекте'], 
    isNew: true, 
    isTrending: true 
  },
  { 
    id: 3, 
    name: 'MacBook Pro 16"', 
    price: 249900, 
    image: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?w=800&h=1200&fit=crop&q=90',
    description: 'Мощный ноутбук для профессионалов с чипом M3 Max', 
    category: 'Ноутбуки', 
    brand: 'Apple', 
    inStock: 8, 
    rating: 4.9, 
    specs: ['16.2" Liquid Retina XDR', 'M3 Max чип', '32GB unified memory', '1TB SSD', '22 часа работы'], 
    isTrending: true 
  },
  { 
    id: 4, 
    name: 'Dell XPS 15', 
    price: 129900, 
    image: 'https://images.unsplash.com/photo-1593642632823-8f785ba67e45?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=800&h=1200&fit=crop&q=90',
    description: 'Компактный и производительный ультрабук для работы', 
    category: 'Ноутбуки', 
    brand: 'Dell', 
    inStock: 10, 
    rating: 4.7, 
    specs: ['15.6" OLED 3.5K', 'Intel Core i7-13700H', '16GB DDR5', '512GB NVMe SSD', 'NVIDIA RTX 4050'] 
  },
  { 
    id: 5, 
    name: 'iPad Pro 12.9"', 
    price: 109900, 
    image: 'https://images.unsplash.com/photo-1585790050230-5dd28404f120?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1544244015-0df4b3ffc6b0?w=800&h=1200&fit=crop&q=90',
    description: 'Профессиональный планшет с M2 чипом и поддержкой Apple Pencil', 
    category: 'Планшеты', 
    brand: 'Apple', 
    inStock: 14, 
    rating: 4.8, 
    specs: ['12.9" Liquid Retina XDR', 'M2 чип', '128GB памяти', 'Apple Pencil (2-го поколения)', 'Face ID'], 
    isNew: true 
  },
  { 
    id: 6, 
    name: 'Sony WH-1000XM5', 
    price: 35900, 
    image: 'https://images.unsplash.com/photo-1546435770-a3e426bf472b?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=800&h=1200&fit=crop&q=90',
    description: 'Беспроводные наушники с лучшим шумоподавлением', 
    category: 'Наушники', 
    brand: 'Sony', 
    inStock: 25, 
    rating: 4.8, 
    specs: ['30 часов работы', 'Bluetooth 5.2', 'HD шумоподавление', '8 микрофонов', 'Быстрая зарядка'], 
    isTrending: true 
  },
  { 
    id: 7, 
    name: 'AirPods Pro 2', 
    price: 24900, 
    image: 'https://images.unsplash.com/photo-1600294037681-c80b4cb5b434?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=800&h=1200&fit=crop&q=90',
    description: 'Беспроводные наушники Apple с адаптивным шумоподавлением', 
    category: 'Наушники', 
    brand: 'Apple', 
    inStock: 30, 
    rating: 4.7, 
    specs: ['H2 чип', '6 часов работы', 'Пространственный звук', 'Адаптивное шумоподавление', 'MagSafe зарядка'] 
  },
  { 
    id: 8, 
    name: 'Sony Alpha A7 IV', 
    price: 249900, 
    image: 'https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=800&h=1200&fit=crop&q=90',
    description: 'Профессиональная беззеркальная камера для фото и видео', 
    category: 'Камеры', 
    brand: 'Sony', 
    inStock: 6, 
    rating: 4.9, 
    specs: ['33MP полнокадровая матрица', '4K 60p видео', '5-осевая стабилизация', '693 точки AF', '10fps серийная съёмка'] 
  },
];

const categories = ['Все', 'Смартфоны', 'Ноутбуки', 'Планшеты', 'Наушники', 'Камеры'];
const genderFilters = ['All', 'Popular', 'New', 'Sale'];

export default memo(function Electronics({ activeTab }: ElectronicsProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [cartItems, setCartItems] = useState<CartItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [selectedFilter, setSelectedFilter] = useState('All');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [showCheckoutSuccess, setShowCheckoutSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: products,
    searchFields: ['name', 'description', 'category', 'brand'] as (keyof Product)[],
  });

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedProduct(null);
    }
    if (activeTab !== 'home') {
      setSelectedFilter('All');
    }
  }, [activeTab]);

  const filteredProducts = filteredItems.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    
    if (activeTab === 'home') {
      const filterMatch = selectedFilter === 'All' || 
                         (selectedFilter === 'New' && p.isNew) ||
                         (selectedFilter === 'Popular' && p.isTrending) ||
                         (selectedFilter === 'Sale' && p.oldPrice);
      return categoryMatch && filterMatch;
    }
    
    return categoryMatch;
  });

  const handleImageLoad = (productId: number) => {
    setLoadedImages(prev => new Set(prev).add(productId));
  };

  const toggleFavorite = (productId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(productId)) {
      newFavorites.delete(productId);
    } else {
      newFavorites.add(productId);
    }
    setFavorites(newFavorites);
  };

  const openProduct = (product: Product) => {
    setSelectedProduct(product);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedProduct.name,
      price: selectedProduct.price,
      quantity: 1,
      image: selectedProduct.image
    };
    
    setCartItems([...cartItems, cartItem]);
    setSelectedProduct(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const handleCheckout = () => {
    if (cartItems.length === 0) return;
    
    const total = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const newOrder: Order = {
      id: Date.now(),
      items: [...cartItems],
      total: total,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCartItems([]);
    setShowCheckoutSuccess(true);
    setTimeout(() => setShowCheckoutSuccess(false), 3000);
  };

  // PRODUCT PAGE - УЛУЧШЕННАЯ
  if (activeTab === 'catalog' && selectedProduct) {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedProduct(null)}
            className="w-10 h-10 rounded-full bg-black/50 backdrop-blur-md flex items-center justify-center border border-white/10"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedProduct.id);
            }}
            className="w-10 h-10 rounded-full bg-black/50 backdrop-blur-md flex items-center justify-center border border-white/10"
            data-testid={`button-favorite-${selectedProduct.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedProduct.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh] bg-gradient-to-br from-white/5 to-transparent">
          <img
            src={selectedProduct.hoverImage}
            alt={selectedProduct.name}
            className="w-full h-full object-contain p-8"
            loading="lazy"
          />
        </div>

        <div className="bg-white/5 backdrop-blur-xl rounded-t-3xl p-6 space-y-6 pb-32">
          <div>
            <div className="flex items-center gap-2 mb-2">
              <span className="text-sm text-[#00D4FF] font-semibold">{selectedProduct.brand}</span>
              {selectedProduct.isNew && (
                <span className="px-2 py-1 bg-[#00D4FF] text-black text-xs font-bold rounded-full">
                  NEW
                </span>
              )}
            </div>
            <h2 className="text-2xl font-bold mb-3">{selectedProduct.name}</h2>
            <div className="flex items-center gap-3 mb-4">
              <p className="text-3xl font-bold">{formatPrice(selectedProduct.price)}</p>
              {selectedProduct.oldPrice && (
                <p className="text-xl text-white/50 line-through">{formatPrice(selectedProduct.oldPrice)}</p>
              )}
            </div>
            <div className="flex items-center gap-2 mb-4">
              <div className="flex">
                {Array.from({ length: 5 }).map((_, i) => (
                  <Star key={i} className={`w-4 h-4 ${i < Math.floor(selectedProduct.rating) ? 'fill-[#00D4FF] text-[#00D4FF]' : 'text-gray-600'}`} />
                ))}
              </div>
              <span className="text-sm text-white/70">{selectedProduct.rating}</span>
            </div>
          </div>

          <p className="text-sm text-white/70 leading-relaxed">{selectedProduct.description}</p>

          <div className="bg-white/5 rounded-2xl p-4 border border-white/10">
            <h3 className="text-sm font-semibold mb-3 flex items-center gap-2">
              <Cpu className="w-4 h-4 text-[#00D4FF]" />
              Характеристики
            </h3>
            <div className="space-y-3">
              {selectedProduct.specs.map((spec, idx) => (
                <div key={idx} className="flex items-start gap-3 text-sm">
                  <Zap className="w-4 h-4 text-[#00D4FF] mt-0.5 flex-shrink-0" />
                  <span className="text-white/80">{spec}</span>
                </div>
              ))}
            </div>
          </div>

          <div className="flex items-center gap-3 text-sm text-white/60">
            <div className="flex items-center gap-1">
              <Package className="w-4 h-4" />
              <span>В наличии: {selectedProduct.inStock} шт</span>
            </div>
            <div className="flex items-center gap-1">
              <Battery className="w-4 h-4" />
              <span>Гарантия 1 год</span>
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full bg-[#00D4FF] text-black font-bold py-4 rounded-full hover:bg-[#00BFEB] transition-all flex items-center justify-center gap-2"
                data-testid="button-buy-now"
              >
                <ShoppingCart className="w-5 h-5" />
                Добавить в корзину
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedProduct.name} — ${new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB', minimumFractionDigits: 0 }).format(selectedProduct.price)}`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />
        </div>
      </div>
    );
  }

  // HOME PAGE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <button aria-label="Меню" data-testid="button-view-menu">
              <Menu className="w-6 h-6" />
            </button>
            <div className="flex items-center gap-3">
              <button aria-label="Корзина" data-testid="button-view-cart">
                <ShoppingCart className="w-6 h-6" />
              </button>
              <button aria-label="Избранное" data-testid="button-view-favorites">
                <Heart className="w-6 h-6" />
              </button>
            </div>
          </div>

          <div className="mb-6">
            <div className="flex items-center gap-2 mb-2">
              <Zap className="w-6 h-6 text-[#00D4FF]" />
            </div>
            <h1 className="text-4xl font-black tracking-tight text-white">
              TECH
            </h1>
            <h1 className="text-4xl font-black tracking-tight text-white">
              STORE
            </h1>
          </div>

          <div className="flex items-center gap-4 mb-6">
            <button 
              className="p-2 bg-white rounded-full"
              aria-label="Главная"
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((filter) => (
              <button
                key={filter}
                onClick={() => setSelectedFilter(filter)}
                className={`text-sm font-medium transition-colors ${
                  selectedFilter === filter
                    ? 'text-white'
                    : 'text-white/40'
                }`}
                data-testid={`button-filter-${filter.toLowerCase()}`}
              >
                {filter}
              </button>
            ))}
          </div>

          <div className="flex items-center gap-3 mb-6">
            <div className="flex-1 bg-white/5 rounded-full px-4 py-3 flex items-center gap-2 border border-white/10">
              <Search className="w-5 h-5 text-white/50" />
              <input
                type="text"
                placeholder="Поиск гаджетов..."
                value={searchQuery}
                onChange={(e) => handleSearch(e.target.value)}
                className="bg-transparent text-white placeholder:text-white/50 outline-none flex-1 text-sm"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        <div className="relative mb-6 mx-6 rounded-3xl overflow-hidden" style={{ height: '500px' }}>
          <img
            src="https://images.unsplash.com/photo-1678652197950-37846b632180?w=800&h=1000&fit=crop&q=90"
            alt="Hero"
            className="absolute inset-0 w-full h-full object-cover"
          />
          
          <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
          
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <div className="flex items-center gap-2 mb-3">
                <Cpu className="w-7 h-7 text-[#00D4FF]" />
              </div>
              <h2 className="text-5xl font-black tracking-tight leading-tight text-white">
                НОВИНКИ
              </h2>
              <h2 className="text-5xl font-black mb-3 tracking-tight leading-tight text-white">
                2025
              </h2>
              <p className="text-base text-white/70 mb-6 flex items-center gap-2" style={{ letterSpacing: '0.05em' }}>
                <Wifi className="w-4 h-4 text-[#00D4FF]" />
                Передовые технологии
              </p>
              <button 
                className="px-8 py-4 rounded-full font-bold text-black transition-all hover:scale-105 bg-[#00D4FF]"
                data-testid="button-view-new"
              >
                Смотреть новинки
              </button>
            </m.div>
          </div>
        </div>

        <div className="px-6 space-y-4">
          {filteredProducts.slice(0, 3).map((product, idx) => (
            <m.div
              key={product.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openProduct(product)}
              className="relative cursor-pointer group rounded-3xl overflow-hidden"
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`featured-product-${product.id}`}
            >
              <div className="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent">
                {!loadedImages.has(product.id) && (
                  <Skeleton className="w-full h-full absolute inset-0" />
                )}
                <img
                  src={product.image}
                  alt={product.name}
                  className={`w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 ${!loadedImages.has(product.id) ? 'opacity-0' : 'opacity-100'}`}
                  loading="lazy"
                  onLoad={() => handleImageLoad(product.id)}
                />
              </div>

              <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>

              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-black/50 backdrop-blur-md rounded-full border border-white/10">
                  <span className="text-xs font-semibold text-white/90">
                    {product.brand}
                  </span>
                </div>
              </div>

              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(product.id);
                }}
                aria-label="Избранное"
                className="absolute top-4 right-4 w-10 h-10 rounded-full bg-black/50 backdrop-blur-md flex items-center justify-center border border-white/10"
                data-testid={`button-favorite-${product.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                />
              </button>

              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <h3 className="text-2xl font-bold mb-2 leading-tight">
                      {product.name}
                    </h3>
                    <p className="text-sm text-white/70 mb-4 flex items-center gap-1">
                      <Cpu className="w-4 h-4 text-[#00D4FF]" />
                      {product.category}
                    </p>
                  </div>

                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openProduct(product);
                    }}
                    aria-label="Добавить в корзину"
                    className="w-14 h-14 rounded-full bg-[#00D4FF] flex items-center justify-center transition-all hover:scale-110"
                    data-testid={`button-add-to-cart-${product.id}`}
                  >
                    <ShoppingCart className="w-6 h-6 text-black" />
                  </button>
                </div>

                <div className="mt-3">
                  <p className="text-lg font-bold text-white">{formatPrice(product.price)}</p>
                </div>
              </div>
            </m.div>
          ))}
        </div>

        <div className="h-8"></div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-2xl font-bold">Каталог</h1>
            <div className="flex items-center gap-3">
              <button className="p-2" aria-label="Поиск" data-testid="button-view-search">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" aria-label="Фильтр" data-testid="button-view-filter">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'bg-[#00D4FF] text-black'
                    : 'bg-white/10 text-white/70 hover:bg-white/15'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-4">
            {filteredProducts.map((product, idx) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer scroll-fade-in-delay-${Math.min((idx % 4) + 2, 5)}`}
                data-testid={`product-card-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-3xl overflow-hidden mb-3 bg-white/5">
                  {!loadedImages.has(product.id) && (
                    <Skeleton className="w-full h-full absolute inset-0" />
                  )}
                  <img
                    src={product.image}
                    alt={product.name}
                    className={`w-full h-full object-cover transition-opacity ${!loadedImages.has(product.id) ? 'opacity-0' : 'opacity-100'}`}
                    loading="lazy"
                    onLoad={() => handleImageLoad(product.id)}
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    aria-label="Избранное"
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/40 backdrop-blur-xl flex items-center justify-center"
                    data-testid={`button-favorite-catalog-${product.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {product.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-[#00D4FF] text-black text-xs font-bold rounded-full">
                      NEW
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-xs text-white/50 mb-1">{product.brand}</p>
                  <p className="text-sm font-semibold mb-1 truncate">{product.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold">{formatPrice(product.price)}</p>
                    {product.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(product.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Корзина</h1>

          {cartItems.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20">
              <ShoppingCart className="w-20 h-20 text-white/20 mb-4" />
              <p className="text-white/50 text-center">Ваша корзина пуста</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cartItems.map((item) => (
                <div
                  key={item.id}
                  className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 flex gap-4"
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <h3 className="font-semibold mb-1">{item.name}</h3>
                    <p className="text-lg font-bold">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCartItems(cartItems.filter(i => i.id !== item.id))}
                    aria-label="Удалить"
                    className="w-8 h-8"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-[#0A0A0A] border-t border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-semibold">Итого:</span>
                  <span className="text-2xl font-bold">{formatPrice(total)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full bg-[#00D4FF] text-black font-bold py-4 rounded-full hover:bg-[#00BFEB] transition-all"
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cartItems.length} товаров на сумму ${formatPrice(total)}`}
                  confirmText="Оформить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>
              {showCheckoutSuccess && (
                <div className="fixed top-20 left-4 right-4 bg-[#00D4FF] text-black p-4 rounded-2xl text-center font-bold z-50 animate-pulse">
                  Заказ успешно оформлен!
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6 bg-white/5 border-b border-white/10">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-[#00D4FF] rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-black" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Иван Петров</h2>
              <p className="text-sm text-muted-foreground">+7 (999) 123-45-67</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-4">
          <div className="scroll-fade-in">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-white/10 rounded-xl p-4" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between mb-2">
                      <span className="text-sm text-white/70">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-sm text-white/70">{order.date}</span>
                    </div>
                    <div className="flex justify-between mb-2">
                      <span className="text-white/80">{order.items.length} товаров</span>
                      <span className="font-bold">{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-[#00D4FF]/20 text-[#00D4FF] rounded-full">
                        {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-orders">
            <div className="flex items-center gap-3">
              <Package className="w-5 h-5 text-white/70" />
              <span className="font-medium">История заказов</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-favorites">
            <div className="flex items-center gap-3">
              <Heart className="w-5 h-5 text-white/70" />
              <span className="font-medium">Избранное</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-addresses">
            <div className="flex items-center gap-3">
              <MapPin className="w-5 h-5 text-white/70" />
              <span className="font-medium">Адреса доставки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-payment">
            <div className="flex items-center gap-3">
              <CreditCard className="w-5 h-5 text-white/70" />
              <span className="font-medium">Способы оплаты</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-settings">
            <div className="flex items-center gap-3">
              <Settings className="w-5 h-5 text-white/70" />
              <span className="font-medium">Настройки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-logout">
            <div className="flex items-center gap-3">
              <LogOut className="w-5 h-5 text-white/70" />
              <span className="font-medium">Выход</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
});
```

### demos/Beauty.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m } from "framer-motion";
import { 
  Heart, 
  Star, 
  X,
  Sparkles,
  Calendar,
  Clock,
  User,
  Gift,
  MapPin,
  Phone,
  Mail,
  ChevronLeft,
  Check,
  Package,
  Search,
  Filter,
  Menu
} from "lucide-react";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { Skeleton } from "../ui/skeleton";
import { useFilter } from "@/hooks/useFilter";

interface BeautyProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Booking {
  id: number;
  serviceName: string;
  specialist: string;
  date: string;
  time: string;
  price: number;
  image: string;
}

interface Order {
  id: number;
  items: Booking[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Service {
  id: number;
  name: string;
  price: number;
  image: string;
  description: string;
  category: string;
  duration: string;
  specialist: string;
  rating: number;
  isPopular?: boolean;
  isNew?: boolean;
}

const services: Service[] = [
  { id: 1, name: 'Классическая стрижка', price: 2500, image: 'https://images.unsplash.com/photo-1562322140-8baeececf3df?w=800&h=1200&fit=crop&q=90', description: 'Профессиональная стрижка с мытьем головы и укладкой от мастера салона', category: 'Парикмахерские', duration: '60 мин', specialist: 'Анна Смирнова', rating: 4.9, isPopular: true },
  { id: 2, name: 'Окрашивание волос', price: 6500, image: 'https://images.unsplash.com/photo-1519699047748-de8e457a634e?w=800&h=1200&fit=crop&q=90', description: 'Профессиональное окрашивание премиум красками Wella с уходом', category: 'Парикмахерские', duration: '180 мин', specialist: 'Елена Козлова', rating: 4.8, isPopular: true },
  { id: 3, name: 'Балаяж', price: 8900, image: 'https://images.unsplash.com/photo-1522337094846-8a818192de1f?w=800&h=1200&fit=crop&q=90', description: 'Модное окрашивание балаяж с плавными переходами', category: 'Парикмахерские', duration: '240 мин', specialist: 'Мария Петрова', rating: 4.9, isNew: true, isPopular: true },
  { id: 4, name: 'Маникюр + гель-лак', price: 1900, image: 'https://images.unsplash.com/photo-1632345031435-8727f6897d53?w=800&h=1200&fit=crop&q=90', description: 'Маникюр с покрытием гель-лак и дизайном на выбор', category: 'Маникюр', duration: '90 мин', specialist: 'Ольга Иванова', rating: 4.8, isPopular: true },
  { id: 5, name: 'Френч маникюр', price: 2200, image: 'https://images.unsplash.com/photo-1610992015732-2449b2604950?w=800&h=1200&fit=crop&q=90', description: 'Элегантный французский маникюр с укреплением ногтевой пластины', category: 'Маникюр', duration: '75 мин', specialist: 'Наталья Волкова', rating: 4.9 },
  { id: 6, name: 'Дизайн ногтей', price: 3500, image: 'https://images.unsplash.com/photo-1604654894610-df63bc138bb9?w=800&h=1200&fit=crop&q=90', description: 'Художественный дизайн ногтей любой сложности', category: 'Маникюр', duration: '120 мин', specialist: 'Дарья Кузнецова', rating: 4.7 },
  { id: 7, name: 'СПА педикюр', price: 3200, image: 'https://images.unsplash.com/photo-1598256989800-fe5f95da9787?w=800&h=1200&fit=crop&q=90', description: 'Расслабляющий СПА педикюр с массажем стоп и уходом', category: 'Педикюр', duration: '100 мин', specialist: 'Светлана Белова', rating: 4.9, isPopular: true },
  { id: 8, name: 'Аппаратный педикюр', price: 2800, image: 'https://images.unsplash.com/photo-1587662784763-0021b5f0b1b7?w=800&h=1200&fit=crop&q=90', description: 'Профессиональный аппаратный педикюр с покрытием', category: 'Педикюр', duration: '80 мин', specialist: 'Татьяна Морозова', rating: 4.8 },
  { id: 9, name: 'Чистка лица', price: 4500, image: 'https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?w=800&h=1200&fit=crop&q=90', description: 'Глубокая чистка лица с увлажняющей маской и массажем', category: 'Косметология', duration: '90 мин', specialist: 'Юлия Титова', rating: 4.8, isPopular: true },
  { id: 10, name: 'Химический пилинг', price: 5500, image: 'https://images.unsplash.com/photo-1616394584738-fc6e612e71b9?w=800&h=1200&fit=crop&q=90', description: 'Профессиональный химический пилинг для обновления кожи', category: 'Косметология', duration: '60 мин', specialist: 'Анна Соколова', rating: 4.7 },
  { id: 11, name: 'Массаж лица', price: 3200, image: 'https://images.unsplash.com/photo-1512290923902-8a9f81dc236c?w=800&h=1200&fit=crop&q=90', description: 'Антивозрастной массаж лица с серумами премиум класса', category: 'Косметология', duration: '45 мин', specialist: 'Валентина Крылова', rating: 4.6, isNew: true },
  { id: 12, name: 'Ботокс для волос', price: 7500, image: 'https://images.unsplash.com/photo-1522338242992-e1a54906a8da?w=800&h=1200&fit=crop&q=90', description: 'Восстанавливающая процедура для гладкости и блеска волос', category: 'Парикмахерские', duration: '120 мин', specialist: 'Анна Смирнова', rating: 4.9, isNew: true },
  { id: 13, name: 'Наращивание ресниц', price: 4900, image: 'https://images.unsplash.com/photo-1583001931096-959e90c3d930?w=800&h=1200&fit=crop&q=90', description: 'Классическое наращивание ресниц 2D-3D эффект', category: 'Косметология', duration: '150 мин', specialist: 'Ирина Павлова', rating: 4.8 },
  { id: 14, name: 'Вечерняя укладка', price: 3800, image: 'https://images.unsplash.com/photo-1560869713-7d0a29430803?w=800&h=1200&fit=crop&q=90', description: 'Роскошная вечерняя укладка на любой случай', category: 'Парикмахерские', duration: '90 мин', specialist: 'Мария Петрова', rating: 4.7 },
  { id: 15, name: 'Массаж тела', price: 6500, image: 'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=800&h=1200&fit=crop&q=90', description: 'Расслабляющий массаж всего тела с ароматическими маслами', category: 'Массаж', duration: '60 мин', specialist: 'Ольга Смирнова', rating: 4.9, isPopular: true },
  { id: 16, name: 'Антицеллюлитный массаж', price: 7200, image: 'https://images.unsplash.com/photo-1515377905703-c4788e51af15?w=800&h=1200&fit=crop&q=90', description: 'Эффективный массаж против целлюлита с разогревом', category: 'Массаж', duration: '75 мин', specialist: 'Марина Белова', rating: 4.6 },
];

const categories = ['Все', 'Парикмахерские', 'Маникюр', 'Педикюр', 'Косметология', 'Массаж'];

// Featured collections for homepage
const collections = [
  {
    id: 1,
    title: 'Уход за волосами',
    subtitle: 'Стрижка + окрашивание',
    image: 'https://images.unsplash.com/photo-1562322140-8baeececf3df?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-pink-500/30 to-rose-500/30',
    accentColor: '#EC4899',
    services: [1, 2, 3]
  },
  {
    id: 2,
    title: 'Маникюр & Педикюр',
    subtitle: 'Идеальные ногти',
    image: 'https://images.unsplash.com/photo-1632345031435-8727f6897d53?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-purple-500/30 to-pink-500/30',
    accentColor: '#A855F7',
    services: [4, 5, 6]
  },
  {
    id: 3,
    title: 'SPA & Релакс',
    subtitle: 'Массаж и уход',
    image: 'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-violet-500/30 to-purple-500/30',
    accentColor: '#8B5CF6',
    services: [15, 16]
  },
];

export default memo(function Beauty({ activeTab }: BeautyProps) {
  const [selectedService, setSelectedService] = useState<Service | null>(null);
  const [bookings, setBookings] = useState<Booking[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [showCheckoutSuccess, setShowCheckoutSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: services,
    searchFields: ['name', 'description', 'category', 'specialist'] as (keyof Service)[],
  });

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedService(null);
    }
  }, [activeTab]);

  const filteredServices = filteredItems.filter(s => 
    selectedCategory === 'Все' || s.category === selectedCategory
  );

  const handleImageLoad = (serviceId: number) => {
    setLoadedImages(prev => new Set(prev).add(serviceId));
  };

  const toggleFavorite = (serviceId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(serviceId)) {
      newFavorites.delete(serviceId);
    } else {
      newFavorites.add(serviceId);
    }
    setFavorites(newFavorites);
  };

  const openService = (service: Service) => {
    setSelectedService(service);
  };

  const bookService = () => {
    if (!selectedService) return;
    
    const booking: Booking = {
      id: Date.now(),
      serviceName: selectedService.name,
      specialist: selectedService.specialist,
      date: 'Уточняется',
      time: 'Согласуем',
      price: selectedService.price,
      image: selectedService.image
    };
    
    setBookings([...bookings, booking]);
    setSelectedService(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const handleCheckout = () => {
    if (bookings.length === 0) return;
    
    const total = bookings.reduce((sum, booking) => sum + booking.price, 0);
    const newOrder: Order = {
      id: Date.now(),
      items: [...bookings],
      total: total,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setBookings([]);
    setShowCheckoutSuccess(true);
    setTimeout(() => setShowCheckoutSuccess(false), 3000);
  };

  // SERVICE DETAIL PAGE
  if (activeTab === 'catalog' && selectedService) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-950 text-white overflow-auto pb-24">
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedService(null)}
            className="w-10 h-10 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
            data-testid="button-back"
            aria-label="Назад"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedService.id);
            }}
            className="w-10 h-10 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
            data-testid={`button-favorite-${selectedService.id}`}
            aria-label="Добавить в избранное"
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedService.id) ? 'fill-pink-400 text-pink-400' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh] overflow-hidden">
          <img
            src={selectedService.image}
            alt={selectedService.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
        </div>

        <div className="bg-black/40 backdrop-blur-xl rounded-t-3xl -mt-8 relative z-10 p-6 space-y-6 pb-32">
          <div>
            <div className="flex items-center gap-2 mb-2">
              <span className="text-sm text-pink-300 font-semibold">{selectedService.category}</span>
              {selectedService.isNew && (
                <span className="px-2 py-1 bg-pink-500/20 text-pink-300 text-xs font-bold rounded-full flex items-center gap-1">
                  <Sparkles className="w-3 h-3" />
                  NEW
                </span>
              )}
              {selectedService.isPopular && (
                <span className="px-2 py-1 bg-purple-500/20 text-purple-300 text-xs font-bold rounded-full">
                  Популярно
                </span>
              )}
            </div>
            <h2 className="text-2xl font-bold mb-3">{selectedService.name}</h2>
            <div className="flex items-center gap-3 mb-4">
              <p className="text-3xl font-bold text-pink-400">{formatPrice(selectedService.price)}</p>
            </div>
            <div className="flex items-center gap-2 mb-4">
              <div className="flex">
                {Array.from({ length: 5 }).map((_, i) => (
                  <Star key={i} className={`w-4 h-4 ${i < Math.floor(selectedService.rating) ? 'fill-yellow-400 text-yellow-400' : 'text-gray-600'}`} />
                ))}
              </div>
              <span className="text-sm text-white/70">{selectedService.rating}</span>
            </div>
          </div>

          <p className="text-sm text-white/80 leading-relaxed">{selectedService.description}</p>

          <div className="grid grid-cols-2 gap-3">
            <div className="bg-white/5 backdrop-blur-xl rounded-xl p-3 border border-white/10">
              <Clock className="w-5 h-5 text-pink-400 mb-2" />
              <p className="text-xs text-white/60">Длительность</p>
              <p className="text-sm font-semibold">{selectedService.duration}</p>
            </div>
            <div className="bg-white/5 backdrop-blur-xl rounded-xl p-3 border border-white/10">
              <User className="w-5 h-5 text-pink-400 mb-2" />
              <p className="text-xs text-white/60">Мастер</p>
              <p className="text-sm font-semibold">{selectedService.specialist}</p>
            </div>
          </div>

          <button
            onClick={bookService}
            className="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-4 rounded-xl hover:shadow-lg hover:shadow-pink-500/50 transition-all"
            data-testid="button-book-now"
          >
            Записаться на процедуру
          </button>
        </div>
      </div>
    );
  }

  // HOME PAGE - Liquid Glass 2025
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-950 text-white overflow-auto pb-24">
        <div className="p-6 space-y-6">
          
          {/* Collections Grid - Liquid Glass Cards */}
          <div className="space-y-4 pt-4">
            {collections.map((collection, idx) => (
              <m.div
                key={collection.id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: idx * 0.1 }}
                className="relative group cursor-pointer overflow-hidden rounded-3xl"
                style={{ height: idx === 0 ? '280px' : '180px' }}
                data-testid={`collection-${collection.id}`}
              >
                {/* Background Image */}
                <img
                  src={collection.image}
                  alt={collection.title}
                  className="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
                
                {/* Gradient Overlay */}
                <div className={`absolute inset-0 bg-gradient-to-br ${collection.gradient} opacity-70`}></div>
                <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
                
                {/* Liquid Glass Effect */}
                <div className="absolute inset-0 bg-white/5 backdrop-blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                
                {/* Glow on Hover */}
                <div 
                  className="absolute inset-0 opacity-0 group-hover:opacity-20 transition-opacity duration-300 blur-2xl"
                  style={{ backgroundColor: collection.accentColor }}
                ></div>
                
                {/* Content */}
                <div className="absolute inset-0 p-6 flex flex-col justify-end">
                  <div className="space-y-2">
                    {idx === 0 && (
                      <div className="flex items-center gap-2 mb-2">
                        <Sparkles className="w-5 h-5" style={{ color: collection.accentColor }} />
                        <span 
                          className="text-xs font-semibold uppercase tracking-wider"
                          style={{ color: collection.accentColor }}
                        >
                          Популярные услуги
                        </span>
                      </div>
                    )}
                    <h3 className="text-3xl font-bold leading-tight">{collection.title}</h3>
                    <p className="text-sm text-white/80">{collection.subtitle}</p>
                  </div>
                </div>
              </m.div>
            ))}
          </div>

          {/* Popular Services */}
          <div>
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-2">
                <Sparkles className="w-5 h-5 text-pink-400" />
                <h3 className="text-xl font-bold">Популярное</h3>
              </div>
              <button className="text-sm text-white/60 hover:text-white transition-colors" data-testid="button-view-all-popular">
                Все
              </button>
            </div>

            <div className="grid grid-cols-2 gap-4">
              {services.filter(s => s.isPopular).slice(0, 4).map((service, idx) => (
                <m.div
                  key={service.id}
                  whileTap={{ scale: 0.97 }}
                  onClick={() => openService(service)}
                  className="relative cursor-pointer group"
                  data-testid={`popular-service-${service.id}`}
                >
                  {/* Glass Card */}
                  <div className="relative aspect-[3/4] rounded-2xl overflow-hidden bg-white/5 backdrop-blur-xl border border-white/10">
                    <img
                      src={service.image}
                      alt={service.name}
                      className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                      loading="lazy"
                    />
                    
                    {/* Gradient Overlay */}
                    <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    {/* Badges */}
                    <div className="absolute top-2 left-2 flex gap-2">
                      {service.isNew && (
                        <div className="px-2 py-1 bg-pink-500/90 text-white text-xs font-bold rounded-full flex items-center gap-1 backdrop-blur-xl">
                          <Sparkles className="w-3 h-3" />
                          NEW
                        </div>
                      )}
                    </div>
                    
                    {/* Favorite */}
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleFavorite(service.id);
                      }}
                      className="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
                      data-testid={`button-favorite-${service.id}`}
                      aria-label="Добавить в избранное"
                    >
                      <Heart 
                        className={`w-4 h-4 ${favorites.has(service.id) ? 'fill-pink-400 text-pink-400' : 'text-white'}`}
                      />
                    </button>
                  </div>

                  {/* Service Info */}
                  <div className="mt-2">
                    <p className="text-xs text-pink-300 mb-1">{service.category}</p>
                    <p className="text-sm font-medium text-white/90 truncate">{service.name}</p>
                    <div className="flex items-center justify-between mt-1">
                      <p className="text-base font-bold text-pink-400">{formatPrice(service.price)}</p>
                      <p className="text-xs text-white/40">{service.duration}</p>
                    </div>
                  </div>
                </m.div>
              ))}
            </div>
          </div>

          <div className="h-4"></div>
        </div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-950 text-white overflow-auto pb-24">
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-xl font-bold">Услуги</h1>
            <Sparkles className="w-6 h-6 text-pink-400" />
          </div>

          {/* Search */}
          <div className="relative mb-4">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" />
            <input
              type="text"
              placeholder="Поиск услуг..."
              value={searchQuery}
              onChange={(e) => handleSearch(e.target.value)}
              className="w-full pl-12 pr-4 py-3 bg-white/10 backdrop-blur-xl border border-white/10 rounded-xl text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-pink-500/50"
              data-testid="input-search"
              aria-label="Поиск услуг"
            />
          </div>

          {/* Hero Banner */}
          <div className="relative h-48 rounded-2xl overflow-hidden mb-6">
            <img
              src="https://images.unsplash.com/photo-1560066984-138dadb4c035?auto=format&fit=crop&w=800&q=80"
              alt="Banner"
              className="w-full h-full object-cover"
              loading="lazy"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
            <div className="absolute bottom-4 left-4">
              <h2 className="text-3xl font-bold tracking-tight text-pink-300 mb-1">
                Весенние<br/>Спецпредложения
              </h2>
              <p className="text-sm text-white/80">Скидки до 30%</p>
            </div>
          </div>

          {/* Categories */}
          <div className="flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'bg-gradient-to-r from-pink-500 to-purple-500 text-white'
                    : 'bg-white/10 text-white/70 hover:bg-white/20 backdrop-blur-xl'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          {/* Services Grid */}
          <div className="grid grid-cols-2 gap-4">
            {filteredServices.map((service, idx) => (
              <m.div
                key={service.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openService(service)}
                className="relative cursor-pointer"
                data-testid={`service-card-${service.id}`}
              >
                <div className="relative aspect-[3/4] rounded-2xl overflow-hidden mb-2 bg-white/5 backdrop-blur-xl border border-white/10">
                  {!loadedImages.has(service.id) && (
                    <Skeleton className="absolute inset-0 rounded-2xl bg-white/10" />
                  )}
                  <img
                    src={service.image}
                    alt={service.name}
                    className={`w-full h-full object-cover transition-opacity duration-300 ${loadedImages.has(service.id) ? 'opacity-100' : 'opacity-0'}`}
                    loading="lazy"
                    onLoad={() => handleImageLoad(service.id)}
                  />
                  
                  {service.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-pink-500/90 text-white text-xs font-bold rounded-full backdrop-blur-xl">
                      NEW
                    </div>
                  )}
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(service.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
                    data-testid={`button-favorite-${service.id}`}
                    aria-label="Добавить в избранное"
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(service.id) ? 'fill-pink-400 text-pink-400' : 'text-white'}`}
                    />
                  </button>
                </div>

                <div>
                  <p className="text-xs text-pink-300 mb-1">{service.category}</p>
                  <p className="text-sm font-medium text-white/90 truncate mb-1">{service.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold text-pink-400">{formatPrice(service.price)}</p>
                    <p className="text-xs text-white/40">{service.duration}</p>
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART (BOOKINGS) PAGE
  if (activeTab === 'cart') {
    const total = bookings.reduce((sum, booking) => sum + booking.price, 0);

    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-950 text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Мои записи</h1>

          {bookings.length === 0 ? (
            <div className="text-center py-20">
              <Calendar className="w-16 h-16 mx-auto mb-4 text-white/20" />
              <p className="text-white/60 mb-4">У вас пока нет записей</p>
            </div>
          ) : (
            <>
              <div className="space-y-4 mb-24">
                {bookings.map((booking) => (
                  <div key={booking.id} className="flex gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                    <div className="w-24 h-24 rounded-xl overflow-hidden flex-shrink-0">
                      <img
                        src={booking.image}
                        alt={booking.serviceName}
                        className="w-full h-full object-cover"
                        loading="lazy"
                      />
                    </div>
                    <div className="flex-1">
                      <h3 className="font-semibold mb-1">{booking.serviceName}</h3>
                      <p className="text-sm text-white/60 mb-1">{booking.specialist}</p>
                      <p className="text-xs text-white/50 mb-2">{booking.date} • {booking.time}</p>
                      <p className="font-bold text-pink-400">{formatPrice(booking.price)}</p>
                    </div>
                    <button
                      onClick={() => setBookings(bookings.filter(b => b.id !== booking.id))}
                      className="p-2 h-fit hover:bg-white/10 rounded-lg transition-colors"
                      data-testid={`button-cancel-${booking.id}`}
                      aria-label="Отменить запись"
                    >
                      <X className="w-5 h-5 text-white/40" />
                    </button>
                  </div>
                ))}
              </div>

              <div className="fixed bottom-24 left-0 right-0 bg-black/60 backdrop-blur-xl border-t border-white/10 p-6">
                <div className="max-w-md mx-auto">
                  <div className="flex items-center justify-between mb-4">
                    <span className="text-lg">Итого:</span>
                    <span className="text-2xl font-bold text-pink-400">{formatPrice(total)}</span>
                  </div>
                  <ConfirmDrawer
                    trigger={
                      <button
                        className="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-4 rounded-xl hover:shadow-lg hover:shadow-pink-500/50 transition-all"
                        data-testid="button-checkout"
                      >
                        Подтвердить записи
                      </button>
                    }
                    title="Подтвердить записи?"
                    description={`${bookings.length} услуг на сумму ${formatPrice(total)}`}
                    confirmText="Подтвердить"
                    cancelText="Отмена"
                    variant="default"
                    onConfirm={handleCheckout}
                  />
                </div>
              </div>
              {showCheckoutSuccess && (
                <div className="fixed top-20 left-4 right-4 bg-gradient-to-r from-pink-500 to-purple-500 text-white p-4 rounded-2xl text-center font-bold z-50 animate-pulse">
                  Записи успешно подтверждены!
                </div>
              )}
            </>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-950 text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-8">
            <h1 className="text-2xl font-bold">Профиль</h1>
          </div>

          <div className="text-center mb-8">
            <div className="w-24 h-24 rounded-full bg-gradient-to-br from-pink-500 to-purple-500 mx-auto mb-4 flex items-center justify-center">
              <User className="w-12 h-12 text-white" />
            </div>
            <h2 className="text-xl font-bold mb-1">Анна Иванова</h2>
            <p className="text-sm text-white/60">anna.ivanova@example.com</p>
          </div>

          <div className="grid grid-cols-3 gap-4 mb-8">
            <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 text-center border border-white/10">
              <Calendar className="w-6 h-6 mx-auto mb-2 text-pink-400" />
              <p className="text-2xl font-bold mb-1">{orders.length}</p>
              <p className="text-xs text-white/60">Заказов</p>
            </div>
            <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 text-center border border-white/10">
              <Heart className="w-6 h-6 mx-auto mb-2 text-pink-400" />
              <p className="text-2xl font-bold mb-1">{favorites.size}</p>
              <p className="text-xs text-white/60">Избранное</p>
            </div>
            <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 text-center border border-white/10">
              <Gift className="w-6 h-6 mx-auto mb-2 text-pink-400" />
              <p className="text-2xl font-bold mb-1">350</p>
              <p className="text-xs text-white/60">Бонусов</p>
            </div>
          </div>

          <div className="scroll-fade-in mb-6">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-white/10 rounded-xl p-4" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between mb-2">
                      <span className="text-sm text-white/70">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-sm text-white/70">{order.date}</span>
                    </div>
                    <div className="flex justify-between mb-2">
                      <span className="text-white/80">{order.items.length} услуг</span>
                      <span className="font-bold text-pink-400">{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-pink-500/20 text-pink-400 rounded-full">
                        {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Выполняется' : 'Завершено'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
            <button className="w-full flex items-center gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 hover:bg-white/10 transition-all border border-white/10" data-testid="button-my-bookings">
              <Package className="w-5 h-5 text-pink-400" />
              <span className="flex-1 text-left font-medium">История заказов</span>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
            </button>

            <button className="w-full flex items-center gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 hover:bg-white/10 transition-all border border-white/10" data-testid="button-loyalty">
              <Gift className="w-5 h-5 text-pink-400" />
              <span className="flex-1 text-left font-medium">Программа лояльности</span>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
            </button>

            <button className="w-full flex items-center gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 hover:bg-white/10 transition-all border border-white/10" data-testid="button-contacts">
              <Phone className="w-5 h-5 text-pink-400" />
              <span className="flex-1 text-left font-medium">Контакты</span>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
});
```

### demos/Restaurant.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m } from "framer-motion";
import { 
  Heart, 
  Star, 
  X,
  Clock,
  Utensils,
  ChevronLeft,
  ShoppingCart,
  User,
  MapPin,
  Phone,
  Package,
  Search,
  Filter,
  Menu
} from "lucide-react";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { Skeleton } from "../ui/skeleton";
import { useFilter } from "@/hooks/useFilter";

interface RestaurantProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface OrderItem {
  id: number;
  name: string;
  price: number;
  quantity: number;
  image: string;
}

interface Order {
  id: number;
  items: OrderItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Dish {
  id: number;
  name: string;
  price: number;
  image: string;
  description: string;
  category: string;
  cookTime: string;
  rating: number;
  ingredients: string;
  isChefSpecial?: boolean;
  isNew?: boolean;
}

const dishes: Dish[] = [
  { id: 1, name: 'Стейк Рибай', price: 3200, image: 'https://images.unsplash.com/photo-1600891964092-4316c288032e?w=800&h=1200&fit=crop&q=90', description: 'Премиум стейк из мраморной говядины с трюфельным маслом', category: 'Основные блюда', cookTime: '25 мин', rating: 4.9, ingredients: 'Говядина, трюфель, розмарин', isChefSpecial: true },
  { id: 2, name: 'Лосось на пару', price: 2800, image: 'https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?w=800&h=1200&fit=crop&q=90', description: 'Филе лосося на пару с овощами гриль и соусом терияки', category: 'Основные блюда', cookTime: '20 мин', rating: 4.8, ingredients: 'Лосось, овощи, терияки', isChefSpecial: true },
  { id: 3, name: 'Ризотто с белыми грибами', price: 2200, image: 'https://images.unsplash.com/photo-1476124369491-b79e6d6c0f16?w=800&h=1200&fit=crop&q=90', description: 'Кремовое ризотто с белыми грибами и пармезаном', category: 'Основные блюда', cookTime: '30 мин', rating: 4.7, ingredients: 'Рис арборио, белые грибы, пармезан', isNew: true },
  { id: 4, name: 'Утиная грудка', price: 3500, image: 'https://images.unsplash.com/photo-1587863568021-6e3bff40e288?w=800&h=1200&fit=crop&q=90', description: 'Утиная грудка с апельсиновым соусом и картофельным пюре', category: 'Основные блюда', cookTime: '35 мин', rating: 4.9, ingredients: 'Утка, апельсины, картофель', isChefSpecial: true },
  { id: 5, name: 'Паста Карбонара', price: 1800, image: 'https://images.unsplash.com/photo-1612874742237-6526221588e3?w=800&h=1200&fit=crop&q=90', description: 'Классическая римская паста с беконом гуанчале и сыром пекорино', category: 'Паста', cookTime: '15 мин', rating: 4.8, ingredients: 'Паста, гуанчале, яйцо, пекорино' },
  { id: 6, name: 'Тальятелле с трюфелем', price: 2400, image: 'https://images.unsplash.com/photo-1621996346565-e3dbc646d9a9?w=800&h=1200&fit=crop&q=90', description: 'Домашняя паста с черным трюфелем и сливочным соусом', category: 'Паста', cookTime: '18 мин', rating: 4.9, ingredients: 'Паста, трюфель, сливки, пармезан', isChefSpecial: true },
  { id: 7, name: 'Лобстер Фра Дьяволо', price: 4500, image: 'https://images.unsplash.com/photo-1558030006-450675393462?w=800&h=1200&fit=crop&q=90', description: 'Паста с омаром в остром томатном соусе', category: 'Паста', cookTime: '22 мин', rating: 4.8, ingredients: 'Омар, томаты, чили, паста', isNew: true, isChefSpecial: true },
  { id: 8, name: 'Боскайола', price: 1900, image: 'https://images.unsplash.com/photo-1563379091339-03246963d7d3?w=800&h=1200&fit=crop&q=90', description: 'Паста с белыми грибами, беконом и сливками', category: 'Паста', cookTime: '16 мин', rating: 4.6, ingredients: 'Паста, грибы, бекон, сливки' },
  { id: 9, name: 'Устрицы свежие', price: 3800, image: 'https://images.unsplash.com/photo-1567608198472-8d8b4c86545f?w=800&h=1200&fit=crop&q=90', description: 'Свежие устрицы с лимоном и мигнонеттой (6 шт)', category: 'Закуски', cookTime: '5 мин', rating: 4.9, ingredients: 'Устрицы, лимон, мигнонетта', isChefSpecial: true },
  { id: 10, name: 'Фуа-гра', price: 4200, image: 'https://images.unsplash.com/photo-1535745318714-da922ca9cc81?w=800&h=1200&fit=crop&q=90', description: 'Фуа-гра с карамелизованными яблоками и бриошью', category: 'Закуски', cookTime: '10 мин', rating: 4.8, ingredients: 'Фуа-гра, яблоки, бриошь', isChefSpecial: true },
  { id: 11, name: 'Тар-тар из тунца', price: 2600, image: 'https://images.unsplash.com/photo-1546833998-877b37c2e5c6?w=800&h=1200&fit=crop&q=90', description: 'Свежий тар-тар из желтоперого тунца с авокадо', category: 'Закуски', cookTime: '8 мин', rating: 4.7, ingredients: 'Тунец, авокадо, кунжут' },
  { id: 12, name: 'Буррата с томатами', price: 1600, image: 'https://images.unsplash.com/photo-1546793665-c74683f339c1?w=800&h=1200&fit=crop&q=90', description: 'Сыр буррата с томатами черри и базиликом', category: 'Закуски', cookTime: '5 мин', rating: 4.8, ingredients: 'Буррата, томаты, базилик, масло' },
  { id: 13, name: 'Тирамису', price: 900, image: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=800&h=1200&fit=crop&q=90', description: 'Классический итальянский десерт с маскарпоне и эспрессо', category: 'Десерты', cookTime: '5 мин', rating: 4.9, ingredients: 'Маскарпоне, кофе, савоярди, какао' },
  { id: 14, name: 'Крем-брюле', price: 850, image: 'https://images.unsplash.com/photo-1470124182917-cc6e71b22ecc?w=800&h=1200&fit=crop&q=90', description: 'Классический французский десерт с карамелизованной корочкой', category: 'Десерты', cookTime: '7 мин', rating: 4.8, ingredients: 'Сливки, яйца, ваниль, сахар' },
  { id: 15, name: 'Шоколадный фондан', price: 950, image: 'https://images.unsplash.com/photo-1541599468348-e96984315921?w=800&h=1200&fit=crop&q=90', description: 'Теплый шоколадный кекс с жидкой начинкой', category: 'Десерты', cookTime: '12 мин', rating: 4.9, ingredients: 'Шоколад, масло, яйца, мука', isNew: true },
  { id: 16, name: 'Панна котта с ягодами', price: 800, image: 'https://images.unsplash.com/photo-1551024506-0bccd828d307?w=800&h=1200&fit=crop&q=90', description: 'Нежный сливочный десерт с лесными ягодами', category: 'Десерты', cookTime: '5 мин', rating: 4.7, ingredients: 'Сливки, ваниль, ягоды, сахар' },
];

const categories = ['Все', 'Закуски', 'Основные блюда', 'Паста', 'Десерты'];

// Featured collections
const collections = [
  {
    id: 1,
    title: 'Выбор шеф-повара',
    subtitle: 'Авторские блюда',
    image: 'https://images.unsplash.com/photo-1600891964092-4316c288032e?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-amber-600/30 to-yellow-600/30',
    accentColor: '#D97706',
    dishes: [1, 4, 6]
  },
  {
    id: 2,
    title: 'Морские деликатесы',
    subtitle: 'Свежие морепродукты',
    image: 'https://images.unsplash.com/photo-1567608198472-8d8b4c86545f?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-blue-600/30 to-cyan-600/30',
    accentColor: '#0EA5E9',
    dishes: [9, 10, 11]
  },
  {
    id: 3,
    title: 'Сладкие удовольствия',
    subtitle: 'Десерты',
    image: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-rose-600/30 to-pink-600/30',
    accentColor: '#E11D48',
    dishes: [13, 15]
  },
];

export default memo(function Restaurant({ activeTab }: RestaurantProps) {
  const [selectedDish, setSelectedDish] = useState<Dish | null>(null);
  const [orderItems, setOrderItems] = useState<OrderItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [showCheckoutSuccess, setShowCheckoutSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: dishes,
    searchFields: ['name', 'description', 'category', 'ingredients'] as (keyof Dish)[],
  });

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedDish(null);
    }
  }, [activeTab]);

  const filteredDishes = filteredItems.filter(d => 
    selectedCategory === 'Все' || d.category === selectedCategory
  );

  const handleImageLoad = (dishId: number) => {
    setLoadedImages(prev => new Set([...Array.from(prev), dishId]));
  };

  const toggleFavorite = (dishId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(dishId)) {
      newFavorites.delete(dishId);
    } else {
      newFavorites.add(dishId);
    }
    setFavorites(newFavorites);
  };

  const openDish = (dish: Dish) => {
    setSelectedDish(dish);
  };

  const addToOrder = () => {
    if (!selectedDish) return;
    
    const existing = orderItems.find(item => item.id === selectedDish.id);
    if (existing) {
      setOrderItems(orderItems.map(item =>
        item.id === selectedDish.id
          ? { ...item, quantity: item.quantity + 1 }
          : item
      ));
    } else {
      setOrderItems([...orderItems, {
        id: selectedDish.id,
        name: selectedDish.name,
        price: selectedDish.price,
        quantity: 1,
        image: selectedDish.image
      }]);
    }
    setSelectedDish(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const handleCheckout = () => {
    if (orderItems.length === 0) return;
    
    const total = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const newOrder: Order = {
      id: Date.now(),
      items: [...orderItems],
      total: total,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setOrderItems([]);
    setShowCheckoutSuccess(true);
    setTimeout(() => setShowCheckoutSuccess(false), 3000);
  };

  // DISH DETAIL PAGE
  if (activeTab === 'catalog' && selectedDish) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-amber-950 to-black text-white overflow-auto pb-24">
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedDish(null)}
            className="w-10 h-10 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
            data-testid="button-back"
            aria-label="Назад"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedDish.id);
            }}
            className="w-10 h-10 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
            data-testid={`button-favorite-${selectedDish.id}`}
            aria-label="Добавить в избранное"
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedDish.id) ? 'fill-amber-400 text-amber-400' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh] overflow-hidden">
          <img
            src={selectedDish.image}
            alt={selectedDish.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
        </div>

        <div className="bg-black/40 backdrop-blur-xl rounded-t-3xl -mt-8 relative z-10 p-6 space-y-6 pb-32">
          <div>
            <div className="flex items-center gap-2 mb-2">
              <span className="text-sm text-amber-300 font-semibold">{selectedDish.category}</span>
              {selectedDish.isNew && (
                <span className="px-2 py-1 bg-amber-500/20 text-amber-300 text-xs font-bold rounded-full">
                  NEW
                </span>
              )}
              {selectedDish.isChefSpecial && (
                <span className="px-2 py-1 bg-amber-500/20 text-amber-300 text-xs font-bold rounded-full flex items-center gap-1">
                  <Star className="w-3 h-3 fill-amber-300" />
                  Chef's Special
                </span>
              )}
            </div>
            <h2 className="text-2xl font-bold mb-3">{selectedDish.name}</h2>
            <div className="flex items-center gap-3 mb-4">
              <p className="text-3xl font-bold text-amber-400">{formatPrice(selectedDish.price)}</p>
            </div>
            <div className="flex items-center gap-2 mb-4">
              <div className="flex">
                {Array.from({ length: 5 }).map((_, i) => (
                  <Star key={i} className={`w-4 h-4 ${i < Math.floor(selectedDish.rating) ? 'fill-yellow-400 text-yellow-400' : 'text-gray-600'}`} />
                ))}
              </div>
              <span className="text-sm text-white/70">{selectedDish.rating}</span>
            </div>
          </div>

          <p className="text-sm text-white/80 leading-relaxed">{selectedDish.description}</p>

          <div>
            <h3 className="text-sm font-semibold mb-2 text-white/80">Состав:</h3>
            <p className="text-sm text-white/60">{selectedDish.ingredients}</p>
          </div>

          <div className="flex items-center gap-2 text-sm">
            <Clock className="w-4 h-4 text-amber-400" />
            <span className="text-white/70">Время приготовления: {selectedDish.cookTime}</span>
          </div>

          <button
            onClick={addToOrder}
            className="w-full bg-gradient-to-r from-amber-600 to-yellow-600 text-black font-bold py-4 rounded-xl hover:shadow-lg hover:shadow-amber-500/50 transition-all"
            data-testid="button-add-to-order"
          >
            Добавить в заказ
          </button>
        </div>
      </div>
    );
  }

  // HOME PAGE - Premium Dark Theme
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-amber-950 to-black text-white overflow-auto pb-24">
        <div className="p-6 space-y-6">
          
          {/* Collections Grid */}
          <div className="space-y-4 pt-4">
            {collections.map((collection, idx) => (
              <m.div
                key={collection.id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: idx * 0.1 }}
                className="relative group cursor-pointer overflow-hidden rounded-3xl"
                style={{ height: idx === 0 ? '280px' : '180px' }}
                data-testid={`collection-${collection.id}`}
              >
                <img
                  src={collection.image}
                  alt={collection.title}
                  className="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
                
                <div className={`absolute inset-0 bg-gradient-to-br ${collection.gradient} opacity-70`}></div>
                <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
                
                <div className="absolute inset-0 bg-white/5 backdrop-blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                
                <div 
                  className="absolute inset-0 opacity-0 group-hover:opacity-20 transition-opacity duration-300 blur-2xl"
                  style={{ backgroundColor: collection.accentColor }}
                ></div>
                
                <div className="absolute inset-0 p-6 flex flex-col justify-end">
                  <div className="space-y-2">
                    {idx === 0 && (
                      <div className="flex items-center gap-2 mb-2">
                        <Star className="w-5 h-5 fill-amber-400 text-amber-400" />
                        <span className="text-xs font-semibold uppercase tracking-wider text-amber-300">
                          Рекомендации шефа
                        </span>
                      </div>
                    )}
                    <h3 className="text-3xl font-bold leading-tight">{collection.title}</h3>
                    <p className="text-sm text-white/80">{collection.subtitle}</p>
                  </div>
                </div>
              </m.div>
            ))}
          </div>

          {/* Chef's Specials */}
          <div>
            <div className="flex items-center justify-between mb-4">
              <div className="flex items-center gap-2">
                <Star className="w-5 h-5 fill-amber-400 text-amber-400" />
                <h3 className="text-xl font-bold">Выбор шефа</h3>
              </div>
              <button className="text-sm text-white/60 hover:text-white transition-colors" data-testid="button-view-all-chef">
                Все
              </button>
            </div>

            <div className="grid grid-cols-2 gap-4">
              {dishes.filter(d => d.isChefSpecial).slice(0, 4).map((dish, idx) => (
                <m.div
                  key={dish.id}
                  whileTap={{ scale: 0.97 }}
                  onClick={() => openDish(dish)}
                  className="relative cursor-pointer group"
                  data-testid={`chef-special-${dish.id}`}
                >
                  <div className="relative aspect-[3/4] rounded-2xl overflow-hidden bg-white/5 backdrop-blur-xl border border-white/10">
                    <img
                      src={dish.image}
                      alt={dish.name}
                      className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                      loading="lazy"
                    />
                    
                    <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <div className="absolute top-2 left-2 flex gap-2">
                      {dish.isNew && (
                        <div className="px-2 py-1 bg-amber-500/90 text-white text-xs font-bold rounded-full backdrop-blur-xl">
                          NEW
                        </div>
                      )}
                    </div>
                    
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleFavorite(dish.id);
                      }}
                      className="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
                      data-testid={`button-favorite-${dish.id}`}
                      aria-label="Добавить в избранное"
                    >
                      <Heart 
                        className={`w-4 h-4 ${favorites.has(dish.id) ? 'fill-amber-400 text-amber-400' : 'text-white'}`}
                      />
                    </button>
                  </div>

                  <div className="mt-2">
                    <p className="text-xs text-amber-300 mb-1">{dish.category}</p>
                    <p className="text-sm font-medium text-white/90 truncate">{dish.name}</p>
                    <div className="flex items-center justify-between mt-1">
                      <p className="text-base font-bold text-amber-400">{formatPrice(dish.price)}</p>
                      <p className="text-xs text-white/40">{dish.cookTime}</p>
                    </div>
                  </div>
                </m.div>
              ))}
            </div>
          </div>

          <div className="h-4"></div>
        </div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-amber-950 to-black text-white overflow-auto pb-24">
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-xl font-bold">Меню</h1>
            <Utensils className="w-6 h-6 text-amber-400" />
          </div>

          {/* Search */}
          <div className="relative mb-4">
            <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-white/40" />
            <input
              type="text"
              placeholder="Поиск блюд..."
              value={searchQuery}
              onChange={(e) => handleSearch(e.target.value)}
              className="w-full pl-12 pr-4 py-3 bg-white/10 backdrop-blur-xl border border-white/10 rounded-xl text-white placeholder:text-white/40 focus:outline-none focus:ring-2 focus:ring-amber-500/50"
              data-testid="input-search"
              aria-label="Поиск блюд"
            />
          </div>

          {/* Hero Banner */}
          <div className="relative h-48 rounded-2xl overflow-hidden mb-6">
            <img
              src="https://images.unsplash.com/photo-1600891964092-4316c288032e?auto=format&fit=crop&w=800&q=80"
              alt="Banner"
              className="w-full h-full object-cover"
              loading="lazy"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent"></div>
            <div className="absolute bottom-4 left-4">
              <h2 className="text-3xl font-bold tracking-tight text-amber-300 mb-1">
                Сезонное<br/>Меню
              </h2>
              <p className="text-sm text-white/80">Новые блюда от шефа</p>
            </div>
          </div>

          {/* Categories */}
          <div className="flex gap-2 mb-4 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'bg-gradient-to-r from-amber-600 to-yellow-600 text-white'
                    : 'bg-white/10 text-white/70 hover:bg-white/20 backdrop-blur-xl'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          {/* Dishes Grid */}
          <div className="grid grid-cols-2 gap-4">
            {filteredDishes.map((dish, idx) => (
              <m.div
                key={dish.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openDish(dish)}
                className="relative cursor-pointer"
                data-testid={`dish-card-${dish.id}`}
              >
                <div className="relative aspect-[3/4] rounded-2xl overflow-hidden mb-2 bg-white/5 backdrop-blur-xl border border-white/10">
                  {!loadedImages.has(dish.id) && (
                    <Skeleton className="absolute inset-0 rounded-2xl bg-white/10" />
                  )}
                  <img
                    src={dish.image}
                    alt={dish.name}
                    className={`w-full h-full object-cover transition-opacity duration-300 ${loadedImages.has(dish.id) ? 'opacity-100' : 'opacity-0'}`}
                    loading="lazy"
                    onLoad={() => handleImageLoad(dish.id)}
                  />
                  
                  {dish.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-amber-500/90 text-white text-xs font-bold rounded-full backdrop-blur-xl">
                      NEW
                    </div>
                  )}
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(dish.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/5 backdrop-blur-xl flex items-center justify-center hover:bg-white/10 transition-all"
                    data-testid={`button-favorite-${dish.id}`}
                    aria-label="Добавить в избранное"
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(dish.id) ? 'fill-amber-400 text-amber-400' : 'text-white'}`}
                    />
                  </button>
                </div>

                <div>
                  <p className="text-xs text-amber-300 mb-1">{dish.category}</p>
                  <p className="text-sm font-medium text-white/90 truncate mb-1">{dish.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold text-amber-400">{formatPrice(dish.price)}</p>
                    <p className="text-xs text-white/40">{dish.cookTime}</p>
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = orderItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-amber-950 to-black text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Корзина</h1>

          {orderItems.length === 0 ? (
            <div className="text-center py-20">
              <ShoppingCart className="w-16 h-16 mx-auto mb-4 text-white/20" />
              <p className="text-white/60 mb-4">Ваша корзина пуста</p>
            </div>
          ) : (
            <>
              <div className="space-y-4 mb-24">
                {orderItems.map((item) => (
                  <div key={item.id} className="flex gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                    <div className="w-24 h-24 rounded-xl overflow-hidden flex-shrink-0">
                      <img
                        src={item.image}
                        alt={item.name}
                        className="w-full h-full object-cover"
                        loading="lazy"
                      />
                    </div>
                    <div className="flex-1">
                      <h3 className="font-semibold mb-1">{item.name}</h3>
                      <p className="text-sm text-white/60 mb-2">Количество: {item.quantity}</p>
                      <p className="font-bold text-amber-400">{formatPrice(item.price * item.quantity)}</p>
                    </div>
                    <button
                      onClick={() => setOrderItems(orderItems.filter(i => i.id !== item.id))}
                      className="p-2 h-fit hover:bg-white/10 rounded-lg transition-colors"
                      data-testid={`button-remove-${item.id}`}
                      aria-label="Удалить из корзины"
                    >
                      <X className="w-5 h-5 text-white/40" />
                    </button>
                  </div>
                ))}
              </div>

              <div className="fixed bottom-24 left-0 right-0 bg-black/60 backdrop-blur-xl border-t border-white/10 p-6">
                <div className="max-w-md mx-auto">
                  <div className="flex items-center justify-between mb-4">
                    <span className="text-lg">Итого:</span>
                    <span className="text-2xl font-bold text-amber-400">{formatPrice(total)}</span>
                  </div>
                  <ConfirmDrawer
                    trigger={
                      <button
                        className="w-full bg-gradient-to-r from-amber-600 to-yellow-600 text-black font-bold py-4 rounded-xl hover:shadow-lg hover:shadow-amber-500/50 transition-all"
                        data-testid="button-checkout"
                      >
                        Оформить заказ
                      </button>
                    }
                    title="Оформить заказ?"
                    description={`${orderItems.length} блюд на сумму ${formatPrice(total)}`}
                    confirmText="Оформить"
                    cancelText="Отмена"
                    variant="default"
                    onConfirm={handleCheckout}
                  />
                </div>
              </div>
              {showCheckoutSuccess && (
                <div className="fixed top-20 left-4 right-4 bg-gradient-to-r from-amber-600 to-yellow-600 text-black p-4 rounded-2xl text-center font-bold z-50 animate-pulse">
                  Заказ успешно оформлен!
                </div>
              )}
            </>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-amber-950 to-black text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-8">
            <h1 className="text-2xl font-bold">Профиль</h1>
          </div>

          <div className="text-center mb-8">
            <div className="w-24 h-24 rounded-full bg-gradient-to-br from-amber-600 to-yellow-600 mx-auto mb-4 flex items-center justify-center">
              <User className="w-12 h-12 text-white" />
            </div>
            <h2 className="text-xl font-bold mb-1">Дмитрий Соколов</h2>
            <p className="text-sm text-white/60">dmitry.sokolov@example.com</p>
          </div>

          <div className="grid grid-cols-3 gap-4 mb-8">
            <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 text-center border border-white/10">
              <ShoppingCart className="w-6 h-6 mx-auto mb-2 text-amber-400" />
              <p className="text-2xl font-bold mb-1">{orders.length}</p>
              <p className="text-xs text-white/60">Заказов</p>
            </div>
            <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 text-center border border-white/10">
              <Heart className="w-6 h-6 mx-auto mb-2 text-amber-400" />
              <p className="text-2xl font-bold mb-1">{favorites.size}</p>
              <p className="text-xs text-white/60">Избранное</p>
            </div>
            <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 text-center border border-white/10">
              <Star className="w-6 h-6 mx-auto mb-2 text-amber-400" />
              <p className="text-2xl font-bold mb-1">250</p>
              <p className="text-xs text-white/60">Баллов</p>
            </div>
          </div>

          <div className="scroll-fade-in mb-6">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-white/10 rounded-xl p-4" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between mb-2">
                      <span className="text-sm text-white/70">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-sm text-white/70">{order.date}</span>
                    </div>
                    <div className="flex justify-between mb-2">
                      <span className="text-white/80">{order.items.length} блюд</span>
                      <span className="font-bold text-amber-400">{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-amber-500/20 text-amber-400 rounded-full">
                        {order.status === 'processing' ? 'Готовится' : order.status === 'shipped' ? 'В пути' : 'Доставлен'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
            <button className="w-full flex items-center gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 hover:bg-white/10 transition-all border border-white/10" data-testid="button-my-orders">
              <Package className="w-5 h-5 text-amber-400" />
              <span className="flex-1 text-left font-medium">История заказов</span>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
            </button>

            <button className="w-full flex items-center gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 hover:bg-white/10 transition-all border border-white/10" data-testid="button-reservation">
              <Utensils className="w-5 h-5 text-amber-400" />
              <span className="flex-1 text-left font-medium">Забронировать стол</span>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
            </button>

            <button className="w-full flex items-center gap-4 bg-white/5 backdrop-blur-xl rounded-2xl p-4 hover:bg-white/10 transition-all border border-white/10" data-testid="button-contacts">
              <Phone className="w-5 h-5 text-amber-400" />
              <span className="flex-1 text-left font-medium">Контакты</span>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
});
```

### demos/TimeElite.tsx
```tsx
import { useState } from "react";
import { 
  Heart, 
  Star, 
  X, 
  Watch,
  Award,
  TrendingUp,
  Package,
  User,
  CreditCard,
  MapPin,
  Settings,
  LogOut,
  ChevronLeft,
  Search
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { useFilter } from "@/hooks/useFilter";
import { Skeleton } from "@/components/ui/skeleton";

interface TimeEliteProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  brand: string;
  price: number;
  image: string;
  quantity: number;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

const products = [
  { id: 1, name: 'Rolex Submariner', brand: 'Rolex', price: 1125000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Легендарные дайверские часы с водонепроницаемостью 300м', category: 'Rolex', inStock: 3, rating: 4.9, movement: 'Автоматический', waterResistance: '300м', material: 'Сталь 904L', diameter: '40мм' },
  { id: 2, name: 'Patek Philippe Calatrava', brand: 'Patek Philippe', price: 2565000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Элегантные часы с вечным дизайном и филигранной отделкой', category: 'Patek', inStock: 2, rating: 4.95, movement: 'Механический', waterResistance: '30м', material: 'Белое золото', diameter: '39мм' },
  { id: 3, name: 'Omega Speedmaster', brand: 'Omega', price: 585000, image: 'https://images.unsplash.com/photo-1611652022419-a9419f74343d?auto=format,compress&fm=webp&q=75&w=400', description: 'Легендарные часы астронавтов, первые на Луне', category: 'Omega', inStock: 5, rating: 4.8, movement: 'Механический', waterResistance: '50м', material: 'Сталь', diameter: '42мм' },
  { id: 4, name: 'Cartier Santos', brand: 'Cartier', price: 765000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Первые наручные часы в истории с квадратным корпусом', category: 'Cartier', inStock: 4, rating: 4.7, movement: 'Автоматический', waterResistance: '100м', material: 'Сталь', diameter: '39.8мм' },
  { id: 5, name: 'Audemars Piguet Royal Oak', brand: 'Audemars Piguet', price: 3150000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Икона часового дизайна с восьмиугольным безелем', category: 'Люкс', inStock: 2, rating: 4.92, movement: 'Автоматический', waterResistance: '50м', material: 'Сталь', diameter: '41мм' },
  { id: 6, name: 'Rolex Datejust', brand: 'Rolex', price: 882000, image: 'https://images.unsplash.com/photo-1611652022419-a9419f74343d?auto=format,compress&fm=webp&q=75&w=400', description: 'Классические часы с датой и циклопом', category: 'Rolex', inStock: 6, rating: 4.85, movement: 'Автоматический', waterResistance: '100м', material: 'Сталь и золото', diameter: '41мм' },
  { id: 7, name: 'Jaeger-LeCoultre Reverso', brand: 'Jaeger-LeCoultre', price: 1620000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Уникальный переворачивающийся корпус Art Deco', category: 'Люкс', inStock: 3, rating: 4.85, movement: 'Механический', waterResistance: '30м', material: 'Розовое золото', diameter: '26мм x 42мм' },
  { id: 8, name: 'Vacheron Constantin Patrimony', brand: 'Vacheron Constantin', price: 2880000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Воплощение утонченности и классического стиля', category: 'Люкс', inStock: 1, rating: 4.9, movement: 'Механический', waterResistance: '30м', material: 'Розовое золото', diameter: '40мм' },
  { id: 9, name: 'Omega Seamaster', brand: 'Omega', price: 468000, image: 'https://images.unsplash.com/photo-1611652022419-a9419f74343d?auto=format,compress&fm=webp&q=75&w=400', description: 'Дайверские часы Джеймса Бонда', category: 'Omega', inStock: 7, rating: 4.75, movement: 'Автоматический', waterResistance: '300м', material: 'Сталь', diameter: '42мм' },
  { id: 10, name: 'Cartier Tank', brand: 'Cartier', price: 648000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Прямоугольные часы, вдохновленные танком', category: 'Cartier', inStock: 5, rating: 4.8, movement: 'Кварцевый', waterResistance: '30м', material: 'Желтое золото', diameter: '29.5 x 22мм' },
  { id: 11, name: 'Rolex GMT-Master II', brand: 'Rolex', price: 1278000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Часы для путешественников с двумя часовыми поясами', category: 'Rolex', inStock: 4, rating: 4.88, movement: 'Автоматический', waterResistance: '100м', material: 'Сталь и золото', diameter: '40мм' },
  { id: 12, name: 'Patek Philippe Nautilus', brand: 'Patek Philippe', price: 3780000, image: 'https://images.unsplash.com/photo-1611652022419-a9419f74343d?auto=format,compress&fm=webp&q=75&w=400', description: 'Спортивно-элегантные часы с иллюминаторным дизайном', category: 'Patek', inStock: 1, rating: 4.98, movement: 'Автоматический', waterResistance: '120м', material: 'Сталь', diameter: '40мм' },
  { id: 13, name: 'A. Lange & Söhne Lange 1', brand: 'A. Lange & Söhne', price: 3420000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Немецкое часовое совершенство с большой датой', category: 'Люкс', inStock: 2, rating: 4.95, movement: 'Механический', waterResistance: '30м', material: 'Розовое золото', diameter: '38.5мм' },
  { id: 14, name: 'Omega Constellation', brand: 'Omega', price: 432000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Элегантные часы со звездным символом', category: 'Omega', inStock: 8, rating: 4.65, movement: 'Автоматический', waterResistance: '50м', material: 'Сталь и золото', diameter: '38мм' },
  { id: 15, name: 'Cartier Ballon Bleu', brand: 'Cartier', price: 855000, image: 'https://images.unsplash.com/photo-1611652022419-a9419f74343d?auto=format,compress&fm=webp&q=75&w=400', description: 'Часы с сапфировой короной и выпуклым стеклом', category: 'Cartier', inStock: 6, rating: 4.72, movement: 'Автоматический', waterResistance: '30м', material: 'Сталь', diameter: '42мм' },
  { id: 16, name: 'Rolex Daytona', brand: 'Rolex', price: 1665000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Хронограф для гоночных трасс', category: 'Rolex', inStock: 2, rating: 4.93, movement: 'Автоматический', waterResistance: '100м', material: 'Сталь', diameter: '40мм' },
  { id: 17, name: 'Patek Philippe Aquanaut', brand: 'Patek Philippe', price: 2250000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Спортивно-шикарные часы с каучуковым ремешком', category: 'Patek', inStock: 3, rating: 4.87, movement: 'Автоматический', waterResistance: '120м', material: 'Сталь', diameter: '40мм' },
  { id: 18, name: 'Zenith El Primero', brand: 'Zenith', price: 648000, image: 'https://images.unsplash.com/photo-1611652022419-a9419f74343d?auto=format,compress&fm=webp&q=75&w=400', description: 'Первый автоматический хронограф высокой частоты', category: 'Хронографы', inStock: 5, rating: 4.8, movement: 'Автоматический', waterResistance: '100м', material: 'Сталь', diameter: '42мм' },
  { id: 19, name: 'Tudor Black Bay', brand: 'Tudor', price: 315000, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=400', description: 'Винтажно-вдохновленные дайверские часы', category: 'Спорт', inStock: 10, rating: 4.6, movement: 'Автоматический', waterResistance: '200м', material: 'Сталь', diameter: '41мм' },
  { id: 20, name: 'IWC Pilot\'s Watch', brand: 'IWC', price: 378000, image: 'https://images.unsplash.com/photo-1609081219090-a6d81d3085bf?auto=format,compress&fm=webp&q=75&w=400', description: 'Классические часы пилотов с большой заводной головкой', category: 'Авиация', inStock: 6, rating: 4.6, movement: 'Автоматический', waterResistance: '60м', material: 'Сталь', diameter: '43мм' }
];

const categories = ['Все', 'Rolex', 'Omega', 'Cartier', 'Patek', 'Люкс', 'Спорт'];

export default function TimeElite({ activeTab }: TimeEliteProps) {
  const [selectedProduct, setSelectedProduct] = useState<typeof products[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([1, 4, 11]);
  const [cart, setCart] = useState<CartItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: products,
    searchFields: ['name', 'description', 'category', 'brand'],
  });

  const handleImageLoad = (id: number) => {
    setLoadedImages(prev => new Set([...Array.from(prev), id]));
  };

  useImagePreloader({
    images: products.slice(0, 6).map(p => p.image),
    priority: true
  });

  const openProductModal = (product: typeof products[0]) => {
    setSelectedProduct(product);
    setIsModalOpen(true);
  };

  const closeProductModal = () => {
    setIsModalOpen(false);
    setTimeout(() => setSelectedProduct(null), 300);
  };

  const toggleFavorite = (productId: number) => {
    setFavorites(prev => 
      prev.includes(productId) 
        ? prev.filter(id => id !== productId)
        : [...prev, productId]
    );
  };

  const addToCart = (product: typeof products[0]) => {
    const cartItem: CartItem = {
      id: Date.now(),
      name: product.name,
      brand: product.brand,
      price: product.price,
      image: product.image,
      quantity: 1
    };
    setCart([...cart, cartItem]);
    closeProductModal();
  };

  const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cartTotal,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const filteredProducts = selectedCategory === 'Все' 
    ? (searchQuery ? filteredItems : products)
    : (searchQuery ? filteredItems : products).filter(p => p.category === selectedCategory);

  const renderHomeTab = () => (
    <div className="min-h-screen bg-white font-montserrat pb-24">
      <div className="max-w-md mx-auto px-4 py-8 space-y-8">
        <div className="text-center space-y-4 scroll-fade-in">
          <div className="w-20 h-20 bg-gradient-to-br from-yellow-600 to-amber-700 rounded-3xl mx-auto flex items-center justify-center shadow-lg">
            <Watch className="w-10 h-10 text-white" strokeWidth={2} />
          </div>
          <div>
            <h1 className="text-3xl font-bold text-gray-900 mb-2">TimeElite</h1>
            <p className="text-sm text-gray-500">Коллекция премиум часов</p>
          </div>
        </div>

        <div className="flex items-center gap-3 scroll-fade-in">
          <div className="flex-1 bg-gray-100 rounded-full px-4 py-3 flex items-center gap-2">
            <Search className="w-5 h-5 text-gray-400" />
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => handleSearch(e.target.value)}
              placeholder="Поиск часов..."
              className="bg-transparent text-gray-900 placeholder:text-gray-400 outline-none flex-1 text-sm"
              data-testid="input-search"
            />
          </div>
        </div>

        <div className="relative bg-gradient-to-br from-yellow-600 to-amber-700 rounded-3xl p-8 text-white overflow-hidden scroll-fade-in">
          <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-3xl"></div>
          <div className="absolute bottom-0 left-0 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
          <div className="relative z-10">
            <h2 className="text-2xl font-bold mb-3">Swiss Luxury 2025</h2>
            <p className="text-white/90 mb-4">Эксклюзивные модели от ведущих мануфактур</p>
            <button 
              onClick={() => setSelectedCategory('Rolex')}
              className="px-6 py-3 bg-white text-amber-700 rounded-xl font-semibold hover:shadow-lg transition-all duration-300"
              data-testid="button-view-collection"
            >
              Смотреть коллекцию
            </button>
          </div>
        </div>

        <div className="space-y-6">
          <div className="flex items-center justify-between scroll-fade-in">
            <h2 className="text-2xl font-bold text-gray-900">Бренды</h2>
            <TrendingUp className="w-5 h-5 text-yellow-600" />
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer scroll-fade-in"
              onClick={() => setSelectedCategory('Rolex')}
              data-testid="button-filter-rolex"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-amber-500 to-yellow-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Award className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Rolex</h3>
              <p className="text-center text-sm text-gray-500">18 моделей</p>
            </div>

            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer scroll-fade-in"
              onClick={() => setSelectedCategory('Omega')}
              data-testid="button-filter-omega"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Star className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Omega</h3>
              <p className="text-center text-sm text-gray-500">12 моделей</p>
            </div>

            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer scroll-fade-in"
              onClick={() => setSelectedCategory('Cartier')}
              data-testid="button-filter-cartier"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-red-500 to-rose-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Heart className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Cartier</h3>
              <p className="text-center text-sm text-gray-500">8 моделей</p>
            </div>

            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer scroll-fade-in"
              onClick={() => setSelectedCategory('Patek')}
              data-testid="button-filter-patek"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-purple-500 to-violet-600 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Watch className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Patek Philippe</h3>
              <p className="text-center text-sm text-gray-500">6 моделей</p>
            </div>
          </div>
        </div>

        <div className="space-y-6">
          <h2 className="text-2xl font-bold text-gray-900 scroll-fade-in">Популярное</h2>
          <div className="grid grid-cols-2 gap-4">
            {filteredProducts.slice(0, 6).map((product, index) => (
              <div 
                key={product.id}
                className={`group bg-white rounded-2xl overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-100 ${index < 4 ? 'scroll-fade-in' : `scroll-fade-in-delay-${Math.min(index - 3, 2)}`}`}
                onClick={() => openProductModal(product)}
                data-testid={`product-card-${product.id}`}
              >
                <div className="relative aspect-square overflow-hidden bg-gray-100">
                  {!loadedImages.has(product.id) && (
                    <Skeleton className="absolute inset-0 rounded-lg" />
                  )}
                  <OptimizedImage 
                    src={product.image}
                    alt={product.name}
                    className={`w-full h-full object-cover group-hover:scale-110 transition-all duration-500 ${
                      loadedImages.has(product.id) ? 'opacity-100' : 'opacity-0'
                    }`}
                    priority={product.id <= 4}
                    onLoad={() => handleImageLoad(product.id)}
                  />
                  <button 
                    className="absolute top-3 right-3 w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    aria-label="Избранное"
                    data-testid={`button-favorite-${product.id}`}
                  >
                    <Heart 
                      className={`w-5 h-5 ${favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-gray-400'}`} 
                      strokeWidth={2}
                    />
                  </button>
                </div>
                <div className="p-4 space-y-2">
                  <div className="text-xs font-medium text-amber-600 mb-1">{product.brand}</div>
                  <h3 className="font-semibold text-gray-900 line-clamp-2 text-sm">{product.name}</h3>
                  <div className="flex items-center justify-between">
                    <p className="text-lg font-bold text-gray-900">{formatPrice(product.price)}</p>
                    <div className="flex items-center gap-1">
                      <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                      <span className="text-xs text-gray-600">{product.rating}</span>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat pb-24">
      <div className="sticky top-0 z-20 bg-white border-b border-gray-200 py-5 px-4">
        <div className="max-w-md mx-auto space-y-4">
          <div className="flex items-center gap-3">
            <div className="flex-1 bg-gray-100 rounded-full px-4 py-3 flex items-center gap-2">
              <Search className="w-5 h-5 text-gray-400" />
              <input
                type="text"
                value={searchQuery}
                onChange={(e) => handleSearch(e.target.value)}
                placeholder="Поиск часов..."
                className="bg-transparent text-gray-900 placeholder:text-gray-400 outline-none flex-1 text-sm"
                data-testid="input-search-catalog"
              />
            </div>
          </div>
          <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-4 py-2 rounded-full whitespace-nowrap transition-all duration-300 font-medium text-sm ${
                  selectedCategory === cat 
                    ? 'bg-gradient-to-r from-yellow-600 to-amber-700 text-white shadow-lg' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>
        </div>
      </div>

      <div className="max-w-md mx-auto px-4 py-6">
        <div className="mb-4">
          <p className="text-sm text-gray-600">Найдено {filteredProducts.length} часов</p>
        </div>
        <div className="grid grid-cols-2 gap-4">
          {filteredProducts.map((product, index) => (
            <div 
              key={product.id}
              className={`group bg-white rounded-2xl overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer ${index < 4 ? '' : `scroll-fade-in-delay-${Math.min((index - 4) % 4 + 1, 3)}`}`}
              onClick={() => openProductModal(product)}
              data-testid={`product-${product.id}`}
            >
              <div className="relative aspect-square overflow-hidden bg-gray-100">
                {!loadedImages.has(product.id) && (
                  <Skeleton className="absolute inset-0 rounded-lg" />
                )}
                <OptimizedImage 
                  src={product.image}
                  alt={product.name}
                  className={`w-full h-full object-cover group-hover:scale-110 transition-all duration-500 ${
                    loadedImages.has(product.id) ? 'opacity-100' : 'opacity-0'
                  }`}
                  priority={product.id <= 4}
                  onLoad={() => handleImageLoad(product.id)}
                />
                <button 
                  className="absolute top-3 right-3 w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(product.id);
                  }}
                  aria-label="Избранное"
                  data-testid={`button-favorite-${product.id}`}
                >
                  <Heart 
                    className={`w-5 h-5 ${favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-gray-400'}`}
                    strokeWidth={2}
                  />
                </button>
              </div>
              <div className="p-4 space-y-2">
                <div className="text-xs font-medium text-amber-600 mb-1">{product.brand}</div>
                <h3 className="font-semibold text-gray-900 line-clamp-2 text-sm">{product.name}</h3>
                <div className="flex items-center justify-between">
                  <p className="text-lg font-bold text-gray-900">{formatPrice(product.price)}</p>
                  <div className="flex items-center gap-1">
                    <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                    <span className="text-xs text-gray-600">{product.rating}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat pb-24">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="text-2xl font-bold text-gray-900 scroll-fade-in">Корзина</h1>
        
        {cart.length === 0 ? (
          <div className="text-center py-16">
            <Watch className="w-16 h-16 text-gray-300 mx-auto mb-4" />
            <p className="text-gray-500">Корзина пуста</p>
          </div>
        ) : (
          <>
            <div className="space-y-4">
              {cart.map((item, index) => (
                <div 
                  key={item.id} 
                  className={`bg-white rounded-2xl p-4 flex gap-4 shadow-sm scroll-fade-in-delay-${Math.min(index + 1, 5)}`}
                  data-testid={`cart-item-${item.id}`}
                >
                  <OptimizedImage 
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover"
                  />
                  <div className="flex-1">
                    <p className="text-xs text-amber-600 font-medium mb-1">{item.brand}</p>
                    <h3 className="font-semibold text-gray-900 mb-1">{item.name}</h3>
                    <p className="text-lg font-bold text-gray-900">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-8 h-8 flex items-center justify-center"
                    aria-label="Удалить"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5 text-gray-400" />
                  </button>
                </div>
              ))}
            </div>

            <div className="fixed bottom-24 left-0 right-0 p-4 bg-white border-t border-gray-200">
              <div className="max-w-md mx-auto">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-semibold text-gray-900">Итого:</span>
                  <span className="text-2xl font-bold text-amber-600">{formatPrice(cartTotal)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full py-4 bg-gradient-to-r from-yellow-600 to-amber-700 text-white rounded-xl font-semibold text-lg hover:shadow-xl transition-all duration-300"
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(cartTotal)}`}
                  confirmText="Подтвердить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>
            </div>
          </>
        )}
      </div>
    </div>
  );

  const renderProfileTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat pb-24">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <div className="bg-white rounded-2xl p-6 scroll-fade-in">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-yellow-600 to-amber-700 rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-white" />
            </div>
            <div>
              <h2 className="text-xl font-bold text-gray-900">Александр Иванов</h2>
              <p className="text-sm text-gray-500">+7 (999) 123-45-67</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-gray-50 rounded-xl">
              <p className="text-sm text-gray-500 mb-1">Заказы</p>
              <p className="text-2xl font-bold text-gray-900">{orders.length}</p>
            </div>
            <div className="p-4 bg-gray-50 rounded-xl">
              <p className="text-sm text-gray-500 mb-1">Избранное</p>
              <p className="text-2xl font-bold text-gray-900">{favorites.length}</p>
            </div>
          </div>
        </div>

        <div className="scroll-fade-in-delay-1">
          <h3 className="text-lg font-bold text-gray-900 mb-4">Мои заказы</h3>
          {orders.length === 0 ? (
            <div className="text-center py-8 bg-white rounded-2xl">
              <Package className="w-12 h-12 mx-auto mb-3 text-gray-300" />
              <p className="text-gray-500">У вас пока нет заказов</p>
            </div>
          ) : (
            <div className="space-y-3">
              {orders.map((order) => (
                <div key={order.id} className="bg-white rounded-2xl p-4" data-testid={`order-${order.id}`}>
                  <div className="flex justify-between mb-2">
                    <span className="text-gray-900 font-medium">Заказ #{order.id.toString().slice(-6)}</span>
                    <span className="text-gray-500">{order.date}</span>
                  </div>
                  <div className="flex justify-between mb-2">
                    <span className="text-gray-600">{order.items.length} товаров</span>
                    <span className="font-bold text-amber-600">{formatPrice(order.total)}</span>
                  </div>
                  <div className="mt-2">
                    <span className="text-xs px-3 py-1 bg-green-100 text-green-700 rounded-full">
                      {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        <div className="space-y-2 scroll-fade-in-delay-2">
          <button className="w-full p-4 bg-white rounded-2xl flex items-center justify-between" aria-label="Избранное" data-testid="button-favorites">
            <div className="flex items-center gap-3">
              <Heart className="w-5 h-5 text-gray-400" />
              <span className="font-medium text-gray-900">Избранное</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-gray-400" />
          </button>

          <button className="w-full p-4 bg-white rounded-2xl flex items-center justify-between" aria-label="Способы оплаты" data-testid="button-payment">
            <div className="flex items-center gap-3">
              <CreditCard className="w-5 h-5 text-gray-400" />
              <span className="font-medium text-gray-900">Способы оплаты</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-gray-400" />
          </button>

          <button className="w-full p-4 bg-white rounded-2xl flex items-center justify-between" aria-label="Адреса доставки" data-testid="button-address">
            <div className="flex items-center gap-3">
              <MapPin className="w-5 h-5 text-gray-400" />
              <span className="font-medium text-gray-900">Адреса доставки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-gray-400" />
          </button>

          <button className="w-full p-4 bg-white rounded-2xl flex items-center justify-between" aria-label="Настройки" data-testid="button-settings">
            <div className="flex items-center gap-3">
              <Settings className="w-5 h-5 text-gray-400" />
              <span className="font-medium text-gray-900">Настройки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-gray-400" />
          </button>

          <button className="w-full p-4 bg-red-50 rounded-2xl flex items-center justify-between mt-4" aria-label="Выйти" data-testid="button-logout">
            <div className="flex items-center gap-3">
              <LogOut className="w-5 h-5 text-red-500" />
              <span className="font-medium text-red-500">Выйти</span>
            </div>
          </button>
        </div>
      </div>
    </div>
  );

  const renderProductModal = () => {
    if (!selectedProduct) return null;

    return (
      <div 
        className={`fixed inset-0 z-50 bg-white transition-all duration-300 ${
          isModalOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'
        }`}
        style={{ overflowY: 'auto' }}
      >
        <div className="max-w-md mx-auto">
          <button 
            onClick={closeProductModal}
            className="fixed top-4 right-4 z-10 w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
            aria-label="Закрыть"
            data-testid="button-back"
          >
            <X className="w-6 h-6 text-gray-900" />
          </button>

          <div className="relative aspect-square overflow-hidden bg-gray-100">
            {!loadedImages.has(selectedProduct.id + 100) && (
              <Skeleton className="absolute inset-0" />
            )}
            <OptimizedImage 
              src={selectedProduct.image}
              alt={selectedProduct.name}
              className={`w-full h-full object-cover transition-opacity duration-300 ${
                loadedImages.has(selectedProduct.id + 100) ? 'opacity-100' : 'opacity-0'
              }`}
              onLoad={() => handleImageLoad(selectedProduct.id + 100)}
            />
          </div>

          <div className="p-6 space-y-6">
            <div className="inline-block px-4 py-2 bg-gradient-to-r from-yellow-600 to-amber-700 text-white rounded-full text-sm font-semibold">
              {selectedProduct.brand}
            </div>

            <div className="space-y-2">
              <h1 className="text-3xl font-bold text-gray-900">{selectedProduct.name}</h1>
              <div className="flex items-center justify-between">
                <p className="text-3xl font-bold text-amber-600">{formatPrice(selectedProduct.price)}</p>
                <div className="flex items-center gap-2">
                  <Star className="w-5 h-5 fill-yellow-400 text-yellow-400" />
                  <span className="text-lg font-semibold text-gray-900">{selectedProduct.rating}</span>
                  <span className="text-gray-500">(128)</span>
                </div>
              </div>
            </div>

            <p className="text-gray-700 leading-relaxed">{selectedProduct.description}</p>

            <div className="space-y-4">
              <h3 className="text-lg font-semibold text-gray-900">Характеристики</h3>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-gray-50 rounded-xl p-4">
                  <p className="text-sm text-gray-500 mb-1">Механизм</p>
                  <p className="font-semibold text-gray-900">{selectedProduct.movement}</p>
                </div>
                <div className="bg-gray-50 rounded-xl p-4">
                  <p className="text-sm text-gray-500 mb-1">Водонепроницаемость</p>
                  <p className="font-semibold text-gray-900">{selectedProduct.waterResistance}</p>
                </div>
                <div className="bg-gray-50 rounded-xl p-4">
                  <p className="text-sm text-gray-500 mb-1">Материал</p>
                  <p className="font-semibold text-gray-900">{selectedProduct.material}</p>
                </div>
                <div className="bg-gray-50 rounded-xl p-4">
                  <p className="text-sm text-gray-500 mb-1">Диаметр</p>
                  <p className="font-semibold text-gray-900">{selectedProduct.diameter}</p>
                </div>
              </div>
            </div>

            <div className="flex items-center gap-2">
              <div className="w-2 h-2 bg-green-500 rounded-full"></div>
              <span className="text-sm text-green-600 font-medium">В наличии {selectedProduct.inStock} шт</span>
            </div>

            <ConfirmDrawer
              trigger={
                <button 
                  className="w-full py-4 bg-gradient-to-r from-yellow-600 to-amber-700 text-white rounded-xl font-semibold text-lg hover:shadow-xl transition-all duration-300"
                  data-testid={`button-add-to-cart-${selectedProduct.id}`}
                >
                  Добавить в корзину
                </button>
              }
              title="Добавить в корзину?"
              description={`${selectedProduct.name} — ${formatPrice(selectedProduct.price)}`}
              confirmText="Добавить"
              cancelText="Отмена"
              variant="default"
              onConfirm={() => addToCart(selectedProduct)}
            />
          </div>
        </div>
      </div>
    );
  };

  return (
    <>
      {activeTab === 'home' && renderHomeTab()}
      {activeTab === 'catalog' && renderCatalogTab()}
      {activeTab === 'cart' && renderCartTab()}
      {activeTab === 'profile' && renderProfileTab()}
      {renderProductModal()}
    </>
  );
}
```

### demos/SneakerVault.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Sparkles, TrendingUp, Zap, Search, Menu } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { ConfirmDrawer } from "../ui/modern-drawer";
import greenNikeImage from "@assets/загруженное-_4__1761733573240.jpg";
import blueNikeImage from "@assets/загруженное-_3__1761733577054.jpg";
import whiteJordanImage from "@assets/загруженное-_2__1761733579316.jpg";
import tealJordanImage from "@assets/NIKE-AIR-JORDAN-V2-e-V3-_designer_designergrafico-_design-_nikeair-_airjordan-_socialmedia-_natural-_1761733582395.jpg";

// Video served from public/videos/ to reduce Docker image size
const sneakerVideo = "/videos/ae01958370d099047455d799eba60389_1762352751328.mp4";

interface SneakerVaultProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  size: string;
  quantity: number;
  image: string;
  brand: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Sneaker {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  sizes: string[];
  brand: string;
  category: string;
  gender: 'Men' | 'Woman' | 'Unisex';
  inStock: number;
  rating: number;
  isNew?: boolean;
  isTrending?: boolean;
  colorway: string;
}

const sneakers: Sneaker[] = [
  { 
    id: 1, 
    name: 'Daisy Dream Dunk', 
    price: 18900, 
    oldPrice: 22900,
    image: greenNikeImage, 
    hoverImage: greenNikeImage,
    description: 'Свежие Nike Dunk с природной эстетикой ромашек', 
    sizes: ['7', '8', '9', '10', '11', '12'], 
    brand: 'Nike',
    category: 'Лайфстайл', 
    gender: 'Unisex',
    inStock: 8, 
    rating: 5.0, 
    isNew: true,
    isTrending: true,
    colorway: 'Green/Beige'
  },
  { 
    id: 2, 
    name: 'Sky Water Dunk', 
    price: 17900, 
    oldPrice: 21900,
    image: blueNikeImage, 
    hoverImage: blueNikeImage,
    description: 'Голубые Nike Dunk с небесной палитрой', 
    sizes: ['7', '8', '9', '10', '11', '12'], 
    brand: 'Nike',
    category: 'Лайфстайл', 
    gender: 'Unisex',
    inStock: 12, 
    rating: 4.9, 
    isNew: true,
    isTrending: true,
    colorway: 'Sky Blue'
  },
  { 
    id: 3, 
    name: 'Forest Air Jordan 1', 
    price: 25900, 
    oldPrice: 29900,
    image: whiteJordanImage, 
    hoverImage: whiteJordanImage,
    description: 'Белые Air Jordan 1 High с мистической атмосферой', 
    sizes: ['7', '8', '9', '10', '11', '12'], 
    brand: 'Jordan',
    category: 'Баскетбол', 
    gender: 'Men',
    inStock: 6, 
    rating: 5.0, 
    isNew: true,
    isTrending: true,
    colorway: 'White/Silver'
  },
  { 
    id: 4, 
    name: 'Butterfly Jordan 1', 
    price: 26900, 
    oldPrice: 31900,
    image: tealJordanImage, 
    hoverImage: tealJordanImage,
    description: 'Бирюзовые Air Jordan 1 с природной энергией', 
    sizes: ['7', '8', '9', '10', '11', '12'], 
    brand: 'Jordan',
    category: 'Баскетбол', 
    gender: 'Men',
    inStock: 5, 
    rating: 5.0, 
    isNew: true,
    isTrending: true,
    colorway: 'Teal/Black'
  },
  { 
    id: 5, 
    name: 'Air Max 90 Essential', 
    price: 15900, 
    image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800&h=1200&fit=crop&q=90',
    description: 'Классические Air Max 90 с видимой подушкой Air', 
    sizes: ['7', '8', '9', '10', '11', '12'], 
    brand: 'Nike',
    category: 'Беговые', 
    gender: 'Unisex',
    inStock: 15, 
    rating: 4.8, 
    isTrending: true,
    colorway: 'White/Red'
  },
  { 
    id: 6, 
    name: 'Yeezy Boost 350 V2', 
    price: 32900, 
    image: 'https://images.unsplash.com/photo-1556906781-9a412961c28c?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1556906781-9a412961c28c?w=800&h=1200&fit=crop&q=90',
    description: 'Инновационные кроссовки с технологией Boost', 
    sizes: ['7', '8', '9', '10', '11'], 
    brand: 'Adidas',
    category: 'Лайфстайл', 
    gender: 'Unisex',
    inStock: 4, 
    rating: 4.7, 
    isNew: true,
    colorway: 'Zebra'
  },
  { 
    id: 7, 
    name: 'Air Force 1 Low', 
    price: 13900, 
    image: 'https://images.unsplash.com/photo-1600185365926-3a2ce3cdb9eb?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1600185365926-3a2ce3cdb9eb?w=800&h=1200&fit=crop&q=90',
    description: 'Самые популярные кроссовки Nike всех времен', 
    sizes: ['7', '8', '9', '10', '11', '12'], 
    brand: 'Nike',
    category: 'Баскетбол', 
    gender: 'Unisex',
    inStock: 20, 
    rating: 4.9, 
    colorway: 'All White'
  },
  { 
    id: 8, 
    name: 'Travis Scott x Jordan', 
    price: 89900, 
    image: 'https://images.unsplash.com/photo-1552346154-21d32810aba3?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1552346154-21d32810aba3?w=800&h=1200&fit=crop&q=90',
    description: 'Эксклюзивная коллаборация с Трэвисом Скоттом', 
    sizes: ['8', '9', '10', '11'], 
    brand: 'Jordan',
    category: 'Коллаб', 
    gender: 'Men',
    inStock: 2, 
    rating: 5.0, 
    isNew: true,
    colorway: 'Brown/Black'
  },
];

const categories = ['Все', 'Лайфстайл', 'Баскетбол', 'Беговые', 'Коллаб'];
const genderFilters = ['All', 'Men', 'Woman', 'Unisex'];

function SneakerVault({ activeTab }: SneakerVaultProps) {
  const [selectedSneaker, setSelectedSneaker] = useState<Sneaker | null>(null);
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [selectedGender, setSelectedGender] = useState<string>('All');

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedSneaker(null);
    }
    // Reset gender filter when leaving home page
    if (activeTab !== 'home') {
      setSelectedGender('All');
    }
  }, [activeTab]);

  // Filter sneakers based on current tab
  const filteredSneakers = sneakers.filter(s => {
    const categoryMatch = selectedCategory === 'Все' || s.category === selectedCategory;
    
    // Apply gender filter only on home page
    if (activeTab === 'home') {
      const genderMatch = selectedGender === 'All' || s.gender === selectedGender;
      return categoryMatch && genderMatch;
    }
    
    // On catalog page, show all genders
    return categoryMatch;
  });

  const toggleFavorite = (sneakerId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(sneakerId)) {
      newFavorites.delete(sneakerId);
    } else {
      newFavorites.add(sneakerId);
    }
    setFavorites(newFavorites);
  };

  const openSneaker = (sneaker: Sneaker) => {
    setSelectedSneaker(sneaker);
    setSelectedSize(sneaker.sizes[0]);
    // Note: User can manually navigate to catalog tab via bottom navigation
  };

  const addToCart = () => {
    if (!selectedSneaker) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedSneaker.name,
      price: selectedSneaker.price,
      size: selectedSize,
      quantity: 1,
      image: selectedSneaker.image,
      brand: selectedSneaker.brand
    };
    
    setCart([...cart, cartItem]);
    setSelectedSneaker(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cartTotal,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
  };

  // PRODUCT DETAIL PAGE
  if (activeTab === 'catalog' && selectedSneaker) {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedSneaker(null)}
            className="w-10 h-10 rounded-full bg-black/60 backdrop-blur-md flex items-center justify-center border border-white/20"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedSneaker.id);
            }}
            className="w-10 h-10 rounded-full bg-black/60 backdrop-blur-md flex items-center justify-center border border-white/20"
            data-testid={`button-favorite-${selectedSneaker.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedSneaker.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh]">
          <img
            src={selectedSneaker.hoverImage}
            alt={selectedSneaker.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
        </div>

        <div className="bg-black/90 backdrop-blur-xl rounded-t-3xl p-6 space-y-6 pb-32">
          <div className="text-center">
            <p className="text-sm text-white/60 mb-2">{selectedSneaker.brand}</p>
            <h2 className="text-2xl font-bold mb-2">{selectedSneaker.name}</h2>
            <div className="flex items-center justify-center gap-3">
              <p className="text-3xl font-bold">{formatPrice(selectedSneaker.price)}</p>
              {selectedSneaker.oldPrice && (
                <p className="text-xl text-white/50 line-through">{formatPrice(selectedSneaker.oldPrice)}</p>
              )}
            </div>
          </div>

          <p className="text-sm text-white/80 text-center">{selectedSneaker.description}</p>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите размер (US):</p>
            <div className="flex items-center justify-center gap-2 flex-wrap">
              {selectedSneaker.sizes.map((size) => (
                <button
                  key={size}
                  onClick={() => setSelectedSize(size)}
                  className={`w-12 h-12 rounded-full font-semibold transition-all ${
                    selectedSize === size
                      ? 'bg-[#CDFF38] text-black'
                      : 'bg-black/40 text-white hover:bg-black/60 border border-white/20'
                  }`}
                  data-testid={`button-size-${size}`}
                >
                  {size}
                </button>
              ))}
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full bg-[#CDFF38] text-black font-bold py-4 rounded-full hover:bg-[#B8E633] transition-all"
                data-testid="button-buy-now"
              >
                Добавить в корзину
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedSneaker.name} • ${selectedSneaker.brand} • Размер ${selectedSize}`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />
        </div>
      </div>
    );
  }

  // HOME PAGE - REAL TIME SHOPPING STYLE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        {/* Header */}
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <Menu className="w-6 h-6" data-testid="button-menu" />
            <div className="flex items-center gap-3">
              <ShoppingBag className="w-6 h-6" data-testid="button-view-cart" />
              <Heart className="w-6 h-6" data-testid="button-view-favorites" />
            </div>
          </div>

          {/* Title */}
          <div className="mb-6 scroll-fade-in">
            <h1 className="text-4xl font-black mb-1 tracking-tight">
              SNEAKER<br/>
              VAULT
            </h1>
          </div>

          {/* Gender Filters */}
          <div className="flex items-center gap-4 mb-6 scroll-fade-in">
            <button 
              className="p-2 bg-[#CDFF38] rounded-full"
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((gender) => (
              <button
                key={gender}
                onClick={() => setSelectedGender(gender)}
                aria-pressed={selectedGender === gender}
                className={`text-sm font-medium transition-all relative ${
                  selectedGender === gender
                    ? 'text-white font-bold'
                    : 'text-white/40'
                }`}
                data-testid={`button-filter-${gender.toLowerCase()}`}
              >
                {gender}
                {selectedGender === gender && (
                  <div className="absolute -bottom-1 left-0 right-0 h-0.5 bg-[#CDFF38] rounded-full"></div>
                )}
              </button>
            ))}
          </div>

          {/* Search Bar */}
          <div className="flex items-center gap-3 mb-6">
            <div className="flex-1 bg-black/40 backdrop-blur-xl rounded-full px-4 py-3 flex items-center gap-2 border border-white/20">
              <Search className="w-5 h-5 text-white/50" />
              <input
                type="text"
                placeholder="Поиск кроссовок..."
                className="bg-transparent text-white placeholder:text-white/50 outline-none flex-1 text-sm"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        {/* Video Hero Banner */}
        <div className="relative mb-6 mx-6 rounded-3xl overflow-hidden scroll-fade-in" style={{ height: '500px' }}>
          <video
            autoPlay
            loop
            muted
            playsInline
            className="absolute inset-0 w-full h-full object-cover"
            data-testid="video-hero-banner-sneaker"
          >
            <source src={sneakerVideo} type="video/mp4" />
          </video>
          
          {/* Gradient Overlay */}
          <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
          
          {/* Content Overlay */}
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <h2 className="text-5xl font-black mb-3 tracking-tight leading-tight">
                LIMITED<br/>
                EDITION
              </h2>
              <p className="text-lg text-white/80 mb-6" style={{ letterSpacing: '0.1em' }}>
                Эксклюзивные релизы 2025
              </p>
              <button 
                className="px-8 py-4 rounded-full font-bold text-black transition-all hover:scale-105"
                style={{
                  background: '#CDFF38',
                  boxShadow: '0 0 30px rgba(205, 255, 56, 0.4)'
                }}
                data-testid="button-hero-shop-sneakers"
              >
                Смотреть коллекцию
              </button>
            </m.div>
          </div>
        </div>

        {/* Featured Sneaker Cards */}
        <div className="px-6 space-y-4">
          {filteredSneakers.slice(0, 3).map((sneaker, idx) => (
            <m.div
              key={sneaker.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openSneaker(sneaker)}
              className={`relative cursor-pointer group rounded-3xl overflow-hidden ${idx === 0 ? 'scroll-fade-in' : ''}`}
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`featured-sneaker-${sneaker.id}`}
            >
              {/* Background Image */}
              <div className="absolute inset-0">
                <img
                  src={sneaker.image}
                  alt={sneaker.name}
                  className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
              </div>

              {/* Gradient Overlay */}
              <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>

              {/* Badge */}
              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-black/60 backdrop-blur-xl rounded-full border border-white/20">
                  <span className="text-xs font-semibold text-white">
                    {sneaker.isNew ? 'New' : sneaker.category}
                  </span>
                </div>
              </div>

              {/* Favorite */}
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(sneaker.id);
                }}
                className="absolute top-4 right-4 w-10 h-10 rounded-full bg-black/60 backdrop-blur-xl flex items-center justify-center border border-white/20"
                data-testid={`button-favorite-${sneaker.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(sneaker.id) ? 'fill-white text-white' : 'text-white'}`}
                />
              </button>

              {/* Content */}
              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <p className="text-sm text-white/70 mb-1">{sneaker.brand}</p>
                    <h3 className="text-2xl font-bold mb-2 leading-tight">
                      {sneaker.name}
                    </h3>
                    <p className="text-sm text-white/80 mb-4">{sneaker.colorway}</p>
                  </div>

                  {/* Buy Button */}
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openSneaker(sneaker);
                    }}
                    className="w-14 h-14 rounded-full bg-[#CDFF38] flex items-center justify-center hover:bg-[#B8E633] transition-all hover:scale-110"
                    data-testid={`button-add-to-cart-${sneaker.id}`}
                  >
                    <ShoppingBag className="w-6 h-6 text-black" />
                  </button>
                </div>

                {/* Price */}
                <div className="mt-3">
                  <p className="text-lg font-bold">{formatPrice(sneaker.price)}</p>
                </div>
              </div>
            </m.div>
          ))}
        </div>

        {/* Bottom Spacer */}
        <div className="h-8"></div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-2xl font-bold">Каталог</h1>
            <div className="flex items-center gap-3">
              <button className="p-2" data-testid="button-view-search">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" data-testid="button-view-filter">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          {/* Categories */}
          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'bg-[#CDFF38] text-black'
                    : 'bg-black/40 text-white/70 hover:bg-black/60 border border-white/20'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          {/* Sneakers Grid */}
          <div className="grid grid-cols-2 gap-4">
            {filteredSneakers.map((sneaker, index) => (
              <m.div
                key={sneaker.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openSneaker(sneaker)}
                className={`relative cursor-pointer ${index < 4 ? '' : `scroll-fade-in-delay-${Math.min((index - 4) % 3 + 1, 3)}`}`}
                data-testid={`sneaker-card-${sneaker.id}`}
              >
                <div className="relative aspect-[3/4] rounded-3xl overflow-hidden mb-3 bg-black/40 border border-white/10">
                  <img
                    src={sneaker.image}
                    alt={sneaker.name}
                    className="w-full h-full object-cover"
                    loading="lazy"
                  />
                  
                  {/* Favorite */}
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(sneaker.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/60 backdrop-blur-xl flex items-center justify-center border border-white/20"
                    data-testid={`button-favorite-${sneaker.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(sneaker.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {/* Badge */}
                  {sneaker.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-[#CDFF38] text-black text-xs font-bold rounded-full">
                      NEW
                    </div>
                  )}
                </div>

                {/* Sneaker Info */}
                <div>
                  <p className="text-xs text-white/60 mb-1">{sneaker.brand}</p>
                  <p className="text-sm font-semibold mb-1 truncate">{sneaker.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold">{formatPrice(sneaker.price)}</p>
                    {sneaker.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(sneaker.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Корзина</h1>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20">
              <ShoppingBag className="w-20 h-20 text-white/20 mb-4" />
              <p className="text-white/50 text-center">Ваша корзина пуста</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item) => (
                <div
                  key={item.id}
                  className="bg-black/40 backdrop-blur-xl rounded-2xl p-4 flex gap-4 border border-white/10"
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <p className="text-xs text-white/60 mb-1">{item.brand}</p>
                    <h3 className="font-semibold mb-1">{item.name}</h3>
                    <p className="text-sm text-white/60 mb-2">
                      Размер: {item.size}
                    </p>
                    <p className="text-lg font-bold">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-8 h-8"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-[#0A0A0A] border-t border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-semibold">Итого:</span>
                  <span className="text-2xl font-bold">{formatPrice(cartTotal)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full bg-[#CDFF38] text-black font-bold py-4 rounded-full hover:bg-[#B8E633] transition-all"
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(cartTotal)}`}
                  confirmText="Подтвердить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6 bg-black/80 backdrop-blur-xl border-b border-white/10">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-[#CDFF38] to-[#B8E633] rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-black" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Дмитрий Смирнов</h2>
              <p className="text-sm text-white/70">+7 (999) 555-77-88</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-black/40 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-black/40 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-4">
          <div className="scroll-fade-in">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-black/40 backdrop-blur-xl rounded-xl p-4 border border-white/10" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between gap-2 mb-2">
                      <span className="text-white/80">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-white/60">{order.date}</span>
                    </div>
                    <div className="flex justify-between gap-2 mb-2">
                      <span className="text-white/60">{order.items.length} товаров</span>
                      <span className="font-bold text-[#CDFF38]">{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full">
                        {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
            <button className="w-full p-4 bg-black/40 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-favorites">
              <div className="flex items-center gap-3">
                <Heart className="w-5 h-5 text-white/70" />
                <span className="font-medium">Избранное</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-black/40 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-payment">
              <div className="flex items-center gap-3">
                <CreditCard className="w-5 h-5 text-white/70" />
                <span className="font-medium">Способы оплаты</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-black/40 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-address">
              <div className="flex items-center gap-3">
                <MapPin className="w-5 h-5 text-white/70" />
                <span className="font-medium">Адреса доставки</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-black/40 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-settings">
              <div className="flex items-center gap-3">
                <Settings className="w-5 h-5 text-white/70" />
                <span className="font-medium">Настройки</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-red-500/10 backdrop-blur-xl rounded-xl border border-red-500/20 flex items-center justify-between hover-elevate active-elevate-2 mt-4" data-testid="button-logout">
              <div className="flex items-center gap-3">
                <LogOut className="w-5 h-5 text-red-400" />
                <span className="font-medium text-red-400">Выйти</span>
              </div>
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(SneakerVault);
```

### demos/FragranceRoyale.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Sparkles, TrendingUp, Zap, Search, Menu, Flower2, Crown, Droplets } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { ConfirmDrawer } from "../ui/modern-drawer";

interface FragranceRoyaleProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  volume: string;
  quantity: number;
  image: string;
  concentration: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Perfume {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  volumes: string[];
  concentrations: string[];
  concentrationColors: string[];
  category: string;
  gender: 'Men' | 'Woman' | 'Unisex';
  inStock: number;
  rating: number;
  brand: string;
  isNew?: boolean;
  isTrending?: boolean;
}

const perfumes: Perfume[] = [
  { 
    id: 1, 
    name: 'Black Orchid', 
    price: 29500, 
    oldPrice: 35000,
    image: 'https://images.unsplash.com/photo-1588405748880-12d1d2a59d75?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1541643600914-78b084683601?w=800&h=1200&fit=crop&q=90',
    description: 'Роскошный аромат с нотами черной орхидеи и пачули', 
    volumes: ['50ml', '100ml'], 
    concentrations: ['Eau de Parfum', 'Intense'], 
    concentrationColors: ['#9333EA', '#7E22CE'],
    category: 'Oriental', 
    gender: 'Unisex',
    inStock: 15, 
    rating: 5.0, 
    brand: 'TOM FORD',
    isNew: true,
    isTrending: true
  },
  { 
    id: 2, 
    name: 'Aventus', 
    price: 44500, 
    oldPrice: 52000,
    image: 'https://images.unsplash.com/photo-1523293182086-7651a899d37f?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1585386959984-a4155224a1ad?w=800&h=1200&fit=crop&q=90',
    description: 'Легендарный фруктово-мускусный аромат успеха', 
    volumes: ['50ml', '100ml', '250ml'], 
    concentrations: ['Eau de Parfum', 'Cologne'], 
    concentrationColors: ['#9333EA', '#C084FC'],
    category: 'Fresh', 
    gender: 'Men',
    inStock: 8, 
    rating: 4.9, 
    brand: 'CREED',
    isNew: true,
    isTrending: true
  },
  { 
    id: 3, 
    name: 'No. 5', 
    price: 18500, 
    oldPrice: 24000,
    image: 'https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1594035910387-fea47794261f?w=800&h=1200&fit=crop&q=90',
    description: 'Легендарный цветочный аромат абсолютной элегантности', 
    volumes: ['50ml', '100ml'], 
    concentrations: ['Eau de Parfum', 'Parfum'], 
    concentrationColors: ['#DB2777', '#BE185D'],
    category: 'Floral', 
    gender: 'Woman',
    inStock: 5, 
    rating: 5.0, 
    brand: 'CHANEL',
    isNew: true,
    isTrending: true
  },
  { 
    id: 4, 
    name: 'Santal 33', 
    price: 38500, 
    oldPrice: 45000,
    image: 'https://images.unsplash.com/photo-1563170351-be82bc888aa4?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1547887537-6158d64c35b3?w=800&h=1200&fit=crop&q=90',
    description: 'Культовый древесный унисекс аромат с нотами сандала', 
    volumes: ['50ml', '100ml'], 
    concentrations: ['Eau de Parfum'], 
    concentrationColors: ['#78716C'],
    category: 'Woody', 
    gender: 'Unisex',
    inStock: 8, 
    rating: 4.9, 
    brand: 'LE LABO',
    isNew: true,
    isTrending: true
  },
  { 
    id: 5, 
    name: 'Baccarat Rouge 540', 
    price: 34000, 
    image: 'https://images.unsplash.com/photo-1528821128474-27f963b062bf?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1595425970377-9ab5d25e8f97?w=800&h=1200&fit=crop&q=90',
    description: 'Роскошный амбровый аромат с нотами жасмина', 
    volumes: ['70ml', '200ml'], 
    concentrations: ['Extrait', 'Eau de Parfum'], 
    concentrationColors: ['#DC2626', '#EF4444'],
    category: 'Amber', 
    gender: 'Unisex',
    inStock: 10, 
    rating: 5.0, 
    brand: 'MAISON FRANCIS',
    isTrending: true
  },
  { 
    id: 6, 
    name: 'Oud Wood', 
    price: 43000, 
    image: 'https://images.unsplash.com/photo-1587017539504-67cfbddac569?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1615634282785-30dd924e9ca0?w=800&h=1200&fit=crop&q=90',
    description: 'Роскошный восточный аромат с нотами уда', 
    volumes: ['50ml', '100ml'], 
    concentrations: ['Eau de Parfum', 'Intense'], 
    concentrationColors: ['#78350F', '#92400E'],
    category: 'Oriental', 
    gender: 'Unisex',
    inStock: 6, 
    rating: 4.8, 
    brand: 'TOM FORD' 
  },
  { 
    id: 7, 
    name: 'Sauvage', 
    price: 14500, 
    image: 'https://images.unsplash.com/photo-1565375473883-12c4e0b8dc8c?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1592417817038-d13bb0b0143d?w=800&h=1200&fit=crop&q=90',
    description: 'Свежий пряный аромат дикой природы', 
    volumes: ['60ml', '100ml', '200ml'], 
    concentrations: ['Eau de Toilette', 'Parfum'], 
    concentrationColors: ['#3B82F6', '#1D4ED8'],
    category: 'Fresh', 
    gender: 'Men',
    inStock: 12, 
    rating: 4.9, 
    brand: 'DIOR',
    isNew: true
  },
  { 
    id: 8, 
    name: 'Coco Mademoiselle', 
    price: 16500, 
    image: 'https://images.unsplash.com/photo-1619994122354-102eeb8c9cb8?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1561053720-76cd73ff22c3?w=800&h=1200&fit=crop&q=90',
    description: 'Изысканный цветочно-фруктовый аромат', 
    volumes: ['50ml', '100ml'], 
    concentrations: ['Eau de Parfum', 'Intense'], 
    concentrationColors: ['#F472B6', '#EC4899'],
    category: 'Floral', 
    gender: 'Woman',
    inStock: 4, 
    rating: 5.0, 
    brand: 'CHANEL' 
  },
];

const categories = ['Все', 'Fresh', 'Oriental', 'Floral', 'Woody', 'Amber'];
const genderFilters = ['All', 'Men', 'Woman', 'Unisex'];

function FragranceRoyale({ activeTab }: FragranceRoyaleProps) {
  const [selectedPerfume, setSelectedPerfume] = useState<Perfume | null>(null);
  const [selectedVolume, setSelectedVolume] = useState<string>('');
  const [selectedConcentration, setSelectedConcentration] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [selectedGender, setSelectedGender] = useState<string>('All');

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedPerfume(null);
    }
    if (activeTab !== 'home') {
      setSelectedGender('All');
    }
  }, [activeTab]);

  const filteredPerfumes = perfumes.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    
    if (activeTab === 'home') {
      const genderMatch = selectedGender === 'All' || p.gender === selectedGender;
      return categoryMatch && genderMatch;
    }
    
    return categoryMatch;
  });

  const toggleFavorite = (perfumeId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(perfumeId)) {
      newFavorites.delete(perfumeId);
    } else {
      newFavorites.add(perfumeId);
    }
    setFavorites(newFavorites);
  };

  const openPerfume = (perfume: Perfume) => {
    setSelectedPerfume(perfume);
    setSelectedVolume(perfume.volumes[0]);
    setSelectedConcentration(perfume.concentrations[0]);
  };

  const addToCart = () => {
    if (!selectedPerfume) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedPerfume.name,
      price: selectedPerfume.price,
      volume: selectedVolume,
      quantity: 1,
      image: selectedPerfume.image,
      concentration: selectedConcentration
    };
    
    setCart([...cart, cartItem]);
    setSelectedPerfume(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cartTotal,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
  };

  // PRODUCT PAGE
  if (activeTab === 'catalog' && selectedPerfume) {
    const bgColor = selectedPerfume.concentrationColors[selectedPerfume.concentrations.indexOf(selectedConcentration)] || '#9333EA';
    
    return (
      <div className="min-h-screen text-white overflow-auto pb-24" style={{ backgroundColor: bgColor }}>
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedPerfume(null)}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedPerfume.id);
            }}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center"
            data-testid={`button-favorite-${selectedPerfume.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedPerfume.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh]">
          <img
            src={selectedPerfume.hoverImage}
            alt={selectedPerfume.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
        </div>

        <div className="bg-white/10 backdrop-blur-xl rounded-t-3xl p-6 space-y-6 pb-32">
          <div className="text-center">
            <p className="text-sm text-white/70 mb-2">{selectedPerfume.brand}</p>
            <h2 className="text-2xl font-bold mb-2">{selectedPerfume.name}</h2>
            <div className="flex items-center justify-center gap-3">
              <p className="text-3xl font-bold">{formatPrice(selectedPerfume.price)}</p>
              {selectedPerfume.oldPrice && (
                <p className="text-xl text-white/50 line-through">{formatPrice(selectedPerfume.oldPrice)}</p>
              )}
            </div>
          </div>

          <p className="text-sm text-white/80 text-center">{selectedPerfume.description}</p>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите концентрацию:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedPerfume.concentrations.map((concentration, idx) => (
                <button
                  key={concentration}
                  onClick={() => setSelectedConcentration(concentration)}
                  className={`px-4 py-2 rounded-full border-2 transition-all text-sm ${
                    selectedConcentration === concentration
                      ? 'border-white scale-105'
                      : 'border-white/30'
                  }`}
                  data-testid={`button-concentration-${concentration}`}
                >
                  {concentration}
                </button>
              ))}
            </div>
          </div>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите объем:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedPerfume.volumes.map((volume) => (
                <button
                  key={volume}
                  onClick={() => setSelectedVolume(volume)}
                  className={`w-16 h-12 rounded-full font-semibold transition-all text-sm ${
                    selectedVolume === volume
                      ? 'bg-[#CDFF38] text-black'
                      : 'bg-white/20 text-white hover:bg-white/30'
                  }`}
                  data-testid={`button-volume-${volume}`}
                >
                  {volume}
                </button>
              ))}
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full bg-[#CDFF38] text-black font-bold py-4 rounded-full hover:bg-[#B8E633] transition-all"
                data-testid="button-buy-now"
              >
                Добавить в корзину
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedPerfume.name} • ${selectedConcentration} • ${selectedVolume}`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />
        </div>
      </div>
    );
  }

  // HOME PAGE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <Menu className="w-6 h-6" data-testid="button-menu" />
            <div className="flex items-center gap-3">
              <ShoppingBag className="w-6 h-6" data-testid="button-view-cart" />
              <Heart className="w-6 h-6" data-testid="button-view-favorites" />
            </div>
          </div>

          <div className="mb-6 scroll-fade-in">
            <div className="flex items-center gap-2 mb-2">
              <Sparkles className="w-6 h-6 text-[#C9B037]" />
            </div>
            <h1 className="text-4xl font-black tracking-tight text-white">
              LUXURY
            </h1>
            <h1 className="text-4xl font-black tracking-tight text-white">
              FRAGRANCE
            </h1>
          </div>

          <div className="flex items-center gap-4 mb-6 scroll-fade-in">
            <button 
              className="p-2 bg-white rounded-full"
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((gender) => (
              <button
                key={gender}
                onClick={() => setSelectedGender(gender)}
                className={`text-sm font-medium transition-colors ${
                  selectedGender === gender
                    ? 'text-white'
                    : 'text-white/40'
                }`}
                data-testid={`button-filter-${gender.toLowerCase()}`}
              >
                {gender}
              </button>
            ))}
          </div>

          <div className="flex items-center gap-3 mb-6">
            <div className="flex-1 bg-white/5 rounded-full px-4 py-3 flex items-center gap-2 border border-white/10">
              <Search className="w-5 h-5 text-white/50" />
              <input
                type="text"
                placeholder="Поиск ароматов..."
                className="bg-transparent text-white placeholder:text-white/50 outline-none flex-1 text-sm"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        <div className="relative mb-6 mx-6 rounded-3xl overflow-hidden scroll-fade-in" style={{ height: '500px' }}>
          <img
            src="https://images.unsplash.com/photo-1588405748880-12d1d2a59d75?w=800&h=1000&fit=crop&q=90"
            alt="Hero"
            className="absolute inset-0 w-full h-full object-cover"
          />
          
          <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>
          
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <div className="flex items-center gap-2 mb-3">
                <Crown className="w-7 h-7 text-[#C9B037]" />
              </div>
              <h2 className="text-5xl font-black tracking-tight leading-tight text-white">
                НОВАЯ
              </h2>
              <h2 className="text-5xl font-black mb-3 tracking-tight leading-tight text-white">
                КОЛЛЕКЦИЯ
              </h2>
              <p className="text-base text-white/70 mb-6 flex items-center gap-2" style={{ letterSpacing: '0.05em' }}>
                <Droplets className="w-4 h-4 text-[#C9B037]" />
                Эксклюзивные ароматы 2025
              </p>
              <button 
                className="px-8 py-4 rounded-full font-bold text-black transition-all hover:scale-105 bg-[#C9B037]"
                data-testid="button-hero-shop-now"
              >
                Смотреть коллекцию
              </button>
            </m.div>
          </div>
        </div>

        <div className="px-6 space-y-4">
          {filteredPerfumes.slice(0, 3).map((perfume, idx) => (
            <m.div
              key={perfume.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openPerfume(perfume)}
              className={`relative cursor-pointer group rounded-3xl overflow-hidden ${idx === 0 ? 'scroll-fade-in' : ''}`}
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`featured-perfume-${perfume.id}`}
            >
              <div className="absolute inset-0">
                <img
                  src={perfume.image}
                  alt={perfume.name}
                  className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
              </div>

              <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>

              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-black/50 backdrop-blur-md rounded-full border border-white/10">
                  <span className="text-xs font-semibold text-white/90">
                    {perfume.brand}
                  </span>
                </div>
              </div>

              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(perfume.id);
                }}
                className="absolute top-4 right-4 w-10 h-10 rounded-full bg-black/50 backdrop-blur-md flex items-center justify-center border border-white/10"
                data-testid={`button-favorite-${perfume.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(perfume.id) ? 'fill-white text-white' : 'text-white'}`}
                />
              </button>

              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <h3 className="text-2xl font-bold mb-2 leading-tight">
                      {perfume.name}
                    </h3>
                    <p className="text-sm text-white/70 mb-4 flex items-center gap-1">
                      <Droplets className="w-4 h-4 text-[#C9B037]" />
                      {perfume.category}
                    </p>
                  </div>

                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openPerfume(perfume);
                    }}
                    className="w-14 h-14 rounded-full bg-[#C9B037] flex items-center justify-center transition-all hover:scale-110"
                    data-testid={`button-add-to-cart-${perfume.id}`}
                  >
                    <ShoppingBag className="w-6 h-6 text-black" />
                  </button>
                </div>

                <div className="mt-3">
                  <p className="text-lg font-bold text-white">{formatPrice(perfume.price)}</p>
                </div>
              </div>
            </m.div>
          ))}
        </div>

        <div className="h-8"></div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-2xl font-bold">Каталог</h1>
            <div className="flex items-center gap-3">
              <button className="p-2" data-testid="button-view-search">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" data-testid="button-view-filter">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'bg-[#C9B037] text-black'
                    : 'bg-white/10 text-white/70 hover:bg-white/15'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-4">
            {filteredPerfumes.map((perfume, index) => (
              <m.div
                key={perfume.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openPerfume(perfume)}
                className={`relative cursor-pointer ${index < 4 ? '' : `scroll-fade-in-delay-${Math.min((index - 4) % 3 + 1, 3)}`}`}
                data-testid={`perfume-card-${perfume.id}`}
              >
                <div className="relative aspect-[3/4] rounded-3xl overflow-hidden mb-3 bg-white/5">
                  <img
                    src={perfume.image}
                    alt={perfume.name}
                    className="w-full h-full object-cover"
                    loading="lazy"
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(perfume.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/40 backdrop-blur-xl flex items-center justify-center"
                    data-testid={`button-favorite-${perfume.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(perfume.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {perfume.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-[#C9B037] text-black text-xs font-bold rounded-full">
                      NEW
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-xs text-white/50 mb-1">{perfume.brand}</p>
                  <p className="text-sm font-semibold mb-1 truncate">{perfume.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold">{formatPrice(perfume.price)}</p>
                    {perfume.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(perfume.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Корзина</h1>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20">
              <ShoppingBag className="w-20 h-20 text-white/20 mb-4" />
              <p className="text-white/50 text-center">Ваша корзина пуста</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item) => (
                <div
                  key={item.id}
                  className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 flex gap-4"
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <h3 className="font-semibold mb-1">{item.name}</h3>
                    <p className="text-sm text-white/60 mb-2">
                      {item.concentration} • {item.volume}
                    </p>
                    <p className="text-lg font-bold">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-8 h-8"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-[#0A0A0A] border-t border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-semibold">Итого:</span>
                  <span className="text-2xl font-bold">{formatPrice(cartTotal)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full bg-[#C9B037] text-black font-bold py-4 rounded-full hover:bg-[#B8A033] transition-all"
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(cartTotal)}`}
                  confirmText="Подтвердить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6 bg-white/5 border-b border-white/10">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-[#C9B037] rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-black" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Анна Смирнова</h2>
              <p className="text-sm text-muted-foreground">+7 (999) 888-77-66</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-4">
          <div className="scroll-fade-in">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between gap-2 mb-2">
                      <span className="text-white/80">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-white/60">{order.date}</span>
                    </div>
                    <div className="flex justify-between gap-2 mb-2">
                      <span className="text-white/60">{order.items.length} товаров</span>
                      <span className="font-bold text-[#C9B037]">{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full">
                        {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-favorites">
              <div className="flex items-center gap-3">
                <Heart className="w-5 h-5 text-white/70" />
                <span className="font-medium">Избранное</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-addresses">
              <div className="flex items-center gap-3">
                <MapPin className="w-5 h-5 text-white/70" />
                <span className="font-medium">Адреса доставки</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-payment">
              <div className="flex items-center gap-3">
                <CreditCard className="w-5 h-5 text-white/70" />
                <span className="font-medium">Способы оплаты</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-settings">
              <div className="flex items-center gap-3">
                <Settings className="w-5 h-5 text-white/70" />
                <span className="font-medium">Настройки</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-logout">
              <div className="flex items-center gap-3">
                <LogOut className="w-5 h-5 text-white/70" />
                <span className="font-medium">Выход</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(FragranceRoyale);
```

### demos/RascalStore.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Sparkles, TrendingUp, Zap, Search, Menu } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { ConfirmDrawer } from "../ui/modern-drawer";
import fashionImg1 from '@assets/stock_images/futuristic_techwear__e958e42c.jpg';
import fashionImg2 from '@assets/stock_images/futuristic_techwear__737df842.jpg';
import fashionImg3 from '@assets/stock_images/futuristic_fashion_m_4203db1e.jpg';
import fashionImg4 from '@assets/stock_images/futuristic_techwear__a22f6015.jpg';
import fashionImg5 from '@assets/stock_images/futuristic_techwear__046f6538.jpg';
import fashionImg6 from '@assets/stock_images/futuristic_fashion_m_331bf630.jpg';
import fashionImg7 from '@assets/stock_images/futuristic_fashion_m_518587e3.jpg';
import fashionImg8 from '@assets/stock_images/futuristic_techwear__95b77175.jpg';

interface RascalStoreProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  size: string;
  quantity: number;
  image: string;
  color: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Product {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  sizes: string[];
  colors: string[];
  colorHex: string[];
  category: string;
  gender: 'Men' | 'Woman';
  inStock: number;
  rating: number;
  brand: string;
  isNew?: boolean;
  isTrending?: boolean;
}

const products: Product[] = [
  { 
    id: 1, 
    name: 'Waterproof Jacket', 
    price: 12900, 
    oldPrice: 15900,
    image: fashionImg1, 
    hoverImage: fashionImg1,
    description: 'Водонепроницаемая куртка Nike ACG с технологией Gore-Tex', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Зеленый', 'Черный'], 
    colorHex: ['#7FB069', '#1a2e2a'],
    category: 'Куртки', 
    gender: 'Men',
    inStock: 15, 
    rating: 5.0, 
    brand: 'NIKE',
    isNew: true,
    isTrending: true
  },
  { 
    id: 2, 
    name: 'Nike ACG Jacket', 
    price: 25900, 
    oldPrice: 32000,
    image: fashionImg2, 
    hoverImage: fashionImg2,
    description: 'Премиальная куртка Nike ACG для экстремальных условий', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Темно-зеленый'], 
    colorHex: ['#1a2e2a', '#5A8C4A'],
    category: 'Куртки', 
    gender: 'Men',
    inStock: 8, 
    rating: 5.0, 
    brand: 'NIKE',
    isNew: true,
    isTrending: true
  },
  { 
    id: 3, 
    name: 'Futuristic Sneakers', 
    price: 18900, 
    oldPrice: 23000,
    image: fashionImg3, 
    hoverImage: fashionImg3,
    description: 'Футуристические кроссовки Nike с технологией React', 
    sizes: ['39', '40', '41', '42', '43'], 
    colors: ['Зеленый', 'Белый', 'Черный'], 
    colorHex: ['#7FB069', '#FFFFFF', '#1a2e2a'],
    category: 'Кроссовки', 
    gender: 'Men',
    inStock: 12, 
    rating: 4.9, 
    brand: 'NIKE',
    isNew: true,
    isTrending: true
  },
  { 
    id: 4, 
    name: 'Tech Runner', 
    price: 22000, 
    oldPrice: 28000,
    image: fashionImg4, 
    hoverImage: fashionImg4,
    description: 'Беговые кроссовки Nike с инновационной подошвой', 
    sizes: ['38', '39', '40', '41', '42'], 
    colors: ['Черный', 'Зеленый'], 
    colorHex: ['#1a2e2a', '#7FB069'],
    category: 'Кроссовки', 
    gender: 'Woman',
    inStock: 10, 
    rating: 5.0, 
    brand: 'NIKE',
    isNew: true,
    isTrending: true
  },
  { 
    id: 5, 
    name: 'Trail Shoes', 
    price: 16500, 
    oldPrice: 20000,
    image: fashionImg5, 
    hoverImage: fashionImg5,
    description: 'Трейловые кроссовки Nike для бега по пересеченной местности', 
    sizes: ['39', '40', '41', '42', '43', '44'], 
    colors: ['Серый', 'Зеленый'], 
    colorHex: ['#6B7280', '#7FB069'],
    category: 'Кроссовки', 
    gender: 'Men',
    inStock: 15, 
    rating: 4.8, 
    brand: 'NIKE',
    isTrending: true
  },
  { 
    id: 6, 
    name: 'Carbon Hoodie', 
    price: 8900, 
    oldPrice: 11500,
    image: fashionImg6, 
    hoverImage: fashionImg6,
    description: 'Премиум худи Nike из высокотехнологичных материалов', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Зеленый'], 
    colorHex: ['#1a2e2a', '#7FB069'],
    category: 'Худи', 
    gender: 'Men',
    inStock: 20, 
    rating: 4.9, 
    brand: 'NIKE',
    isNew: true
  },
  { 
    id: 7, 
    name: 'Urban Tech Jacket', 
    price: 19900, 
    oldPrice: 25000,
    image: fashionImg7, 
    hoverImage: fashionImg7,
    description: 'Городская куртка Nike с защитой от непогоды', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Зеленый', 'Графит'], 
    colorHex: ['#7FB069', '#2D2D2D'],
    category: 'Куртки', 
    gender: 'Woman',
    inStock: 7, 
    rating: 5.0, 
    brand: 'NIKE',
    isNew: true
  },
  { 
    id: 8, 
    name: 'Elite Training Hoodie', 
    price: 11900, 
    oldPrice: 15000,
    image: fashionImg8, 
    hoverImage: fashionImg8,
    description: 'Тренировочный худи Nike для профессиональных спортсменов', 
    sizes: ['S', 'M', 'L', 'XL', 'XXL'], 
    colors: ['Черный', 'Темно-зеленый'], 
    colorHex: ['#1a2e2a', '#5A8C4A'],
    category: 'Худи', 
    gender: 'Men',
    inStock: 18, 
    rating: 4.9, 
    brand: 'NIKE',
    isTrending: true
  },
  { 
    id: 9, 
    name: 'Storm Runner Pro', 
    price: 24500, 
    oldPrice: 30000,
    image: fashionImg3, 
    hoverImage: fashionImg3,
    description: 'Профессиональные беговые кроссовки Nike для любой погоды', 
    sizes: ['39', '40', '41', '42', '43'], 
    colors: ['Зеленый', 'Черный'], 
    colorHex: ['#7FB069', '#1a2e2a'],
    category: 'Кроссовки', 
    gender: 'Men',
    inStock: 9, 
    rating: 5.0, 
    brand: 'NIKE',
    isNew: true,
    isTrending: true
  },
  { 
    id: 10, 
    name: 'Winter Tech Parka', 
    price: 32900, 
    oldPrice: 42000,
    image: fashionImg2, 
    hoverImage: fashionImg2,
    description: 'Зимняя парка Nike ACG с утеплителем премиум класса', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Хаки'], 
    colorHex: ['#1a2e2a', '#9CAF88'],
    category: 'Куртки', 
    gender: 'Woman',
    inStock: 6, 
    rating: 5.0, 
    brand: 'NIKE',
    isNew: true
  },
];

const categories = ['Все', 'Куртки', 'Кроссовки', 'Худи'];
const genderFilters = ['All', 'Men', 'Woman'];

function RascalStore({ activeTab }: RascalStoreProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [selectedColor, setSelectedColor] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [selectedGender, setSelectedGender] = useState<string>('All');
  const [showCheckout, setShowCheckout] = useState<boolean>(false);

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedProduct(null);
    }
    if (activeTab !== 'home') {
      setSelectedGender('All');
    }
    if (activeTab !== 'cart') {
      setShowCheckout(false);
    }
  }, [activeTab]);

  const filteredProducts = products.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    
    if (activeTab === 'home') {
      const genderMatch = selectedGender === 'All' || p.gender === selectedGender;
      return categoryMatch && genderMatch;
    }
    
    return categoryMatch;
  });

  const toggleFavorite = (productId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(productId)) {
      newFavorites.delete(productId);
    } else {
      newFavorites.add(productId);
    }
    setFavorites(newFavorites);
  };

  const openProduct = (product: Product) => {
    setSelectedProduct(product);
    setSelectedSize(product.sizes[0]);
    setSelectedColor(product.colors[0]);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedProduct.name,
      price: selectedProduct.price,
      size: selectedSize,
      quantity: 1,
      image: selectedProduct.image,
      color: selectedColor
    };
    
    setCart([...cart, cartItem]);
    setSelectedProduct(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cartTotal,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
    setShowCheckout(false);
  };

  if (activeTab === 'catalog' && selectedProduct) {
    const bgColor = selectedProduct.colorHex[selectedProduct.colors.indexOf(selectedColor)] || '#1a2e2a';
    
    return (
      <div className="min-h-screen text-white overflow-auto" style={{ backgroundColor: bgColor }}>
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedProduct(null)}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedProduct.id);
            }}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center"
            data-testid={`button-favorite-${selectedProduct.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedProduct.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh]">
          <img
            src={selectedProduct.hoverImage}
            alt={selectedProduct.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
        </div>

        <div className="bg-white/10 backdrop-blur-xl rounded-t-3xl p-6 space-y-6 pb-32">
          <div className="text-center">
            <div className="inline-block px-3 py-1 bg-white/20 rounded-full mb-3">
              <span className="text-xs font-bold tracking-wider">NIKE • Rascal®</span>
            </div>
            <h2 className="text-2xl font-bold mb-2">{selectedProduct.name}</h2>
            <div className="flex items-center justify-center gap-3">
              <p className="text-3xl font-bold">{formatPrice(selectedProduct.price)}</p>
              {selectedProduct.oldPrice && (
                <p className="text-xl text-white/50 line-through">{formatPrice(selectedProduct.oldPrice)}</p>
              )}
            </div>
          </div>

          <p className="text-sm text-white/80 text-center">{selectedProduct.description}</p>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите цвет:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedProduct.colors.map((color, idx) => (
                <button
                  key={color}
                  onClick={() => setSelectedColor(color)}
                  className={`w-10 h-10 rounded-full border-2 transition-all ${
                    selectedColor === color
                      ? 'border-white scale-110'
                      : 'border-white/30'
                  }`}
                  style={{ backgroundColor: selectedProduct.colorHex[idx] }}
                  data-testid={`button-color-${color}`}
                />
              ))}
            </div>
          </div>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите размер:</p>
            <div className="flex items-center justify-center gap-3 flex-wrap">
              {selectedProduct.sizes.map((size) => (
                <button
                  key={size}
                  onClick={() => setSelectedSize(size)}
                  className={`w-12 h-12 rounded-full font-semibold transition-all ${
                    selectedSize === size
                      ? 'text-black'
                      : 'bg-white/20 text-white hover:bg-white/30'
                  }`}
                  style={selectedSize === size ? { backgroundColor: '#7FB069' } : {}}
                  data-testid={`button-size-${size}`}
                >
                  {size}
                </button>
              ))}
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full text-black font-bold py-4 rounded-full transition-all hover:opacity-90"
                style={{ backgroundColor: '#7FB069' }}
                data-testid="button-buy-now"
              >
                Добавить в корзину
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedProduct.name} • ${selectedColor} • ${selectedSize}`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />
        </div>
      </div>
    );
  }

  if (activeTab === 'home') {
    return (
      <div className="min-h-screen text-white overflow-auto pb-24" style={{ backgroundColor: '#1a2e2a' }}>
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <Menu className="w-6 h-6" data-testid="button-menu" />
            <div className="flex items-center gap-3">
              <ShoppingBag className="w-6 h-6" data-testid="button-view-cart" />
              <Heart className="w-6 h-6" data-testid="button-view-favorites" />
            </div>
          </div>

          <div className="mb-6 scroll-fade-in">
            <h1 className="text-4xl font-black mb-1 tracking-tight">
              Hello Pixie<br/>
              <span style={{ color: '#7FB069' }}>Rascal Collection</span>
            </h1>
          </div>

          <div className="flex items-center gap-4 mb-6 scroll-fade-in">
            <button 
              className="p-2 rounded-full"
              style={{ backgroundColor: '#7FB069' }}
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5" fill="#1a2e2a" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((gender) => (
              <button
                key={gender}
                onClick={() => setSelectedGender(gender)}
                className={`text-sm font-medium transition-colors ${
                  selectedGender === gender
                    ? 'text-white'
                    : 'text-white/40'
                }`}
                data-testid={`button-filter-${gender.toLowerCase()}`}
              >
                {gender}
              </button>
            ))}
          </div>

          <div className="flex items-center gap-3 mb-6">
            <div className="flex-1 bg-white/10 backdrop-blur-xl rounded-full px-4 py-3 flex items-center gap-2">
              <Search className="w-5 h-5 text-white/50" />
              <input
                type="text"
                placeholder="Поиск товаров..."
                className="bg-transparent text-white placeholder:text-white/50 outline-none flex-1 text-sm"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        <div className="relative mb-6 mx-6 rounded-3xl overflow-hidden scroll-fade-in" style={{ height: '500px' }}>
          <img
            src={fashionImg1}
            alt="Hero Banner"
            className="absolute inset-0 w-full h-full object-cover"
          />
          
          <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
          
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <div className="flex items-center gap-3 mb-4">
                <div className="w-10 h-10 bg-white rounded-full flex items-center justify-center">
                  <svg viewBox="0 0 24 24" className="w-5 h-5" fill="#1a2e2a">
                    <path d="M12.4,2.2c-5.6,0-10.2,4.6-10.2,10.2s4.6,10.2,10.2,10.2c5.6,0,10.2-4.6,10.2-10.2S18,2.2,12.4,2.2z M12.4,20.3c-4.4,0-8-3.6-8-8c0-4.4,3.6-8,8-8s8,3.6,8,8C20.4,16.7,16.8,20.3,12.4,20.3z"/>
                  </svg>
                </div>
                <span className="text-lg font-bold">NIKE • Rascal®</span>
              </div>
              <h2 className="text-5xl font-black mb-3 tracking-tight leading-tight">
                НОВАЯ<br/>
                КОЛЛЕКЦИЯ
              </h2>
              <p className="text-lg text-white/80 mb-6" style={{ letterSpacing: '0.1em' }}>
                Эксклюзивные модели 2025
              </p>
              <button 
                className="px-8 py-4 rounded-full font-bold text-black transition-all hover:scale-105"
                style={{
                  backgroundColor: '#7FB069',
                  boxShadow: '0 0 30px rgba(127, 176, 105, 0.4)'
                }}
                data-testid="button-hero-shop-now"
              >
                Смотреть коллекцию
              </button>
            </m.div>
          </div>
        </div>

        <div className="px-6 space-y-4">
          {filteredProducts.slice(0, 3).map((product, idx) => (
            <m.div
              key={product.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openProduct(product)}
              className={`relative cursor-pointer group rounded-3xl overflow-hidden ${idx === 0 ? 'scroll-fade-in' : ''}`}
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`featured-product-${product.id}`}
            >
              <div className="absolute inset-0">
                <img
                  src={product.image}
                  alt={product.name}
                  className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                />
              </div>

              <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>

              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-white/20 backdrop-blur-xl rounded-full">
                  <span className="text-xs font-semibold text-white">
                    {product.isNew ? 'New' : product.category}
                  </span>
                </div>
              </div>

              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(product.id);
                }}
                className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 backdrop-blur-xl flex items-center justify-center"
                data-testid={`button-favorite-${product.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                />
              </button>

              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <h3 className="text-2xl font-bold mb-2 leading-tight">
                      {product.name.split(' ').slice(0, 2).join(' ')}<br/>
                      {product.name.split(' ').slice(2).join(' ')}
                    </h3>
                    <p className="text-sm text-white/80 mb-4">{product.gender}'s wear</p>
                  </div>

                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openProduct(product);
                    }}
                    className="w-14 h-14 rounded-full flex items-center justify-center transition-all hover:scale-110"
                    style={{ backgroundColor: '#7FB069' }}
                    data-testid={`button-add-to-cart-${product.id}`}
                  >
                    <ShoppingBag className="w-6 h-6 text-black" />
                  </button>
                </div>

                <div className="mt-3">
                  <p className="text-lg font-bold">{formatPrice(product.price)}</p>
                </div>
              </div>
            </m.div>
          ))}
        </div>

        <div className="h-8"></div>
      </div>
    );
  }

  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen text-white overflow-auto pb-24" style={{ backgroundColor: '#1a2e2a' }}>
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-2xl font-bold">Каталог</h1>
            <div className="flex items-center gap-3">
              <button className="p-2" data-testid="button-view-search">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" data-testid="button-view-filter">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'text-black'
                    : 'bg-white/10 text-white/70 hover:bg-white/20'
                }`}
                style={selectedCategory === cat ? { backgroundColor: '#7FB069' } : {}}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-4">
            {filteredProducts.map((product, index) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer ${index < 4 ? '' : `scroll-fade-in-delay-${Math.min((index - 4) % 3 + 1, 3)}`}`}
                data-testid={`product-card-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-3xl overflow-hidden mb-3 bg-white/5">
                  <img
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover"
                    loading="lazy"
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/40 backdrop-blur-xl flex items-center justify-center"
                    data-testid={`button-favorite-${product.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {product.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 text-black text-xs font-bold rounded-full" style={{ backgroundColor: '#7FB069' }}>
                      NEW
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-sm font-semibold mb-1 truncate">{product.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold">{formatPrice(product.price)}</p>
                    {product.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(product.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    if (showCheckout) {
      return (
        <div className="min-h-screen text-white overflow-auto pb-32" style={{ backgroundColor: '#1a2e2a' }}>
          <div className="p-6">
            <div className="flex items-center gap-3 mb-6">
              <button 
                onClick={() => setShowCheckout(false)}
                className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center"
                data-testid="button-back"
              >
                <ChevronLeft className="w-6 h-6" />
              </button>
              <h1 className="text-2xl font-bold">Оформление заказа</h1>
            </div>

            <div className="space-y-4">
              <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4">
                <h3 className="font-semibold mb-3 flex items-center gap-2">
                  <User className="w-5 h-5" style={{ color: '#7FB069' }} />
                  Контактная информация
                </h3>
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="Имя Фамилия"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-name"
                  />
                  <input
                    type="tel"
                    placeholder="+7 (999) 123-45-67"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-phone"
                  />
                  <input
                    type="email"
                    placeholder="email@example.com"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-email"
                  />
                </div>
              </div>

              <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4">
                <h3 className="font-semibold mb-3 flex items-center gap-2">
                  <MapPin className="w-5 h-5" style={{ color: '#7FB069' }} />
                  Адрес доставки
                </h3>
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="Город"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-city"
                  />
                  <input
                    type="text"
                    placeholder="Улица, дом, квартира"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-address"
                  />
                  <input
                    type="text"
                    placeholder="Индекс"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-zip"
                  />
                </div>
              </div>

              <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4">
                <h3 className="font-semibold mb-3 flex items-center gap-2">
                  <CreditCard className="w-5 h-5" style={{ color: '#7FB069' }} />
                  Оплата
                </h3>
                <div className="space-y-3">
                  <input
                    type="text"
                    placeholder="Номер карты"
                    className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                    data-testid="input-card-number"
                  />
                  <div className="grid grid-cols-2 gap-3">
                    <input
                      type="text"
                      placeholder="ММ/ГГ"
                      className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                      data-testid="input-card-expiry"
                    />
                    <input
                      type="text"
                      placeholder="CVV"
                      className="w-full bg-white/10 rounded-xl px-4 py-3 text-white placeholder:text-white/50 outline-none"
                      data-testid="input-card-cvv"
                    />
                  </div>
                </div>
              </div>

              <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4">
                <div className="flex items-center justify-between mb-2">
                  <span className="text-white/70">Товары ({cart.length})</span>
                  <span className="font-semibold">{formatPrice(total)}</span>
                </div>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-white/70">Доставка</span>
                  <span className="font-semibold">Бесплатно</span>
                </div>
                <div className="border-t border-white/10 pt-2 mt-2">
                  <div className="flex items-center justify-between">
                    <span className="text-lg font-bold">Итого:</span>
                    <span className="text-2xl font-bold">{formatPrice(total)}</span>
                  </div>
                </div>
              </div>

              <ConfirmDrawer
                trigger={
                  <button
                    className="w-full text-black font-bold py-4 rounded-full transition-all hover:opacity-90"
                    style={{ backgroundColor: '#7FB069' }}
                    data-testid="button-confirm-order"
                  >
                    Подтвердить заказ
                  </button>
                }
                title="Подтвердить заказ?"
                description={`${cart.length} товаров на сумму ${formatPrice(cartTotal)}`}
                confirmText="Подтвердить"
                cancelText="Отмена"
                variant="default"
                onConfirm={handleCheckout}
              />
            </div>
          </div>
        </div>
      );
    }

    return (
      <div className="min-h-screen text-white overflow-auto pb-32" style={{ backgroundColor: '#1a2e2a' }}>
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Корзина</h1>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20">
              <ShoppingBag className="w-20 h-20 text-white/20 mb-4" />
              <p className="text-white/50 text-center">Ваша корзина пуста</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item) => (
                <div
                  key={item.id}
                  className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 flex gap-4"
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <h3 className="font-semibold mb-1">{item.name}</h3>
                    <p className="text-sm text-white/60 mb-2">
                      {item.color} • {item.size}
                    </p>
                    <p className="text-lg font-bold">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-8 h-8"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 border-t border-white/10" style={{ backgroundColor: '#1a2e2a' }}>
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-semibold">Итого:</span>
                  <span className="text-2xl font-bold">{formatPrice(total)}</span>
                </div>
                <button
                  onClick={() => setShowCheckout(true)}
                  className="w-full text-black font-bold py-4 rounded-full transition-all hover:opacity-90"
                  style={{ backgroundColor: '#7FB069' }}
                  data-testid="button-checkout"
                >
                  Оформить заказ
                </button>
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen text-white overflow-auto pb-24" style={{ backgroundColor: '#1a2e2a' }}>
        <div className="p-6 bg-white/5 backdrop-blur-xl border-b border-white/10">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 rounded-full flex items-center justify-center" style={{
              background: 'linear-gradient(135deg, #7FB069 0%, #5A8C4A 100%)'
            }}>
              <User className="w-8 h-8 text-white" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Александр Петров</h2>
              <p className="text-sm text-white/60">+7 (999) 123-45-67</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-4">
          <div className="scroll-fade-in">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between gap-2 mb-2">
                      <span className="text-white/80">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-white/60">{order.date}</span>
                    </div>
                    <div className="flex justify-between gap-2 mb-2">
                      <span className="text-white/60">{order.items.length} товаров</span>
                      <span className="font-bold" style={{ color: '#7FB069' }}>{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full">
                        {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all" data-testid="button-favorites">
              <div className="flex items-center gap-3">
                <Heart className="w-5 h-5 text-white/70" />
                <span className="font-medium">Избранное</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all" data-testid="button-payment">
              <div className="flex items-center gap-3">
                <CreditCard className="w-5 h-5 text-white/70" />
                <span className="font-medium">Способы оплаты</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all" data-testid="button-address">
              <div className="flex items-center gap-3">
                <MapPin className="w-5 h-5 text-white/70" />
                <span className="font-medium">Адреса доставки</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all" data-testid="button-settings">
              <div className="flex items-center gap-3">
                <Settings className="w-5 h-5 text-white/70" />
                <span className="font-medium">Настройки</span>
              </div>
              <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
            </button>

            <div className="pt-4">
              <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-red-500/20 transition-all" data-testid="button-logout">
                <div className="flex items-center gap-3">
                  <LogOut className="w-5 h-5 text-red-400" />
                  <span className="font-medium text-red-400">Выйти из аккаунта</span>
                </div>
              </button>
            </div>
          </div>
        </div>

        <div className="p-6">
          <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 bg-white rounded-full flex items-center justify-center">
                <svg viewBox="0 0 24 24" className="w-6 h-6" fill="#1a2e2a">
                  <path d="M12.4,2.2c-5.6,0-10.2,4.6-10.2,10.2s4.6,10.2,10.2,10.2c5.6,0,10.2-4.6,10.2-10.2S18,2.2,12.4,2.2z M12.4,20.3c-4.4,0-8-3.6-8-8c0-4.4,3.6-8,8-8s8,3.6,8,8C20.4,16.7,16.8,20.3,12.4,20.3z"/>
                </svg>
              </div>
              <div>
                <p className="font-bold text-lg">NIKE • Rascal®</p>
                <p className="text-sm text-white/60">Premium Collection</p>
              </div>
            </div>
            <p className="text-sm text-white/70 mb-4">
              Присоединяйтесь к программе лояльности Nike и получайте эксклюзивные предложения!
            </p>
            <button
              className="w-full text-black font-bold py-3 rounded-full transition-all hover:opacity-90"
              style={{ backgroundColor: '#7FB069' }}
              data-testid="button-join-loyalty"
            >
              Узнать больше
            </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
}

export default RascalStore;
```

### demos/LabSurvivalist.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Sparkles, TrendingUp, Zap, Search, Menu, Shield, Target, Check } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { useFilter } from "@/hooks/useFilter";
import { Skeleton } from "@/components/ui/skeleton";
import img1 from '@assets/stock_images/futuristic_fashion_m_331bf630.jpg';
import img2 from '@assets/stock_images/futuristic_fashion_m_b5d87157.jpg';
import img3 from '@assets/stock_images/futuristic_fashion_m_472b5d38.jpg';
import img4 from '@assets/stock_images/futuristic_fashion_m_655a9d67.jpg';
import img5 from '@assets/stock_images/futuristic_fashion_m_4950c20e.jpg';

interface LabSurvivalistProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  size: string;
  quantity: number;
  image: string;
  color: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Product {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  sizes: string[];
  colors: string[];
  colorHex: string[];
  category: string;
  gender: 'Мужское' | 'Женское' | 'Унисекс';
  inStock: number;
  rating: number;
  brand: string;
  isNew?: boolean;
  isTrending?: boolean;
}

const products: Product[] = [
  { 
    id: 1, 
    name: 'Field Vest', 
    price: 24900, 
    oldPrice: 32000,
    image: img1, 
    hoverImage: img1,
    description: 'Тактический жилет с множеством карманов для выживания в любых условиях', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Серый', 'Белый'], 
    colorHex: ['#000000', '#6B7280', '#FFFFFF'],
    category: 'Верхняя одежда', 
    gender: 'Унисекс',
    inStock: 12, 
    rating: 5.0, 
    brand: 'LAB',
    isNew: true,
    isTrending: true
  },
  { 
    id: 2, 
    name: 'Tactical Jacket', 
    price: 45900, 
    oldPrice: 58000,
    image: img2, 
    hoverImage: img2,
    description: 'Премиальная тактическая куртка с усиленными швами и водоотталкивающим покрытием', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Графит'], 
    colorHex: ['#000000', '#374151'],
    category: 'Верхняя одежда', 
    gender: 'Мужское',
    inStock: 8, 
    rating: 5.0, 
    brand: 'LAB',
    isNew: true,
    isTrending: true
  },
  { 
    id: 3, 
    name: 'Cargo Pants', 
    price: 18500, 
    oldPrice: 25000,
    image: img3, 
    hoverImage: img3,
    description: 'Функциональные брюки карго с усиленными коленями', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Серый'], 
    colorHex: ['#000000', '#6B7280'],
    category: 'Брюки', 
    gender: 'Унисекс',
    inStock: 15, 
    rating: 4.9, 
    brand: 'LAB',
    isNew: true,
    isTrending: true
  },
  { 
    id: 4, 
    name: 'Combat Boots', 
    price: 32000, 
    oldPrice: 42000,
    image: img4, 
    hoverImage: img4,
    description: 'Тактические ботинки с композитным носком и противоскользящей подошвой', 
    sizes: ['39', '40', '41', '42', '43', '44'], 
    colors: ['Черный'], 
    colorHex: ['#000000'],
    category: 'Аксессуары', 
    gender: 'Унисекс',
    inStock: 10, 
    rating: 5.0, 
    brand: 'LAB',
    isTrending: true
  },
  { 
    id: 5, 
    name: 'Utility Backpack', 
    price: 15900, 
    oldPrice: 21000,
    image: img5, 
    hoverImage: img5,
    description: 'Рюкзак повышенной вместимости с модульной системой MOLLE', 
    sizes: ['ONE SIZE'], 
    colors: ['Черный', 'Серый', 'Белый'], 
    colorHex: ['#000000', '#6B7280', '#FFFFFF'],
    category: 'Аксессуары', 
    gender: 'Унисекс',
    inStock: 20, 
    rating: 4.8, 
    brand: 'LAB',
    isNew: true,
    isTrending: true
  },
  { 
    id: 6, 
    name: 'Tech Gloves', 
    price: 8900, 
    image: img1, 
    hoverImage: img1,
    description: 'Тактические перчатки с сенсорными пальцами и усиленной защитой', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Серый'], 
    colorHex: ['#000000', '#6B7280'],
    category: 'Аксессуары', 
    gender: 'Унисекс',
    inStock: 25, 
    rating: 4.7, 
    brand: 'LAB',
    isNew: true
  },
  { 
    id: 7, 
    name: 'Tactical Belt', 
    price: 6900, 
    image: img2, 
    hoverImage: img2,
    description: 'Усиленный тактический ремень с быстрой застежкой', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный'], 
    colorHex: ['#000000'],
    category: 'Аксессуары', 
    gender: 'Унисекс',
    inStock: 18, 
    rating: 4.9, 
    brand: 'LAB'
  },
  { 
    id: 8, 
    name: 'Survival Jacket', 
    price: 52000, 
    oldPrice: 65000,
    image: img3, 
    hoverImage: img3,
    description: 'Куртка для экстремальных условий с встроенными отражателями', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Графит', 'Белый'], 
    colorHex: ['#000000', '#374151', '#FFFFFF'],
    category: 'Верхняя одежда', 
    gender: 'Мужское',
    inStock: 6, 
    rating: 5.0, 
    brand: 'LAB',
    isTrending: true
  },
  { 
    id: 9, 
    name: 'Reinforced Pants', 
    price: 22000, 
    image: img4, 
    hoverImage: img4,
    description: 'Усиленные брюки с защитными вставками', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Серый'], 
    colorHex: ['#000000', '#6B7280'],
    category: 'Брюки', 
    gender: 'Унисекс',
    inStock: 14, 
    rating: 4.8, 
    brand: 'LAB'
  },
  { 
    id: 10, 
    name: 'Base Layer Set', 
    price: 12500, 
    image: img5, 
    hoverImage: img5,
    description: 'Комплект термобелья для базового слоя', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Серый', 'Белый'], 
    colorHex: ['#000000', '#6B7280', '#FFFFFF'],
    category: 'Верхняя одежда', 
    gender: 'Унисекс',
    inStock: 22, 
    rating: 4.6, 
    brand: 'LAB',
    isNew: true
  },
];

const categories = ['Все', 'Верхняя одежда', 'Брюки', 'Аксессуары'];
const genderFilters = ['All', 'Мужское', 'Женское', 'Унисекс'];

const getDelayClass = (index: number) => {
  const delays = ['scroll-fade-in', 'scroll-fade-in-delay-1', 'scroll-fade-in-delay-2', 'scroll-fade-in-delay-3', 'scroll-fade-in-delay-4', 'scroll-fade-in-delay-5'];
  return delays[index % delays.length];
};

function LabSurvivalist({ activeTab }: LabSurvivalistProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [selectedColor, setSelectedColor] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [selectedGender, setSelectedGender] = useState<string>('All');
  const [orders, setOrders] = useState<Order[]>([]);
  const [showOrderSuccess, setShowOrderSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: products,
    searchFields: ['name', 'description', 'category', 'brand'] as (keyof Product)[],
  });

  const handleImageLoad = (id: number) => {
    setLoadedImages(prev => new Set([...Array.from(prev), id]));
  };

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedProduct(null);
    }
    if (activeTab !== 'home') {
      setSelectedGender('All');
    }
  }, [activeTab]);

  const filteredProducts = filteredItems.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    
    if (activeTab === 'home') {
      const genderMatch = selectedGender === 'All' || p.gender === selectedGender;
      return categoryMatch && genderMatch;
    }
    
    return categoryMatch;
  });

  const toggleFavorite = (productId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(productId)) {
      newFavorites.delete(productId);
    } else {
      newFavorites.add(productId);
    }
    setFavorites(newFavorites);
  };

  const openProduct = (product: Product) => {
    setSelectedProduct(product);
    setSelectedSize(product.sizes[0]);
    setSelectedColor(product.colors[0]);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedProduct.name,
      price: selectedProduct.price,
      size: selectedSize,
      quantity: 1,
      image: selectedProduct.image,
      color: selectedColor
    };
    
    setCart([...cart, cartItem]);
    setSelectedProduct(null);
  };

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0),
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
    setShowOrderSuccess(true);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  // PRODUCT DETAIL PAGE
  if (activeTab === 'catalog' && selectedProduct) {
    const bgColor = selectedProduct.colorHex[selectedProduct.colors.indexOf(selectedColor)] || '#000000';
    
    return (
      <div className="min-h-screen text-white overflow-auto" style={{ backgroundColor: bgColor }}>
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedProduct(null)}
            className="w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/20"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedProduct.id);
            }}
            className="w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/20"
            data-testid={`button-favorite-${selectedProduct.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedProduct.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh] scroll-fade-in">
          <img
            src={selectedProduct.hoverImage}
            alt={selectedProduct.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
        </div>

        <div className="bg-gradient-to-b from-black/95 to-black backdrop-blur-xl rounded-t-3xl p-6 space-y-6 pb-32 -mt-20 relative z-10 scroll-fade-in-delay-1">
          <div className="text-center border-b border-white/10 pb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 bg-white/10 rounded-full mb-3">
              <Shield className="w-4 h-4" />
              <span className="text-xs font-mono tracking-wider">{selectedProduct.brand}</span>
            </div>
            <h2 className="text-3xl font-black mb-3 tracking-tight uppercase">{selectedProduct.name}</h2>
            <div className="flex items-center justify-center gap-3">
              <p className="text-4xl font-bold">{formatPrice(selectedProduct.price)}</p>
              {selectedProduct.oldPrice && (
                <p className="text-xl text-white/30 line-through">{formatPrice(selectedProduct.oldPrice)}</p>
              )}
            </div>
          </div>

          <p className="text-sm text-white/70 text-center leading-relaxed scroll-fade-in-delay-2">{selectedProduct.description}</p>

          <div className="border-t border-white/10 pt-6 scroll-fade-in-delay-3">
            <p className="text-xs font-mono tracking-wider mb-4 text-white/60 uppercase">Выберите цвет:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedProduct.colors.map((color, idx) => (
                <button
                  key={color}
                  onClick={() => setSelectedColor(color)}
                  className={`relative w-12 h-12 rounded-full border-2 transition-all ${
                    selectedColor === color
                      ? 'border-white scale-110 shadow-lg shadow-white/20'
                      : 'border-white/20 hover:border-white/40'
                  }`}
                  style={{ backgroundColor: selectedProduct.colorHex[idx] }}
                  data-testid={`button-color-${color}`}
                >
                  {selectedColor === color && (
                    <div className="absolute inset-0 rounded-full bg-white/20"></div>
                  )}
                </button>
              ))}
            </div>
          </div>

          <div className="border-t border-white/10 pt-6 scroll-fade-in-delay-4">
            <p className="text-xs font-mono tracking-wider mb-4 text-white/60 uppercase">Выберите размер:</p>
            <div className="flex items-center justify-center gap-3 flex-wrap">
              {selectedProduct.sizes.map((size) => (
                <button
                  key={size}
                  onClick={() => setSelectedSize(size)}
                  className={`min-w-[60px] h-12 px-4 rounded-lg font-mono font-bold transition-all border ${
                    selectedSize === size
                      ? 'bg-white text-black border-white'
                      : 'bg-transparent text-white border-white/20 hover:border-white/40'
                  }`}
                  data-testid={`button-size-${size}`}
                >
                  {size}
                </button>
              ))}
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full bg-white text-black font-bold py-4 rounded-lg hover:bg-white/90 transition-all uppercase tracking-wider text-sm flex items-center justify-center gap-2 scroll-fade-in-delay-5"
                data-testid={`button-add-to-cart-${selectedProduct.id}`}
              >
                <ShoppingBag className="w-5 h-5" />
                Добавить в корзину
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedProduct.name} • ${selectedColor} • ${selectedSize}`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />
        </div>
      </div>
    );
  }

  // HOME PAGE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-24">
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <Menu className="w-6 h-6" data-testid="button-view-menu" />
            <div className="flex items-center gap-3">
              <ShoppingBag className="w-6 h-6" data-testid="button-view-cart" />
              <Heart className="w-6 h-6" data-testid="button-view-favorites" />
            </div>
          </div>

          <div className="mb-8 scroll-fade-in">
            <h1 className="text-6xl font-black mb-1 tracking-tighter leading-none">
              SURVIVALIST
            </h1>
            <h2 className="text-4xl font-light tracking-[0.3em] text-white/60">
              LAB
            </h2>
          </div>

          <div className="flex items-center gap-4 mb-6 overflow-x-auto pb-2 scrollbar-hide scroll-fade-in">
            <button 
              className="p-2 bg-white rounded-lg flex-shrink-0"
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((gender) => (
              <button
                key={gender}
                onClick={() => setSelectedGender(gender)}
                className={`text-sm font-mono uppercase tracking-wider transition-colors flex-shrink-0 ${
                  selectedGender === gender
                    ? 'text-white'
                    : 'text-white/30'
                }`}
                data-testid={`button-filter-${gender.toLowerCase()}`}
              >
                {gender}
              </button>
            ))}
          </div>

          <div className="flex items-center gap-3 mb-6 scroll-fade-in">
            <div className="flex-1 bg-white/5 backdrop-blur-xl rounded-lg px-4 py-3 flex items-center gap-2 border border-white/10">
              <Search className="w-5 h-5 text-white/40" />
              <input
                type="text"
                placeholder="Поиск снаряжения..."
                value={searchQuery}
                onChange={(e) => handleSearch(e.target.value)}
                className="bg-transparent text-white placeholder:text-white/40 outline-none flex-1 text-sm font-mono"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        <div className="relative mb-6 mx-6 rounded-2xl overflow-hidden border border-white/10 scroll-fade-in" style={{ height: '500px' }}>
          <img
            src={img1}
            alt="Hero"
            className="absolute inset-0 w-full h-full object-cover"
          />
          
          <div className="absolute inset-0 bg-gradient-to-t from-black via-black/60 to-transparent"></div>
          
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <div className="inline-flex items-center gap-2 px-3 py-1 bg-white/10 backdrop-blur-md rounded-full mb-4 border border-white/20">
                <Target className="w-4 h-4" />
                <span className="text-xs font-mono tracking-wider">НОВИНКА</span>
              </div>
              <h2 className="text-5xl font-black mb-3 tracking-tighter leading-tight">
                TACTICAL<br/>
                COLLECTION
              </h2>
              <p className="text-base text-white/70 mb-6 font-mono tracking-wider">
                Выживание в стиле 2025
              </p>
              <button 
                className="px-8 py-4 rounded-lg font-bold text-black transition-all hover:scale-105 bg-white uppercase tracking-wider text-sm"
                data-testid="button-view-collection"
              >
                Смотреть коллекцию
              </button>
            </m.div>
          </div>
        </div>

        <div className="px-6 space-y-4">
          {filteredProducts.slice(0, 3).map((product, idx) => (
            <m.div
              key={product.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openProduct(product)}
              className="relative cursor-pointer group rounded-2xl overflow-hidden border border-white/10 scroll-fade-in"
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`card-product-${product.id}`}
            >
              <div className="absolute inset-0">
                <img
                  src={product.image}
                  alt={product.name}
                  className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 grayscale"
                  loading="lazy"
                />
              </div>

              <div className="absolute inset-0 bg-gradient-to-t from-black/95 via-black/50 to-transparent"></div>

              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-white/10 backdrop-blur-xl rounded-lg border border-white/20">
                  <span className="text-xs font-mono font-semibold text-white tracking-wider">
                    {product.isNew ? 'NEW' : product.category.toUpperCase()}
                  </span>
                </div>
              </div>

              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(product.id);
                }}
                className="absolute top-4 right-4 w-10 h-10 rounded-lg bg-white/10 backdrop-blur-xl flex items-center justify-center border border-white/20"
                data-testid={`button-favorite-${product.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                />
              </button>

              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <h3 className="text-2xl font-black mb-2 leading-tight tracking-tight uppercase">
                      {product.name}
                    </h3>
                    <p className="text-sm text-white/60 mb-4 font-mono">{product.gender}</p>
                  </div>

                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openProduct(product);
                    }}
                    className="w-14 h-14 rounded-lg bg-white flex items-center justify-center hover:bg-white/90 transition-all hover:scale-110"
                    data-testid={`button-add-to-cart-${product.id}`}
                  >
                    <ShoppingBag className="w-6 h-6 text-black" />
                  </button>
                </div>

                <div className="mt-3">
                  <p className="text-xl font-bold">{formatPrice(product.price)}</p>
                </div>
              </div>
            </m.div>
          ))}
        </div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-3xl font-black tracking-tight">КАТАЛОГ</h1>
            <div className="flex items-center gap-3">
              <button className="p-2" data-testid="button-view-search">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" data-testid="button-view-filter">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide scroll-fade-in">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-lg text-sm font-mono font-semibold whitespace-nowrap transition-all border uppercase tracking-wider ${
                  selectedCategory === cat
                    ? 'bg-white text-black border-white'
                    : 'bg-transparent text-white/60 border-white/20 hover:border-white/40'
                }`}
                data-testid={`button-filter-${cat.toLowerCase().replace(/\s+/g, '-')}`}
              >
                {cat}
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-4">
            {filteredProducts.map((product, idx) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer ${idx < 4 ? 'scroll-fade-in' : getDelayClass(idx)}`}
                data-testid={`card-product-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-2xl overflow-hidden mb-3 bg-white/5 border border-white/10">
                  <img
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-500"
                    loading="lazy"
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    className="absolute top-2 right-2 w-8 h-8 rounded-lg bg-black/60 backdrop-blur-xl flex items-center justify-center border border-white/20"
                    data-testid={`button-favorite-${product.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {product.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-white text-black text-xs font-mono font-bold rounded-lg">
                      NEW
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-sm font-bold mb-1 truncate uppercase tracking-wide">{product.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold">{formatPrice(product.price)}</p>
                    {product.oldPrice && (
                      <p className="text-xs text-white/30 line-through">{formatPrice(product.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-3xl font-black mb-6 tracking-tight scroll-fade-in">КОРЗИНА</h1>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20 scroll-fade-in-delay-1">
              <div className="w-20 h-20 rounded-2xl bg-white/5 flex items-center justify-center mb-4 border border-white/10">
                <ShoppingBag className="w-10 h-10 text-white/20" />
              </div>
              <p className="text-white/40 text-center font-mono">Ваша корзина пуста</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item, idx) => (
                <div
                  key={item.id}
                  className={`bg-white/5 backdrop-blur-xl rounded-2xl p-4 flex gap-4 border border-white/10 ${idx < 2 ? 'scroll-fade-in' : getDelayClass(idx)}`}
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover grayscale"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <h3 className="font-bold mb-1 uppercase tracking-wide text-sm">{item.name}</h3>
                    <p className="text-sm text-white/50 mb-2 font-mono">
                      {item.color} • {item.size}
                    </p>
                    <p className="text-lg font-bold">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center hover:bg-red-500/20 transition-colors"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-black border-t border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-mono uppercase tracking-wider">Итого:</span>
                  <span className="text-3xl font-bold">{formatPrice(total)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full bg-white text-black font-bold py-4 rounded-lg hover:bg-white/90 transition-all uppercase tracking-wider text-sm"
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(total)}`}
                  confirmText="Подтвердить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>

              <ConfirmDrawer
                open={showOrderSuccess}
                onOpenChange={setShowOrderSuccess}
                trigger={<span />}
                title="Заказ оформлен!"
                description="Ваш заказ успешно создан и передан в обработку. Вы можете отслеживать статус в разделе 'Мои заказы'"
                confirmText="Отлично"
                cancelText=""
                variant="default"
                onConfirm={() => setShowOrderSuccess(false)}
                icon={<Check className="w-8 h-8 text-emerald-400" />}
              />
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-black text-white overflow-auto pb-24">
        <div className="p-6 bg-gradient-to-b from-white/5 to-transparent backdrop-blur-xl border-b border-white/10 scroll-fade-in">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-white to-gray-400 rounded-2xl flex items-center justify-center">
              <User className="w-8 h-8 text-black" />
            </div>
            <div>
              <h2 className="text-xl font-bold uppercase tracking-wide">Иван Сидоров</h2>
              <p className="text-sm text-white/60 font-mono">+7 (999) 987-65-43</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 scroll-fade-in">
              <p className="text-sm text-white/60 mb-1 font-mono uppercase tracking-wider">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 scroll-fade-in">
              <p className="text-sm text-white/60 mb-1 font-mono uppercase tracking-wider">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-4 scroll-fade-in">
          <h3 className="text-lg font-bold mb-4 font-mono uppercase tracking-wider">Мои заказы</h3>
          {orders.length === 0 ? (
            <div className="text-center py-8 text-white/50">
              <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
              <p className="font-mono">У вас пока нет заказов</p>
            </div>
          ) : (
            <div className="space-y-3">
              {orders.map((order) => (
                <div key={order.id} className="bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10" data-testid={`order-${order.id}`}>
                  <div className="flex justify-between gap-2 mb-2">
                    <span className="text-sm font-mono">Заказ #{order.id.toString().slice(-6)}</span>
                    <span className="text-white/60 text-sm font-mono">{order.date}</span>
                  </div>
                  <div className="flex justify-between gap-2 mb-2">
                    <span className="text-white/70 font-mono">{order.items.length} товаров</span>
                    <span className="font-bold">{formatPrice(order.total)}</span>
                  </div>
                  <div>
                    <span className="text-xs px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded-full font-mono">
                      {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        <div className="p-4 space-y-2">
          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-1" data-testid="button-view-orders">
            <div className="flex items-center gap-3">
              <Package className="w-5 h-5 text-white/60" />
              <span className="font-mono uppercase tracking-wider text-sm">Мои заказы</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-2" data-testid="button-view-favorites">
            <div className="flex items-center gap-3">
              <Heart className="w-5 h-5 text-white/60" />
              <span className="font-mono uppercase tracking-wider text-sm">Избранное</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-3" data-testid="button-view-payment">
            <div className="flex items-center gap-3">
              <CreditCard className="w-5 h-5 text-white/60" />
              <span className="font-mono uppercase tracking-wider text-sm">Способы оплаты</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-4" data-testid="button-view-address">
            <div className="flex items-center gap-3">
              <MapPin className="w-5 h-5 text-white/60" />
              <span className="font-mono uppercase tracking-wider text-sm">Адреса доставки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover:bg-white/10 transition-all scroll-fade-in-delay-5" data-testid="button-view-settings">
            <div className="flex items-center gap-3">
              <Settings className="w-5 h-5 text-white/60" />
              <span className="font-mono uppercase tracking-wider text-sm">Настройки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/40" />
          </button>

          <button className="w-full p-4 bg-red-500/10 backdrop-blur-xl rounded-xl border border-red-500/20 flex items-center justify-between hover:bg-red-500/20 transition-all mt-4" data-testid="button-logout">
            <div className="flex items-center gap-3">
              <LogOut className="w-5 h-5 text-red-400" />
              <span className="font-mono uppercase tracking-wider text-sm text-red-400">Выйти</span>
            </div>
          </button>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(LabSurvivalist);
```

### demos/NikeACG.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Search, Menu, ChevronUp, ChevronDown, Check } from "lucide-react";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { useFilter } from "@/hooks/useFilter";
import { Skeleton } from "@/components/ui/skeleton";
import img1 from '@assets/stock_images/futuristic_fashion_m_4203db1e.jpg';
import img2 from '@assets/stock_images/futuristic_techwear__737df842.jpg';
import img3 from '@assets/stock_images/futuristic_fashion_m_331bf630.jpg';
import img4 from '@assets/stock_images/futuristic_techwear__046f6538.jpg';
import img5 from '@assets/stock_images/futuristic_fashion_m_472b5d38.jpg';
import img6 from '@assets/stock_images/futuristic_techwear__832ae961.jpg';
import img7 from '@assets/stock_images/futuristic_fashion_m_4950c20e.jpg';
import img8 from '@assets/stock_images/futuristic_techwear__95b77175.jpg';
import img9 from '@assets/stock_images/futuristic_fashion_m_518587e3.jpg';
import img10 from '@assets/stock_images/futuristic_techwear__a1b10a04.jpg';

interface NikeACGProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
  onTabChange?: (tab: 'home' | 'catalog' | 'cart' | 'profile') => void;
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  size: string;
  quantity: number;
  image: string;
  color: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Product {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  sizes: string[];
  colors: string[];
  colorHex: string[];
  category: string;
  inStock: number;
  rating: number;
  isNew?: boolean;
  isTrending?: boolean;
}

const products: Product[] = [
  { 
    id: 1, 
    name: 'ACG Trail Pants', 
    price: 19900,
    image: img1, 
    hoverImage: img2,
    description: 'Технологичные брюки для горных троп. Водонепроницаемая ткань, множество карманов.', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Оливковый'], 
    colorHex: ['#1A1A1A', '#4A5D23'],
    category: 'Верхняя одежда',
    inStock: 15, 
    rating: 5.0,
    isNew: true,
    isTrending: true
  },
  { 
    id: 2, 
    name: '075 Jacket', 
    price: 37900,
    oldPrice: 45900,
    image: img3, 
    hoverImage: img4,
    description: 'Премиальная куртка ACG с мембраной Gore-Tex. Защита от экстремальных условий.', 
    sizes: ['S', 'M', 'L', 'XL', 'XXL'], 
    colors: ['Черный', 'Синий'], 
    colorHex: ['#1A1A1A', '#1E3A5F'],
    category: 'Верхняя одежда',
    inStock: 8, 
    rating: 5.0,
    isNew: true,
    isTrending: true
  },
  { 
    id: 3, 
    name: 'ACG Full System', 
    price: 79900,
    oldPrice: 95000,
    image: img5, 
    hoverImage: img6,
    description: 'Полная экипировка для outdoor приключений. Куртка + штаны + жилет в одном комплекте.', 
    sizes: ['M', 'L', 'XL'], 
    colors: ['Черный', 'Камуфляж'], 
    colorHex: ['#1A1A1A', '#3D4F35'],
    category: 'Верхняя одежда',
    inStock: 5, 
    rating: 5.0,
    isNew: true,
    isTrending: true
  },
  { 
    id: 4, 
    name: '005 Gloves', 
    price: 12900,
    image: img7, 
    hoverImage: img8,
    description: 'Утепленные перчатки с touch-screen совместимостью для экстремальных условий.', 
    sizes: ['S', 'M', 'L'], 
    colors: ['Черный', 'Серый'], 
    colorHex: ['#1A1A1A', '#4A4A4A'],
    category: 'Аксессуары',
    inStock: 20, 
    rating: 4.9,
    isNew: true
  },
  { 
    id: 5, 
    name: 'Terrain Shoes', 
    price: 24900,
    oldPrice: 29900,
    image: img9, 
    hoverImage: img10,
    description: 'Треккинговые кроссовки ACG с технологией React foam и противоскользящей подошвой.', 
    sizes: ['40', '41', '42', '43', '44', '45'], 
    colors: ['Черный', 'Коричневый'], 
    colorHex: ['#1A1A1A', '#5C4033'],
    category: 'Обувь',
    inStock: 12, 
    rating: 5.0,
    isTrending: true
  },
  { 
    id: 6, 
    name: 'Mountain Vest', 
    price: 28900,
    image: img1, 
    hoverImage: img2,
    description: 'Легкий утепленный жилет с системой вентиляции для горных восхождений.', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Оранжевый', 'Черный'], 
    colorHex: ['#FF6B35', '#1A1A1A'],
    category: 'Верхняя одежда',
    inStock: 10, 
    rating: 4.8,
    isTrending: true
  },
  { 
    id: 7, 
    name: 'ACG Storm Jacket', 
    price: 42900,
    image: img3, 
    hoverImage: img4,
    description: 'Штормовая куртка с усиленной защитой от ветра и дождя.', 
    sizes: ['M', 'L', 'XL', 'XXL'], 
    colors: ['Серый', 'Зеленый'], 
    colorHex: ['#6B7280', '#2D5016'],
    category: 'Верхняя одежда',
    inStock: 7, 
    rating: 5.0,
    isNew: true
  },
  { 
    id: 8, 
    name: 'ACG Tech Pack', 
    price: 16900,
    image: img5, 
    hoverImage: img6,
    description: 'Компактный рюкзак с водонепроницаемым покрытием для urban exploration.', 
    sizes: ['ONE SIZE'], 
    colors: ['Черный', 'Хаки'], 
    colorHex: ['#1A1A1A', '#77815C'],
    category: 'Аксессуары',
    inStock: 15, 
    rating: 4.9
  },
  { 
    id: 9, 
    name: 'ACG Fleece Layer', 
    price: 21900,
    image: img7, 
    hoverImage: img8,
    description: 'Флисовый промежуточный слой для максимального комфорта в холодную погоду.', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Бордовый'], 
    colorHex: ['#1A1A1A', '#800020'],
    category: 'Верхняя одежда',
    inStock: 18, 
    rating: 4.8,
    isNew: true
  },
  { 
    id: 10, 
    name: 'ACG Cargo Shorts', 
    price: 14900,
    image: img9, 
    hoverImage: img10,
    description: 'Летние карго шорты с множеством карманов для летних походов.', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Хаки', 'Черный'], 
    colorHex: ['#77815C', '#1A1A1A'],
    category: 'Верхняя одежда',
    inStock: 14, 
    rating: 4.7
  },
];

const categories = ['Все', 'Верхняя одежда', 'Обувь', 'Аксессуары'];

const getDelayClass = (index: number) => {
  const delays = ['scroll-fade-in', 'scroll-fade-in-delay-1', 'scroll-fade-in-delay-2', 'scroll-fade-in-delay-3', 'scroll-fade-in-delay-4', 'scroll-fade-in-delay-5'];
  return delays[index % delays.length];
};

function NikeACG({ activeTab, onTabChange }: NikeACGProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [selectedColor, setSelectedColor] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [orders, setOrders] = useState<Order[]>([]);
  const [showOrderSuccess, setShowOrderSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: products,
    searchFields: ['name', 'description', 'category'] as (keyof Product)[],
  });

  const handleImageLoad = (id: number) => {
    setLoadedImages(prev => new Set([...Array.from(prev), id]));
  };

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedProduct(null);
    }
  }, [activeTab]);

  const filteredProducts = filteredItems.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    return categoryMatch;
  });

  const toggleFavorite = (productId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(productId)) {
      newFavorites.delete(productId);
    } else {
      newFavorites.add(productId);
    }
    setFavorites(newFavorites);
  };

  const openProduct = (product: Product) => {
    setSelectedProduct(product);
    setSelectedSize(product.sizes[0]);
    setSelectedColor(product.colors[0]);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedProduct.name,
      price: selectedProduct.price,
      size: selectedSize,
      quantity: 1,
      image: selectedProduct.image,
      color: selectedColor
    };
    
    setCart([...cart, cartItem]);
    setSelectedProduct(null);
  };

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: cart.reduce((sum, item) => sum + item.price * item.quantity, 0),
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
    setShowOrderSuccess(true);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  // PRODUCT DETAIL PAGE
  if (activeTab === 'catalog' && selectedProduct) {
    const bgColor = selectedProduct.colorHex[selectedProduct.colors.indexOf(selectedColor)] || '#2D3748';
    
    return (
      <div className="min-h-screen text-white overflow-auto" style={{ backgroundColor: bgColor }}>
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedProduct(null)}
            className="w-12 h-12 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center hover:bg-white/30 transition-all"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedProduct.id);
            }}
            className="w-12 h-12 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center hover:bg-white/30 transition-all"
            data-testid={`button-favorite-${selectedProduct.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedProduct.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh] scroll-fade-in">
          <img
            src={selectedProduct.hoverImage}
            alt={selectedProduct.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
        </div>

        <div className="bg-[#2D3748] rounded-t-3xl p-6 space-y-6 pb-32 -mt-8 relative z-10 scroll-fade-in-delay-1">
          <div className="text-center">
            <div className="text-xs font-bold tracking-[0.2em] text-white/60 mb-2">NIKE ACG</div>
            <h2 className="text-3xl font-black mb-3 tracking-tight">{selectedProduct.name}</h2>
            <div className="flex items-center justify-center gap-4 mb-2">
              <p className="text-4xl font-black">{formatPrice(selectedProduct.price)}</p>
              {selectedProduct.oldPrice && (
                <p className="text-xl text-white/40 line-through">{formatPrice(selectedProduct.oldPrice)}</p>
              )}
            </div>
            <div className="flex items-center justify-center gap-1 mb-4">
              {[...Array(5)].map((_, i) => (
                <Star key={i} className="w-4 h-4 fill-yellow-400 text-yellow-400" />
              ))}
              <span className="text-sm text-white/60 ml-2">({selectedProduct.rating})</span>
            </div>
          </div>

          <p className="text-sm text-white/80 text-center leading-relaxed scroll-fade-in-delay-2">{selectedProduct.description}</p>

          <div className="scroll-fade-in-delay-3">
            <p className="text-xs font-bold mb-3 text-white/70 text-center tracking-widest">ЦВЕТ:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedProduct.colors.map((color, idx) => (
                <button
                  key={color}
                  onClick={() => setSelectedColor(color)}
                  className={`w-12 h-12 rounded-full border-2 transition-all ${
                    selectedColor === color
                      ? 'border-white scale-110 shadow-lg'
                      : 'border-white/30 hover:border-white/50'
                  }`}
                  style={{ backgroundColor: selectedProduct.colorHex[idx] }}
                  data-testid={`button-color-${color}`}
                />
              ))}
            </div>
          </div>

          <div className="scroll-fade-in-delay-4">
            <p className="text-xs font-bold mb-3 text-white/70 text-center tracking-widest">РАЗМЕР:</p>
            <div className="flex items-center justify-center gap-2 flex-wrap">
              {selectedProduct.sizes.map((size) => (
                <button
                  key={size}
                  onClick={() => setSelectedSize(size)}
                  className={`px-6 py-3 rounded-full font-bold text-sm transition-all ${
                    selectedSize === size
                      ? 'bg-white text-black shadow-lg'
                      : 'bg-white/10 text-white hover:bg-white/20 border border-white/20'
                  }`}
                  data-testid={`button-size-${size}`}
                >
                  {size}
                </button>
              ))}
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full bg-white text-black font-black py-5 rounded-full hover:bg-white/90 transition-all text-lg tracking-wider shadow-xl scroll-fade-in-delay-5"
                data-testid={`button-add-to-cart-${selectedProduct.id}`}
              >
                ДОБАВИТЬ В КОРЗИНУ
              </button>
            }
            title={`${selectedProduct.name} добавлен`}
            description={`Размер: ${selectedSize} • Цвет: ${selectedColor} • ${formatPrice(selectedProduct.price)}`}
            confirmText="Перейти в корзину"
            cancelText="Продолжить покупки"
            onConfirm={() => {
              addToCart();
              onTabChange?.('cart');
            }}
            onCancel={addToCart}
          />
        </div>
      </div>
    );
  }

  // HOME PAGE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-[#2D3748] text-white overflow-auto pb-24">
        <div className="relative h-screen scroll-fade-in">
          <div className="absolute inset-0">
            <img
              src={img1}
              alt="ACG Hero"
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-b from-black/70 via-black/50 to-[#2D3748]"></div>
          </div>

          <div className="relative h-full flex flex-col items-center justify-center p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8 }}
              className="text-center"
            >
              <div className="text-xs font-bold tracking-[0.3em] mb-6 text-white/80">NIKE</div>
              <h1 className="text-[100px] md:text-[140px] font-black leading-none mb-6 tracking-tighter">
                ACG
              </h1>
              <p className="text-4xl md:text-5xl font-light tracking-[0.2em] mb-12 text-white/90">
                システム
              </p>
              <p className="text-lg text-white/70 mb-12 max-w-md mx-auto tracking-wide">
                All Conditions Gear для экстремальных приключений
              </p>
              <button 
                className="px-10 py-5 bg-white text-black font-black rounded-full text-lg hover:bg-white/90 transition-all shadow-2xl tracking-wider"
                data-testid="button-view-explore"
              >
                ИССЛЕДОВАТЬ
              </button>
            </m.div>
          </div>

          <div className="absolute bottom-12 left-1/2 transform -translate-x-1/2 animate-bounce">
            <ChevronDown className="w-8 h-8 text-white/50" />
          </div>
        </div>

        <div className="px-6 py-12 space-y-6">
          {[
            { 
              product: products[0], 
              bg: '#000000', 
              text: '#FFFFFF',
              label: 'TRAIL SYSTEM'
            },
            { 
              product: products[1], 
              bg: '#FFFFFF', 
              text: '#000000',
              label: 'WEATHER PROTECTION'
            },
            { 
              product: products[2], 
              bg: '#000000', 
              text: '#FFFFFF',
              label: 'FULL SYSTEM'
            },
          ].map((item, idx) => (
            <m.div
              key={item.product.id}
              initial={{ opacity: 0, y: 50 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ delay: idx * 0.2 }}
              onClick={() => openProduct(item.product)}
              className="relative cursor-pointer rounded-3xl overflow-hidden shadow-2xl scroll-fade-in"
              style={{ 
                backgroundColor: item.bg,
                minHeight: '500px'
              }}
              data-testid={`card-product-${item.product.id}`}
            >
              <div className="grid grid-cols-2 h-full">
                <div className="relative h-[500px]">
                  <img
                    src={item.product.image}
                    alt={item.product.name}
                    className="w-full h-full object-cover"
                  />
                  <div 
                    className="absolute inset-0"
                    style={{
                      background: item.bg === '#FFFFFF' 
                        ? 'linear-gradient(to right, transparent, #FFFFFF)' 
                        : 'linear-gradient(to right, transparent, #000000)'
                    }}
                  ></div>
                </div>

                <div className="flex flex-col justify-center p-8" style={{ color: item.text }}>
                  <div className="text-xs font-bold tracking-[0.3em] mb-4 opacity-60">
                    {item.label}
                  </div>
                  <h3 className="text-5xl font-black mb-4 leading-tight tracking-tight">
                    {item.product.name}
                  </h3>
                  <p className="text-sm mb-6 opacity-70 leading-relaxed">
                    {item.product.description}
                  </p>
                  <p className="text-3xl font-black mb-8">
                    {formatPrice(item.product.price)}
                  </p>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openProduct(item.product);
                    }}
                    className="px-8 py-4 rounded-full font-black text-sm tracking-widest transition-all hover:scale-105 w-fit"
                    style={{
                      backgroundColor: item.text,
                      color: item.bg
                    }}
                    data-testid={`button-add-to-cart-${item.product.id}`}
                  >
                    КУПИТЬ
                  </button>
                </div>
              </div>

              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(item.product.id);
                }}
                className="absolute top-6 right-6 w-12 h-12 rounded-full flex items-center justify-center backdrop-blur-md"
                style={{ 
                  backgroundColor: item.bg === '#FFFFFF' ? 'rgba(0,0,0,0.1)' : 'rgba(255,255,255,0.1)' 
                }}
                data-testid={`button-favorite-${item.product.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(item.product.id) ? 'fill-current' : ''}`}
                  style={{ color: item.text }}
                />
              </button>
            </m.div>
          ))}
        </div>

        <div className="px-6 pb-12">
          <h2 className="text-3xl font-black mb-8 tracking-tight scroll-fade-in">ВСЕ ПРОДУКТЫ</h2>
          <div className="grid grid-cols-2 gap-4">
            {products.slice(3).map((product, idx) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer ${getDelayClass(idx)}`}
                data-testid={`card-product-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-2xl overflow-hidden mb-3 bg-black/20">
                  <img
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover"
                    loading="lazy"
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    className="absolute top-2 right-2 w-10 h-10 rounded-full bg-black/40 backdrop-blur-md flex items-center justify-center"
                    data-testid={`button-favorite-${product.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {product.isNew && (
                    <div className="absolute top-2 left-2 px-3 py-1 bg-white text-black text-xs font-black rounded-full">
                      NEW
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-xs font-bold text-white/50 mb-1">ACG</p>
                  <p className="text-sm font-bold mb-2 truncate">{product.name}</p>
                  <p className="text-lg font-black">{formatPrice(product.price)}</p>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-[#2D3748] text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-8 scroll-fade-in">
            <div>
              <div className="text-xs font-bold tracking-[0.3em] text-white/60 mb-1">NIKE</div>
              <h1 className="text-3xl font-black tracking-tight">ACG カタログ</h1>
            </div>
            <div className="flex items-center gap-3">
              <button className="w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center hover:bg-white/20 transition-all" data-testid="button-view-search">
                <Search className="w-5 h-5" />
              </button>
              <button className="w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center hover:bg-white/20 transition-all" data-testid="button-view-filter">
                <Filter className="w-5 h-5" />
              </button>
            </div>
          </div>

          <div className="flex flex-col gap-3 mb-8 scroll-fade-in">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`w-full py-4 px-6 rounded-full text-left font-bold text-sm transition-all ${
                  selectedCategory === cat
                    ? 'bg-white text-black shadow-lg'
                    : 'bg-white/10 text-white/70 hover:bg-white/20 border border-white/20'
                }`}
                data-testid={`button-filter-${cat.toLowerCase().replace(/\s+/g, '-')}`}
              >
                <div className="flex items-center justify-between">
                  <span className="tracking-wider">{cat}</span>
                  {selectedCategory === cat && (
                    <div className="w-2 h-2 rounded-full bg-black"></div>
                  )}
                </div>
              </button>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-5">
            {filteredProducts.map((product, idx) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer ${idx < 4 ? 'scroll-fade-in' : getDelayClass(idx)}`}
                data-testid={`card-product-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-2xl overflow-hidden mb-3 bg-black/20">
                  <img
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover transition-transform duration-500 hover:scale-110"
                    loading="lazy"
                  />
                  
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    className="absolute top-3 right-3 w-10 h-10 rounded-full bg-black/50 backdrop-blur-md flex items-center justify-center hover:bg-black/70 transition-all"
                    data-testid={`button-favorite-${product.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {product.isNew && (
                    <div className="absolute top-3 left-3 px-3 py-1 bg-white text-black text-xs font-black rounded-full tracking-wider">
                      NEW
                    </div>
                  )}

                  {product.oldPrice && (
                    <div className="absolute bottom-3 left-3 px-3 py-1 bg-red-500 text-white text-xs font-black rounded-full">
                      SALE
                    </div>
                  )}
                </div>

                <div>
                  <p className="text-xs font-bold text-white/50 mb-1 tracking-widest">ACG</p>
                  <p className="text-sm font-bold mb-2 truncate tracking-wide">{product.name}</p>
                  <div className="flex items-center gap-2">
                    <p className="text-lg font-black">{formatPrice(product.price)}</p>
                    {product.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(product.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-[#2D3748] text-white overflow-auto pb-32">
        <div className="p-6">
          <div className="mb-8 scroll-fade-in">
            <div className="text-xs font-bold tracking-[0.3em] text-white/60 mb-1">NIKE ACG</div>
            <h1 className="text-3xl font-black tracking-tight">カート</h1>
          </div>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20 scroll-fade-in-delay-1">
              <div className="w-24 h-24 rounded-full bg-white/10 flex items-center justify-center mb-6">
                <ShoppingBag className="w-12 h-12 text-white/30" />
              </div>
              <p className="text-white/50 text-center font-medium">Ваша корзина пуста</p>
              <p className="text-white/30 text-sm text-center mt-2">Добавьте товары для оформления заказа</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item, idx) => (
                <div
                  key={item.id}
                  className={`bg-black/20 backdrop-blur-xl rounded-2xl p-5 flex gap-4 border border-white/10 ${idx < 2 ? 'scroll-fade-in' : getDelayClass(idx)}`}
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-24 h-24 rounded-xl object-cover"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <p className="text-xs font-bold text-white/50 mb-1 tracking-widest">ACG</p>
                    <h3 className="font-bold mb-2 tracking-wide">{item.name}</h3>
                    <p className="text-sm text-white/60 mb-3">
                      {item.color} • {item.size}
                    </p>
                    <p className="text-xl font-black">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    className="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center transition-all"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-[#2D3748] border-t border-white/20">
                <div className="flex items-center justify-between mb-6">
                  <span className="text-lg font-bold tracking-wider">ИТОГО:</span>
                  <span className="text-3xl font-black">{formatPrice(total)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full bg-white text-black font-black py-5 rounded-full hover:bg-white/90 transition-all text-lg tracking-widest shadow-xl"
                      data-testid="button-checkout"
                    >
                      ОФОРМИТЬ ЗАКАЗ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(total)}`}
                  confirmText="Подтвердить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>

              <ConfirmDrawer
                open={showOrderSuccess}
                onOpenChange={setShowOrderSuccess}
                trigger={<span />}
                title="Заказ оформлен!"
                description="Ваш заказ успешно создан и передан в обработку. Вы можете отслеживать статус в разделе 'Мои заказы'"
                confirmText="Отлично"
                cancelText=""
                variant="default"
                onConfirm={() => setShowOrderSuccess(false)}
                icon={<Check className="w-8 h-8 text-emerald-400" />}
              />
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-[#2D3748] text-white overflow-auto pb-24">
        <div className="p-6 bg-black/20 backdrop-blur-xl border-b border-white/10 scroll-fade-in">
          <div className="flex items-center gap-5 mb-8">
            <div className="w-20 h-20 bg-gradient-to-br from-white to-gray-300 rounded-full flex items-center justify-center">
              <User className="w-10 h-10 text-black" />
            </div>
            <div>
              <div className="text-xs font-bold tracking-[0.3em] text-white/60 mb-1">NIKE ACG</div>
              <h2 className="text-2xl font-black tracking-tight">Иван Петров</h2>
              <p className="text-sm text-white/60 mt-1">+7 (999) 123-45-67</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-4">
            <div className="p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 scroll-fade-in">
              <p className="text-xs text-white/60 mb-2 font-bold tracking-widest">ЗАКАЗЫ</p>
              <p className="text-3xl font-black">{orders.length}</p>
            </div>
            <div className="p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 scroll-fade-in">
              <p className="text-xs text-white/60 mb-2 font-bold tracking-widest">ИЗБРАННОЕ</p>
              <p className="text-3xl font-black">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-6 scroll-fade-in">
          <h3 className="text-lg font-black mb-4 tracking-wide">МОИ ЗАКАЗЫ</h3>
          {orders.length === 0 ? (
            <div className="text-center py-8 text-white/50">
              <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
              <p>У вас пока нет заказов</p>
            </div>
          ) : (
            <div className="space-y-3">
              {orders.map((order) => (
                <div key={order.id} className="bg-white/10 backdrop-blur-xl rounded-2xl p-5 border border-white/20" data-testid={`order-${order.id}`}>
                  <div className="flex justify-between gap-2 mb-2">
                    <span className="text-sm font-bold">Заказ #{order.id.toString().slice(-6)}</span>
                    <span className="text-white/60 text-sm">{order.date}</span>
                  </div>
                  <div className="flex justify-between gap-2 mb-3">
                    <span className="text-white/70">{order.items.length} товаров</span>
                    <span className="font-black text-lg">{formatPrice(order.total)}</span>
                  </div>
                  <div>
                    <span className="text-xs px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded-full font-bold">
                      {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        <div className="p-6 space-y-3">
          <button className="w-full p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 flex items-center justify-between hover:bg-white/20 transition-all scroll-fade-in-delay-1" data-testid="button-view-orders">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center">
                <Package className="w-5 h-5" />
              </div>
              <span className="font-bold tracking-wide">Мои заказы</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 flex items-center justify-between hover:bg-white/20 transition-all scroll-fade-in-delay-2" data-testid="button-view-favorites">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center">
                <Heart className="w-5 h-5" />
              </div>
              <span className="font-bold tracking-wide">Избранное</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 flex items-center justify-between hover:bg-white/20 transition-all scroll-fade-in-delay-3" data-testid="button-view-payment">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center">
                <CreditCard className="w-5 h-5" />
              </div>
              <span className="font-bold tracking-wide">Способы оплаты</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 flex items-center justify-between hover:bg-white/20 transition-all scroll-fade-in-delay-4" data-testid="button-view-address">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center">
                <MapPin className="w-5 h-5" />
              </div>
              <span className="font-bold tracking-wide">Адреса доставки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-5 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 flex items-center justify-between hover:bg-white/20 transition-all scroll-fade-in-delay-5" data-testid="button-view-settings">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center">
                <Settings className="w-5 h-5" />
              </div>
              <span className="font-bold tracking-wide">Настройки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-5 bg-red-500/20 backdrop-blur-xl rounded-2xl border border-red-500/30 flex items-center justify-between hover:bg-red-500/30 transition-all mt-6" data-testid="button-logout">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center">
                <LogOut className="w-5 h-5 text-red-400" />
              </div>
              <span className="font-bold text-red-400 tracking-wide">Выйти</span>
            </div>
          </button>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(NikeACG);
```

### demos/OxyzNFT.tsx
```tsx
import { useState, useEffect, memo, useMemo, useCallback } from "react";
import { m, AnimatePresence } from "framer-motion";
import { 
  Heart, ShoppingBag, X, ChevronLeft, ChevronRight, Star, Clock, 
  Sparkles, Menu, Search, User, Package, ArrowRight, Minus, Plus,
  History, Ruler, Settings, Crown, Zap, Eye, TrendingUp, MessageCircle
} from "lucide-react";
import { Skeleton } from "../ui/skeleton";
import { ConfirmDrawer } from "../ui/modern-drawer";

interface OxyzNFTProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Product {
  id: number;
  name: string;
  brand: string;
  price: number;
  originalPrice?: number;
  image: string;
  category: 'Jackets' | 'Pants' | 'Accessories';
  description: string;
  sizes: string[];
  colors: string[];
  isNew?: boolean;
  isTrending?: boolean;
}

interface CartItem extends Product {
  quantity: number;
  selectedSize: string;
  selectedColor: string;
}

interface Story {
  id: number;
  title: string;
  subtitle: string;
  image: string;
}

const COLORS = {
  primary: '#050505',
  primaryGradient: 'linear-gradient(180deg, #050505 0%, #0f0f13 100%)',
  accent1: '#ff2e63',
  accent2: '#4de5ff',
  textPrimary: '#e5e1db',
  textSecondary: '#8a8a8a',
  cardBg: 'linear-gradient(160deg, #111113 0%, #0a0a0c 100%)',
  cardBorder: 'rgba(255, 255, 255, 0.04)',
  glowCrimson: '0 0 60px rgba(255, 46, 99, 0.4)',
  glowCyan: '0 0 40px rgba(77, 229, 255, 0.3)',
};

const products: Product[] = [
  {
    id: 1,
    name: "Phantom Jacket",
    brand: "OXYZ",
    price: 890,
    originalPrice: 1190,
    image: "https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800&h=1000&fit=crop&q=90",
    category: "Jackets",
    description: "Premium technical fabric with magnetic closures",
    sizes: ["S", "M", "L", "XL"],
    colors: ["Obsidian", "Graphite"],
    isNew: true,
    isTrending: true
  },
  {
    id: 2,
    name: "Stealth Cargo Pants",
    brand: "OXYZ",
    price: 420,
    originalPrice: 520,
    image: "https://images.unsplash.com/photo-1624378439575-d8705ad7ae80?w=800&h=1000&fit=crop&q=90",
    category: "Pants",
    description: "Utility-focused design with hidden pockets",
    sizes: ["28", "30", "32", "34", "36"],
    colors: ["Shadow", "Slate"],
    isTrending: true
  },
  {
    id: 3,
    name: "Void Hoodie",
    brand: "OXYZ",
    price: 350,
    image: "https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=800&h=1000&fit=crop&q=90",
    category: "Jackets",
    description: "Zero-gravity comfort with thermal core",
    sizes: ["S", "M", "L", "XL", "XXL"],
    colors: ["Void Black", "Carbon"],
    isNew: true
  },
  {
    id: 4,
    name: "Neon Edge Sneakers",
    brand: "OXYZ",
    price: 580,
    originalPrice: 720,
    image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=800&h=1000&fit=crop&q=90",
    category: "Accessories",
    description: "Reactive soles with luminescent threading",
    sizes: ["40", "41", "42", "43", "44", "45"],
    colors: ["Neon Core", "Phantom"],
    isNew: true,
    isTrending: true
  },
  {
    id: 5,
    name: "Shadow Tee",
    brand: "OXYZ",
    price: 180,
    image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=800&h=1000&fit=crop&q=90",
    category: "Jackets",
    description: "Seamless construction, anti-microbial fabric",
    sizes: ["XS", "S", "M", "L", "XL"],
    colors: ["Pure Black", "Midnight"]
  },
  {
    id: 6,
    name: "Chrome Belt",
    brand: "OXYZ",
    price: 220,
    originalPrice: 280,
    image: "https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=800&h=1000&fit=crop&q=90",
    category: "Accessories",
    description: "Aerospace-grade titanium buckle",
    sizes: ["One Size"],
    colors: ["Chrome", "Matte Black"],
    isTrending: true
  },
  {
    id: 7,
    name: "Obsidian Cap",
    brand: "OXYZ",
    price: 120,
    image: "https://images.unsplash.com/photo-1588850561407-ed78c282e89b?w=800&h=1000&fit=crop&q=90",
    category: "Accessories",
    description: "Water-resistant with UV protection",
    sizes: ["One Size"],
    colors: ["Obsidian", "Storm Grey"]
  },
  {
    id: 8,
    name: "Tech Gloves",
    brand: "OXYZ",
    price: 280,
    originalPrice: 350,
    image: "https://images.unsplash.com/photo-1491553895911-0055uj42d9a?w=800&h=1000&fit=crop&q=90",
    category: "Accessories",
    description: "Touch-compatible with thermal regulation",
    sizes: ["S", "M", "L"],
    colors: ["Tech Black", "Carbon Fiber"],
    isNew: true
  }
];

const stories: Story[] = [
  {
    id: 1,
    title: "THE DROP",
    subtitle: "Winter 2025",
    image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600&h=800&fit=crop&q=90"
  },
  {
    id: 2,
    title: "BEHIND",
    subtitle: "The Design",
    image: "https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=600&h=800&fit=crop&q=90"
  },
  {
    id: 3,
    title: "EDITORIAL",
    subtitle: "Tokyo Nights",
    image: "https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=600&h=800&fit=crop&q=90"
  }
];

const springConfig = { type: "spring" as const, stiffness: 300, damping: 30 };
const containerVariants = {
  hidden: { opacity: 0 },
  visible: { 
    opacity: 1,
    transition: { staggerChildren: 0.08 }
  }
};

function OxyzNFT({ activeTab }: OxyzNFTProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [countdown, setCountdown] = useState({ hours: 4, minutes: 55, seconds: 16 });
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());
  const [selectedCategory, setSelectedCategory] = useState<string>('All');
  const [hoveredProduct, setHoveredProduct] = useState<number | null>(null);
  const [tierProgress] = useState(72);

  useEffect(() => {
    const timer = setInterval(() => {
      setCountdown(prev => {
        if (prev.seconds > 0) {
          return { ...prev, seconds: prev.seconds - 1 };
        } else if (prev.minutes > 0) {
          return { ...prev, minutes: prev.minutes - 1, seconds: 59 };
        } else if (prev.hours > 0) {
          return { hours: prev.hours - 1, minutes: 59, seconds: 59 };
        }
        return { hours: 23, minutes: 59, seconds: 59 };
      });
    }, 1000);
    return () => clearInterval(timer);
  }, []);

  const toggleFavorite = useCallback((id: number) => {
    setFavorites(prev => {
      const newFavorites = new Set(prev);
      if (newFavorites.has(id)) {
        newFavorites.delete(id);
      } else {
        newFavorites.add(id);
      }
      return newFavorites;
    });
  }, []);

  const addToCart = useCallback((product: Product, size?: string, color?: string) => {
    const cartItem: CartItem = {
      ...product,
      quantity: 1,
      selectedSize: size || product.sizes[0],
      selectedColor: color || product.colors[0]
    };
    setCart(prev => [...prev, cartItem]);
    setSelectedProduct(null);
  }, []);

  const removeFromCart = useCallback((id: number) => {
    setCart(prev => prev.filter(item => item.id !== id));
  }, []);

  const updateQuantity = useCallback((id: number, delta: number) => {
    setCart(prev => prev.map(item => {
      if (item.id === id) {
        const newQty = Math.max(1, Math.min(10, item.quantity + delta));
        return { ...item, quantity: newQty };
      }
      return item;
    }));
  }, []);

  const cartSubtotal = useMemo(() => 
    cart.reduce((sum, item) => sum + item.price * item.quantity, 0), 
    [cart]
  );
  
  const vipDiscount = useMemo(() => cartSubtotal * 0.15, [cartSubtotal]);
  const cartTotal = useMemo(() => cartSubtotal - vipDiscount, [cartSubtotal, vipDiscount]);

  const handleImageLoad = useCallback((id: number) => {
    setLoadedImages(prev => new Set(prev).add(id));
  }, []);

  const formatPrice = (price: number) => `$${price.toLocaleString()}`;

  const filteredProducts = useMemo(() => 
    selectedCategory === 'All' 
      ? products 
      : products.filter(p => p.category === selectedCategory),
    [selectedCategory]
  );

  const categories = ['All', 'Jackets', 'Pants', 'Accessories'];

  if (activeTab === 'catalog' && selectedProduct) {
    return (
      <div 
        className="min-h-screen text-white overflow-auto pb-24"
        style={{ background: COLORS.primaryGradient }}
      >
        <div className="relative">
          <div className="relative h-[65vh]">
            <img
              src={selectedProduct.image}
              alt={selectedProduct.name}
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-[#050505] via-[#050505]/40 to-transparent" />
            
            <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
              <m.button 
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                onClick={() => setSelectedProduct(null)}
                className="w-11 h-11 rounded-full backdrop-blur-xl flex items-center justify-center"
                style={{ background: 'rgba(5, 5, 5, 0.6)', border: `1px solid ${COLORS.cardBorder}` }}
                data-testid="button-back-detail"
              >
                <ChevronLeft className="w-5 h-5" style={{ color: COLORS.textPrimary }} />
              </m.button>
              <m.button
                initial={{ opacity: 0, x: 20 }}
                animate={{ opacity: 1, x: 0 }}
                onClick={() => toggleFavorite(selectedProduct.id)}
                className="w-11 h-11 rounded-full backdrop-blur-xl flex items-center justify-center"
                style={{ background: 'rgba(5, 5, 5, 0.6)', border: `1px solid ${COLORS.cardBorder}` }}
                data-testid={`button-favorite-detail-${selectedProduct.id}`}
              >
                <Heart 
                  className="w-5 h-5"
                  style={{ 
                    color: favorites.has(selectedProduct.id) ? COLORS.accent1 : COLORS.textPrimary,
                    fill: favorites.has(selectedProduct.id) ? COLORS.accent1 : 'transparent'
                  }}
                />
              </m.button>
            </div>

            {selectedProduct.isNew && (
              <m.div 
                initial={{ opacity: 0, scale: 0.8 }}
                animate={{ opacity: 1, scale: 1 }}
                className="absolute top-28 right-5 z-10"
              >
                <span 
                  className="px-4 py-2 rounded-full text-[11px] font-bold tracking-[0.15em] uppercase"
                  style={{ 
                    background: COLORS.accent2, 
                    color: '#050505',
                    boxShadow: COLORS.glowCyan
                  }}
                >
                  NEW DROP
                </span>
              </m.div>
            )}
          </div>

          <m.div 
            initial={{ opacity: 0, y: 40 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
            className="relative -mt-12 rounded-t-[32px] p-6 pb-32"
            style={{ background: COLORS.primary }}
          >
            <div className="flex items-start justify-between mb-4">
              <div>
                <p 
                  className="text-[11px] font-semibold tracking-[0.2em] uppercase mb-1"
                  style={{ color: COLORS.accent2 }}
                >
                  {selectedProduct.brand}
                </p>
                <h2 
                  className="text-[26px] font-bold tracking-tight uppercase"
                  style={{ color: COLORS.textPrimary, letterSpacing: '-0.02em' }}
                >
                  {selectedProduct.name}
                </h2>
              </div>
              <div className="text-right">
                <p 
                  className="text-[28px] font-bold"
                  style={{ color: COLORS.textPrimary }}
                >
                  {formatPrice(selectedProduct.price)}
                </p>
                {selectedProduct.originalPrice && (
                  <p 
                    className="text-[14px] line-through"
                    style={{ color: COLORS.textSecondary }}
                  >
                    {formatPrice(selectedProduct.originalPrice)}
                  </p>
                )}
              </div>
            </div>

            <p 
              className="text-[14px] leading-relaxed mb-8"
              style={{ color: COLORS.textSecondary }}
            >
              {selectedProduct.description}
            </p>

            <div className="mb-6">
              <p 
                className="text-[11px] font-semibold tracking-[0.15em] uppercase mb-3"
                style={{ color: COLORS.textSecondary }}
              >
                SIZE
              </p>
              <div className="flex flex-wrap gap-2">
                {selectedProduct.sizes.map((size, idx) => (
                  <button
                    key={size}
                    className="px-5 py-3 rounded-lg text-[13px] font-medium transition-all"
                    style={{
                      background: idx === 0 ? COLORS.accent1 : 'transparent',
                      border: `1px solid ${idx === 0 ? COLORS.accent1 : 'rgba(255,255,255,0.1)'}`,
                      color: COLORS.textPrimary
                    }}
                    data-testid={`button-size-${size}`}
                  >
                    {size}
                  </button>
                ))}
              </div>
            </div>

            <div className="mb-8">
              <p 
                className="text-[11px] font-semibold tracking-[0.15em] uppercase mb-3"
                style={{ color: COLORS.textSecondary }}
              >
                COLOR
              </p>
              <div className="flex gap-3">
                {selectedProduct.colors.map((color, idx) => (
                  <button
                    key={color}
                    className="flex items-center gap-2 px-4 py-2.5 rounded-lg text-[12px] font-medium"
                    style={{
                      background: idx === 0 ? 'rgba(255,255,255,0.08)' : 'transparent',
                      border: `1px solid ${idx === 0 ? 'rgba(255,255,255,0.15)' : 'rgba(255,255,255,0.06)'}`,
                      color: COLORS.textPrimary
                    }}
                    data-testid={`button-color-${color.toLowerCase().replace(' ', '-')}`}
                  >
                    <span 
                      className="w-3 h-3 rounded-full"
                      style={{ background: idx === 0 ? '#1a1a1a' : '#2a2a2a' }}
                    />
                    {color}
                  </button>
                ))}
              </div>
            </div>

            <div 
              className="flex items-center gap-3 p-4 rounded-xl mb-6"
              style={{ 
                background: 'rgba(77, 229, 255, 0.08)', 
                border: '1px solid rgba(77, 229, 255, 0.15)' 
              }}
            >
              <Eye className="w-5 h-5" style={{ color: COLORS.accent2 }} />
              <span className="text-[13px] font-medium" style={{ color: COLORS.accent2 }}>
                AR TRY-ON AVAILABLE
              </span>
            </div>

            <ConfirmDrawer
              trigger={
                <button 
                  className="w-full py-4.5 rounded-full font-bold text-[15px] tracking-wide uppercase transition-all flex items-center justify-center gap-3"
                  style={{ 
                    background: COLORS.accent1,
                    boxShadow: COLORS.glowCrimson,
                    color: '#ffffff'
                  }}
                  data-testid="button-add-to-bag"
                >
                  <ShoppingBag className="w-5 h-5" />
                  ADD TO BAG
                </button>
              }
              title="Added to Bag"
              description={`${selectedProduct.name} - ${formatPrice(selectedProduct.price)}`}
              confirmText="View Bag"
              cancelText="Continue Shopping"
              variant="default"
              onConfirm={() => addToCart(selectedProduct)}
            />
          </m.div>
        </div>
      </div>
    );
  }

  if (activeTab === 'home') {
    return (
      <div 
        className="min-h-screen text-white overflow-auto pb-24"
        style={{ background: COLORS.primaryGradient }}
      >
        <div className="demo-nav-safe px-5">
          <m.div 
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            className="flex items-center justify-between mb-8"
          >
            <button 
              className="w-12 h-12 rounded-xl flex items-center justify-center"
              style={{ background: 'rgba(255,255,255,0.04)', border: `1px solid ${COLORS.cardBorder}` }}
              data-testid="button-menu"
            >
              <Menu className="w-5 h-5" style={{ color: COLORS.textSecondary }} />
            </button>
            
            <div className="flex items-center gap-2">
              <span 
                className="text-[22px] font-black tracking-[0.02em]"
                style={{ color: COLORS.textPrimary }}
              >
                OXYZ
              </span>
              <span 
                className="text-[22px] font-light"
                style={{ color: COLORS.accent1 }}
              >
                .
              </span>
            </div>

            <button 
              className="w-12 h-12 rounded-xl flex items-center justify-center relative"
              style={{ background: 'rgba(255,255,255,0.04)', border: `1px solid ${COLORS.cardBorder}` }}
              data-testid="button-cart-home"
            >
              <ShoppingBag className="w-5 h-5" style={{ color: COLORS.textSecondary }} />
              {cart.length > 0 && (
                <span 
                  className="absolute -top-1 -right-1 w-5 h-5 rounded-full text-[10px] font-bold flex items-center justify-center"
                  style={{ background: COLORS.accent1, color: '#fff' }}
                >
                  {cart.length}
                </span>
              )}
            </button>
          </m.div>

          <m.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
            className="mb-6"
          >
            <p 
              className="text-[13px] font-medium tracking-[0.15em] uppercase mb-4"
              style={{ color: COLORS.textSecondary }}
            >
              IT'S NOT JUST
            </p>
            <h1 
              className="text-[56px] font-black leading-[0.9] tracking-[-0.03em] uppercase mb-3"
              style={{ color: COLORS.textPrimary }}
            >
              FASHION
            </h1>
            <p 
              className="text-[28px] font-bold tracking-[-0.02em] uppercase"
              style={{ color: COLORS.accent1 }}
            >
              IT'S A STATEMENT
            </p>
          </m.div>

          <m.div 
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.15 }}
            className="flex items-center gap-4 py-4 mb-6 border-y"
            style={{ borderColor: 'rgba(255,255,255,0.06)' }}
          >
            {[
              { value: '9.5K', label: 'Active' },
              { value: '847', label: 'Drops' },
              { value: '12', label: 'New' }
            ].map((stat, idx) => (
              <div key={idx} className="flex items-center gap-2">
                <span 
                  className="text-[15px] font-bold"
                  style={{ color: COLORS.textPrimary }}
                >
                  {stat.value}
                </span>
                <span 
                  className="text-[12px]"
                  style={{ color: COLORS.textSecondary }}
                >
                  {stat.label}
                </span>
                {idx < 2 && (
                  <span 
                    className="ml-4 w-px h-4"
                    style={{ background: 'rgba(255,255,255,0.1)' }}
                  />
                )}
              </div>
            ))}
          </m.div>

          <m.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="rounded-2xl p-5 mb-6"
            style={{ 
              background: 'linear-gradient(135deg, rgba(255,46,99,0.12) 0%, rgba(255,46,99,0.04) 100%)',
              border: '1px solid rgba(255,46,99,0.2)'
            }}
          >
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <Clock className="w-4 h-4" style={{ color: COLORS.accent1 }} />
                <span 
                  className="text-[11px] font-semibold tracking-[0.15em] uppercase"
                  style={{ color: COLORS.accent1 }}
                >
                  NEXT DROP
                </span>
              </div>
              <span 
                className="text-[11px] font-medium"
                style={{ color: COLORS.textSecondary }}
              >
                EXCLUSIVE
              </span>
            </div>
            <div 
              className="text-[36px] font-bold tracking-tight font-mono"
              style={{ color: COLORS.textPrimary }}
            >
              {String(countdown.hours).padStart(2, '0')}:
              {String(countdown.minutes).padStart(2, '0')}:
              {String(countdown.seconds).padStart(2, '0')}
            </div>
          </m.div>

          <m.button
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.25 }}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="w-full py-4 rounded-full font-bold text-[14px] tracking-wide uppercase flex items-center justify-center gap-3 mb-8"
            style={{ 
              background: `linear-gradient(135deg, ${COLORS.accent1} 0%, #cc2450 100%)`,
              boxShadow: COLORS.glowCrimson,
              color: '#ffffff'
            }}
            data-testid="button-ai-stylist"
          >
            <Sparkles className="w-5 h-5" />
            AI STYLIST - GET YOUR LOOK
          </m.button>

          <m.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.3 }}
            className="mb-8"
          >
            <div className="flex items-center justify-between mb-4">
              <h3 
                className="text-[13px] font-semibold tracking-[0.15em] uppercase"
                style={{ color: COLORS.textSecondary }}
              >
                EDITORIAL
              </h3>
              <button 
                className="text-[12px] font-medium flex items-center gap-1"
                style={{ color: COLORS.accent2 }}
                data-testid="button-view-all-stories"
              >
                View All
                <ChevronRight className="w-4 h-4" />
              </button>
            </div>
            <div className="flex gap-4 overflow-x-auto pb-2 no-scrollbar -mx-5 px-5">
              {stories.map((story, idx) => (
                <m.div
                  key={story.id}
                  initial={{ opacity: 0, x: 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.3 + idx * 0.08 }}
                  className="relative flex-shrink-0 w-[140px] h-[200px] rounded-2xl overflow-hidden cursor-pointer"
                  style={{ border: `1px solid ${COLORS.cardBorder}` }}
                  data-testid={`story-card-${story.id}`}
                >
                  <img
                    src={story.image}
                    alt={story.title}
                    className="w-full h-full object-cover"
                  />
                  <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent" />
                  <div className="absolute bottom-0 left-0 right-0 p-3">
                    <p 
                      className="text-[13px] font-bold tracking-tight"
                      style={{ color: COLORS.textPrimary }}
                    >
                      {story.title}
                    </p>
                    <p 
                      className="text-[11px]"
                      style={{ color: COLORS.textSecondary }}
                    >
                      {story.subtitle}
                    </p>
                  </div>
                </m.div>
              ))}
            </div>
          </m.div>

          <m.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.4 }}
          >
            <div className="flex items-center justify-between mb-4">
              <h3 
                className="text-[13px] font-semibold tracking-[0.15em] uppercase"
                style={{ color: COLORS.textSecondary }}
              >
                FEATURED COLLECTION
              </h3>
            </div>
            <div className="grid grid-cols-2 gap-3">
              {products.slice(0, 4).map((product, idx) => (
                <m.div
                  key={product.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.4 + idx * 0.06 }}
                  whileHover={{ scale: 1.02 }}
                  onClick={() => setSelectedProduct(product)}
                  className="relative rounded-2xl overflow-hidden cursor-pointer"
                  style={{ 
                    background: COLORS.cardBg,
                    border: `1px solid ${COLORS.cardBorder}`,
                    aspectRatio: '3/4'
                  }}
                  data-testid={`featured-product-${product.id}`}
                >
                  <img
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover"
                  />
                  <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent" />
                  {product.isNew && (
                    <span 
                      className="absolute top-3 left-3 px-2.5 py-1 rounded-full text-[9px] font-bold tracking-[0.1em] uppercase"
                      style={{ background: COLORS.accent2, color: '#050505' }}
                    >
                      NEW
                    </span>
                  )}
                  <div className="absolute bottom-0 left-0 right-0 p-3">
                    <p 
                      className="text-[12px] font-bold truncate"
                      style={{ color: COLORS.textPrimary }}
                    >
                      {product.name}
                    </p>
                    <p 
                      className="text-[11px] font-medium"
                      style={{ color: COLORS.accent1 }}
                    >
                      {formatPrice(product.price)}
                    </p>
                  </div>
                </m.div>
              ))}
            </div>
          </m.div>
        </div>
      </div>
    );
  }

  if (activeTab === 'catalog') {
    return (
      <div 
        className="min-h-screen text-white overflow-auto pb-24"
        style={{ background: COLORS.primaryGradient }}
      >
        <div className="demo-nav-safe px-5">
          <m.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            className="flex items-center justify-between mb-6"
          >
            <h1 
              className="text-[24px] font-bold tracking-tight uppercase"
              style={{ color: COLORS.textPrimary, letterSpacing: '-0.02em' }}
            >
              CATALOG
            </h1>
            <div className="flex items-center gap-3">
              <button 
                className="w-11 h-11 rounded-xl flex items-center justify-center"
                style={{ background: 'rgba(255,255,255,0.04)', border: `1px solid ${COLORS.cardBorder}` }}
                data-testid="button-search-catalog"
              >
                <Search className="w-5 h-5" style={{ color: COLORS.textSecondary }} />
              </button>
            </div>
          </m.div>

          <m.div 
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
            className="flex gap-2 mb-6 overflow-x-auto pb-2 no-scrollbar -mx-5 px-5"
          >
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className="px-5 py-2.5 rounded-full text-[13px] font-medium whitespace-nowrap transition-all"
                style={selectedCategory === cat 
                  ? { background: COLORS.accent1, color: '#fff' } 
                  : { background: 'transparent', border: '1px solid rgba(255,255,255,0.08)', color: COLORS.textSecondary }
                }
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </m.div>

          <m.div 
            variants={containerVariants}
            initial="hidden"
            animate="visible"
            className="grid grid-cols-2 gap-3"
          >
            <AnimatePresence mode="popLayout">
              {filteredProducts.map((product, idx) => (
                <m.div
                  key={product.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, scale: 0.95 }}
                  transition={{ delay: idx * 0.05, ...springConfig }}
                  layout
                  onClick={() => setSelectedProduct(product)}
                  onMouseEnter={() => setHoveredProduct(product.id)}
                  onMouseLeave={() => setHoveredProduct(null)}
                  className="relative rounded-2xl overflow-hidden cursor-pointer group"
                  style={{ 
                    background: COLORS.cardBg,
                    border: `1px solid ${COLORS.cardBorder}`,
                  }}
                  data-testid={`product-card-${product.id}`}
                >
                  <div className="relative aspect-[3/4]">
                    {!loadedImages.has(product.id) && (
                      <Skeleton className="absolute inset-0" />
                    )}
                    <img
                      src={product.image}
                      alt={product.name}
                      className={`w-full h-full object-cover transition-all duration-500 ${
                        !loadedImages.has(product.id) ? 'opacity-0' : 'opacity-100'
                      } ${hoveredProduct === product.id ? 'scale-105' : 'scale-100'}`}
                      onLoad={() => handleImageLoad(product.id)}
                    />
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent" />
                    
                    {product.isNew && (
                      <span 
                        className="absolute top-3 left-3 px-2.5 py-1 rounded-full text-[9px] font-bold tracking-[0.1em] uppercase"
                        style={{ background: COLORS.accent2, color: '#050505' }}
                      >
                        NEW
                      </span>
                    )}
                    
                    {product.isTrending && (
                      <span 
                        className="absolute top-3 right-3 flex items-center gap-1 px-2 py-1 rounded-full text-[9px] font-bold"
                        style={{ background: 'rgba(255,46,99,0.2)', color: COLORS.accent1 }}
                      >
                        <TrendingUp className="w-3 h-3" />
                      </span>
                    )}

                    <m.div
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ 
                        opacity: hoveredProduct === product.id ? 1 : 0, 
                        y: hoveredProduct === product.id ? 0 : 10 
                      }}
                      className="absolute bottom-16 left-3 right-3"
                    >
                      <span 
                        className="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-[10px] font-semibold"
                        style={{ background: 'rgba(77,229,255,0.15)', color: COLORS.accent2 }}
                      >
                        <Eye className="w-3 h-3" />
                        AR TRY-ON
                      </span>
                    </m.div>

                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleFavorite(product.id);
                      }}
                      className="absolute w-8 h-8 rounded-full flex items-center justify-center transition-all"
                      style={{ 
                        background: favorites.has(product.id) ? 'rgba(255,46,99,0.2)' : 'rgba(0,0,0,0.4)',
                        top: product.isTrending ? '2.5rem' : '0.75rem',
                        right: '0.75rem'
                      }}
                      data-testid={`button-wishlist-${product.id}`}
                    >
                      <Heart 
                        className="w-4 h-4"
                        style={{ 
                          color: favorites.has(product.id) ? COLORS.accent1 : COLORS.textPrimary,
                          fill: favorites.has(product.id) ? COLORS.accent1 : 'transparent'
                        }}
                      />
                    </button>
                  </div>

                  <div className="p-3">
                    <p 
                      className="text-[10px] font-semibold tracking-[0.12em] uppercase mb-0.5"
                      style={{ color: COLORS.accent2 }}
                    >
                      {product.brand}
                    </p>
                    <p 
                      className="text-[13px] font-bold truncate mb-1.5"
                      style={{ color: COLORS.textPrimary }}
                    >
                      {product.name}
                    </p>
                    <div className="flex items-center gap-2">
                      <span 
                        className="text-[14px] font-bold"
                        style={{ color: COLORS.accent1 }}
                      >
                        {formatPrice(product.price)}
                      </span>
                      {product.originalPrice && (
                        <span 
                          className="text-[11px] line-through"
                          style={{ color: COLORS.textSecondary }}
                        >
                          {formatPrice(product.originalPrice)}
                        </span>
                      )}
                    </div>
                  </div>
                </m.div>
              ))}
            </AnimatePresence>
          </m.div>
        </div>
      </div>
    );
  }

  if (activeTab === 'cart') {
    const recommendations = products.filter(p => !cart.some(c => c.id === p.id)).slice(0, 3);
    
    return (
      <div 
        className="min-h-screen text-white overflow-auto pb-24"
        style={{ background: COLORS.primaryGradient }}
      >
        <div className="demo-nav-safe px-5">
          <m.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            className="flex items-center justify-between mb-6"
          >
            <h1 
              className="text-[24px] font-bold tracking-tight uppercase"
              style={{ color: COLORS.textPrimary, letterSpacing: '-0.02em' }}
            >
              YOUR BAG
            </h1>
            {cart.length > 0 && (
              <span 
                className="px-3 py-1.5 rounded-full text-[12px] font-bold"
                style={{ background: 'rgba(255,255,255,0.06)', color: COLORS.textSecondary }}
              >
                {cart.length} {cart.length === 1 ? 'ITEM' : 'ITEMS'}
              </span>
            )}
          </m.div>

          {cart.length === 0 ? (
            <m.div 
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              className="text-center py-16"
            >
              <div 
                className="w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-5"
                style={{ background: 'rgba(255,255,255,0.04)', border: `1px solid ${COLORS.cardBorder}` }}
              >
                <ShoppingBag className="w-10 h-10" style={{ color: COLORS.textSecondary }} />
              </div>
              <p 
                className="font-bold text-[17px] mb-2"
                style={{ color: COLORS.textPrimary }}
              >
                Your bag is empty
              </p>
              <p 
                className="text-[14px] mb-6"
                style={{ color: COLORS.textSecondary }}
              >
                Start adding pieces to your collection
              </p>
              <button 
                className="px-8 py-3.5 rounded-full font-bold text-[14px] uppercase"
                style={{ background: COLORS.accent1, color: '#fff' }}
                data-testid="button-explore-catalog"
              >
                Explore Catalog
              </button>
            </m.div>
          ) : (
            <m.div initial="hidden" animate="visible" variants={containerVariants}>
              <div className="space-y-3 mb-6">
                <AnimatePresence>
                  {cart.map((item, idx) => (
                    <m.div
                      key={item.id}
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      exit={{ opacity: 0, x: -20, height: 0 }}
                      transition={{ delay: idx * 0.05 }}
                      className="rounded-2xl p-4"
                      style={{ 
                        background: COLORS.cardBg,
                        border: `1px solid ${COLORS.cardBorder}`
                      }}
                    >
                      <div className="flex gap-4">
                        <div className="relative w-[80px] h-[100px] rounded-xl overflow-hidden flex-shrink-0">
                          <img
                            src={item.image}
                            alt={item.name}
                            className="w-full h-full object-cover"
                          />
                        </div>
                        
                        <div className="flex-1 min-w-0">
                          <div className="flex items-start justify-between gap-2">
                            <div>
                              <p 
                                className="text-[10px] font-semibold tracking-[0.1em] uppercase mb-0.5"
                                style={{ color: COLORS.accent2 }}
                              >
                                {item.brand}
                              </p>
                              <p 
                                className="text-[14px] font-bold truncate"
                                style={{ color: COLORS.textPrimary }}
                              >
                                {item.name}
                              </p>
                            </div>
                            <button
                              onClick={() => removeFromCart(item.id)}
                              className="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0"
                              style={{ background: 'rgba(255,46,99,0.1)' }}
                              data-testid={`button-remove-${item.id}`}
                            >
                              <X className="w-3.5 h-3.5" style={{ color: COLORS.accent1 }} />
                            </button>
                          </div>
                          
                          <div className="flex items-center gap-3 mt-1.5 mb-3">
                            <span 
                              className="text-[11px]"
                              style={{ color: COLORS.textSecondary }}
                            >
                              Size: {item.selectedSize}
                            </span>
                            <span 
                              className="w-px h-3"
                              style={{ background: 'rgba(255,255,255,0.1)' }}
                            />
                            <span 
                              className="text-[11px]"
                              style={{ color: COLORS.textSecondary }}
                            >
                              {item.selectedColor}
                            </span>
                          </div>

                          <div className="flex items-center justify-between">
                            <div 
                              className="flex items-center gap-1 rounded-lg"
                              style={{ background: 'rgba(255,255,255,0.04)' }}
                            >
                              <button
                                onClick={() => updateQuantity(item.id, -1)}
                                className="w-8 h-8 flex items-center justify-center"
                                data-testid={`button-decrease-${item.id}`}
                              >
                                <Minus className="w-3.5 h-3.5" style={{ color: COLORS.textSecondary }} />
                              </button>
                              <span 
                                className="w-8 text-center text-[13px] font-bold"
                                style={{ color: COLORS.textPrimary }}
                              >
                                {item.quantity}
                              </span>
                              <button
                                onClick={() => updateQuantity(item.id, 1)}
                                className="w-8 h-8 flex items-center justify-center"
                                data-testid={`button-increase-${item.id}`}
                              >
                                <Plus className="w-3.5 h-3.5" style={{ color: COLORS.textSecondary }} />
                              </button>
                            </div>
                            <span 
                              className="text-[16px] font-bold"
                              style={{ color: COLORS.textPrimary }}
                            >
                              {formatPrice(item.price * item.quantity)}
                            </span>
                          </div>
                        </div>
                      </div>
                    </m.div>
                  ))}
                </AnimatePresence>
              </div>

              {recommendations.length > 0 && (
                <m.div 
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.2 }}
                  className="mb-6"
                >
                  <p 
                    className="text-[11px] font-semibold tracking-[0.15em] uppercase mb-3"
                    style={{ color: COLORS.textSecondary }}
                  >
                    YOU MIGHT ALSO LIKE
                  </p>
                  <div className="flex gap-3 overflow-x-auto no-scrollbar -mx-5 px-5">
                    {recommendations.map(product => (
                      <div 
                        key={product.id}
                        onClick={() => setSelectedProduct(product)}
                        className="flex-shrink-0 w-[120px] rounded-xl overflow-hidden cursor-pointer"
                        style={{ border: `1px solid ${COLORS.cardBorder}` }}
                        data-testid={`recommendation-${product.id}`}
                      >
                        <img
                          src={product.image}
                          alt={product.name}
                          className="w-full h-[100px] object-cover"
                        />
                        <div className="p-2" style={{ background: COLORS.cardBg }}>
                          <p 
                            className="text-[11px] font-medium truncate"
                            style={{ color: COLORS.textPrimary }}
                          >
                            {product.name}
                          </p>
                          <p 
                            className="text-[11px] font-bold"
                            style={{ color: COLORS.accent1 }}
                          >
                            {formatPrice(product.price)}
                          </p>
                        </div>
                      </div>
                    ))}
                  </div>
                </m.div>
              )}

              <m.div 
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.25 }}
                className="rounded-2xl p-5 mb-4"
                style={{ 
                  background: COLORS.cardBg,
                  border: `1px solid ${COLORS.cardBorder}`
                }}
              >
                <div className="space-y-3 mb-4">
                  <div className="flex items-center justify-between">
                    <span style={{ color: COLORS.textSecondary }} className="text-[14px]">Subtotal</span>
                    <span style={{ color: COLORS.textPrimary }} className="text-[14px] font-medium">
                      {formatPrice(cartSubtotal)}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span style={{ color: COLORS.accent1 }} className="text-[14px] font-medium">
                      VIP DISCOUNT -15%
                    </span>
                    <span style={{ color: COLORS.accent1 }} className="text-[14px] font-medium">
                      -{formatPrice(vipDiscount)}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span style={{ color: COLORS.textSecondary }} className="text-[14px]">Shipping</span>
                    <span style={{ color: COLORS.accent2 }} className="text-[14px] font-medium">
                      FREE VIP
                    </span>
                  </div>
                </div>
                <div 
                  className="flex items-center justify-between pt-4 border-t"
                  style={{ borderColor: 'rgba(255,255,255,0.06)' }}
                >
                  <span style={{ color: COLORS.textPrimary }} className="text-[16px] font-bold uppercase">
                    Total
                  </span>
                  <span style={{ color: COLORS.textPrimary }} className="text-[22px] font-bold">
                    {formatPrice(cartTotal)}
                  </span>
                </div>
              </m.div>

              <m.button
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 }}
                whileHover={{ scale: 1.02, boxShadow: '0 0 30px rgba(229, 225, 219, 0.4)' }}
                whileTap={{ scale: 0.98 }}
                className="w-full py-4.5 rounded-full font-bold text-[15px] tracking-wide uppercase flex items-center justify-center gap-3 mb-4"
                style={{ 
                  background: COLORS.textPrimary,
                  color: '#050505',
                  boxShadow: '0 0 20px rgba(229, 225, 219, 0.25)'
                }}
                data-testid="button-checkout"
              >
                <svg viewBox="0 0 24 24" className="w-6 h-6" fill="currentColor">
                  <path d="M17.0009 21.7502C17.1906 21.7502 17.3751 21.6872 17.5249 21.5712C17.6746 21.4552 17.7812 21.2927 17.8283 21.1086L21.4535 6.97422C21.5036 6.78114 21.4882 6.57716 21.4099 6.39426C21.3315 6.21137 21.1946 6.06024 21.0204 5.96434C20.8462 5.86844 20.6448 5.83329 20.4488 5.86435C20.2528 5.89541 20.0731 5.99084 19.9382 6.13553L13.0009 13.0728V2.25024C13.0009 2.05132 12.9219 1.86056 12.7812 1.71991C12.6406 1.57926 12.4498 1.50024 12.2509 1.50024H4.75086C4.55195 1.50024 4.36118 1.57926 4.22053 1.71991C4.07988 1.86056 4.00086 2.05132 4.00086 2.25024V21.0002C4.00086 21.1991 4.07988 21.3899 4.22053 21.5306C4.36118 21.6712 4.55195 21.7502 4.75086 21.7502H17.0009Z"/>
                </svg>
                PAY WITH APPLE PAY
              </m.button>

              <m.div 
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ delay: 0.35 }}
                className="flex items-center justify-center gap-2 py-3"
                data-testid="concierge-message"
              >
                <MessageCircle className="w-4 h-4" style={{ color: COLORS.accent2 }} />
                <span 
                  className="text-[12px] font-medium"
                  style={{ color: COLORS.textSecondary }}
                >
                  Personal shopper available 24/7
                </span>
              </m.div>
            </m.div>
          )}
        </div>
      </div>
    );
  }

  if (activeTab === 'profile') {
    const menuItems = [
      { icon: History, label: 'Order History', count: 23 },
      { icon: Heart, label: 'Wishlist', count: favorites.size || 47 },
      { icon: Sparkles, label: 'Personal Stylist' },
      { icon: Ruler, label: 'Measurements' },
      { icon: Settings, label: 'Settings' }
    ];

    return (
      <div 
        className="min-h-screen text-white overflow-auto pb-24"
        style={{ background: COLORS.primaryGradient }}
      >
        <div className="demo-nav-safe px-5">
          <m.div 
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-center mb-8"
          >
            <div className="relative w-[100px] h-[100px] mx-auto mb-4">
              <m.div
                animate={{ rotate: 360 }}
                transition={{ duration: 8, repeat: Infinity, ease: "linear" }}
                className="absolute inset-0 rounded-full"
                style={{ 
                  background: `linear-gradient(135deg, ${COLORS.accent1}, ${COLORS.accent2}, ${COLORS.accent1})`,
                  padding: '3px'
                }}
              />
              <div 
                className="absolute inset-[3px] rounded-full overflow-hidden"
                style={{ background: COLORS.primary }}
              >
                <img
                  src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&q=90"
                  alt="Profile"
                  className="w-full h-full object-cover"
                />
              </div>
              <div 
                className="absolute -bottom-1 -right-1 w-9 h-9 rounded-full flex items-center justify-center"
                style={{ background: COLORS.accent1, boxShadow: COLORS.glowCrimson }}
              >
                <Crown className="w-4 h-4 text-white" />
              </div>
            </div>
            <h2 
              className="text-[22px] font-bold tracking-tight"
              style={{ color: COLORS.textPrimary }}
            >
              ALEXANDER VOSS
            </h2>
            <p 
              className="text-[13px]"
              style={{ color: COLORS.textSecondary }}
            >
              @alexvoss
            </p>
          </m.div>

          <m.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
            className="rounded-2xl p-5 mb-6"
            style={{ 
              background: `linear-gradient(135deg, rgba(255,46,99,0.15) 0%, rgba(77,229,255,0.08) 100%)`,
              border: '1px solid rgba(255,46,99,0.2)'
            }}
          >
            <div className="flex items-center justify-between mb-4">
              <div>
                <p 
                  className="text-[10px] font-semibold tracking-[0.2em] uppercase mb-1"
                  style={{ color: COLORS.textSecondary }}
                >
                  VIP STATUS
                </p>
                <p 
                  className="text-[18px] font-bold tracking-tight uppercase"
                  style={{ color: COLORS.textPrimary }}
                >
                  OBSIDIAN ELITE
                </p>
              </div>
              <div className="relative w-16 h-16">
                <svg className="w-16 h-16 -rotate-90" viewBox="0 0 100 100">
                  <circle
                    cx="50"
                    cy="50"
                    r="40"
                    fill="none"
                    stroke="rgba(255,255,255,0.1)"
                    strokeWidth="8"
                  />
                  <m.circle
                    cx="50"
                    cy="50"
                    r="40"
                    fill="none"
                    stroke={COLORS.accent1}
                    strokeWidth="8"
                    strokeLinecap="round"
                    strokeDasharray={`${2 * Math.PI * 40}`}
                    initial={{ strokeDashoffset: 2 * Math.PI * 40 }}
                    animate={{ strokeDashoffset: 2 * Math.PI * 40 * (1 - tierProgress / 100) }}
                    transition={{ duration: 1.5, ease: "easeOut" }}
                  />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center">
                  <span 
                    className="text-[14px] font-bold"
                    style={{ color: COLORS.textPrimary }}
                  >
                    {tierProgress}%
                  </span>
                </div>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <Zap className="w-4 h-4" style={{ color: COLORS.accent2 }} />
              <span 
                className="text-[14px] font-bold"
                style={{ color: COLORS.accent2 }}
              >
                12,450 XP
              </span>
              <span 
                className="text-[12px]"
                style={{ color: COLORS.textSecondary }}
              >
                to next tier
              </span>
            </div>
          </m.div>

          <m.div 
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.15 }}
            className="grid grid-cols-3 gap-3 mb-6"
          >
            {[
              { value: 23, label: 'Orders' },
              { value: favorites.size || 47, label: 'Wishlist' },
              { value: 12, label: 'Reviews' }
            ].map((stat, idx) => (
              <div 
                key={idx}
                className="rounded-xl p-4 text-center"
                style={{ 
                  background: COLORS.cardBg,
                  border: `1px solid ${COLORS.cardBorder}`
                }}
              >
                <p 
                  className="text-[24px] font-bold"
                  style={{ color: COLORS.textPrimary }}
                >
                  {stat.value}
                </p>
                <p 
                  className="text-[11px] font-medium tracking-wide uppercase"
                  style={{ color: COLORS.textSecondary }}
                >
                  {stat.label}
                </p>
              </div>
            ))}
          </m.div>

          <m.div 
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.2 }}
            className="space-y-2 mb-6"
          >
            {menuItems.map((item, idx) => (
              <m.button
                key={idx}
                initial={{ opacity: 0, x: -10 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.2 + idx * 0.05 }}
                whileHover={{ x: 4 }}
                className="w-full flex items-center gap-4 p-4 rounded-xl transition-all"
                style={{ 
                  background: COLORS.cardBg,
                  border: `1px solid ${COLORS.cardBorder}`
                }}
                data-testid={`button-menu-${item.label.toLowerCase().replace(' ', '-')}`}
              >
                <div 
                  className="w-11 h-11 rounded-xl flex items-center justify-center"
                  style={{ background: 'rgba(255,255,255,0.04)' }}
                >
                  <item.icon className="w-5 h-5" style={{ color: COLORS.textSecondary }} />
                </div>
                <span 
                  className="flex-1 text-left font-medium text-[15px]"
                  style={{ color: COLORS.textPrimary }}
                >
                  {item.label}
                </span>
                {item.count !== undefined && (
                  <span 
                    className="px-2.5 py-1 rounded-full text-[11px] font-bold"
                    style={{ background: 'rgba(255,255,255,0.06)', color: COLORS.textSecondary }}
                  >
                    {item.count}
                  </span>
                )}
                <ChevronRight className="w-5 h-5" style={{ color: COLORS.textSecondary }} />
              </m.button>
            ))}
          </m.div>

          <m.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4 }}
            className="rounded-2xl p-5 text-center"
            style={{ 
              background: `linear-gradient(135deg, rgba(77,229,255,0.12) 0%, rgba(77,229,255,0.04) 100%)`,
              border: '1px solid rgba(77,229,255,0.2)'
            }}
          >
            <div className="flex items-center justify-center gap-2 mb-2">
              <Star className="w-4 h-4" style={{ color: COLORS.accent2 }} />
              <span 
                className="text-[11px] font-bold tracking-[0.2em] uppercase"
                style={{ color: COLORS.accent2 }}
              >
                EXCLUSIVE ACCESS
              </span>
              <Star className="w-4 h-4" style={{ color: COLORS.accent2 }} />
            </div>
            <p 
              className="text-[13px]"
              style={{ color: COLORS.textSecondary }}
            >
              Early access to drops and private sales
            </p>
          </m.div>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(OxyzNFT);
```

### demos/EmilyCarterAI.tsx
```tsx
import { useState, memo } from "react";
import { m } from "framer-motion";
import { Heart, MessageCircle, ChevronLeft, ChevronRight, Check, Lock, Star, Sparkles, X, Send, Image as ImageIcon, Settings, Grid } from "lucide-react";

interface EmilyCarterAIProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Post {
  id: number;
  text: string;
  price: number;
  image?: string;
  locked: boolean;
  likes: number;
}

const posts: Post[] = [
  {
    id: 1,
    text: "Hi! Set for those who want to see awesome gameplay! Spoiler alert - i win!",
    price: 5.99,
    image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=400&fit=crop&q=90",
    locked: true,
    likes: 847
  },
  {
    id: 2,
    text: "New cosplay photos are ready! Check out my latest Zodiac collection",
    price: 9.99,
    image: "https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=400&h=400&fit=crop&q=90",
    locked: true,
    likes: 1234
  },
  {
    id: 3,
    text: "Behind the scenes of my latest photoshoot. Exclusive access!",
    price: 14.99,
    locked: true,
    likes: 2156
  }
];

function EmilyCarterAI({ activeTab }: EmilyCarterAIProps) {
  const [selectedPlan, setSelectedPlan] = useState<'yearly' | 'weekly'>('yearly');
  const [isSubscribed, setIsSubscribed] = useState(false);
  const [following, setFollowing] = useState(false);
  const [showMessages, setShowMessages] = useState(false);

  // ========================================
  // HOME PAGE - Subscription screen (Light mode)
  // ========================================
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-[#F5F4F0] text-[#1A1A1A] overflow-auto pb-24">
        <div className="demo-nav-safe px-5">
          {/* Hero Image */}
          <m.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            className="relative rounded-[32px] overflow-hidden mb-6"
            style={{ height: '420px' }}
          >
            <img
              src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=800&h=1000&fit=crop&q=95"
              alt="Emily Carter"
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent" />
            
            {/* AI Creator Badge */}
            <div className="absolute bottom-6 left-6">
              <div 
                className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full mb-3"
                style={{ background: 'rgba(0,0,0,0.4)', backdropFilter: 'blur(20px)' }}
              >
                <Sparkles className="w-3.5 h-3.5" style={{ color: '#A78BFA' }} />
                <span className="text-white text-[12px] font-medium">AI Creator</span>
              </div>
              <div className="flex items-center gap-2">
                <h2 className="text-white text-[28px] font-bold">Emily Carter</h2>
                <div className="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center">
                  <Check className="w-3 h-3 text-white" />
                </div>
              </div>
            </div>
          </m.div>

          {/* Subscription Section */}
          <div className="bg-white rounded-[24px] p-6 shadow-sm">
            <h3 className="text-[18px] font-semibold text-center mb-6">Select your plan</h3>
            
            {/* Yearly Plan */}
            <m.button
              whileTap={{ scale: 0.98 }}
              onClick={() => setSelectedPlan('yearly')}
              className={`w-full p-4 rounded-2xl mb-3 flex items-center justify-between transition-all ${
                selectedPlan === 'yearly' 
                  ? 'bg-[#F5F4F0] border-2 border-[#1A1A1A]' 
                  : 'bg-[#F5F4F0] border-2 border-transparent'
              }`}
              data-testid="button-plan-yearly"
            >
              <div className="flex items-center gap-3">
                <div 
                  className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                    selectedPlan === 'yearly' ? 'border-[#1A1A1A] bg-[#1A1A1A]' : 'border-gray-300'
                  }`}
                >
                  {selectedPlan === 'yearly' && <Check className="w-3 h-3 text-white" />}
                </div>
                <div className="text-left">
                  <div className="flex items-center gap-2">
                    <span className="font-semibold">Yearly</span>
                    <span 
                      className="px-2 py-0.5 rounded-full text-[10px] font-bold text-white"
                      style={{ background: '#22C55E' }}
                    >
                      Save 90%
                    </span>
                  </div>
                </div>
              </div>
              <div className="text-right">
                <div className="font-bold">$0.77 <span className="font-normal text-gray-500">/ week</span></div>
                <div className="text-[12px] text-gray-400">just $39.99 year</div>
              </div>
            </m.button>

            {/* Weekly Plan */}
            <m.button
              whileTap={{ scale: 0.98 }}
              onClick={() => setSelectedPlan('weekly')}
              className={`w-full p-4 rounded-2xl mb-6 flex items-center justify-between transition-all ${
                selectedPlan === 'weekly' 
                  ? 'bg-[#F5F4F0] border-2 border-[#1A1A1A]' 
                  : 'bg-[#F5F4F0] border-2 border-transparent'
              }`}
              data-testid="button-plan-weekly"
            >
              <div className="flex items-center gap-3">
                <div 
                  className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${
                    selectedPlan === 'weekly' ? 'border-[#1A1A1A] bg-[#1A1A1A]' : 'border-gray-300'
                  }`}
                >
                  {selectedPlan === 'weekly' && <Check className="w-3 h-3 text-white" />}
                </div>
                <span className="font-semibold">Weekly</span>
              </div>
              <div className="font-bold">$6.99 <span className="font-normal text-gray-500">/ week</span></div>
            </m.button>

            {/* Subscribe Button */}
            <button 
              onClick={() => setIsSubscribed(true)}
              className="w-full py-4 rounded-full bg-[#1A1A1A] text-white font-semibold text-[15px]"
              data-testid="button-subscribe"
            >
              Subscribe
            </button>

            <p className="text-center text-gray-400 text-[13px] mt-4">Cancel anytime</p>
            
            <div className="flex items-center justify-center gap-4 mt-3">
              <span className="text-[12px] text-gray-400 underline">Terms of use</span>
              <span className="text-gray-300">|</span>
              <span className="text-[12px] text-gray-400 underline">Privacy policy</span>
              <span className="text-gray-300">|</span>
              <span className="text-[12px] text-gray-400 underline">Purchases</span>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // ========================================
  // CATALOG/PROFILE PAGE - Dark mode profile
  // ========================================
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="demo-nav-safe px-5">
          {/* Back button */}
          <button 
            className="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center mb-6"
            data-testid="button-back"
          >
            <ChevronLeft className="w-5 h-5" />
          </button>

          {/* Profile Section */}
          <div className="flex items-center justify-between mb-6">
            <div className="text-center flex-1">
              <span className="text-[24px] font-bold">34.9 K</span>
              <p className="text-white/50 text-[12px]">followers</p>
            </div>
            
            {/* Avatar */}
            <div className="relative">
              <div 
                className="w-[100px] h-[100px] rounded-full overflow-hidden"
                style={{ border: '3px solid rgba(255,255,255,0.1)' }}
              >
                <img
                  src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&h=200&fit=crop&q=90"
                  alt="Emily Carter"
                  className="w-full h-full object-cover"
                />
              </div>
            </div>

            <div className="text-center flex-1">
              <span className="text-[24px] font-bold">2245</span>
              <p className="text-white/50 text-[12px]">following</p>
            </div>
          </div>

          {/* Name and Bio */}
          <div className="text-center mb-6">
            <div className="flex items-center justify-center gap-2 mb-2">
              <span className="text-[20px] font-bold">Emily Carter</span>
              <div className="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center">
                <Check className="w-3 h-3 text-white" />
              </div>
            </div>
            <p className="text-white/50 text-[13px]">E-gamer | Kawaii lover | Zodiac girl</p>
          </div>

          {/* Action Buttons */}
          <div className="flex gap-3 mb-8">
            <button 
              onClick={() => setFollowing(!following)}
              className={`flex-1 py-3 rounded-full font-semibold text-[14px] flex items-center justify-center gap-2 ${
                following 
                  ? 'bg-white/10 text-white' 
                  : 'bg-white text-black'
              }`}
              data-testid="button-follow"
            >
              <Heart className={`w-4 h-4 ${following ? 'fill-red-500 text-red-500' : ''}`} />
              {following ? 'Following' : 'Follow'}
            </button>
            <button 
              onClick={() => setShowMessages(true)}
              className="flex-1 py-3 rounded-full bg-white/10 font-semibold text-[14px] flex items-center justify-center gap-2"
              data-testid="button-messages"
            >
              <MessageCircle className="w-4 h-4" />
              Messages
            </button>
          </div>

          {/* Posts */}
          <div className="space-y-4">
            {posts.slice(0, 1).map(post => (
              <div 
                key={post.id}
                className="rounded-[24px] p-4"
                style={{ background: 'linear-gradient(160deg, #2A2A2C 0%, #1C1C1E 100%)' }}
              >
                <div className="flex items-start gap-3 mb-4">
                  <img
                    src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=80&h=80&fit=crop&q=90"
                    alt="Emily"
                    className="w-10 h-10 rounded-full object-cover"
                  />
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="font-semibold text-[14px]">Emily Carter</span>
                      <div className="w-4 h-4 rounded-full bg-blue-500 flex items-center justify-center">
                        <Check className="w-2.5 h-2.5 text-white" />
                      </div>
                    </div>
                    <p className="text-white/60 text-[13px]">{post.text}</p>
                  </div>
                </div>
                
                {post.image && (
                  <div className="relative rounded-2xl overflow-hidden mb-4">
                    <img
                      src={post.image}
                      alt="Post"
                      className="w-full h-[120px] object-cover"
                      style={{ filter: post.locked ? 'blur(20px)' : 'none' }}
                    />
                    {post.locked && (
                      <div className="absolute inset-0 flex items-center justify-center">
                        <Lock className="w-8 h-8 text-white/80" />
                      </div>
                    )}
                    <div className="absolute bottom-3 right-3 px-2 py-1 rounded-lg bg-black/60 text-[11px]">
                      21:24
                    </div>
                  </div>
                )}
                
                <button 
                  className="w-full py-3 rounded-full text-[14px] font-semibold"
                  style={{ background: 'rgba(255,255,255,0.1)' }}
                  data-testid={`button-buy-${post.id}`}
                >
                  Buy ${post.price}
                </button>
              </div>
            ))}
          </div>

          {/* Upgrade Card */}
          <div 
            className="rounded-[24px] p-5 mt-4"
            style={{ background: 'linear-gradient(160deg, #F5F4F0 0%, #E8E7E3 100%)' }}
          >
            <div className="flex items-start gap-4">
              <div className="flex-1">
                <div className="flex items-center gap-2 mb-1">
                  <Sparkles className="w-4 h-4 text-gray-600" />
                  <span className="text-[12px] text-gray-500">The best price</span>
                </div>
                <h3 className="text-[#1A1A1A] text-[18px] font-bold mb-1">Unlock all exclusive content</h3>
                <p className="text-gray-500 text-[13px]">Upgrade to Silver</p>
              </div>
              <div 
                className="w-16 h-16 rounded-2xl flex items-center justify-center"
                style={{ background: 'linear-gradient(135deg, #E5E7EB 0%, #9CA3AF 100%)' }}
              >
                <Star className="w-8 h-8 text-white" />
              </div>
            </div>
          </div>

          {/* Bottom Action Bar */}
          <div className="flex items-center justify-center gap-3 mt-6">
            {[Star, Heart, MessageCircle, Grid].map((Icon, idx) => (
              <button
                key={idx}
                className="w-12 h-12 rounded-full flex items-center justify-center"
                style={{ background: idx === 0 ? '#1A1A1A' : 'rgba(255,255,255,0.1)' }}
              >
                <Icon className="w-5 h-5" />
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // ========================================
  // CART PAGE - Content purchases
  // ========================================
  if (activeTab === 'cart') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="demo-nav-safe px-5">
          <h1 className="text-[24px] font-bold mb-6">My Purchases</h1>

          {isSubscribed ? (
            <div className="space-y-4">
              {posts.map(post => (
                <div 
                  key={post.id}
                  className="rounded-[20px] p-4"
                  style={{ background: 'linear-gradient(160deg, #1C1C1E 0%, #0D0D0D 100%)' }}
                >
                  <div className="flex gap-4">
                    <div className="relative w-[80px] h-[80px] rounded-xl overflow-hidden">
                      <img
                        src={post.image || "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&h=200&fit=crop&q=90"}
                        alt="Content"
                        className="w-full h-full object-cover"
                      />
                    </div>
                    <div className="flex-1">
                      <p className="text-[14px] mb-2 line-clamp-2">{post.text}</p>
                      <div className="flex items-center gap-2">
                        <Check className="w-4 h-4 text-green-500" />
                        <span className="text-green-500 text-[12px]">Unlocked</span>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-20">
              <div 
                className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"
                style={{ background: 'rgba(255,255,255,0.05)' }}
              >
                <Lock className="w-8 h-8 text-white/30" />
              </div>
              <p className="text-white/60 font-medium text-[15px]">No purchases yet</p>
              <p className="text-white/30 text-[13px] mt-2">Subscribe to unlock exclusive content</p>
            </div>
          )}
        </div>
      </div>
    );
  }

  // ========================================
  // PROFILE PAGE - Settings
  // ========================================
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="demo-nav-safe px-5">
          <div className="text-center mb-8">
            <div className="relative w-[88px] h-[88px] mx-auto mb-4">
              <img
                src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=200&h=200&fit=crop&q=80"
                alt="Profile"
                className="w-full h-full rounded-full object-cover"
                style={{ border: '3px solid #A78BFA' }}
              />
            </div>
            <h2 className="text-[22px] font-bold">My Account</h2>
            <p className="text-white/40 text-[13px]">@viewer</p>
          </div>

          <div className="space-y-3">
            {[
              { icon: Heart, label: 'Favorites', value: '12 creators' },
              { icon: Lock, label: 'Subscriptions', value: isSubscribed ? 'Active' : 'None' },
              { icon: ImageIcon, label: 'Purchases', value: isSubscribed ? '3 items' : '0 items' },
              { icon: Settings, label: 'Settings', value: '' }
            ].map((item, idx) => (
              <button
                key={idx}
                className="w-full flex items-center gap-4 p-4 rounded-[18px]"
                style={{ background: 'linear-gradient(160deg, #1C1C1E 0%, #0D0D0D 100%)' }}
              >
                <div 
                  className="w-11 h-11 rounded-full flex items-center justify-center"
                  style={{ background: 'rgba(255,255,255,0.05)' }}
                >
                  <item.icon className="w-5 h-5" />
                </div>
                <span className="font-medium text-[15px] flex-1 text-left">{item.label}</span>
                {item.value && <span className="text-white/40 text-[13px]">{item.value}</span>}
                <ChevronRight className="w-5 h-5 text-white/30" />
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(EmilyCarterAI);
```

### demos/DemoRegistry.ts
```tsx
// Dynamic demo registry for lazy loading
import { lazy, ComponentType } from 'react';

// Type for demo components
export interface DemoComponent {
  component: ComponentType<any>;
  preload?: () => Promise<{ default: ComponentType<any> }>;
}

// Demo registry with lazy loading
export const demoRegistry: Record<string, DemoComponent> = {
  'clothing-store': {
    component: lazy(() => import('./PremiumFashionStore')),
    preload: () => import('./PremiumFashionStore')
  },
  'premium-fashion': {
    component: lazy(() => import('./PremiumFashionStore')),
    preload: () => import('./PremiumFashionStore')
  },
  'electronics': {
    component: lazy(() => import('./Electronics')),
    preload: () => import('./Electronics')
  },
  'beauty': {
    component: lazy(() => import('./Beauty')),
    preload: () => import('./Beauty')
  },
  'restaurant': {
    component: lazy(() => import('./Restaurant')),
    preload: () => import('./Restaurant')
  },
  'fitness': {
    component: lazy(() => import('./Fitness')),
    preload: () => import('./Fitness')
  },
  'banking': {
    component: lazy(() => import('./Banking')),
    preload: () => import('./Banking')
  },
  'bookstore': {
    component: lazy(() => import('./Bookstore')),
    preload: () => import('./Bookstore')
  },
  'car-rental': {
    component: lazy(() => import('./CarRental')),
    preload: () => import('./CarRental')
  },
  'taxi': {
    component: lazy(() => import('./Taxi')),
    preload: () => import('./Taxi')
  },
  'medical': {
    component: lazy(() => import('./Medical')),
    preload: () => import('./Medical')
  },
  'courses': {
    component: lazy(() => import('./Courses')),
    preload: () => import('./Courses')
  },
  'car-wash': {
    component: lazy(() => import('./CarWash')),
    preload: () => import('./CarWash')
  },
  'florist': {
    component: lazy(() => import('./Florist')),
    preload: () => import('./Florist')
  },
  'tea-house': {
    component: lazy(() => import('./TeaHouse')),
    preload: () => import('./TeaHouse')
  },
  'sneaker-vault': {
    component: lazy(() => import('./SneakerVault')),
    preload: () => import('./SneakerVault')
  },
  'fragrance-royale': {
    component: lazy(() => import('./FragranceRoyale')),
    preload: () => import('./FragranceRoyale')
  },
  'time-elite': {
    component: lazy(() => import('./TimeElite')),
    preload: () => import('./TimeElite')
  },
  'interior-lux': {
    component: lazy(() => import('./InteriorLux')),
    preload: () => import('./InteriorLux')
  },
  
  // Aliases for compatibility with demoApps.ts IDs
  'luxury-watches': {
    component: lazy(() => import('./TimeElite')),
    preload: () => import('./TimeElite')
  },
  'home-decor': {
    component: lazy(() => import('./InteriorLux')),
    preload: () => import('./InteriorLux')
  },
  'sneaker-store': {
    component: lazy(() => import('./SneakerVault')),
    preload: () => import('./SneakerVault')
  },
  'premium-tea': {
    component: lazy(() => import('./TeaHouse')),
    preload: () => import('./TeaHouse')
  },
  'luxury-perfume': {
    component: lazy(() => import('./FragranceRoyale')),
    preload: () => import('./FragranceRoyale')
  },
  
  // Futuristic Fashion Collection (4 premium full stores)
  'futuristic-fashion-1': {
    component: lazy(() => import('./RascalStore')),
    preload: () => import('./RascalStore')
  },
  'futuristic-fashion-2': {
    component: lazy(() => import('./StoreBlack')),
    preload: () => import('./StoreBlack')
  },
  'futuristic-fashion-3': {
    component: lazy(() => import('./LabSurvivalist')),
    preload: () => import('./LabSurvivalist')
  },
  'futuristic-fashion-4': {
    component: lazy(() => import('./NikeACG')),
    preload: () => import('./NikeACG')
  },
  
  // Premium Design Collection - New Apps
  'oxyz-nft': {
    component: lazy(() => import('./OxyzNFT')),
    preload: () => import('./OxyzNFT')
  },
  'emily-carter-ai': {
    component: lazy(() => import('./EmilyCarterAI')),
    preload: () => import('./EmilyCarterAI')
  }
};

// Preload critical demos (reduced to essential only for performance)
export const preloadCriticalDemos = () => {
  const criticalDemos = ['clothing-store', 'electronics']; // Reduced from 4 to 2 most critical
  
  criticalDemos.forEach(demoId => {
    const demo = demoRegistry[demoId];
    if (demo?.preload) {
      // Preload on requestIdleCallback with delay to not block initial render
      if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
          setTimeout(() => demo.preload!(), 200); // Additional delay
        });
      } else {
        // Fallback with longer delay
        setTimeout(() => demo.preload!(), 500);
      }
    }
  });
};

// Get demo component
export const getDemoComponent = (demoId: string): ComponentType<any> | null => {
  const demo = demoRegistry[demoId];
  return demo?.component || null;
};

// Check if demo exists
export const isDemoAvailable = (demoId: string): boolean => {
  return demoId in demoRegistry;
};

// Preload a specific demo component on hover
export const preloadDemo = (demoId: string): void => {
  const demo = demoRegistry[demoId];
  if (demo?.preload) {
    demo.preload().catch(() => {
      // Silently fail if preload fails
    });
  }
};```

## ХУКИ (Hooks)

### hooks/useAccessibility.ts
```tsx
import { useEffect, useCallback, useRef } from 'react';

interface AccessibilityOptions {
  enableKeyboardNav?: boolean;
  enableFocusManagement?: boolean;
  enableScreenReader?: boolean;
  skipToContentId?: string;
}

export const useAccessibility = (options: AccessibilityOptions = {}) => {
  const {
    enableKeyboardNav = true,
    enableFocusManagement = true,
    enableScreenReader = true,
    skipToContentId = 'main-content'
  } = options;
  
  const focusableElementsRef = useRef<HTMLElement[]>([]);
  
  // Focus management
  const trapFocus = useCallback((container: HTMLElement) => {
    if (!enableFocusManagement) return;
    
    const focusableElements = container.querySelectorAll<HTMLElement>(
      'a[href], button:not([disabled]), textarea:not([disabled]), input:not([disabled]), select:not([disabled]), [tabindex]:not([tabindex="-1"])'
    );
    
    focusableElementsRef.current = Array.from(focusableElements);
    
    const firstElement = focusableElementsRef.current[0];
    const lastElement = focusableElementsRef.current[focusableElementsRef.current.length - 1];
    
    const handleTabKey = (e: KeyboardEvent) => {
      if (e.key !== 'Tab') return;
      
      if (e.shiftKey) {
        if (document.activeElement === firstElement) {
          e.preventDefault();
          lastElement?.focus();
        }
      } else {
        if (document.activeElement === lastElement) {
          e.preventDefault();
          firstElement?.focus();
        }
      }
    };
    
    container.addEventListener('keydown', handleTabKey);
    
    return () => {
      container.removeEventListener('keydown', handleTabKey);
    };
  }, [enableFocusManagement]);
  
  // Keyboard navigation
  useEffect(() => {
    if (!enableKeyboardNav) return;
    
    const handleKeyDown = (e: KeyboardEvent) => {
      // ESC to close modals/dropdowns
      if (e.key === 'Escape') {
        const event = new CustomEvent('accessibility:escape');
        document.dispatchEvent(event);
      }
      
      // Arrow keys for navigation
      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
        const event = new CustomEvent('accessibility:arrow', { detail: { key: e.key } });
        document.dispatchEvent(event);
      }
    };
    
    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [enableKeyboardNav]);
  
  // Skip to content link
  useEffect(() => {
    if (!skipToContentId) return;
    
    const skipLink = document.createElement('a');
    skipLink.href = `#${skipToContentId}`;
    skipLink.className = 'skip-to-content';
    skipLink.textContent = 'Skip to main content';
    skipLink.style.cssText = `
      position: absolute;
      left: -9999px;
      z-index: 999;
      padding: 1rem;
      background: var(--emerald-500);
      color: white;
      text-decoration: none;
      border-radius: 0.5rem;
    `;
    
    skipLink.addEventListener('focus', () => {
      skipLink.style.left = '1rem';
      skipLink.style.top = '1rem';
    });
    
    skipLink.addEventListener('blur', () => {
      skipLink.style.left = '-9999px';
    });
    
    document.body.insertBefore(skipLink, document.body.firstChild);
    
    return () => {
      skipLink.remove();
    };
  }, [skipToContentId]);
  
  // Announce to screen readers
  const announce = useCallback((message: string, priority: 'polite' | 'assertive' = 'polite') => {
    if (!enableScreenReader) return;
    
    const announcement = document.createElement('div');
    announcement.setAttribute('role', 'status');
    announcement.setAttribute('aria-live', priority);
    announcement.setAttribute('aria-atomic', 'true');
    announcement.className = 'sr-only';
    announcement.textContent = message;
    
    document.body.appendChild(announcement);
    
    setTimeout(() => {
      announcement.remove();
    }, 1000);
  }, [enableScreenReader]);
  
  return {
    trapFocus,
    announce
  };
};

// Screen reader only text utility
export const srOnly = {
  position: 'absolute' as const,
  width: '1px',
  height: '1px',
  padding: 0,
  margin: '-1px',
  overflow: 'hidden',
  clip: 'rect(0, 0, 0, 0)',
  whiteSpace: 'nowrap' as const,
  borderWidth: 0
};
```

### hooks/useAIRecommendations.ts
```tsx
import { useState, useEffect } from 'react';
import { useQuery } from '@tanstack/react-query';

interface UserProfile {
  interests: string[];
  businessType?: string;
  browsingHistory: string[];
  interactions: {
    appId: string;
    action: 'view' | 'click' | 'favorite';
    timestamp: number;
  }[];
}

interface AIRecommendation {
  appId: string;
  score: number;
  reason: string;
}

export interface AIRecommendations {
  personalizedApps: AIRecommendation[];
  suggestedFeatures: string[];
  searchSuggestions: string[];
  loading: boolean;
}

export function useAIRecommendations(): AIRecommendations {
  const [userProfile, setUserProfile] = useState<UserProfile>(() => {
    try {
      const stored = localStorage.getItem('ai_user_profile');
      return stored ? JSON.parse(stored) : {
        interests: [],
        browsingHistory: [],
        interactions: []
      };
    } catch {
      return {
        interests: [],
        browsingHistory: [],
        interactions: []
      };
    }
  });

  // Listen for profile updates
  useEffect(() => {
    const handleProfileUpdate = () => {
      try {
        const stored = localStorage.getItem('ai_user_profile');
        if (stored) {
          setUserProfile(JSON.parse(stored));
        }
      } catch (error) {
        console.error('Failed to load AI profile:', error);
      }
    };

    window.addEventListener('ai_profile_update', handleProfileUpdate);
    window.addEventListener('storage', handleProfileUpdate);

    return () => {
      window.removeEventListener('ai_profile_update', handleProfileUpdate);
      window.removeEventListener('storage', handleProfileUpdate);
    };
  }, []);

  const { data, isLoading } = useQuery({
    queryKey: ['/api/ai/recommendations', userProfile],
    enabled: false, // Client-side only for now
  });

  // Client-side AI recommendation algorithm
  const generateRecommendations = (): AIRecommendation[] => {
    const { interactions, browsingHistory, interests } = userProfile;
    
    // Simple scoring algorithm based on user behavior
    const appScores = new Map<string, number>();
    
    // Score based on interactions
    interactions.forEach(({ appId, action }) => {
      const currentScore = appScores.get(appId) || 0;
      const actionWeight = action === 'favorite' ? 3 : action === 'click' ? 2 : 1;
      appScores.set(appId, currentScore + actionWeight);
    });
    
    // Score based on browsing history
    browsingHistory.forEach((appId) => {
      const currentScore = appScores.get(appId) || 0;
      appScores.set(appId, currentScore + 1);
    });
    
    // Convert to array and sort by score
    const recommendations = Array.from(appScores.entries())
      .map(([appId, score]) => ({
        appId,
        score,
        reason: score > 5 ? 'Часто просматриваете' : 'Может вам понравиться'
      }))
      .sort((a, b) => b.score - a.score)
      .slice(0, 5);
    
    return recommendations;
  };

  const generateSearchSuggestions = (): string[] => {
    const { interests, browsingHistory } = userProfile;
    
    // Combine interests and recent history for suggestions
    const suggestions = new Set<string>();
    
    interests.forEach(interest => suggestions.add(interest));
    
    // Add category-based suggestions
    if (browsingHistory.some(id => id.includes('restaurant'))) {
      suggestions.add('ресторан');
      suggestions.add('доставка еды');
    }
    if (browsingHistory.some(id => id.includes('fitness'))) {
      suggestions.add('фитнес');
      suggestions.add('тренировки');
    }
    if (browsingHistory.some(id => id.includes('store'))) {
      suggestions.add('магазин');
      suggestions.add('одежда');
    }
    
    return Array.from(suggestions).slice(0, 5);
  };

  return {
    personalizedApps: generateRecommendations(),
    suggestedFeatures: ['Персонализация', 'AI помощник', 'Умный поиск'],
    searchSuggestions: generateSearchSuggestions(),
    loading: isLoading
  };
}

// Hook to track user interactions
export function useTrackInteraction() {
  return (appId: string, action: 'view' | 'click' | 'favorite') => {
    try {
      const stored = localStorage.getItem('ai_user_profile');
      const profile: UserProfile = stored ? JSON.parse(stored) : {
        interests: [],
        browsingHistory: [],
        interactions: []
      };
      
      // Add interaction
      profile.interactions.push({
        appId,
        action,
        timestamp: Date.now()
      });
      
      // Update browsing history
      if (!profile.browsingHistory.includes(appId)) {
        profile.browsingHistory.push(appId);
      }
      
      // Keep only last 50 interactions
      if (profile.interactions.length > 50) {
        profile.interactions = profile.interactions.slice(-50);
      }
      
      // Keep only last 20 items in history
      if (profile.browsingHistory.length > 20) {
        profile.browsingHistory = profile.browsingHistory.slice(-20);
      }
      
      localStorage.setItem('ai_user_profile', JSON.stringify(profile));
      
      // Emit custom event to trigger re-renders
      window.dispatchEvent(new CustomEvent('ai_profile_update'));
    } catch (error) {
      console.error('Failed to track interaction:', error);
    }
  };
}
```

### hooks/useBackButton.ts
```tsx
import { useEffect } from 'react';
import WebApp from '@twa-dev/sdk';
import { useLocation } from 'wouter';

export function useBackButton() {
  const [location, setLocation] = useLocation();
  
  useEffect(() => {
    if (location !== '/') {
      WebApp.BackButton.show();
    } else {
      WebApp.BackButton.hide();
    }
    
    const handleBack = () => {
      window.history.back();
    };
    
    WebApp.BackButton.onClick(handleBack);
    
    return () => {
      WebApp.BackButton.offClick(handleBack);
      WebApp.BackButton.hide();
    };
  }, [location]);
}
```

### hooks/useCart.ts
```tsx
import { useState, useCallback } from 'react';

export interface CartItem {
  id: string;
  name: string;
  price: number;
  quantity: number;
  image?: string;
  [key: string]: any;
}

export function useCart() {
  const [cartItems, setCartItems] = useState<CartItem[]>([]);

  const addToCart = useCallback((item: Omit<CartItem, 'quantity'>) => {
    setCartItems(prev => {
      const existing = prev.find(i => i.id === item.id);
      if (existing) {
        return prev.map(i => 
          i.id === item.id 
            ? { ...i, quantity: i.quantity + 1 } as CartItem
            : i
        );
      }
      return [...prev, { ...item, quantity: 1 } as CartItem];
    });
  }, []);

  const updateQuantity = useCallback((id: string, quantity: number) => {
    if (quantity <= 0) {
      setCartItems(prev => prev.filter(item => item.id !== id));
    } else {
      setCartItems(prev => prev.map(item => 
        item.id === id ? { ...item, quantity } : item
      ));
    }
  }, []);

  const removeFromCart = useCallback((id: string) => {
    setCartItems(prev => prev.filter(item => item.id !== id));
  }, []);

  const clearCart = useCallback(() => {
    setCartItems([]);
  }, []);

  const totalAmount = cartItems.reduce(
    (sum, item) => sum + item.price * item.quantity, 
    0
  );

  const totalItems = cartItems.reduce(
    (sum, item) => sum + item.quantity, 
    0
  );

  return {
    cartItems,
    addToCart,
    updateQuantity,
    removeFromCart,
    clearCart,
    totalAmount,
    totalItems
  };
}
```

### hooks/useCleanup.ts
```tsx
import { useEffect, useRef } from 'react';

export function useEventListener<K extends keyof WindowEventMap>(
  eventName: K,
  handler: (event: WindowEventMap[K]) => void,
  options?: AddEventListenerOptions
) {
  const savedHandler = useRef(handler);
  
  useEffect(() => {
    savedHandler.current = handler;
  }, [handler]);
  
  useEffect(() => {
    const eventListener = (event: WindowEventMap[K]) => savedHandler.current(event);
    
    window.addEventListener(eventName, eventListener, options);
    
    return () => {
      window.removeEventListener(eventName, eventListener, options);
    };
  }, [eventName, options]);
}

export function useTimeout(callback: () => void, delay: number | null) {
  const savedCallback = useRef(callback);
  
  useEffect(() => {
    savedCallback.current = callback;
  }, [callback]);
  
  useEffect(() => {
    if (delay === null) return;
    
    const id = setTimeout(() => savedCallback.current(), delay);
    
    return () => clearTimeout(id);
  }, [delay]);
}

export function useInterval(callback: () => void, delay: number | null) {
  const savedCallback = useRef(callback);
  
  useEffect(() => {
    savedCallback.current = callback;
  }, [callback]);
  
  useEffect(() => {
    if (delay === null) return;
    
    const id = setInterval(() => savedCallback.current(), delay);
    
    return () => clearInterval(id);
  }, [delay]);
}

export function useUnmountEffect(effect: () => void) {
  useEffect(() => {
    return effect;
  }, []);
}
```

### hooks/useFavorites.ts
```tsx
import { useState, useCallback } from 'react';

export function useFavorites<T extends { id: string }>(initialFavorites: string[] = []) {
  const [favorites, setFavorites] = useState<string[]>(initialFavorites);

  const toggleFavorite = useCallback((id: string) => {
    setFavorites(prev => 
      prev.includes(id) 
        ? prev.filter(favId => favId !== id)
        : [...prev, id]
    );
  }, []);

  const isFavorite = useCallback((id: string) => {
    return favorites.includes(id);
  }, [favorites]);

  const clearFavorites = useCallback(() => {
    setFavorites([]);
  }, []);

  return {
    favorites,
    toggleFavorite,
    isFavorite,
    clearFavorites,
    favoritesCount: favorites.length
  };
}
```

### hooks/useFilter.ts
```tsx
import { useState, useMemo, useCallback } from 'react';

interface UseFilterOptions<T> {
  items: T[];
  searchFields?: (keyof T)[];
  categoryField?: keyof T;
}

export function useFilter<T extends Record<string, any>>({ 
  items, 
  searchFields = [], 
  categoryField 
}: UseFilterOptions<T>) {
  const [searchQuery, setSearchQuery] = useState('');
  const [selectedCategory, setSelectedCategory] = useState<string>('all');

  const filteredItems = useMemo(() => {
    return items.filter(item => {
      // Category filter
      const categoryMatch = !categoryField || 
        selectedCategory === 'all' || 
        item[categoryField] === selectedCategory;

      // Search filter
      const searchMatch = searchQuery === '' || 
        searchFields.some(field => {
          const value = item[field];
          if (typeof value === 'string') {
            return value.toLowerCase().includes(searchQuery.toLowerCase());
          }
          return false;
        });

      return categoryMatch && searchMatch;
    });
  }, [items, searchQuery, selectedCategory, searchFields, categoryField]);

  const handleSearch = useCallback((query: string) => {
    setSearchQuery(query);
  }, []);

  const handleCategoryChange = useCallback((category: string) => {
    setSelectedCategory(category);
  }, []);

  const resetFilters = useCallback(() => {
    setSearchQuery('');
    setSelectedCategory('all');
  }, []);

  return {
    filteredItems,
    searchQuery,
    selectedCategory,
    handleSearch,
    handleCategoryChange,
    resetFilters
  };
}
```

### hooks/useGamification.ts
```tsx
import { useState, useEffect } from 'react';

export interface Achievement {
  id: string;
  name: string;
  description: string;
  level: 'Bronze' | 'Silver' | 'Gold' | 'Platinum';
  progress: number;
  maxProgress: number;
  reward: string;
  unlocked: boolean;
  icon: string;
}

export interface DailyTask {
  id: string;
  name: string;
  description: string;
  xp: number;
  completed: boolean;
  progress: number;
  maxProgress: number;
}

export interface UserStats {
  level: number;
  xp: number;
  xpToNextLevel: number;
  totalXp: number;
  streak: {
    current: number;
    best: number;
    lastVisit: string;
  };
  achievements: Achievement[];
  completedTasks: number;
}

interface GamificationData {
  stats: UserStats;
  dailyTasks: DailyTask[];
  leaderboard: {
    position: number;
    totalUsers: number;
    nearbyUsers: Array<{
      rank: number;
      name: string;
      level: number;
      xp: number;
    }>;
  };
}

// Factory functions to create fresh copies (avoid shared mutable state)
function createDefaultAchievements(): Achievement[] {
  return [
    {
      id: 'explorer-bronze',
      name: 'Исследователь',
      description: 'Просмотрите 3 демо-приложения',
      level: 'Bronze',
      progress: 0,
      maxProgress: 3,
      reward: '50 XP бонус',
      unlocked: false,
      icon: 'compass'
    },
    {
      id: 'explorer-silver',
      name: 'Опытный исследователь',
      description: 'Просмотрите 10 демо-приложений',
      level: 'Silver',
      progress: 0,
      maxProgress: 10,
      reward: '200 XP бонус',
      unlocked: false,
      icon: 'telescope'
    },
    {
      id: 'early-adopter',
      name: 'Ранний пользователь',
      description: 'Откройте приложение в первый раз',
      level: 'Gold',
      progress: 1,
      maxProgress: 1,
      reward: '100 XP бонус',
      unlocked: true,
      icon: 'star'
    },
    {
      id: 'streak-master',
      name: 'Мастер регулярности',
      description: 'Посещайте приложение 7 дней подряд',
      level: 'Platinum',
      progress: 0,
      maxProgress: 7,
      reward: 'VIP статус на месяц',
      unlocked: false,
      icon: 'flame'
    },
    {
      id: 'constructor-novice',
      name: 'Архитектор',
      description: 'Создайте свой первый проект',
      level: 'Bronze',
      progress: 0,
      maxProgress: 1,
      reward: '75 XP бонус',
      unlocked: false,
      icon: 'wrench'
    },
    {
      id: 'feature-master',
      name: 'Эксперт функций',
      description: 'Добавьте 5+ функций в проект',
      level: 'Silver',
      progress: 0,
      maxProgress: 5,
      reward: '150 XP бонус',
      unlocked: false,
      icon: 'layers'
    },
    {
      id: 'order-placed',
      name: 'Решительный',
      description: 'Оформите первый заказ',
      level: 'Gold',
      progress: 0,
      maxProgress: 1,
      reward: '300 XP бонус',
      unlocked: false,
      icon: 'rocket'
    },
    {
      id: 'xp-collector',
      name: 'Коллекционер опыта',
      description: 'Наберите 1000 XP',
      level: 'Platinum',
      progress: 0,
      maxProgress: 1000,
      reward: 'Эксклюзивный бейдж',
      unlocked: false,
      icon: 'zap'
    }
  ];
}

function createDefaultDailyTasks(): DailyTask[] {
  return [
  {
    id: 'view-demos',
    name: 'Просмотрите 3 демо',
    description: 'Изучите минимум 3 демо-приложения',
    xp: 50,
    completed: false,
    progress: 0,
    maxProgress: 3
  },
  {
    id: 'customize-project',
    name: 'Настройте проект',
    description: 'Откройте конструктор и настройте проект',
    xp: 100,
    completed: false,
    progress: 0,
    maxProgress: 1
  },
  {
    id: 'share',
    name: 'Поделитесь с другом',
    description: 'Отправьте ссылку другу',
    xp: 150,
    completed: false,
    progress: 0,
    maxProgress: 1
  }
];
}

function calculateLevel(totalXp: number): number {
  // XP required for each level: level^2 * 100
  let level = 1;
  while (totalXp >= level * level * 100) {
    totalXp -= level * level * 100;
    level++;
  }
  return level;
}

function xpForNextLevel(level: number): number {
  return level * level * 100;
}

export function useGamification(): GamificationData {
  const [stats, setStats] = useState<UserStats>(() => {
    try {
      const stored = localStorage.getItem('gamification_stats');
      if (stored) {
        return JSON.parse(stored);
      }
    } catch (error) {
      console.error('Failed to load gamification stats:', error);
    }
    
    // Default stats with fresh copies
    return {
      level: 1,
      xp: 0,
      xpToNextLevel: 100,
      totalXp: 0,
      streak: {
        current: 1,
        best: 1,
        lastVisit: new Date().toISOString().split('T')[0]
      },
      achievements: createDefaultAchievements(),
      completedTasks: 0
    };
  });

  const [dailyTasks, setDailyTasks] = useState<DailyTask[]>(() => {
    const today = new Date().toISOString().split('T')[0];
    
    try {
      const stored = localStorage.getItem('daily_tasks');
      const lastReset = localStorage.getItem('daily_tasks_reset');
      
      // Reset daily tasks if it's a new day
      if (lastReset !== today) {
        localStorage.setItem('daily_tasks_reset', today);
        return createDefaultDailyTasks();
      }
      
      if (stored) {
        return JSON.parse(stored);
      }
    } catch (error) {
      console.error('Failed to load daily tasks:', error);
    }
    
    return createDefaultDailyTasks();
  });

  // Update streak
  useEffect(() => {
    const today = new Date().toISOString().split('T')[0];
    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
    
    if (stats.streak.lastVisit === yesterday) {
      // Continue streak
      setStats(prev => ({
        ...prev,
        streak: {
          current: prev.streak.current + 1,
          best: Math.max(prev.streak.best, prev.streak.current + 1),
          lastVisit: today
        }
      }));
    } else if (stats.streak.lastVisit !== today) {
      // Reset streak
      setStats(prev => ({
        ...prev,
        streak: {
          ...prev.streak,
          current: 1,
          lastVisit: today
        }
      }));
    }
  }, []);

  // Save to localStorage
  useEffect(() => {
    localStorage.setItem('gamification_stats', JSON.stringify(stats));
  }, [stats]);

  useEffect(() => {
    localStorage.setItem('daily_tasks', JSON.stringify(dailyTasks));
  }, [dailyTasks]);

  return {
    stats,
    dailyTasks,
    leaderboard: {
      position: Math.floor(Math.random() * 1000) + 1,
      totalUsers: 5000,
      nearbyUsers: [
        { rank: 141, name: 'Александр П.', level: 12, xp: 14400 },
        { rank: 142, name: 'Вы', level: stats.level, xp: stats.totalXp },
        { rank: 143, name: 'Мария С.', level: 11, xp: 12100 },
        { rank: 144, name: 'Дмитрий К.', level: 11, xp: 12000 },
        { rank: 145, name: 'Елена В.', level: 10, xp: 10000 }
      ]
    }
  };
}

export function useAwardXP() {
  return (xpAmount: number) => {
    const stored = localStorage.getItem('gamification_stats');
    if (!stored) return;
    
    const stats: UserStats = JSON.parse(stored);
    const newTotalXp = stats.totalXp + xpAmount;
    const newLevel = calculateLevel(newTotalXp);
    const xpInCurrentLevel = newTotalXp - (newLevel - 1) * (newLevel - 1) * 100;
    const xpNeeded = xpForNextLevel(newLevel);
    
    const updatedStats = {
      ...stats,
      level: newLevel,
      xp: xpInCurrentLevel,
      xpToNextLevel: xpNeeded,
      totalXp: newTotalXp
    };
    
    localStorage.setItem('gamification_stats', JSON.stringify(updatedStats));
    
    // Trigger storage event for other components
    window.dispatchEvent(new Event('gamification_update'));
  };
}

export function useCompleteTask() {
  return (taskId: string) => {
    const stored = localStorage.getItem('daily_tasks');
    if (!stored) return;
    
    const tasks: DailyTask[] = JSON.parse(stored);
    const task = tasks.find(t => t.id === taskId);
    
    if (task && !task.completed) {
      task.completed = true;
      task.progress = task.maxProgress;
      
      localStorage.setItem('daily_tasks', JSON.stringify(tasks));
      
      // Award XP
      const awardXP = useAwardXP();
      awardXP(task.xp);
      
      // Trigger update
      window.dispatchEvent(new Event('gamification_update'));
    }
  };
}

// Track demo view for achievements
export function trackDemoView() {
  const statsStr = localStorage.getItem('gamification_stats');
  if (!statsStr) return;
  
  const stats: UserStats = JSON.parse(statsStr);
  const achievements = stats.achievements;
  
  // Update explorer achievements
  const explorerBronze = achievements.find(a => a.id === 'explorer-bronze');
  const explorerSilver = achievements.find(a => a.id === 'explorer-silver');
  
  let updated = false;
  let unlockedAchievements: Achievement[] = [];
  
  if (explorerBronze && explorerBronze.progress < explorerBronze.maxProgress) {
    explorerBronze.progress++;
    if (explorerBronze.progress >= explorerBronze.maxProgress && !explorerBronze.unlocked) {
      explorerBronze.unlocked = true;
      unlockedAchievements.push(explorerBronze);
      const awardXP = useAwardXP();
      awardXP(50); // Award bonus XP
    }
    updated = true;
  }
  
  if (explorerSilver && explorerSilver.progress < explorerSilver.maxProgress) {
    explorerSilver.progress++;
    if (explorerSilver.progress >= explorerSilver.maxProgress && !explorerSilver.unlocked) {
      explorerSilver.unlocked = true;
      unlockedAchievements.push(explorerSilver);
      const awardXP = useAwardXP();
      awardXP(200); // Award bonus XP
    }
    updated = true;
  }
  
  if (updated) {
    localStorage.setItem('gamification_stats', JSON.stringify(stats));
    window.dispatchEvent(new CustomEvent('gamification_update', { 
      detail: { unlockedAchievements } 
    }));
  }
}

// Track project creation
export function trackProjectCreation() {
  const statsStr = localStorage.getItem('gamification_stats');
  if (!statsStr) return;
  
  const stats: UserStats = JSON.parse(statsStr);
  const achievement = stats.achievements.find(a => a.id === 'constructor-novice');
  
  if (achievement && !achievement.unlocked) {
    achievement.progress = 1;
    achievement.unlocked = true;
    
    localStorage.setItem('gamification_stats', JSON.stringify(stats));
    const awardXP = useAwardXP();
    awardXP(75 + 50); // Base XP + bonus
    
    window.dispatchEvent(new CustomEvent('gamification_update', { 
      detail: { unlockedAchievements: [achievement] } 
    }));
  }
}

// Track feature selection
export function trackFeatureAdded() {
  const statsStr = localStorage.getItem('gamification_stats');
  if (!statsStr) return;
  
  const stats: UserStats = JSON.parse(statsStr);
  const achievement = stats.achievements.find(a => a.id === 'feature-master');
  
  if (achievement && achievement.progress < achievement.maxProgress) {
    achievement.progress++;
    
    if (achievement.progress >= achievement.maxProgress && !achievement.unlocked) {
      achievement.unlocked = true;
      localStorage.setItem('gamification_stats', JSON.stringify(stats));
      const awardXP = useAwardXP();
      awardXP(150); // Award bonus XP
      
      window.dispatchEvent(new CustomEvent('gamification_update', { 
        detail: { unlockedAchievements: [achievement] } 
      }));
    } else {
      localStorage.setItem('gamification_stats', JSON.stringify(stats));
      window.dispatchEvent(new Event('gamification_update'));
    }
  }
}

// Track order placement
export function trackOrderPlaced() {
  const statsStr = localStorage.getItem('gamification_stats');
  if (!statsStr) return;
  
  const stats: UserStats = JSON.parse(statsStr);
  const achievement = stats.achievements.find(a => a.id === 'order-placed');
  
  if (achievement && !achievement.unlocked) {
    achievement.progress = 1;
    achievement.unlocked = true;
    
    localStorage.setItem('gamification_stats', JSON.stringify(stats));
    const awardXP = useAwardXP();
    awardXP(300 + 200); // Base XP + bonus
    
    window.dispatchEvent(new CustomEvent('gamification_update', { 
      detail: { unlockedAchievements: [achievement] } 
    }));
  }
}
```

### hooks/useHapticManager.ts
```tsx
import { useCallback, useEffect, useState } from 'react';
import { useTelegram } from './useTelegram';

interface HapticManagerConfig {
  enabled: boolean;
  soundEnabled: boolean;
  visualEnabled: boolean;
  intensity: 'light' | 'medium' | 'heavy';
}

const defaultConfig: HapticManagerConfig = {
  enabled: true,
  soundEnabled: true,
  visualEnabled: true,
  intensity: 'medium'
};

export const useHapticManager = (config: Partial<HapticManagerConfig> = {}) => {
  const { hapticFeedback, isAvailable } = useTelegram();
  const [settings, setSettings] = useState<HapticManagerConfig>({
    ...defaultConfig,
    ...config
  });
  
  // Load settings from localStorage
  useEffect(() => {
    const saved = localStorage.getItem('haptic-settings');
    if (saved) {
      try {
        setSettings({ ...defaultConfig, ...JSON.parse(saved) });
      } catch (error) {
        console.error('[Haptic Manager] Failed to load settings:', error);
      }
    }
  }, []);
  
  // Save settings to localStorage
  const updateSettings = useCallback((newSettings: Partial<HapticManagerConfig>) => {
    setSettings(prev => {
      const updated = { ...prev, ...newSettings };
      localStorage.setItem('haptic-settings', JSON.stringify(updated));
      return updated;
    });
  }, []);
  
  // Play haptic feedback with optional sound and visual
  const trigger = useCallback((
    type: 'light' | 'medium' | 'heavy' | 'selection' = 'medium',
    options: { sound?: boolean; visual?: boolean } = {}
  ) => {
    if (!settings.enabled) return;
    
    // Haptic feedback
    if (isAvailable && hapticFeedback[type]) {
      hapticFeedback[type]();
    } else {
      // Fallback for non-Telegram environments (browser vibration)
      if (typeof navigator !== 'undefined' && 'vibrate' in navigator) {
        const patterns = {
          light: 10,
          medium: 20,
          heavy: 50,
          selection: 5
        };
        navigator.vibrate(patterns[type]);
      }
    }
    
    // Sound feedback
    if ((options.sound ?? settings.soundEnabled) && typeof Audio !== 'undefined') {
      const sounds = {
        light: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi78OWeSwkPU6bn77RgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSA==',
        medium: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi78OWeSwkPU6bn77RgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSA==',
        heavy: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi78OWeSwkPU6bn77RgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSA==',
        selection: 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGWi78OWeSwkPU6bn77RgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSKLh8r9pHQUsgs/y2Ik3CBlouu3mnUwJDlSm5/G1YRoFO5PZ88x6KgQlecXv3o0+CRJcserrq1IUCkii4fK/aR0FLIHO8tmJNwgZaLrw5Z5MCQ5Upufxs2AaBTuT2fPMeioEJXnF796NPgkSXLHq66tSFApIouHyv2kdBSyBzvLZiTcIGWi68OWeSwkPU6bn8bVgGgU7k9r0y3kpBCR1xe/fjj8JE12y5uurUxMKSA=='
      };
      
      try {
        const audio = new Audio(sounds[type]);
        audio.volume = 0.3;
        audio.play().catch(() => {}); // Ignore errors
      } catch (error) {
        // Silently fail
      }
    }
    
    // Visual feedback
    if ((options.visual ?? settings.visualEnabled) && typeof document !== 'undefined') {
      const pulse = document.createElement('div');
      pulse.className = 'haptic-pulse';
      pulse.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        width: 100px;
        height: 100px;
        margin: -50px 0 0 -50px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(16, 185, 129, 0.3) 0%, transparent 70%);
        pointer-events: none;
        z-index: 9999;
        animation: haptic-pulse 0.6s ease-out;
      `;
      
      document.body.appendChild(pulse);
      setTimeout(() => pulse.remove(), 600);
    }
  }, [settings, isAvailable, hapticFeedback]);
  
  return {
    trigger,
    settings,
    updateSettings,
    isAvailable
  };
};

// Add CSS animation
if (typeof document !== 'undefined') {
  const style = document.createElement('style');
  style.textContent = `
    @keyframes haptic-pulse {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(2);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(style);
}
```

### hooks/useHaptic.ts
```tsx
import { useCallback } from 'react';
import { haptic } from '@/lib/telegram';

export function useHaptic() {
  const light = useCallback(() => {
    haptic.light();
  }, []);
  
  const medium = useCallback(() => {
    haptic.medium();
  }, []);
  
  const heavy = useCallback(() => {
    haptic.heavy();
  }, []);
  
  const success = useCallback(() => {
    haptic.success();
  }, []);
  
  const error = useCallback(() => {
    haptic.error();
  }, []);
  
  const warning = useCallback(() => {
    haptic.warning();
  }, []);
  
  const selection = useCallback(() => {
    haptic.selection();
  }, []);
  
  return {
    light,
    medium,
    heavy,
    success,
    error,
    warning,
    selection
  };
}
```

### hooks/useImagePreloader.ts
```tsx
import { useEffect } from 'react';

interface PreloadOptions {
  images: string[];
  priority?: boolean;
}

export function useImagePreloader({ images, priority = true }: PreloadOptions) {
  useEffect(() => {
    if (!images || images.length === 0) return;

    // Optimize Unsplash URLs
    const optimizeUrl = (url: string): string => {
      if (url.includes('images.unsplash.com')) {
        const urlObj = new URL(url);
        urlObj.searchParams.set('auto', 'format,compress');
        urlObj.searchParams.set('q', '75');
        urlObj.searchParams.set('fm', 'webp');
        return urlObj.toString();
      }
      return url;
    };

    // Preload images using link tags for highest priority
    const linkElements: HTMLLinkElement[] = [];

    images.forEach((src) => {
      const optimizedSrc = optimizeUrl(src);
      
      // Use link preload for critical images
      const link = document.createElement('link');
      link.rel = 'preload';
      link.as = 'image';
      link.href = optimizedSrc;
      if (priority) {
        link.setAttribute('fetchpriority', 'high');
      }
      
      document.head.appendChild(link);
      linkElements.push(link);

      // Also create img element for browser cache
      const img = new Image();
      img.src = optimizedSrc;
      img.decoding = 'async';
    });

    // Cleanup
    return () => {
      linkElements.forEach(link => {
        if (link.parentNode) {
          link.parentNode.removeChild(link);
        }
      });
    };
  }, [images, priority]);
}

export default useImagePreloader;
```

### hooks/useLazyVideo.ts
```tsx
import { useEffect, useRef, useState } from 'react';

export function useLazyVideo(threshold = 0.1) {
  const videoRef = useRef<HTMLVideoElement>(null);
  const [isLoaded, setIsLoaded] = useState(false);
  const [isInView, setIsInView] = useState(false);

  useEffect(() => {
    const video = videoRef.current;
    if (!video) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting && !isLoaded) {
            const sources = video.querySelectorAll('source[data-src]');
            sources.forEach((source) => {
              const htmlSource = source as HTMLSourceElement;
              htmlSource.src = htmlSource.dataset.src || '';
            });
            
            video.load();
            setIsLoaded(true);
            setIsInView(true);
          } else if (!entry.isIntersecting) {
            setIsInView(false);
          }
        });
      },
      {
        rootMargin: '100px',
        threshold
      }
    );

    observer.observe(video);

    return () => {
      observer.disconnect();
    };
  }, [threshold, isLoaded]);

  return { videoRef, isLoaded, isInView };
}
```

### hooks/useModal.ts
```tsx
import { useState, useCallback } from 'react';

export function useModal<T = any>() {
  const [isOpen, setIsOpen] = useState(false);
  const [data, setData] = useState<T | null>(null);

  const open = useCallback((modalData?: T) => {
    if (modalData !== undefined) {
      setData(modalData);
    }
    setIsOpen(true);
  }, []);

  const close = useCallback(() => {
    setIsOpen(false);
    setData(null);
  }, []);

  const toggle = useCallback(() => {
    setIsOpen(prev => !prev);
  }, []);

  return {
    isOpen,
    data,
    open,
    close,
    toggle
  };
}
```

### hooks/usePersistentCart.ts
```tsx
import { useState, useCallback, useEffect } from 'react';

export interface CartItem {
  id: string;
  name: string;
  price: number;
  quantity: number;
  image?: string;
  size?: string;
  color?: string;
  [key: string]: any;
}

interface UsePersistentCartOptions {
  storageKey: string;
  maxItems?: number;
}

export function usePersistentCart({ storageKey, maxItems = 99 }: UsePersistentCartOptions) {
  const [cartItems, setCartItems] = useState<CartItem[]>(() => {
    try {
      const stored = localStorage.getItem(storageKey);
      return stored ? JSON.parse(stored) : [];
    } catch {
      return [];
    }
  });

  const [isHydrated, setIsHydrated] = useState(false);

  useEffect(() => {
    setIsHydrated(true);
  }, []);

  useEffect(() => {
    if (isHydrated) {
      try {
        localStorage.setItem(storageKey, JSON.stringify(cartItems));
      } catch (e) {
        console.warn('Failed to persist cart:', e);
      }
    }
  }, [cartItems, storageKey, isHydrated]);

  const addToCart = useCallback((item: Omit<CartItem, 'quantity'> & { quantity?: number }) => {
    setCartItems(prev => {
      const itemKey = `${item.id}-${item.size || ''}-${item.color || ''}`;
      const existing = prev.find(i => 
        `${i.id}-${i.size || ''}-${i.color || ''}` === itemKey
      );
      
      if (existing) {
        return prev.map((i): CartItem => 
          `${i.id}-${i.size || ''}-${i.color || ''}` === itemKey
            ? { ...i, quantity: Math.min(i.quantity + (item.quantity || 1), maxItems) }
            : i
        );
      }
      
      if (prev.length >= maxItems) {
        return prev;
      }
      
      return [...prev, { ...item, quantity: item.quantity || 1 } as CartItem];
    });
  }, [maxItems]);

  const updateQuantity = useCallback((id: string, quantity: number, size?: string, color?: string) => {
    const itemKey = `${id}-${size || ''}-${color || ''}`;
    
    if (quantity <= 0) {
      setCartItems(prev => prev.filter(item => 
        `${item.id}-${item.size || ''}-${item.color || ''}` !== itemKey
      ));
    } else {
      setCartItems(prev => prev.map(item => 
        `${item.id}-${item.size || ''}-${item.color || ''}` === itemKey
          ? { ...item, quantity: Math.min(quantity, maxItems) }
          : item
      ));
    }
  }, [maxItems]);

  const removeFromCart = useCallback((id: string, size?: string, color?: string) => {
    const itemKey = `${id}-${size || ''}-${color || ''}`;
    setCartItems(prev => prev.filter(item => 
      `${item.id}-${item.size || ''}-${item.color || ''}` !== itemKey
    ));
  }, []);

  const clearCart = useCallback(() => {
    setCartItems([]);
  }, []);

  const getItemQuantity = useCallback((id: string, size?: string, color?: string) => {
    const itemKey = `${id}-${size || ''}-${color || ''}`;
    const item = cartItems.find(i => 
      `${i.id}-${i.size || ''}-${i.color || ''}` === itemKey
    );
    return item?.quantity || 0;
  }, [cartItems]);

  const totalAmount = cartItems.reduce(
    (sum, item) => sum + item.price * item.quantity, 
    0
  );

  const totalItems = cartItems.reduce(
    (sum, item) => sum + item.quantity, 
    0
  );

  return {
    cartItems,
    addToCart,
    updateQuantity,
    removeFromCart,
    clearCart,
    getItemQuantity,
    totalAmount,
    totalItems,
    isHydrated
  };
}
```

### hooks/usePersistentFavorites.ts
```tsx
import { useState, useCallback, useEffect } from 'react';

interface UsePersistentFavoritesOptions {
  storageKey: string;
}

export function usePersistentFavorites({ storageKey }: UsePersistentFavoritesOptions) {
  const [favorites, setFavorites] = useState<Set<string>>(() => {
    try {
      const stored = localStorage.getItem(storageKey);
      return stored ? new Set(JSON.parse(stored)) : new Set();
    } catch {
      return new Set();
    }
  });

  const [isHydrated, setIsHydrated] = useState(false);

  useEffect(() => {
    setIsHydrated(true);
  }, []);

  useEffect(() => {
    if (isHydrated) {
      try {
        localStorage.setItem(storageKey, JSON.stringify(Array.from(favorites)));
      } catch (e) {
        console.warn('Failed to persist favorites:', e);
      }
    }
  }, [favorites, storageKey, isHydrated]);

  const toggleFavorite = useCallback((id: string | number) => {
    const strId = String(id);
    setFavorites(prev => {
      const next = new Set(prev);
      if (next.has(strId)) {
        next.delete(strId);
      } else {
        next.add(strId);
      }
      return next;
    });
  }, []);

  const isFavorite = useCallback((id: string | number) => {
    return favorites.has(String(id));
  }, [favorites]);

  const addFavorite = useCallback((id: string | number) => {
    setFavorites(prev => new Set([...Array.from(prev), String(id)]));
  }, []);

  const removeFavorite = useCallback((id: string | number) => {
    setFavorites(prev => {
      const next = new Set(prev);
      next.delete(String(id));
      return next;
    });
  }, []);

  const clearFavorites = useCallback(() => {
    setFavorites(new Set());
  }, []);

  return {
    favorites,
    favoritesArray: Array.from(favorites),
    toggleFavorite,
    isFavorite,
    addFavorite,
    removeFavorite,
    clearFavorites,
    favoritesCount: favorites.size,
    isHydrated
  };
}
```

### hooks/usePersistentOrders.ts
```tsx
import { useState, useCallback, useEffect } from 'react';

export interface OrderItem {
  id: string;
  name: string;
  price: number;
  quantity: number;
  image?: string;
  size?: string;
  color?: string;
}

export interface Order {
  id: string;
  items: OrderItem[];
  total: number;
  status: 'pending' | 'confirmed' | 'processing' | 'shipped' | 'delivered';
  createdAt: string;
  address?: string;
  phone?: string;
}

interface UsePersistentOrdersOptions {
  storageKey: string;
  maxOrders?: number;
}

export function usePersistentOrders({ storageKey, maxOrders = 50 }: UsePersistentOrdersOptions) {
  const [orders, setOrders] = useState<Order[]>(() => {
    try {
      const stored = localStorage.getItem(storageKey);
      return stored ? JSON.parse(stored) : [];
    } catch {
      return [];
    }
  });

  const [isHydrated, setIsHydrated] = useState(false);

  useEffect(() => {
    setIsHydrated(true);
  }, []);

  useEffect(() => {
    if (isHydrated) {
      try {
        localStorage.setItem(storageKey, JSON.stringify(orders));
      } catch (e) {
        console.warn('Failed to persist orders:', e);
      }
    }
  }, [orders, storageKey, isHydrated]);

  const createOrder = useCallback((
    items: OrderItem[], 
    total: number, 
    details?: { address?: string; phone?: string }
  ): Order => {
    const newOrder: Order = {
      id: `ORD-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
      items,
      total,
      status: 'confirmed',
      createdAt: new Date().toISOString(),
      ...details
    };

    setOrders(prev => {
      const updated = [newOrder, ...prev];
      if (updated.length > maxOrders) {
        return updated.slice(0, maxOrders);
      }
      return updated;
    });

    return newOrder;
  }, [maxOrders]);

  const updateOrderStatus = useCallback((orderId: string, status: Order['status']) => {
    setOrders(prev => prev.map(order => 
      order.id === orderId ? { ...order, status } : order
    ));
  }, []);

  const getOrder = useCallback((orderId: string) => {
    return orders.find(order => order.id === orderId);
  }, [orders]);

  const getRecentOrders = useCallback((count: number = 5) => {
    return orders.slice(0, count);
  }, [orders]);

  const clearOrders = useCallback(() => {
    setOrders([]);
  }, []);

  return {
    orders,
    createOrder,
    updateOrderStatus,
    getOrder,
    getRecentOrders,
    clearOrders,
    ordersCount: orders.length,
    isHydrated
  };
}
```

### hooks/usePreloadImages.ts
```tsx
import { useEffect, useState } from 'react';

/**
 * Preload critical images before app renders
 * This significantly improves perceived performance
 * 
 * Usage:
 * const { isLoading } = usePreloadImages(['/hero.webp', '/logo.png']);
 */
export function usePreloadImages(imagePaths: string[]) {
  const [isLoading, setIsLoading] = useState(true);
  const [loadedCount, setLoadedCount] = useState(0);

  useEffect(() => {
    if (!imagePaths.length) {
      setIsLoading(false);
      return;
    }

    let mounted = true;
    let loaded = 0;
    const total = imagePaths.length;

    const loadImage = (src: string) => {
      return new Promise<void>((resolve) => {
        const img = new Image();
        
        img.onload = () => {
          if (mounted) {
            loaded++;
            setLoadedCount(loaded);
            if (loaded === total) {
              setIsLoading(false);
            }
          }
          resolve();
        };

        img.onerror = () => {
          console.warn(`[Preload] Failed to load image: ${src}`);
          if (mounted) {
            loaded++;
            setLoadedCount(loaded);
            if (loaded === total) {
              setIsLoading(false);
            }
          }
          resolve();
        };

        img.src = src;
      });
    };

    // Load all images in parallel
    Promise.all(imagePaths.map(loadImage)).then(() => {
      if (mounted) {
        console.log(`[Preload] All ${total} images loaded successfully`);
      }
    });

    return () => {
      mounted = false;
    };
  }, [imagePaths]);

  return {
    isLoading,
    loadedCount,
    total: imagePaths.length,
    progress: imagePaths.length > 0 ? (loadedCount / imagePaths.length) * 100 : 100,
  };
}
```

### hooks/usePullToRefresh.ts
```tsx
import { useEffect, useRef, useState } from 'react';

interface PullToRefreshOptions {
  onRefresh: () => Promise<void> | void;
  threshold?: number;
  maxPullDistance?: number;
  enabled?: boolean;
}

export function usePullToRefresh({
  onRefresh,
  threshold = 80,
  maxPullDistance = 120,
  enabled = true
}: PullToRefreshOptions) {
  const [pullDistance, setPullDistance] = useState(0);
  const [isRefreshing, setIsRefreshing] = useState(false);
  const startY = useRef(0);
  const containerRef = useRef<HTMLElement | null>(null);

  useEffect(() => {
    // Only activate on touch-capable devices
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
    
    if (!enabled || !isTouchDevice) {
      return;
    }

    const handleTouchStart = (e: TouchEvent) => {
      // Only activate pull-to-refresh when scrolled to top
      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      if (scrollTop === 0 && !isRefreshing) {
        startY.current = e.touches[0].clientY;
      }
    };

    const handleTouchMove = (e: TouchEvent) => {
      if (startY.current === 0 || isRefreshing) return;

      const currentY = e.touches[0].clientY;
      const distance = currentY - startY.current;

      // Only pull down and only prevent if actively pulling
      if (distance > threshold * 0.3) {
        // Only prevent default when actually engaging the gesture
        e.preventDefault();

        // Apply elastic resistance
        const elasticDistance = Math.min(
          distance * 0.5,
          maxPullDistance
        );
        setPullDistance(elasticDistance);
      }
    };

    const handleTouchEnd = async () => {
      if (pullDistance > threshold && !isRefreshing) {
        setIsRefreshing(true);
        setPullDistance(threshold); // Keep indicator visible during refresh

        // Haptic feedback
        if (window.navigator.vibrate) {
          window.navigator.vibrate(20);
        }

        try {
          await onRefresh();
        } finally {
          // Reset after refresh
          setTimeout(() => {
            setIsRefreshing(false);
            setPullDistance(0);
          }, 500);
        }
      } else {
        // Reset if didn't reach threshold
        setPullDistance(0);
      }

      startY.current = 0;
    };

    // Use passive listeners where possible
    document.addEventListener('touchstart', handleTouchStart, { passive: true });
    document.addEventListener('touchmove', handleTouchMove, { passive: false }); // Can't be passive - needs preventDefault
    document.addEventListener('touchend', handleTouchEnd, { passive: true });

    return () => {
      document.removeEventListener('touchstart', handleTouchStart);
      document.removeEventListener('touchmove', handleTouchMove);
      document.removeEventListener('touchend', handleTouchEnd);
    };
  }, [enabled, isRefreshing, pullDistance, threshold, maxPullDistance, onRefresh]);

  const progress = Math.min(pullDistance / threshold, 1);
  const shouldShowIndicator = pullDistance > 0 || isRefreshing;

  return {
    pullDistance,
    isRefreshing,
    progress,
    shouldShowIndicator,
    containerRef
  };
}
```

### hooks/useRecommendations.ts
```tsx
import { useState, useEffect, useCallback } from 'react';

interface UserBehavior {
  viewedDemos: string[];
  categoryPreferences: Record<string, number>;
  lastVisit: number;
  sessionCount: number;
}

interface RecommendationScore {
  id: string;
  score: number;
  reasons: string[];
}

const BEHAVIOR_KEY = 'web4tg_user_behavior';

// AI-powered recommendation algorithm
function calculateRecommendationScore(
  demo: any,
  behavior: UserBehavior
): RecommendationScore {
  let score = 0;
  const reasons: string[] = [];

  // 1. Category preference (40% weight)
  const categoryScore = behavior.categoryPreferences[demo.category] || 0;
  score += categoryScore * 0.4;
  if (categoryScore > 2) {
    reasons.push(`You frequently browse ${demo.category}`);
  }

  // 2. Recency bias - boost newer demos (20% weight)
  const demoIndex = parseInt(demo.id.split('-')[1] || '0');
  const recencyScore = Math.max(0, 30 - demoIndex) / 30;
  score += recencyScore * 0.2;

  // 3. Diversity bonus - recommend unviewed categories (20% weight)
  const isNewCategory = !behavior.viewedDemos.some(viewedId => {
    const viewedCategory = viewedId.split('-')[0];
    return viewedCategory === demo.category.toLowerCase().split(' ')[0];
  });
  if (isNewCategory) {
    score += 0.2;
    reasons.push('New category for you to explore');
  }

  // 4. Popularity boost for new users (10% weight)
  if (behavior.sessionCount < 3) {
    const popularDemos = ['clothing-store', 'electronics', 'beauty', 'fitness'];
    if (popularDemos.includes(demo.id)) {
      score += 0.1;
      reasons.push('Popular choice');
    }
  }

  // 5. Time-based patterns (10% weight)
  const now = Date.now();
  const hoursSinceLastVisit = (now - behavior.lastVisit) / (1000 * 60 * 60);
  if (hoursSinceLastVisit > 24) {
    score += 0.1;
    reasons.push('Recommended based on your return');
  }

  return {
    id: demo.id,
    score: Math.min(score, 1),
    reasons
  };
}

export function useRecommendations(demoApps: any[]) {
  const [behavior, setBehavior] = useState<UserBehavior>(() => {
    const stored = localStorage.getItem(BEHAVIOR_KEY);
    if (stored) {
      return JSON.parse(stored);
    }
    return {
      viewedDemos: [],
      categoryPreferences: {},
      lastVisit: Date.now(),
      sessionCount: 1
    };
  });

  const [recommendations, setRecommendations] = useState<RecommendationScore[]>([]);

  // Track demo view (stable reference)
  const trackDemoView = useCallback((demoId: string, category: string) => {
    // Update localStorage directly to avoid triggering re-renders
    const stored = localStorage.getItem(BEHAVIOR_KEY);
    if (stored) {
      const current = JSON.parse(stored);
      const newBehavior = {
        ...current,
        viewedDemos: [...new Set([...current.viewedDemos, demoId])],
        categoryPreferences: {
          ...current.categoryPreferences,
          [category]: (current.categoryPreferences[category] || 0) + 1
        },
        lastVisit: Date.now()
      };
      localStorage.setItem(BEHAVIOR_KEY, JSON.stringify(newBehavior));
      // Only update state after localStorage is updated
      setBehavior(newBehavior);
    }
  }, []);

  // Update session count on mount (only once)
  useEffect(() => {
    const updateSession = () => {
      const stored = localStorage.getItem(BEHAVIOR_KEY);
      if (stored) {
        const current = JSON.parse(stored);
        const newBehavior = {
          ...current,
          sessionCount: current.sessionCount + 1,
          lastVisit: Date.now()
        };
        localStorage.setItem(BEHAVIOR_KEY, JSON.stringify(newBehavior));
      }
    };
    updateSession();
  }, []);

  // Calculate recommendations
  useEffect(() => {
    if (!demoApps || demoApps.length === 0) return;

    const scored = demoApps
      .map(demo => calculateRecommendationScore(demo, behavior))
      .sort((a, b) => b.score - a.score);

    setRecommendations(scored);
  }, [demoApps, behavior]);

  // Get top N recommendations
  const getTopRecommendations = useCallback((count: number = 6) => {
    return recommendations.slice(0, count);
  }, [recommendations]);

  // Get personalized greeting
  const getPersonalizedGreeting = useCallback(() => {
    const { sessionCount, categoryPreferences } = behavior;
    
    if (sessionCount === 1) {
      return "Welcome! Explore our demo apps";
    }
    
    if (sessionCount < 5) {
      return "Welcome back! Continue exploring";
    }

    const topCategory = Object.entries(categoryPreferences)
      .sort(([, a], [, b]) => b - a)[0]?.[0];

    if (topCategory) {
      return `We found more ${topCategory} apps for you`;
    }

    return "Your personalized recommendations";
  }, [behavior]);

  return {
    recommendations,
    trackDemoView,
    getTopRecommendations,
    getPersonalizedGreeting,
    behavior
  };
}
```

### hooks/useScrollAnimation.ts
```tsx
import { useEffect, useState, useRef } from 'react';

export function useScrollAnimation() {
  const [isScrolling, setIsScrolling] = useState(false);
  
  useEffect(() => {
    let timeoutId: number;
    
    const handleScroll = () => {
      setIsScrolling(true);
      
      clearTimeout(timeoutId);
      timeoutId = window.setTimeout(() => {
        setIsScrolling(false);
      }, 150);
    };
    
    window.addEventListener('scroll', handleScroll, { passive: true });
    
    return () => {
      window.removeEventListener('scroll', handleScroll);
      clearTimeout(timeoutId);
    };
  }, []);
  
  return isScrolling;
}

export function useThrottle<T>(value: T, delay: number): T {
  const [throttledValue, setThrottledValue] = useState<T>(value);
  const lastRan = useRef(Date.now());
  
  useEffect(() => {
    const handler = setTimeout(() => {
      if (Date.now() - lastRan.current >= delay) {
        setThrottledValue(value);
        lastRan.current = Date.now();
      }
    }, delay - (Date.now() - lastRan.current));
    
    return () => clearTimeout(handler);
  }, [value, delay]);
  
  return throttledValue;
}
```

### hooks/useTelegram.ts
```tsx
import { useEffect, useState } from 'react';
import { ensureTelegramPolyfill } from '../lib/telegram';

// Telegram WebApp SDK types (complete as per official documentation + 2025 features)
interface SafeAreaInset {
  top: number;
  bottom: number;
  left: number;
  right: number;
}

interface TelegramWebApp {
  ready: () => void;
  expand: () => void;
  close: () => void;
  initData: string;
  colorScheme: 'light' | 'dark';
  themeParams: {
    bg_color?: string;
    text_color?: string;
    hint_color?: string;
    link_color?: string;
    button_color?: string;
    button_text_color?: string;
    secondary_bg_color?: string;
    header_bg_color?: string;
    section_bg_color?: string;
    section_header_text_color?: string;
    subtitle_text_color?: string;
    destructive_text_color?: string;
    accent_text_color?: string;
  };
  HapticFeedback: {
    impactOccurred: (style: 'light' | 'medium' | 'heavy') => void;
    selectionChanged: () => void;
  };
  BackButton: {
    isVisible: boolean;
    show: () => void;
    hide: () => void;
    onClick: (callback: () => void) => void;
    offClick: (callback: () => void) => void;
  };
  initDataUnsafe: {
    user?: {
      id: number;
      first_name: string;
      last_name?: string;
      username?: string;
      language_code?: string;
      photo_url?: string;
    };
  };
  onEvent: (eventType: string, callback: () => void) => void;
  offEvent: (eventType: string, callback: () => void) => void;
  
  // 2025 Full-Screen Mode API
  requestFullscreen: () => void;
  exitFullscreen: () => void;
  isFullscreen: boolean;
  
  // 2025 Safe Area API
  safeAreaInset: SafeAreaInset;
  contentSafeAreaInset: SafeAreaInset;
  
  // 2025 Home Screen Shortcuts API
  addToHomeScreen: () => void;
  checkHomeScreenStatus: (callback: (status: 'unsupported' | 'unknown' | 'added' | 'missed') => void) => void;
  
  // Version checking
  isVersionAtLeast: (version: string) => boolean;
  
  // Swipe behavior control (Bot API 7.7+)
  disableVerticalSwipes: () => void;
  enableVerticalSwipes: () => void;
}

declare global {
  interface Window {
    Telegram?: {
      WebApp: TelegramWebApp;
    };
  }
}

// Helper to apply Telegram theme colors to CSS custom properties
const applyTelegramTheme = (tg: TelegramWebApp) => {
  const root = document.documentElement;
  const isDark = tg.colorScheme === 'dark';
  
  // Neon accent colors for 2025 dark mode (adapt to light mode)
  root.style.setProperty('--tg-theme-accent', isDark ? '#00ffff' : '#0088cc'); // Cyan neon
  root.style.setProperty('--tg-theme-accent-2', isDark ? '#ff00ff' : '#cc0088'); // Magenta neon
  root.style.setProperty('--tg-theme-accent-3', isDark ? '#39ff14' : '#10B981'); // Neon green
  root.style.setProperty('--tg-theme-bg', tg.themeParams.bg_color || (isDark ? '#0A0A0A' : '#ffffff'));
  root.style.setProperty('--tg-theme-text', tg.themeParams.text_color || (isDark ? '#ffffff' : '#000000'));
  
  // Apply additional theme params if available
  if (tg.themeParams.button_color) {
    root.style.setProperty('--tg-theme-button', tg.themeParams.button_color);
  }
  if (tg.themeParams.section_bg_color) {
    root.style.setProperty('--tg-theme-section-bg', tg.themeParams.section_bg_color);
  }
};

// Helper to apply safe area padding dynamically (2025 API)
// Uses CSS variables for better performance and flexibility
const applySafeAreaPadding = (inset: SafeAreaInset) => {
  const root = document.documentElement;
  
  // Set CSS variables for safe area (can be used anywhere in CSS)
  root.style.setProperty('--tg-safe-area-top', `${inset.top}px`);
  root.style.setProperty('--tg-safe-area-bottom', `${inset.bottom}px`);
  root.style.setProperty('--tg-safe-area-left', `${inset.left}px`);
  root.style.setProperty('--tg-safe-area-right', `${inset.right}px`);
  
  // Apply to body for backwards compatibility
  const body = document.body;
  body.style.paddingTop = `${inset.top}px`;
  body.style.paddingBottom = `${inset.bottom}px`;
  body.style.paddingLeft = `${inset.left}px`;
  body.style.paddingRight = `${inset.right}px`;
  
  console.log('[2025 API] Applied safe area padding:', inset);
};

// Helper to reset safe area padding on cleanup
const resetSafeAreaPadding = () => {
  const body = document.body;
  body.style.paddingTop = '';
  body.style.paddingBottom = '';
  body.style.paddingLeft = '';
  body.style.paddingRight = '';
  console.log('[2025 API] Reset safe area padding');
};

// Helper to apply viewport height CSS variables
const applyViewportVariables = (tg: TelegramWebApp) => {
  const root = document.documentElement;
  
  // @ts-ignore - These properties exist on TelegramWebApp
  const viewportHeight = tg.viewportHeight || window.innerHeight;
  // @ts-ignore
  const viewportStableHeight = tg.viewportStableHeight || window.innerHeight;
  
  root.style.setProperty('--tg-viewport-height', `${viewportHeight}px`);
  root.style.setProperty('--tg-viewport-stable-height', `${viewportStableHeight}px`);
  
  // Also set to CSS viewport units for better compatibility
  root.style.setProperty('--vh', `${viewportHeight * 0.01}px`);
};

// Helper to detect device performance (for adaptive quality)
const detectDevicePerformance = (tg: TelegramWebApp): 'low' | 'medium' | 'high' => {
  // @ts-ignore
  const platform = tg.platform || 'unknown';
  
  // Check if mobile
  const isMobile = /android|ios|iphone|ipad/i.test(platform);
  
  // Basic performance detection based on hardware concurrency
  const cores = navigator.hardwareConcurrency || 2;
  const memory = (navigator as any).deviceMemory || 4; // GB
  
  if (!isMobile) return 'high'; // Desktop is always high
  if (cores >= 8 && memory >= 6) return 'high';
  if (cores >= 4 && memory >= 4) return 'medium';
  return 'low';
};

export function useTelegram() {
  const [webApp, setWebApp] = useState<TelegramWebApp | null>(null);
  const [user, setUser] = useState<any>(null);
  const [initData, setInitData] = useState<string>('');
  const [colorScheme, setColorScheme] = useState<'light' | 'dark'>('dark');
  const [themeParams, setThemeParams] = useState<TelegramWebApp['themeParams']>({});
  const [devicePerformance, setDevicePerformance] = useState<'low' | 'medium' | 'high'>('medium');
  
  // 2025 Features State
  const [isFullscreen, setIsFullscreen] = useState<boolean>(false);
  const [safeArea, setSafeArea] = useState<SafeAreaInset>({ top: 0, bottom: 0, left: 0, right: 0 });
  const [contentSafeArea, setContentSafeArea] = useState<SafeAreaInset>({ top: 0, bottom: 0, left: 0, right: 0 });
  const [homeScreenStatus, setHomeScreenStatus] = useState<'unsupported' | 'unknown' | 'added' | 'missed'>('unknown');

  useEffect(() => {
    if (window.Telegram?.WebApp) {
      // CRITICAL: Apply polyfill FIRST before using any methods
      ensureTelegramPolyfill();
      
      const tg = window.Telegram.WebApp;
      setWebApp(tg);
      setUser(tg.initDataUnsafe.user || null);
      setInitData(tg.initData || '');
      setColorScheme(tg.colorScheme || 'dark');
      setThemeParams(tg.themeParams || {});
      
      // Apply theme on initial load
      applyTelegramTheme(tg);
      
      // CRITICAL: Apply viewport height CSS variables
      applyViewportVariables(tg);
      
      // CRITICAL: Detect device performance for adaptive quality
      const performance = detectDevicePerformance(tg);
      setDevicePerformance(performance);
      console.log('[Performance] Device class:', performance);
      
      // Initialize fullscreen state (2025)
      if (typeof tg.isFullscreen !== 'undefined') {
        setIsFullscreen(tg.isFullscreen);
      }
      
      // Initialize Safe Area Insets (2025) - CRITICAL for native UI compatibility
      if (tg.safeAreaInset) {
        setSafeArea(tg.safeAreaInset);
        applySafeAreaPadding(tg.safeAreaInset);
      }
      
      // Initialize Content Safe Area Inset (2025)
      if (tg.contentSafeAreaInset) {
        setContentSafeArea(tg.contentSafeAreaInset);
      }
      
      // Listen for theme changes and reapply CSS variables
      const handleThemeChange = () => {
        setColorScheme(tg.colorScheme || 'dark');
        setThemeParams(tg.themeParams || {});
        // Critical: reapply theme CSS variables on change
        applyTelegramTheme(tg);
      };
      
      // Listen for fullscreen changes (2025)
      const handleFullscreenChange = () => {
        if (typeof tg.isFullscreen !== 'undefined') {
          setIsFullscreen(tg.isFullscreen);
          console.log('[2025 API] Fullscreen:', tg.isFullscreen);
        }
      };
      
      // Listen for home screen status changes (2025)
      const handleHomeScreenAdded = () => {
        setHomeScreenStatus('added');
        console.log('[2025 API] Home Screen: Added');
      };
      
      // Listen for safe area changes (2025) - rotation, viewport resize, etc.
      const handleSafeAreaChanged = () => {
        if (tg.safeAreaInset) {
          setSafeArea(tg.safeAreaInset);
          applySafeAreaPadding(tg.safeAreaInset);
          console.log('[2025 API] Safe Area Updated:', tg.safeAreaInset);
        }
        if (tg.contentSafeAreaInset) {
          setContentSafeArea(tg.contentSafeAreaInset);
        }
      };
      
      // Listen for viewport changes (2025) - may also affect safe area
      const handleViewportChanged = () => {
        if (tg.safeAreaInset) {
          setSafeArea(tg.safeAreaInset);
          applySafeAreaPadding(tg.safeAreaInset);
        }
        if (tg.contentSafeAreaInset) {
          setContentSafeArea(tg.contentSafeAreaInset);
        }
        // Update viewport height variables on viewport change
        applyViewportVariables(tg);
        console.log('[2025 API] Viewport Changed');
      };
      
      tg.onEvent('themeChanged', handleThemeChange);
      tg.onEvent('fullscreenChanged', handleFullscreenChange);
      tg.onEvent('homeScreenAdded', handleHomeScreenAdded);
      tg.onEvent('safeAreaChanged', handleSafeAreaChanged);
      tg.onEvent('viewportChanged', handleViewportChanged);
      
      tg.ready();
      tg.expand();
      
      // CRITICAL FIX: Disable vertical swipes to prevent app collapse on scroll (Bot API 7.7+)
      // This prevents Telegram from interpreting downward scroll as "close app" gesture
      if (typeof tg.isVersionAtLeast === 'function' && tg.isVersionAtLeast('7.7')) {
        if (typeof tg.disableVerticalSwipes === 'function') {
          tg.disableVerticalSwipes();
          console.log('[Telegram] Vertical swipes disabled - smooth scrolling enabled');
        }
      }
      
      return () => {
        // Cleanup event listeners
        tg.offEvent('themeChanged', handleThemeChange);
        tg.offEvent('fullscreenChanged', handleFullscreenChange);
        tg.offEvent('homeScreenAdded', handleHomeScreenAdded);
        tg.offEvent('safeAreaChanged', handleSafeAreaChanged);
        tg.offEvent('viewportChanged', handleViewportChanged);
        
        // Cleanup body padding to prevent stale styles
        resetSafeAreaPadding();
      };
    }
  }, []);

  const hapticFeedback = {
    light: () => webApp?.HapticFeedback.impactOccurred('light'),
    medium: () => webApp?.HapticFeedback.impactOccurred('medium'),
    heavy: () => webApp?.HapticFeedback.impactOccurred('heavy'),
    selection: () => webApp?.HapticFeedback.selectionChanged(),
  };

  // 2025 Full-Screen Mode methods
  const fullscreen = {
    request: () => {
      if (webApp?.requestFullscreen) {
        webApp.requestFullscreen();
        console.log('[2025 API] Requesting fullscreen...');
      } else {
        console.warn('[2025 API] Full-screen mode not supported');
      }
    },
    exit: () => {
      if (webApp?.exitFullscreen) {
        webApp.exitFullscreen();
        console.log('[2025 API] Exiting fullscreen...');
      }
    },
    isActive: isFullscreen,
  };

  // 2025 Home Screen Shortcuts methods
  const homeScreen = {
    add: () => {
      if (webApp?.addToHomeScreen) {
        webApp.addToHomeScreen();
        console.log('[2025 API] Adding to home screen...');
      } else {
        console.warn('[2025 API] Home screen shortcuts not supported');
      }
    },
    checkStatus: () => {
      if (webApp?.checkHomeScreenStatus) {
        webApp.checkHomeScreenStatus((status) => {
          setHomeScreenStatus(status);
          console.log('[2025 API] Home screen status:', status);
        });
      }
    },
    status: homeScreenStatus,
  };

  return {
    webApp,
    user,
    initData,
    colorScheme,
    themeParams,
    hapticFeedback,
    isAvailable: !!webApp,
    isDark: colorScheme === 'dark',
    
    // 2025 Features
    fullscreen,
    homeScreen,
    safeArea,
    contentSafeArea,
    
    // Performance Optimization
    devicePerformance, // 'low' | 'medium' | 'high' for adaptive quality
  };
}
```

### hooks/useTelegramViewport.ts
```tsx
import { useEffect } from 'react';
import WebApp from '@twa-dev/sdk';

export function useTelegramViewport() {
  useEffect(() => {
    const updateViewport = () => {
      // Viewport height
      const vh = WebApp.viewportHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
      
      // Safe Area Insets (всегда устанавливаем для всех платформ)
      const safeAreaTop = WebApp.safeAreaInset?.top || 0;
      const safeAreaBottom = WebApp.safeAreaInset?.bottom || 0;
      const safeAreaLeft = WebApp.safeAreaInset?.left || 0;
      const safeAreaRight = WebApp.safeAreaInset?.right || 0;
      
      document.documentElement.style.setProperty('--sat', `${safeAreaTop}px`);
      document.documentElement.style.setProperty('--sab', `${safeAreaBottom}px`);
      document.documentElement.style.setProperty('--sal', `${safeAreaLeft}px`);
      document.documentElement.style.setProperty('--sar', `${safeAreaRight}px`);
      
      // Content Safe Area Insets (для учета Telegram UI элементов)
      const contentSafeAreaTop = WebApp.contentSafeAreaInset?.top || 0;
      const contentSafeAreaBottom = WebApp.contentSafeAreaInset?.bottom || 0;
      const contentSafeAreaLeft = WebApp.contentSafeAreaInset?.left || 0;
      const contentSafeAreaRight = WebApp.contentSafeAreaInset?.right || 0;
      
      document.documentElement.style.setProperty('--csat', `${contentSafeAreaTop}px`);
      document.documentElement.style.setProperty('--csab', `${contentSafeAreaBottom}px`);
      document.documentElement.style.setProperty('--csal', `${contentSafeAreaLeft}px`);
      document.documentElement.style.setProperty('--csar', `${contentSafeAreaRight}px`);
    };
    
    updateViewport();
    
    WebApp.onEvent('viewportChanged', updateViewport);
    WebApp.onEvent('safeAreaChanged', updateViewport);
    WebApp.onEvent('contentSafeAreaChanged', updateViewport);
    
    return () => {
      WebApp.offEvent('viewportChanged', updateViewport);
      WebApp.offEvent('safeAreaChanged', updateViewport);
      WebApp.offEvent('contentSafeAreaChanged', updateViewport);
    };
  }, []);
}
```

### hooks/use-toast.ts
```tsx
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }
```

### hooks/useVideoLazyLoad.ts
```tsx
import { useEffect, useRef } from 'react';

export function useVideoLazyLoad() {
  const videoRef = useRef<HTMLVideoElement>(null);
  const loadedRef = useRef(false);
  const isIntersectingRef = useRef(false);
  const canplayHandlerRef = useRef<(() => void) | null>(null);

  useEffect(() => {
    const video = videoRef.current;
    if (!video) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          isIntersectingRef.current = entry.isIntersecting;
          
          if (entry.isIntersecting) {
            // Start loading video if not already loaded
            if (!loadedRef.current && video.readyState === 0) {
              loadedRef.current = true;
              video.load(); // Force load for preload="none" videos
            }
            
            // Try to play when ready
            if (video.readyState >= 2) {
              video.play().catch(() => {
                // Autoplay blocked, ignore
              });
            } else {
              // Wait for canplay event if not ready yet
              if (!canplayHandlerRef.current) {
                canplayHandlerRef.current = () => {
                  // Only play if still intersecting
                  if (isIntersectingRef.current) {
                    video.play().catch(() => {
                      // Autoplay blocked, ignore
                    });
                  }
                };
                video.addEventListener('canplay', canplayHandlerRef.current, { once: true });
              }
            }
          } else {
            // Remove pending canplay handler when leaving viewport
            if (canplayHandlerRef.current) {
              video.removeEventListener('canplay', canplayHandlerRef.current);
              canplayHandlerRef.current = null;
            }
            video.pause();
          }
        });
      },
      {
        threshold: 0.1, // Play when 10% visible
        rootMargin: '200px', // Start loading earlier
      }
    );

    observer.observe(video);

    return () => {
      observer.disconnect();
      if (canplayHandlerRef.current) {
        video.removeEventListener('canplay', canplayHandlerRef.current);
      }
    };
  }, []);

  return videoRef;
}
```

### hooks/useVideoPreload.ts
```tsx
import { useEffect, useRef } from 'react';

/**
 * Hook for immediate video preloading on mount
 * Use for critical above-the-fold videos that should start loading immediately
 */
export function useVideoPreload() {
  const videoRef = useRef<HTMLVideoElement>(null);
  const isIntersectingRef = useRef(false);
  const canplayHandlerRef = useRef<(() => void) | null>(null);

  useEffect(() => {
    const video = videoRef.current;
    if (!video) return;

    // Start loading immediately on mount
    video.load();

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          isIntersectingRef.current = entry.isIntersecting;
          
          if (entry.isIntersecting) {
            // Try to play when ready
            if (video.readyState >= 2) {
              video.play().catch(() => {
                // Autoplay blocked, ignore
              });
            } else {
              // Wait for canplay event if not ready yet
              if (!canplayHandlerRef.current) {
                canplayHandlerRef.current = () => {
                  // Only play if still intersecting
                  if (isIntersectingRef.current) {
                    video.play().catch(() => {
                      // Autoplay blocked, ignore
                    });
                  }
                };
                video.addEventListener('canplay', canplayHandlerRef.current, { once: true });
              }
            }
          } else {
            // Remove pending canplay handler when leaving viewport
            if (canplayHandlerRef.current) {
              video.removeEventListener('canplay', canplayHandlerRef.current);
              canplayHandlerRef.current = null;
            }
            video.pause();
          }
        });
      },
      {
        threshold: 0.1,
        rootMargin: '200px',
      }
    );

    observer.observe(video);

    return () => {
      observer.disconnect();
      if (canplayHandlerRef.current) {
        video.removeEventListener('canplay', canplayHandlerRef.current);
      }
    };
  }, []);

  return videoRef;
}
```

### hooks/useWebVitals.ts
```tsx
import { useEffect } from 'react';
import { onCLS, onFCP, onINP, onLCP, onTTFB, type Metric } from 'web-vitals';

interface WebVitalsMetrics {
  CLS?: number;
  FCP?: number;
  INP?: number;
  LCP?: number;
  TTFB?: number;
}

type WebVitalsCallback = (metrics: WebVitalsMetrics) => void;

export const useWebVitals = (callback?: WebVitalsCallback) => {
  useEffect(() => {
    const metrics: WebVitalsMetrics = {};
    
    const handleMetric = (metric: Metric) => {
      metrics[metric.name as keyof WebVitalsMetrics] = metric.value;
      
      // Log to console in development
      if (process.env.NODE_ENV === 'development') {
        console.log(`[Web Vitals] ${metric.name}:`, metric.value);
      }
      
      // Call custom callback
      callback?.(metrics);
      
      // Send to analytics (implement your own logic)
      if (typeof window !== 'undefined' && (window as any).gtag) {
        (window as any).gtag('event', metric.name, {
          value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
          event_category: 'Web Vitals',
          event_label: metric.id,
          non_interaction: true
        });
      }
    };
    
    onCLS(handleMetric);
    onFCP(handleMetric);
    onINP(handleMetric);
    onLCP(handleMetric);
    onTTFB(handleMetric);
  }, [callback]);
};

// Performance Observer for custom metrics
export const usePerformanceObserver = () => {
  useEffect(() => {
    if (typeof window === 'undefined' || !('PerformanceObserver' in window)) {
      return;
    }
    
    const observer = new PerformanceObserver((list) => {
      for (const entry of list.getEntries()) {
        if (entry.entryType === 'navigation') {
          const navEntry = entry as PerformanceNavigationTiming;
          console.log('[Performance] Navigation timing:', {
            dns: navEntry.domainLookupEnd - navEntry.domainLookupStart,
            tcp: navEntry.connectEnd - navEntry.connectStart,
            request: navEntry.responseStart - navEntry.requestStart,
            response: navEntry.responseEnd - navEntry.responseStart,
            dom: navEntry.domContentLoadedEventEnd - navEntry.domContentLoadedEventStart,
            load: navEntry.loadEventEnd - navEntry.loadEventStart
          });
        }
      }
    });
    
    try {
      observer.observe({ entryTypes: ['navigation', 'resource', 'paint'] });
    } catch (error) {
      console.error('[Performance Observer] Error:', error);
    }
    
    return () => observer.disconnect();
  }, []);
};
```

### hooks/useXPSystem.ts
```tsx
import { useState, useCallback } from 'react';
import { useAwardXP } from './useGamification';

interface XPNotification {
  id: string;
  amount: number;
  message: string;
  show: boolean;
}

interface AchievementNotif {
  id: string;
  name: string;
  description: string;
  icon: React.ReactNode;
  show: boolean;
}

export function useXPSystem() {
  const [xpNotifications, setXpNotifications] = useState<XPNotification[]>([]);
  const [achievementNotifs, setAchievementNotifs] = useState<AchievementNotif[]>([]);
  const awardXP = useAwardXP();

  const showXPNotification = useCallback((amount: number, message: string) => {
    const id = Date.now().toString();
    setXpNotifications(prev => [...prev, { id, amount, message, show: true }]);
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
      setXpNotifications(prev => prev.filter(n => n.id !== id));
    }, 3000);
  }, []);

  const showAchievementNotification = useCallback((
    name: string,
    description: string,
    icon: React.ReactNode
  ) => {
    const id = Date.now().toString();
    setAchievementNotifs(prev => [...prev, { id, name, description, icon, show: true }]);
    
    // Auto-remove after 4 seconds
    setTimeout(() => {
      setAchievementNotifs(prev => prev.filter(n => n.id !== id));
    }, 4000);
  }, []);

  const awardXPWithNotification = useCallback((amount: number, message: string) => {
    awardXP(amount);
    showXPNotification(amount, message);
  }, [awardXP, showXPNotification]);

  const closeXPNotification = useCallback((id: string) => {
    setXpNotifications(prev => prev.filter(n => n.id !== id));
  }, []);

  const closeAchievementNotification = useCallback((id: string) => {
    setAchievementNotifs(prev => prev.filter(n => n.id !== id));
  }, []);

  return {
    xpNotifications,
    achievementNotifs,
    awardXPWithNotification,
    showAchievementNotification,
    closeXPNotification,
    closeAchievementNotification
  };
}
```

### hooks/use-mobile.tsx
```tsx
import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}
```

## БИБЛИОТЕКИ (Lib)

### lib/accessibility.ts
```tsx
/**
 * Accessibility utilities for WCAG 2.1 AA compliance
 */

// Focus Management
export class FocusTrap {
  private focusableElements: HTMLElement[] = [];
  private firstFocusable: HTMLElement | null = null;
  private lastFocusable: HTMLElement | null = null;
  private previousFocusedElement: HTMLElement | null = null;

  constructor(private container: HTMLElement) {
    this.updateFocusableElements();
  }

  private updateFocusableElements() {
    const focusableSelectors = [
      'a[href]',
      'button:not([disabled])',
      'textarea:not([disabled])',
      'input:not([disabled]):not([type="hidden"])',
      'select:not([disabled])',
      '[tabindex]:not([tabindex="-1"])'
    ].join(',');

    const elements = Array.from(
      this.container.querySelectorAll<HTMLElement>(focusableSelectors)
    );

    this.focusableElements = elements.filter(
      el => !el.hasAttribute('disabled') && el.offsetParent !== null
    );

    this.firstFocusable = this.focusableElements[0] || null;
    this.lastFocusable = this.focusableElements[this.focusableElements.length - 1] || null;
  }

  activate() {
    this.previousFocusedElement = document.activeElement as HTMLElement;
    this.updateFocusableElements();
    this.firstFocusable?.focus();

    this.container.addEventListener('keydown', this.handleKeyDown);
  }

  deactivate() {
    this.container.removeEventListener('keydown', this.handleKeyDown);
    this.previousFocusedElement?.focus();
  }

  private handleKeyDown = (event: KeyboardEvent) => {
    if (event.key !== 'Tab') return;

    if (event.shiftKey) {
      if (document.activeElement === this.firstFocusable) {
        event.preventDefault();
        this.lastFocusable?.focus();
      }
    } else {
      if (document.activeElement === this.lastFocusable) {
        event.preventDefault();
        this.firstFocusable?.focus();
      }
    }
  };
}

// Keyboard Navigation Helper
export class KeyboardNavigation {
  static isNavigationKey(key: string): boolean {
    return ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Home', 'End', 'Enter', 'Space'].includes(key);
  }

  static handleListNavigation(
    event: KeyboardEvent,
    items: HTMLElement[],
    currentIndex: number,
    options: {
      orientation?: 'vertical' | 'horizontal';
      onSelect?: (index: number) => void;
      loop?: boolean;
    } = {}
  ): number {
    const { orientation = 'vertical', onSelect, loop = true } = options;
    let newIndex = currentIndex;

    const nextKey = orientation === 'vertical' ? 'ArrowDown' : 'ArrowRight';
    const prevKey = orientation === 'vertical' ? 'ArrowUp' : 'ArrowLeft';

    switch (event.key) {
      case nextKey:
        event.preventDefault();
        newIndex = currentIndex + 1;
        if (newIndex >= items.length) {
          newIndex = loop ? 0 : items.length - 1;
        }
        break;

      case prevKey:
        event.preventDefault();
        newIndex = currentIndex - 1;
        if (newIndex < 0) {
          newIndex = loop ? items.length - 1 : 0;
        }
        break;

      case 'Home':
        event.preventDefault();
        newIndex = 0;
        break;

      case 'End':
        event.preventDefault();
        newIndex = items.length - 1;
        break;

      case 'Enter':
      case ' ':
        event.preventDefault();
        onSelect?.(currentIndex);
        return currentIndex;
    }

    if (newIndex !== currentIndex && items[newIndex]) {
      items[newIndex].focus();
    }

    return newIndex;
  }
}

// Screen Reader Announcements
export class Announcer {
  private static instance: Announcer;
  private liveRegion: HTMLElement;

  private constructor() {
    this.liveRegion = this.createLiveRegion();
  }

  static getInstance(): Announcer {
    if (!Announcer.instance) {
      Announcer.instance = new Announcer();
    }
    return Announcer.instance;
  }

  private createLiveRegion(): HTMLElement {
    const region = document.createElement('div');
    region.setAttribute('role', 'status');
    region.setAttribute('aria-live', 'polite');
    region.setAttribute('aria-atomic', 'true');
    region.className = 'sr-only';
    
    // Visually hidden but accessible to screen readers
    region.style.cssText = `
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    `;
    
    document.body.appendChild(region);
    return region;
  }

  announce(message: string, priority: 'polite' | 'assertive' = 'polite') {
    this.liveRegion.setAttribute('aria-live', priority);
    
    // Clear previous message
    this.liveRegion.textContent = '';
    
    // Set new message with small delay to ensure screen readers pick it up
    setTimeout(() => {
      this.liveRegion.textContent = message;
    }, 100);

    // Clear after announcement
    setTimeout(() => {
      this.liveRegion.textContent = '';
    }, 3000);
  }
}

// ARIA Helpers
export const aria = {
  setExpanded(element: HTMLElement, expanded: boolean) {
    element.setAttribute('aria-expanded', String(expanded));
  },

  setHidden(element: HTMLElement, hidden: boolean) {
    element.setAttribute('aria-hidden', String(hidden));
    if (hidden) {
      element.setAttribute('tabindex', '-1');
    } else {
      element.removeAttribute('tabindex');
    }
  },

  setPressed(element: HTMLElement, pressed: boolean) {
    element.setAttribute('aria-pressed', String(pressed));
  },

  setChecked(element: HTMLElement, checked: boolean | 'mixed') {
    element.setAttribute('aria-checked', String(checked));
  },

  setDisabled(element: HTMLElement, disabled: boolean) {
    element.setAttribute('aria-disabled', String(disabled));
    if (disabled) {
      element.setAttribute('tabindex', '-1');
    } else {
      element.removeAttribute('tabindex');
    }
  },

  setLabel(element: HTMLElement, label: string) {
    element.setAttribute('aria-label', label);
  },

  setLabelledBy(element: HTMLElement, id: string) {
    element.setAttribute('aria-labelledby', id);
  },

  setDescribedBy(element: HTMLElement, id: string) {
    element.setAttribute('aria-describedby', id);
  },

  setCurrent(element: HTMLElement, current: boolean | 'page' | 'step' | 'location' | 'date' | 'time') {
    if (current === false) {
      element.removeAttribute('aria-current');
    } else {
      element.setAttribute('aria-current', String(current === true ? 'true' : current));
    }
  }
};

// Contrast Ratio Calculator
export function getContrastRatio(foreground: string, background: string): number {
  const getLuminance = (color: string): number => {
    const rgb = color.match(/\d+/g)?.map(Number) || [0, 0, 0];
    const [r, g, b] = rgb.map(val => {
      const sRGB = val / 255;
      return sRGB <= 0.03928
        ? sRGB / 12.92
        : Math.pow((sRGB + 0.055) / 1.055, 2.4);
    });
    return 0.2126 * r + 0.7152 * g + 0.0722 * b;
  };

  const l1 = getLuminance(foreground);
  const l2 = getLuminance(background);
  const lighter = Math.max(l1, l2);
  const darker = Math.min(l1, l2);

  return (lighter + 0.05) / (darker + 0.05);
}

export function meetsWCAGAA(contrastRatio: number, isLargeText: boolean = false): boolean {
  return isLargeText ? contrastRatio >= 3 : contrastRatio >= 4.5;
}

export function meetsWCAGAAA(contrastRatio: number, isLargeText: boolean = false): boolean {
  return isLargeText ? contrastRatio >= 4.5 : contrastRatio >= 7;
}

// Skip to Content Link Component Data
export const skipToContentProps = {
  href: '#main-content',
  className: 'sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-6 focus:py-3 focus:bg-emerald-500 focus:text-white focus:rounded-xl focus:font-semibold',
  children: 'Перейти к основному содержимому'
};
```

### lib/analytics.ts
```tsx
interface AnalyticsEvent {
  category: string;
  action: string;
  label?: string;
  value?: number;
  metadata?: Record<string, any>;
}

interface UserProperties {
  userId?: string;
  email?: string;
  plan?: string;
  referralCode?: string;
  [key: string]: any;
}

class Analytics {
  private enabled: boolean;
  private userId: string | null = null;
  private sessionId: string;
  private eventQueue: AnalyticsEvent[] = [];
  private flushInterval: number = 30000; // 30 seconds
  private flushTimer: NodeJS.Timeout | null = null;

  constructor() {
    this.enabled = import.meta.env.PROD; // Only in production
    this.sessionId = this.generateSessionId();
    
    if (this.enabled) {
      this.startFlushTimer();
      this.trackPageView();
      this.setupAutoTracking();
    }
  }

  private generateSessionId(): string {
    return `session_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;
  }

  private startFlushTimer() {
    this.flushTimer = setInterval(() => {
      this.flush();
    }, this.flushInterval);
  }

  private setupAutoTracking() {
    // Track page visibility
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        this.trackEvent({
          category: 'Engagement',
          action: 'page_hidden',
        });
      } else {
        this.trackEvent({
          category: 'Engagement',
          action: 'page_visible',
        });
      }
    });

    // Track errors
    window.addEventListener('error', (event) => {
      this.trackEvent({
        category: 'Error',
        action: 'javascript_error',
        label: event.message,
        metadata: {
          filename: event.filename,
          lineno: event.lineno,
          colno: event.colno,
        },
      });
    });

    // Track unhandled promise rejections
    window.addEventListener('unhandledrejection', (event) => {
      this.trackEvent({
        category: 'Error',
        action: 'unhandled_rejection',
        label: event.reason?.toString(),
      });
    });
  }

  setUserId(userId: string) {
    this.userId = userId;
    this.trackEvent({
      category: 'User',
      action: 'identify',
      metadata: { userId },
    });
  }

  setUserProperties(properties: UserProperties) {
    this.trackEvent({
      category: 'User',
      action: 'set_properties',
      metadata: properties,
    });
  }

  trackPageView(path?: string) {
    const currentPath = path || window.location.pathname;
    this.trackEvent({
      category: 'Navigation',
      action: 'page_view',
      label: currentPath,
      metadata: {
        title: document.title,
        referrer: document.referrer,
        url: window.location.href,
      },
    });
  }

  trackEvent(event: AnalyticsEvent) {
    if (!this.enabled) {
      console.debug('[Analytics]', event);
      return;
    }

    const enrichedEvent = {
      ...event,
      timestamp: new Date().toISOString(),
      sessionId: this.sessionId,
      userId: this.userId,
      userAgent: navigator.userAgent,
      language: navigator.language,
      screenResolution: `${window.screen.width}x${window.screen.height}`,
      viewportSize: `${window.innerWidth}x${window.innerHeight}`,
    };

    this.eventQueue.push(enrichedEvent);

    // Flush immediately for important events
    if (event.category === 'Error' || event.category === 'Purchase') {
      this.flush();
    }
  }

  // Convenience methods for common events
  trackClick(elementName: string, metadata?: Record<string, any>) {
    this.trackEvent({
      category: 'Interaction',
      action: 'click',
      label: elementName,
      metadata,
    });
  }

  trackFormSubmit(formName: string, success: boolean, metadata?: Record<string, any>) {
    this.trackEvent({
      category: 'Form',
      action: success ? 'submit_success' : 'submit_failure',
      label: formName,
      metadata,
    });
  }

  trackSearch(query: string, resultsCount?: number) {
    this.trackEvent({
      category: 'Search',
      action: 'search',
      label: query,
      value: resultsCount,
    });
  }

  trackShare(method: string, contentType: string, contentId?: string) {
    this.trackEvent({
      category: 'Social',
      action: 'share',
      label: method,
      metadata: { contentType, contentId },
    });
  }

  trackVideoPlay(videoId: string, duration?: number) {
    this.trackEvent({
      category: 'Media',
      action: 'video_play',
      label: videoId,
      value: duration,
    });
  }

  trackPurchase(amount: number, currency: string, items: any[]) {
    this.trackEvent({
      category: 'Purchase',
      action: 'transaction',
      value: amount,
      metadata: {
        currency,
        items,
        transactionId: `txn_${Date.now()}`,
      },
    });
  }

  trackSignup(method: string) {
    this.trackEvent({
      category: 'User',
      action: 'signup',
      label: method,
    });
  }

  trackLogin(method: string) {
    this.trackEvent({
      category: 'User',
      action: 'login',
      label: method,
    });
  }

  trackLogout() {
    this.trackEvent({
      category: 'User',
      action: 'logout',
    });
  }

  trackTiming(category: string, variable: string, time: number, label?: string) {
    this.trackEvent({
      category,
      action: 'timing',
      label: `${variable}${label ? `:${label}` : ''}`,
      value: time,
    });
  }

  startTiming(name: string): () => void {
    const startTime = performance.now();
    return () => {
      const duration = Math.round(performance.now() - startTime);
      this.trackTiming('Performance', name, duration);
    };
  }

  private async flush() {
    if (this.eventQueue.length === 0) return;

    const events = [...this.eventQueue];
    this.eventQueue = [];

    try {
      // Send to your analytics backend
      await fetch('/api/analytics', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ events }),
      });
    } catch (error) {
      console.error('[Analytics] Failed to send events:', error);
      // Re-add failed events to queue
      this.eventQueue.unshift(...events);
    }
  }

  async destroy() {
    if (this.flushTimer) {
      clearInterval(this.flushTimer);
      this.flushTimer = null;
    }
    
    // Final flush
    await this.flush();
  }
}

// Create singleton instance
export const analytics = new Analytics();

// Cleanup on page unload
window.addEventListener('beforeunload', () => {
  analytics.destroy();
});

// Export for debugging
if (import.meta.env.DEV) {
  (window as any).analytics = analytics;
}
```

### lib/deepLinks.ts
```tsx
type Platform = 'ios' | 'android' | 'unknown';

class DeepLinker {
  private platform: Platform;

  constructor() {
    this.platform = this.detectPlatform();
  }

  private detectPlatform(): Platform {
    const ua = navigator.userAgent.toLowerCase();
    if (/ipad|iphone|ipod/.test(ua)) return 'ios';
    if (/android/.test(ua)) return 'android';
    return 'unknown';
  }

  openInstagram(username: string, postId?: string) {
    let deepLink: string;
    let webUrl: string;
    
    if (postId) {
      webUrl = `https://instagram.com/p/${postId}`;
      deepLink = this.platform === 'android' 
        ? `intent://instagram.com/p/${postId}#Intent;package=com.instagram.android;scheme=https;end`
        : `instagram://media?id=${postId}`;
    } else {
      webUrl = `https://instagram.com/${username}`;
      deepLink = this.platform === 'android'
        ? `intent://instagram.com/${username}/#Intent;package=com.instagram.android;scheme=https;end`
        : `instagram://user?username=${username}`;
    }
    
    this.attemptOpen(deepLink, webUrl, 'Instagram');
  }

  openTikTok(username: string, videoId?: string) {
    let deepLink: string;
    let webUrl: string;
    
    if (videoId) {
      webUrl = `https://tiktok.com/@${username}/video/${videoId}`;
      deepLink = this.platform === 'android'
        ? `intent://www.tiktok.com/@${username}/video/${videoId}#Intent;package=com.zhiliaoapp.musically;scheme=https;end`
        : `tiktok://video/${videoId}`;
    } else {
      webUrl = `https://tiktok.com/@${username}`;
      deepLink = this.platform === 'android'
        ? `intent://www.tiktok.com/@${username}#Intent;package=com.zhiliaoapp.musically;scheme=https;end`
        : `tiktok://user/@${username}`;
    }
    
    this.attemptOpen(deepLink, webUrl, 'TikTok');
  }

  openYouTube(videoId: string) {
    const webUrl = `https://youtube.com/watch?v=${videoId}`;
    const deepLink = this.platform === 'android'
      ? `intent://youtube.com/watch?v=${videoId}#Intent;package=com.google.android.youtube;scheme=https;end`
      : `youtube://watch?v=${videoId}`;
    
    this.attemptOpen(deepLink, webUrl, 'YouTube');
  }

  openYouTubeChannel(channelId: string) {
    const webUrl = `https://youtube.com/channel/${channelId}`;
    const deepLink = this.platform === 'android'
      ? `intent://youtube.com/channel/${channelId}#Intent;package=com.google.android.youtube;scheme=https;end`
      : `youtube://channel/${channelId}`;
    
    this.attemptOpen(deepLink, webUrl, 'YouTube');
  }

  openTelegramChannel(username: string) {
    const webUrl = `https://t.me/${username}`;
    const deepLink = `tg://resolve?domain=${username}`;
    const isInTelegramWebView = window.Telegram?.WebApp;
    
    window.location.href = deepLink;
    
    setTimeout(() => {
      if (!document.hidden) {
        if (isInTelegramWebView) {
          window.Telegram.WebApp.openLink(webUrl);
        } else {
          window.location.href = webUrl;
        }
      }
    }, 1500);
  }

  private attemptOpen(deepLink: string, webUrl: string, appName: string) {
    const isInTelegramWebView = window.Telegram?.WebApp;
    
    if (this.platform === 'android' || this.platform === 'ios') {
      if (this.platform === 'ios') {
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = deepLink;
        document.body.appendChild(iframe);
        
        setTimeout(() => {
          document.body.removeChild(iframe);
          if (!document.hidden) {
            if (isInTelegramWebView) {
              window.Telegram.WebApp.openLink(webUrl);
            } else {
              window.open(webUrl, '_blank');
            }
          }
        }, 1500);
      } else {
        window.location.href = deepLink;
        setTimeout(() => {
          if (!document.hidden && isInTelegramWebView) {
            window.Telegram.WebApp.openLink(webUrl);
          }
        }, 1500);
      }
    } else {
      if (isInTelegramWebView) {
        window.Telegram.WebApp.openLink(webUrl);
      } else {
        window.open(webUrl, '_blank');
      }
    }
  }

  shareViaMessenger(text: string, url?: string) {
    if (window.Telegram?.WebApp) {
      const shareUrl = url || window.location.href;
      
      window.location.href = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(text)}`;
    }
  }
}

export const deepLinker = new DeepLinker();
```

### lib/i18n.ts
```tsx
type Language = 'ru' | 'en';

type TranslationKeys = {
  // Common
  'common.loading': string;
  'common.error': string;
  'common.success': string;
  'common.cancel': string;
  'common.save': string;
  'common.delete': string;
  'common.edit': string;
  'common.close': string;
  'common.back': string;
  'common.next': string;
  'common.previous': string;
  'common.search': string;
  'common.filter': string;
  'common.sort': string;
  
  // Navigation
  'nav.home': string;
  'nav.showcases': string;
  'nav.projects': string;
  'nav.aiAgent': string;
  'nav.profile': string;
  
  // Hero
  'hero.title': string;
  'hero.subtitle': string;
  'hero.cta': string;
  'hero.socialProof': string;
  'hero.rating': string;
  
  // Features
  'features.title': string;
  'features.subtitle': string;
  
  // Gamification
  'gamification.level': string;
  'gamification.xp': string;
  'gamification.streak': string;
  'gamification.achievements': string;
  'gamification.dailyTasks': string;
  'gamification.leaderboard': string;
  
  // Referral
  'referral.title': string;
  'referral.code': string;
  'referral.share': string;
  'referral.earnings': string;
  'referral.tier': string;
  
  // Payment
  'payment.express': string;
  'payment.applePay': string;
  'payment.googlePay': string;
  'payment.sbp': string;
  'payment.card': string;
  
  // SEO
  'seo.defaultTitle': string;
  'seo.defaultDescription': string;
  
  // Errors
  'error.notFound': string;
  'error.serverError': string;
  'error.networkError': string;
  'error.validationError': string;
};

const translations: Record<Language, TranslationKeys> = {
  ru: {
    // Common
    'common.loading': 'Загрузка...',
    'common.error': 'Ошибка',
    'common.success': 'Успешно',
    'common.cancel': 'Отмена',
    'common.save': 'Сохранить',
    'common.delete': 'Удалить',
    'common.edit': 'Редактировать',
    'common.close': 'Закрыть',
    'common.back': 'Назад',
    'common.next': 'Далее',
    'common.previous': 'Предыдущий',
    'common.search': 'Поиск',
    'common.filter': 'Фильтр',
    'common.sort': 'Сортировка',
    
    // Navigation
    'nav.home': 'Главная',
    'nav.showcases': 'Демо',
    'nav.projects': 'Проекты',
    'nav.aiAgent': 'AI Агент',
    'nav.profile': 'Профиль',
    
    // Hero
    'hero.title': 'Запустите бизнес в Telegram за 24 часа',
    'hero.subtitle': 'Создайте своё приложение без программирования. Более 2,453 успешных предпринимателей уже запустили свои проекты.',
    'hero.cta': 'Начать бесплатно',
    'hero.socialProof': '2,453+ успешных запусков',
    'hero.rating': '4.9/5 рейтинг',
    
    // Features
    'features.title': 'Всё что нужно для успеха',
    'features.subtitle': 'Полный набор инструментов для роста вашего бизнеса',
    
    // Gamification
    'gamification.level': 'Уровень',
    'gamification.xp': 'Опыт',
    'gamification.streak': 'Серия',
    'gamification.achievements': 'Достижения',
    'gamification.dailyTasks': 'Ежедневные задания',
    'gamification.leaderboard': 'Таблица лидеров',
    
    // Referral
    'referral.title': 'Реферальная программа',
    'referral.code': 'Ваш код',
    'referral.share': 'Поделиться',
    'referral.earnings': 'Заработано',
    'referral.tier': 'Уровень партнёра',
    
    // Payment
    'payment.express': 'Быстрая оплата',
    'payment.applePay': 'Apple Pay',
    'payment.googlePay': 'Google Pay',
    'payment.sbp': 'СБП',
    'payment.card': 'Банковская карта',
    
    // SEO
    'seo.defaultTitle': 'WEB4TG - Telegram Mini Apps для вашего бизнеса',
    'seo.defaultDescription': 'Создайте свой бизнес в Telegram за 24 часа. Более 2,453 успешных предпринимателей уже запустили свои приложения. Рейтинг 4.9/5 ⭐',
    
    // Errors
    'error.notFound': 'Страница не найдена',
    'error.serverError': 'Ошибка сервера',
    'error.networkError': 'Ошибка сети',
    'error.validationError': 'Ошибка валидации',
  },
  
  en: {
    // Common
    'common.loading': 'Loading...',
    'common.error': 'Error',
    'common.success': 'Success',
    'common.cancel': 'Cancel',
    'common.save': 'Save',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.close': 'Close',
    'common.back': 'Back',
    'common.next': 'Next',
    'common.previous': 'Previous',
    'common.search': 'Search',
    'common.filter': 'Filter',
    'common.sort': 'Sort',
    
    // Navigation
    'nav.home': 'Home',
    'nav.showcases': 'Showcases',
    'nav.projects': 'Projects',
    'nav.aiAgent': 'AI Agent',
    'nav.profile': 'Profile',
    
    // Hero
    'hero.title': 'Launch Your Business in Telegram in 24 Hours',
    'hero.subtitle': 'Create your app without coding. Over 2,453 successful entrepreneurs have already launched their projects.',
    'hero.cta': 'Start for Free',
    'hero.socialProof': '2,453+ successful launches',
    'hero.rating': '4.9/5 rating',
    
    // Features
    'features.title': 'Everything you need to succeed',
    'features.subtitle': 'Complete toolkit for growing your business',
    
    // Gamification
    'gamification.level': 'Level',
    'gamification.xp': 'Experience',
    'gamification.streak': 'Streak',
    'gamification.achievements': 'Achievements',
    'gamification.dailyTasks': 'Daily Tasks',
    'gamification.leaderboard': 'Leaderboard',
    
    // Referral
    'referral.title': 'Referral Program',
    'referral.code': 'Your code',
    'referral.share': 'Share',
    'referral.earnings': 'Earnings',
    'referral.tier': 'Partner Tier',
    
    // Payment
    'payment.express': 'Express Payment',
    'payment.applePay': 'Apple Pay',
    'payment.googlePay': 'Google Pay',
    'payment.sbp': 'SBP',
    'payment.card': 'Bank Card',
    
    // SEO
    'seo.defaultTitle': 'WEB4TG - Telegram Mini Apps for Your Business',
    'seo.defaultDescription': 'Create your business in Telegram in 24 hours. Over 2,453 successful entrepreneurs have launched their apps. 4.9/5 rating ⭐',
    
    // Errors
    'error.notFound': 'Page not found',
    'error.serverError': 'Server error',
    'error.networkError': 'Network error',
    'error.validationError': 'Validation error',
  },
};

class I18n {
  private currentLanguage: Language = 'ru';
  private listeners: Set<(lang: Language) => void> = new Set();

  constructor() {
    // Load language from localStorage or browser
    const stored = localStorage.getItem('language') as Language;
    const browserLang = navigator.language.split('-')[0] as Language;
    
    this.currentLanguage = stored || (browserLang === 'en' || browserLang === 'ru' ? browserLang : 'ru');
  }

  get language(): Language {
    return this.currentLanguage;
  }

  setLanguage(lang: Language) {
    this.currentLanguage = lang;
    localStorage.setItem('language', lang);
    this.listeners.forEach(listener => listener(lang));
    
    // Update HTML lang attribute
    document.documentElement.lang = lang;
  }

  t(key: keyof TranslationKeys, variables?: Record<string, string | number>): string {
    let translation = translations[this.currentLanguage][key] || key;
    
    // Replace variables
    if (variables) {
      Object.entries(variables).forEach(([varKey, value]) => {
        translation = translation.replace(`{{${varKey}}}`, String(value));
      });
    }
    
    return translation;
  }

  subscribe(listener: (lang: Language) => void): () => void {
    this.listeners.add(listener);
    return () => this.listeners.delete(listener);
  }

  formatNumber(num: number): string {
    return new Intl.NumberFormat(this.currentLanguage === 'ru' ? 'ru-RU' : 'en-US').format(num);
  }

  formatCurrency(amount: number, currency: string = 'RUB'): string {
    return new Intl.NumberFormat(this.currentLanguage === 'ru' ? 'ru-RU' : 'en-US', {
      style: 'currency',
      currency,
    }).format(amount);
  }

  formatDate(date: Date | string, options?: Intl.DateTimeFormatOptions): string {
    const d = typeof date === 'string' ? new Date(date) : date;
    return new Intl.DateTimeFormat(this.currentLanguage === 'ru' ? 'ru-RU' : 'en-US', options).format(d);
  }

  formatRelativeTime(date: Date | string): string {
    const d = typeof date === 'string' ? new Date(date) : date;
    const now = new Date();
    const diffInSeconds = Math.floor((now.getTime() - d.getTime()) / 1000);
    
    const rtf = new Intl.RelativeTimeFormat(this.currentLanguage === 'ru' ? 'ru-RU' : 'en-US', {
      numeric: 'auto',
    });
    
    if (diffInSeconds < 60) {
      return rtf.format(-diffInSeconds, 'second');
    } else if (diffInSeconds < 3600) {
      return rtf.format(-Math.floor(diffInSeconds / 60), 'minute');
    } else if (diffInSeconds < 86400) {
      return rtf.format(-Math.floor(diffInSeconds / 3600), 'hour');
    } else if (diffInSeconds < 2592000) {
      return rtf.format(-Math.floor(diffInSeconds / 86400), 'day');
    } else {
      return rtf.format(-Math.floor(diffInSeconds / 2592000), 'month');
    }
  }
}

// Create singleton instance
export const i18n = new I18n();

// Export for convenience
export const t = (key: keyof TranslationKeys, variables?: Record<string, string | number>) =>
  i18n.t(key, variables);
  
export const setLanguage = (lang: Language) => i18n.setLanguage(lang);
export const getLanguage = () => i18n.language;

// Export for debugging
if (import.meta.env.DEV) {
  (window as any).i18n = i18n;
}
```

### lib/queryClient.ts
```tsx
import { QueryClient, QueryFunction } from "@tanstack/react-query";

async function throwIfResNotOk(res: Response) {
  if (!res.ok) {
    const text = (await res.text()) || res.statusText;
    throw new Error(`${res.status}: ${text}`);
  }
}

export async function apiRequest(
  method: string,
  url: string,
  data?: unknown | undefined,
): Promise<Response> {
  const res = await fetch(url, {
    method,
    headers: data ? { "Content-Type": "application/json" } : {},
    body: data ? JSON.stringify(data) : undefined,
    credentials: "include",
  });

  await throwIfResNotOk(res);
  return res;
}

type UnauthorizedBehavior = "returnNull" | "throw";
export const getQueryFn: <T>(options: {
  on401: UnauthorizedBehavior;
}) => QueryFunction<T> =
  ({ on401: unauthorizedBehavior }) =>
  async ({ queryKey }) => {
    const res = await fetch(queryKey.join("/") as string, {
      credentials: "include",
    });

    if (unauthorizedBehavior === "returnNull" && res.status === 401) {
      return null;
    }

    await throwIfResNotOk(res);
    return await res.json();
  };

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      queryFn: getQueryFn({ on401: "throw" }),
      refetchInterval: false,
      refetchOnWindowFocus: false,
      staleTime: Infinity,
      retry: false,
    },
    mutations: {
      retry: false,
    },
  },
});
```

### lib/telegramApi.ts
```tsx
export async function telegramApiRequest(
  method: string,
  url: string,
  initData: string,
  data?: unknown,
): Promise<Response> {
  const headers: Record<string, string> = {
    'x-telegram-init-data': initData,
  };

  if (data) {
    headers['Content-Type'] = 'application/json';
  }

  const res = await fetch(url, {
    method,
    headers,
    body: data ? JSON.stringify(data) : undefined,
    credentials: 'include',
  });

  if (!res.ok) {
    const text = (await res.text()) || res.statusText;
    throw new Error(`${res.status}: ${text}`);
  }

  return res;
}

export async function getTelegramApiData<T>(
  url: string,
  initData: string,
): Promise<T> {
  const res = await telegramApiRequest('GET', url, initData);
  return await res.json();
}

export async function postTelegramApiData<T>(
  url: string,
  initData: string,
  data: unknown,
): Promise<T> {
  const res = await telegramApiRequest('POST', url, initData, data);
  return await res.json();
}
```

### lib/telegram.ts
```tsx
import WebApp from '@twa-dev/sdk';

/**
 * Ensure Telegram WebView 7.7+ polyfill is applied
 * Call this BEFORE using any WebApp methods
 */
export function ensureTelegramPolyfill() {
  if (!window.Telegram?.WebApp) {
    return;
  }

  const tg = window.Telegram.WebApp;

  // Check if already polyfilled
  if ((tg as any).__polyfilled) {
    return;
  }

  console.log('[Telegram Polyfill] Applying WebView 7.7+ API');

  // Override version check
  const originalIsVersionAtLeast = tg.isVersionAtLeast;
  tg.isVersionAtLeast = function(version: string) {
    return true; // Always return true in dev
  };

  // Add missing methods
  if (!tg.disableVerticalSwipes) {
    tg.disableVerticalSwipes = () => console.log('[Polyfill] disableVerticalSwipes()');
    tg.enableVerticalSwipes = () => console.log('[Polyfill] enableVerticalSwipes()');
  }

  if (!tg.requestFullscreen) {
    (tg as any).isFullscreen = false;
    tg.requestFullscreen = () => {
      (tg as any).isFullscreen = true;
      console.log('[Polyfill] requestFullscreen()');
    };
    tg.exitFullscreen = () => {
      (tg as any).isFullscreen = false;
      console.log('[Polyfill] exitFullscreen()');
    };
  }

  if (!(tg as any).setHeaderColor) {
    (tg as any).setHeaderColor = (color: string) => console.log('[Polyfill] setHeaderColor(' + color + ')');
  }

  if (!(tg as any).setBottomBarColor) {
    (tg as any).setBottomBarColor = (color: string) => console.log('[Polyfill] setBottomBarColor(' + color + ')');
  }

  (tg as any).__polyfilled = true;
  console.log('[Telegram Polyfill] ✅ Ready');
}

export function initTelegramWebApp() {
  // CRITICAL: Apply polyfill FIRST before any WebApp API usage
  ensureTelegramPolyfill();
  
  // Use native Telegram API (not @twa-dev/sdk wrapper) after polyfill
  const tg = window.Telegram?.WebApp;
  if (!tg) {
    console.warn('[Telegram] WebApp not available');
    return WebApp; // Fallback to SDK
  }
  
  // ready() and expand() already called in index.html for instant load
  
  // Continue with other setup - use native API to avoid SDK version checks
  
  // Request fullscreen mode (hides bot name header)
  if (typeof tg.requestFullscreen === 'function') {
    tg.requestFullscreen();
  }
  
  // Make header transparent/invisible by matching background
  if (typeof (tg as any).setHeaderColor === 'function') {
    (tg as any).setHeaderColor('bg_color');
  }
  if (typeof (tg as any).setBackgroundColor === 'function') {
    (tg as any).setBackgroundColor('#0A0A0B');
  }
  
  // Disable vertical swipes to prevent accidental close
  if (typeof tg.disableVerticalSwipes === 'function') {
    tg.disableVerticalSwipes();
  }
  
  // Lock orientation for better UX
  if (typeof (tg as any).lockOrientation === 'function') {
    (tg as any).lockOrientation();
  }
  
  // Set viewport height for full screen experience
  if (WebApp.platform === 'ios' || WebApp.platform === 'android') {
    document.documentElement.style.setProperty(
      '--viewport-height',
      `${WebApp.viewportHeight}px`
    );
    
    // Update on viewport changes
    WebApp.onEvent('viewportChanged', () => {
      document.documentElement.style.setProperty(
        '--viewport-height',
        `${WebApp.viewportHeight}px`
      );
    });
  }
  
  // Maximize safe area usage
  document.documentElement.style.setProperty(
    '--safe-area-inset-top',
    '0px'
  );
  
  return WebApp;
}

class HapticManager {
  private lastHaptic = 0;
  private readonly throttleTime = 50;
  private enabled = true;
  
  setEnabled(enabled: boolean) {
    this.enabled = enabled;
  }
  
  light() {
    if (!this.enabled) return;
    const now = Date.now();
    if (now - this.lastHaptic < this.throttleTime) return;
    
    try {
      WebApp.HapticFeedback.impactOccurred('light');
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
    this.lastHaptic = now;
  }
  
  medium() {
    if (!this.enabled) return;
    const now = Date.now();
    if (now - this.lastHaptic < this.throttleTime) return;
    
    try {
      WebApp.HapticFeedback.impactOccurred('medium');
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
    this.lastHaptic = now;
  }
  
  heavy() {
    if (!this.enabled) return;
    const now = Date.now();
    if (now - this.lastHaptic < this.throttleTime) return;
    
    try {
      WebApp.HapticFeedback.impactOccurred('heavy');
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
    this.lastHaptic = now;
  }
  
  success() {
    if (!this.enabled) return;
    try {
      WebApp.HapticFeedback.notificationOccurred('success');
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
  }
  
  error() {
    if (!this.enabled) return;
    try {
      WebApp.HapticFeedback.notificationOccurred('error');
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
  }
  
  warning() {
    if (!this.enabled) return;
    try {
      WebApp.HapticFeedback.notificationOccurred('warning');
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
  }
  
  selection() {
    if (!this.enabled) return;
    const now = Date.now();
    if (now - this.lastHaptic < this.throttleTime) return;
    
    try {
      WebApp.HapticFeedback.selectionChanged();
    } catch (e) {
      console.debug('[Haptic] Not available');
    }
    this.lastHaptic = now;
  }
}

export const haptic = new HapticManager();
```

### lib/utils.ts
```tsx
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

## ДАННЫЕ (Data)

### data/demoApps.ts
```tsx
export interface Banner {
  title: string;
  subtitle?: string;
  image?: string;
  bgClass?: string;
}

export interface Service {
  id: string;
  title: string;
  priceText?: string;
  iconName?: string;
  image?: string;
}

export interface DemoAppHome {
  hero: {
    title?: string;
    subtitle?: string;
    image?: string;
    bgClass?: string;
  };
  banners?: Banner[];
  services?: Service[];
}

export interface DemoApp {
  id: string;
  title: string;
  description: string;
  category: string;
  image: string;
  creator: string;
  likes: string;
  badge?: string;
  badgeColor?: string;
  home?: DemoAppHome;
}

// Топ-10 самых популярных приложений по лайкам
export const demoApps: DemoApp[] = [
  {
    id: 'clothing-store',
    title: 'Radiance',
    description: 'Магазин модной одежды и аксессуаров',
    category: 'Электронная коммерция',
    image: '/attached_assets/4659a0f48988f601b98b2cec6406c739_1762127566273.jpg',
    creator: 'WEB4TG',
    likes: '12.3k',
    badge: 'Premium',
    badgeColor: 'bg-black',
    home: {
      hero: {
        title: 'Digital Fashion',
        subtitle: 'Sharp design. Strong brands. Clear meaning.',
        image: '/attached_assets/4659a0f48988f601b98b2cec6406c739_1762127566273.jpg',
        bgClass: 'bg-black'
      },
      banners: [
        {
          title: 'Digital Collection',
          subtitle: 'Radiance.Family',
          image: '/attached_assets/4659a0f48988f601b98b2cec6406c739_1762127566273.jpg',
          bgClass: 'bg-black'
        },
        {
          title: 'Premium Design',
          subtitle: 'Beautiful & meaningful',
          bgClass: 'bg-gradient-to-r from-gray-900 to-black'
        }
      ],
      services: [
        { id: 'catalog', title: 'Каталог', priceText: 'Просмотр товаров', iconName: 'grid' },
        { id: 'favorites', title: 'Избранное', priceText: 'Сохраненные товары', iconName: 'heart' },
        { id: 'cart', title: 'Корзина', priceText: 'Мои покупки', iconName: 'shopping-cart' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  {
    id: 'electronics',
    title: 'TechMart',
    description: 'Магазин электроники и техники',
    category: 'Электронная коммерция',
    image: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
    creator: 'WEB4TG',
    likes: '11.8k',
    badge: 'Хит продаж',
    badgeColor: 'bg-blue-500',
    home: {
      hero: {
        title: 'Добро пожаловать в TechMart',
        subtitle: 'Лучшие технологии по доступным ценам',
        image: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
        bgClass: 'bg-gradient-to-r from-blue-500 to-cyan-600'
      },
      banners: [
        {
          title: 'iPhone 16 Pro',
          subtitle: 'Новинка уже в продаже',
          image: 'https://images.unsplash.com/photo-1510557880182-3d4d3cba35a5?w=400&auto=format,compress&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-gray-800 to-gray-900'
        },
        {
          title: 'Черная пятница',
          subtitle: 'Скидки до 70% на всё',
          bgClass: 'bg-gradient-to-r from-red-500 to-orange-600'
        }
      ],
      services: [
        { id: 'catalog', title: 'Каталог', priceText: 'Все товары', iconName: 'smartphone' },
        { id: 'compare', title: 'Сравнение', priceText: 'Сравнить товары', iconName: 'bar-chart' },
        { id: 'cart', title: 'Корзина', priceText: 'Мои покупки', iconName: 'shopping-cart' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  {
    id: 'beauty',
    title: 'GlowSpa',
    description: 'Салон красоты и SPA-услуги',
    category: 'Красота и здоровье',
    image: 'https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
    creator: 'WEB4TG',
    likes: '9.7k',
    badge: 'Премиум',
    badgeColor: 'bg-pink-500',
    home: {
      hero: {
        title: 'Добро пожаловать в GlowSpa',
        subtitle: 'Откройте секрет вашей красоты',
        image: 'https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
        bgClass: 'bg-gradient-to-r from-pink-500 to-rose-600'
      },
      banners: [
        {
          title: 'Новые процедуры',
          subtitle: 'Anti-age терапия',
          image: 'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=400&auto=format,compress&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-purple-500 to-indigo-600'
        },
        {
          title: 'Акция месяца',
          subtitle: 'Скидка 30% на все услуги',
          bgClass: 'bg-gradient-to-r from-emerald-500 to-teal-600'
        }
      ],
      services: [
        { id: 'services', title: 'Услуги', priceText: 'Все процедуры', iconName: 'sparkles' },
        { id: 'booking', title: 'Запись', priceText: 'Онлайн бронирование', iconName: 'calendar' },
        { id: 'loyalty', title: 'Программа лояльности', priceText: 'Накопительные скидки', iconName: 'gift' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  {
    id: 'restaurant',
    title: 'DeluxeDine',
    description: 'Ресторан с доставкой',
    category: 'Еда и рестораны',
    image: 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
    creator: 'WEB4TG',
    likes: '8.9k',
    badge: 'Мишлен',
    badgeColor: 'bg-yellow-500',
    home: {
      hero: {
        title: 'Добро пожаловать в DeluxeDine',
        subtitle: 'Незабываемые вкусы высокой кухни',
        image: 'https://images.unsplash.com/photo-1414235077428-338989a2e8c0?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
        bgClass: 'bg-gradient-to-r from-yellow-500 to-orange-600'
      },
      banners: [
        {
          title: 'Сезонное меню',
          subtitle: 'Блюда от шеф-повара',
          image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?w=400&auto=format,compress&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-emerald-500 to-teal-600'
        },
        {
          title: 'Бесплатная доставка',
          subtitle: 'При заказе от 2000₽',
          bgClass: 'bg-gradient-to-r from-blue-500 to-indigo-600'
        }
      ],
      services: [
        { id: 'menu', title: 'Меню', priceText: 'Наши блюда', iconName: 'utensils' },
        { id: 'reservations', title: 'Бронирование', priceText: 'Забронировать стол', iconName: 'calendar' },
        { id: 'delivery', title: 'Доставка', priceText: 'Заказать на дом', iconName: 'truck' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  // НОВЫЕ E-COMMERCE ПРИЛОЖЕНИЯ
  {
    id: 'luxury-watches',
    title: 'TimeElite',
    description: 'Магазин элитных часов',
    category: 'Электронная коммерция',
    image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
    creator: 'WEB4TG',
    likes: '15.2k',
    badge: 'Люкс',
    badgeColor: 'bg-yellow-600',
    home: {
      hero: {
        title: 'Добро пожаловать в TimeElite',
        subtitle: 'Эксклюзивные часы для истинных ценителей',
        image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
        bgClass: 'bg-gradient-to-r from-yellow-600 to-amber-700'
      },
      banners: [
        {
          title: 'Новинка',
          subtitle: 'Коллекция Rolex 2025',
          image: 'https://images.unsplash.com/photo-1434056886845-dac89ffe9b56?w=400&auto=format,compress&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-blue-500 to-indigo-600'
        },
        {
          title: 'Эксклюзив',
          subtitle: 'Лимитированные серии',
          bgClass: 'bg-gradient-to-r from-purple-500 to-pink-600'
        }
      ],
      services: [
        { id: 'catalog', title: 'Каталог', priceText: 'Все часы', iconName: 'watch' },
        { id: 'brands', title: 'Бренды', priceText: 'Rolex, Omega, Cartier', iconName: 'star' },
        { id: 'cart', title: 'Корзина', priceText: 'Мои покупки', iconName: 'shopping-cart' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  {
    id: 'sneaker-store',
    title: 'SneakerVault',
    description: 'Магазин кроссовок',
    category: 'Электронная коммерция',
    image: 'https://images.unsplash.com/photo-1549298916-b41d501d3772?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
    creator: 'WEB4TG',
    likes: '18.9k',
    badge: 'Streetwear',
    badgeColor: 'bg-red-500',
    home: {
      hero: {
        title: 'Добро пожаловать в SneakerVault',
        subtitle: 'Редкие дропы и эксклюзивные коллаборации',
        image: 'https://images.unsplash.com/photo-1549298916-b41d501d3772?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
        bgClass: 'bg-gradient-to-r from-red-500 to-orange-600'
      },
      banners: [
        {
          title: 'Jordan Retro',
          subtitle: 'Новый релиз уже в продаже',
          image: 'https://images.unsplash.com/photo-1556906781-9a412961c28c?w=400&auto=format,compress&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-black to-gray-800'
        },
        {
          title: 'Предзаказ',
          subtitle: 'Yeezy Boost 350 V3',
          bgClass: 'bg-gradient-to-r from-purple-500 to-pink-600'
        }
      ],
      services: [
        { id: 'catalog', title: 'Каталог', priceText: 'Все кроссовки', iconName: 'zap' },
        { id: 'drops', title: 'Дропы', priceText: 'Новые релизы', iconName: 'lightning' },
        { id: 'cart', title: 'Корзина', priceText: 'Мои покупки', iconName: 'shopping-cart' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  {
    id: 'luxury-perfume',
    title: 'FragranceRoyale',
    description: 'Магазин премиальной парфюмерии',
    category: 'Электронная коммерция',
    image: 'https://images.unsplash.com/photo-1588405748880-12d1d2a59d75?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
    creator: 'WEB4TG',
    likes: '11.7k',
    badge: 'Премиум',
    badgeColor: 'bg-purple-500',
    home: {
      hero: {
        title: 'Добро пожаловать в FragranceRoyale',
        subtitle: 'Откройте для себя последние ароматы премиум класса',
        image: 'https://images.unsplash.com/photo-1588405748880-12d1d2a59d75?ixlib=rb-4.0.3&auto=format,compress&fit=crop&w=400&h=300&q=80&dpr=2',
        bgClass: 'bg-gradient-to-r from-purple-500 to-pink-600'
      },
      banners: [
        {
          title: 'Новая коллекция',
          subtitle: 'Весна-Лето 2025',
          image: 'https://images.unsplash.com/photo-1523293182086-7651a899d37f?w=400&auto=format,compress&fit=crop&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-pink-500 to-rose-600'
        },
        {
          title: 'Скидки до 50%',
          subtitle: 'На избранные ароматы',
          image: 'https://images.unsplash.com/photo-1585386959984-a4155224a1ad?w=400&auto=format,compress&fit=crop&q=80&dpr=2',
          bgClass: 'bg-gradient-to-r from-orange-500 to-red-600'
        }
      ],
      services: [
        { id: 'catalog', title: 'Каталог', priceText: 'Просмотр ароматов', iconName: 'grid' },
        { id: 'favorites', title: 'Избранное', priceText: 'Сохраненные ароматы', iconName: 'heart' },
        { id: 'cart', title: 'Корзина', priceText: 'Мои покупки', iconName: 'shopping-cart' },
        { id: 'profile', title: 'Профиль', priceText: 'Личный кабинет', iconName: 'user' }
      ]
    }
  },
  
  // Futuristic Fashion Collection - 4 Premium Designs
  {
    id: 'futuristic-fashion-1',
    title: 'Rascal®',
    description: 'Футуристический магазин waterproof jacket',
    category: 'Электронная коммерция',
    image: '/attached_assets/stock_images/futuristic_techwear__e958e42c.jpg',
    creator: 'WEB4TG',
    likes: '24.1k',
    badge: 'Футуристика',
    badgeColor: 'bg-gradient-to-r from-green-600 to-emerald-700'
  },
  {
    id: 'futuristic-fashion-2',
    title: 'STORE',
    description: 'Минималистичный черный магазин',
    category: 'Электронная коммерция',
    image: '/attached_assets/stock_images/cyberpunk_fashion_ho_8df162c4.jpg',
    creator: 'WEB4TG',
    likes: '22.8k',
    badge: 'Минимализм',
    badgeColor: 'bg-black'
  },
  {
    id: 'futuristic-fashion-3',
    title: 'lab. SURVIVALIST',
    description: 'Черно-белый минималистичный магазин',
    category: 'Электронная коммерция',
    image: '/attached_assets/stock_images/futuristic_fashion_m_331bf630.jpg',
    creator: 'WEB4TG',
    likes: '26.5k',
    badge: 'Премиум',
    badgeColor: 'bg-gray-900'
  },
  {
    id: 'futuristic-fashion-4',
    title: 'Nike ACG',
    description: 'Карточный дизайн с 3D эффектами',
    category: 'Электронная коммерция',
    image: '/attached_assets/stock_images/futuristic_fashion_m_4203db1e.jpg',
    creator: 'WEB4TG',
    likes: '28.3k',
    badge: 'Интерактив',
    badgeColor: 'bg-gradient-to-r from-gray-800 to-black'
  },
  
  // Premium Design Collection - New Apps
  {
    id: 'oxyz-nft',
    title: 'OXYZ',
    description: 'Футуристическая NFT платформа с красными акцентами',
    category: 'NFT & Крипто',
    image: 'https://images.unsplash.com/photo-1529139574466-a303027c1d8b?w=400&h=300&fit=crop&q=80',
    creator: 'WEB4TG',
    likes: '45.2k',
    badge: 'NFT',
    badgeColor: 'bg-red-600',
    home: {
      hero: {
        title: 'OXYZ NFT',
        subtitle: 'The Future of Digital Art',
        image: 'https://images.unsplash.com/photo-1529139574466-a303027c1d8b?w=800&h=600&fit=crop&q=90',
        bgClass: 'bg-black'
      },
      services: [
        { id: 'catalog', title: 'Explore', priceText: 'NFT Collection', iconName: 'grid' },
        { id: 'cart', title: 'Wallet', priceText: 'Your Assets', iconName: 'wallet' },
        { id: 'profile', title: 'Settings', priceText: 'Account', iconName: 'settings' }
      ]
    }
  },
  {
    id: 'emily-carter-ai',
    title: 'Emily Carter AI',
    description: 'AI-ассистент с минималистичным современным дизайном',
    category: 'AI & Технологии',
    image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=400&h=300&fit=crop&q=80',
    creator: 'WEB4TG',
    likes: '67.8k',
    badge: 'AI',
    badgeColor: 'bg-emerald-600',
    home: {
      hero: {
        title: 'Emily Carter',
        subtitle: 'Your AI Assistant',
        image: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&h=600&fit=crop&q=90',
        bgClass: 'bg-white'
      },
      services: [
        { id: 'catalog', title: 'Chat', priceText: 'Start talking', iconName: 'message-square' },
        { id: 'cart', title: 'History', priceText: 'Past chats', iconName: 'clock' },
        { id: 'profile', title: 'Profile', priceText: 'Settings', iconName: 'user' }
      ]
    }
  },
];
```

## КОНТЕКСТЫ (Contexts)

### contexts/RewardsContext.tsx
```tsx
import React, { createContext, useContext, useState, useEffect } from 'react';

interface Task {
  id: string;
  platform: 'tiktok' | 'instagram';
  type: 'like' | 'follow' | 'share' | 'view' | 'comment';
  title: string;
  description: string;
  coins: number;
  url: string;
  completed: boolean;
  timeLimit?: number;
  startTime?: number;
  minimumTime?: number;
  verificationStatus?: 'pending' | 'verifying' | 'verified' | 'failed';
  attempts?: number;
  lastAttempt?: number;
}

interface UserStats {
  totalCoins: number;
  tasksCompleted: number;
  currentStreak: number;
  level: number;
  totalSaved: number;
}

interface RewardsContextType {
  userStats: UserStats;
  tasks: Task[];
  completeTask: (taskId: string) => void;
  updateStats: (newStats: Partial<UserStats>) => void;
  startTask: (taskId: string) => void;
  verifyTask: (taskId: string) => Promise<boolean>;
}

const defaultTasks: Task[] = [
  {
    id: 'tiktok_like_1',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк TikTok видео',
    description: 'Поставьте лайк нашему последнему видео о разработке приложений',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 8,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_follow',
    platform: 'tiktok',
    type: 'follow',
    title: 'Подписка TikTok',
    description: 'Подпишитесь на наш TikTok аккаунт',
    coins: 150,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    minimumTime: 5,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_like_1',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Instagram поста',
    description: 'Лайкните наш пост про новые функции Telegram Mini Apps',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 6,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_follow',
    platform: 'instagram',
    type: 'follow',
    title: 'Подписка Instagram',
    description: 'Подпишитесь на наш Instagram для получения актуальных новостей',
    coins: 120,
    url: 'https://instagram.com/web4tg',
    completed: false,
    minimumTime: 4,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_share_1',
    platform: 'tiktok',
    type: 'share',
    title: 'Репост TikTok',
    description: 'Поделитесь нашим видео о создании Telegram ботов',
    coins: 100,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 10
  },
  {
    id: 'instagram_share_1',
    platform: 'instagram',
    type: 'share',
    title: 'Репост Instagram',
    description: 'Поделитесь в Stories нашим постом',
    coins: 80,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 8
  },
  {
    id: 'tiktok_comment_1',
    platform: 'tiktok',
    type: 'comment',
    title: 'Комментарий TikTok',
    description: 'Оставьте комментарий под нашим видео о МиниАппах',
    coins: 75,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 7
  },
  {
    id: 'instagram_comment_1',
    platform: 'instagram',
    type: 'comment',
    title: 'Комментарий Instagram',
    description: 'Прокомментируйте наш пост о новых возможностях',
    coins: 60,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 5
  },
  {
    id: 'tiktok_view_1',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр TikTok видео',
    description: 'Досмотрите до конца наше видео о заработке с ТГ ботами',
    coins: 30,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 3
  },
  {
    id: 'instagram_view_1',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр Instagram Reels',
    description: 'Посмотрите наш Reels о создании бизнес-приложений',
    coins: 25,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 2
  },
  {
    id: 'tiktok_like_2',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк TikTok #2',
    description: 'Поставьте лайк видео о кейсах наших клиентов',
    coins: 45,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 4
  },
  {
    id: 'instagram_like_2',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Instagram #2',
    description: 'Лайкните пост о том, как мы помогаем бизнесу расти',
    coins: 35,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 3
  },
  // Дополнительные TikTok задания
  {
    id: 'tiktok_like_3',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк TikTok #3',
    description: 'Поставьте лайк нашему видео о мобильной разработке',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 8,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_like_4',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк TikTok #4',
    description: 'Лайкните видео о дизайне интерфейсов',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 8,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_like_5',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк TikTok #5',
    description: 'Поставьте лайк видео о технологиях будущего',
    coins: 50,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 8,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_share_2',
    platform: 'tiktok',
    type: 'share',
    title: 'Репост TikTok #2',
    description: 'Поделитесь нашим видео о стартапах',
    coins: 100,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 10,
    minimumTime: 15,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_share_3',
    platform: 'tiktok',
    type: 'share',
    title: 'Репост TikTok #3',
    description: 'Поделитесь видео о заработке в интернете',
    coins: 100,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 10,
    minimumTime: 15,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_comment_2',
    platform: 'tiktok',
    type: 'comment',
    title: 'Комментарий TikTok #2',
    description: 'Оставьте развернутый комментарий о своем опыте',
    coins: 75,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 7,
    minimumTime: 20,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_comment_3',
    platform: 'tiktok',
    type: 'comment',
    title: 'Комментарий TikTok #3',
    description: 'Задайте интересный вопрос в комментариях',
    coins: 75,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 7,
    minimumTime: 20,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_view_2',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр TikTok #2',
    description: 'Полностью досмотрите видео о веб-дизайне',
    coins: 30,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 12,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_view_3',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр TikTok #3',
    description: 'Посмотрите видео о цифровом маркетинге',
    coins: 30,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 12,
    verificationStatus: 'pending',
    attempts: 0
  },
  // Дополнительные Instagram задания
  {
    id: 'instagram_like_3',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Instagram #3',
    description: 'Лайкните пост о программировании',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 6,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_like_4',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Instagram #4',
    description: 'Поставьте лайк посту о цифровых технологиях',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 6,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_like_5',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк Instagram #5',
    description: 'Лайкните пост о росте бизнеса',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 6,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_share_2',
    platform: 'instagram',
    type: 'share',
    title: 'Репост Instagram #2',
    description: 'Поделитесь в Stories постом о наших услугах',
    coins: 80,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 8,
    minimumTime: 12,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_share_3',
    platform: 'instagram',
    type: 'share',
    title: 'Репост Instagram #3',
    description: 'Поделитесь Reels с вашими подписчиками',
    coins: 80,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 8,
    minimumTime: 12,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_comment_2',
    platform: 'instagram',
    type: 'comment',
    title: 'Комментарий Instagram #2',
    description: 'Расскажите о своем опыте работы с нами',
    coins: 60,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 18,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_comment_3',
    platform: 'instagram',
    type: 'comment',
    title: 'Комментарий Instagram #3',
    description: 'Поделитесь своими идеями в комментариях',
    coins: 60,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 18,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_view_2',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр Instagram #2',
    description: 'Посмотрите наш Reels о клиентских кейсах',
    coins: 25,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 2,
    minimumTime: 10,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_view_3',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр Instagram #3',
    description: 'Просмотрите все Stories за сегодня',
    coins: 25,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 2,
    minimumTime: 10,
    verificationStatus: 'pending',
    attempts: 0
  },
  // Специальные задания для продвинутых пользователей
  {
    id: 'tiktok_duet_create',
    platform: 'tiktok',
    type: 'share',
    title: 'Создать Duet',
    description: 'Создайте Duet с нашим видео и поделитесь мыслями',
    coins: 200,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 30,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_reel_create',
    platform: 'instagram',
    type: 'share',
    title: 'Создать свой Reels',
    description: 'Создайте Reels о нашей компании',
    coins: 250,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 20,
    minimumTime: 40,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_playlist_save',
    platform: 'tiktok',
    type: 'like',
    title: 'Сохранить в избранное',
    description: 'Добавьте наши видео в свой плейлист',
    coins: 90,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 8,
    minimumTime: 15,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_tag_post',
    platform: 'instagram',
    type: 'share',
    title: 'Отметить в посте',
    description: 'Отметьте наш аккаунт в своем новом посте',
    coins: 180,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 12,
    minimumTime: 25,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_hashtag_use',
    platform: 'tiktok',
    type: 'share',
    title: 'Использовать хештег',
    description: 'Создайте видео с хештегом #web4tg',
    coins: 220,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 18,
    minimumTime: 35,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_hashtag_post',
    platform: 'instagram',
    type: 'share',
    title: 'Пост с хештегом',
    description: 'Создайте пост с хештегом #web4tg',
    coins: 200,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 30,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_trend_follow',
    platform: 'tiktok',
    type: 'view',
    title: 'Просмотр трендов',
    description: 'Найдите наши видео в трендах и досмотрите',
    coins: 60,
    url: 'https://tiktok.com/discover',
    completed: false,
    timeLimit: 10,
    minimumTime: 20,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_explore_visit',
    platform: 'instagram',
    type: 'view',
    title: 'Исследование ленты',
    description: 'Найдите наши посты через поиск и лайкните',
    coins: 45,
    url: 'https://instagram.com/explore',
    completed: false,
    timeLimit: 8,
    minimumTime: 15,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_sound_original',
    platform: 'tiktok',
    type: 'share',
    title: 'Использовать оригинальный звук',
    description: 'Используйте звук из нашего видео для своего контента',
    coins: 190,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 35,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_live_watch',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр прямого эфира',
    description: 'Присоединитесь к нашим прямым эфирам',
    coins: 120,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 20,
    minimumTime: 30,
    verificationStatus: 'pending',
    attempts: 0
  },
  // Еще больше заданий для максимальной раскрутки
  {
    id: 'tiktok_like_multiple_1',
    platform: 'tiktok',
    type: 'like',
    title: 'Лайк 3 видео подряд',
    description: 'Поставьте лайки на 3 наших последних видео подряд',
    coins: 150,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 25,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_like_multiple_1',
    platform: 'instagram',
    type: 'like',
    title: 'Лайк 5 постов подряд',
    description: 'Лайкните 5 наших последних постов подряд',
    coins: 200,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 10,
    minimumTime: 20,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_story_add',
    platform: 'tiktok',
    type: 'share',
    title: 'Добавить в историю',
    description: 'Добавьте наше видео в свою историю TikTok',
    coins: 130,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 8,
    minimumTime: 15,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_story_mention',
    platform: 'instagram',
    type: 'share',
    title: 'Упомянуть в Stories',
    description: 'Упомяните @web4tg в своих Instagram Stories',
    coins: 160,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 10,
    minimumTime: 20,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_challenge_join',
    platform: 'tiktok',
    type: 'share',
    title: 'Участие в челлендже',
    description: 'Примите участие в нашем TikTok челлендже',
    coins: 300,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 25,
    minimumTime: 45,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_tutorial_watch',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр туториала',
    description: 'Посмотрите наш Instagram туториал до конца',
    coins: 80,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 25,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_music_add',
    platform: 'tiktok',
    type: 'like',
    title: 'Добавить музыку в избранное',
    description: 'Добавьте музыку из наших видео в избранное',
    coins: 70,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 10,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_poll_vote',
    platform: 'instagram',
    type: 'view',
    title: 'Голосование в опросе',
    description: 'Проголосуйте в наших Instagram Stories опросах',
    coins: 40,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 3,
    minimumTime: 8,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_effect_use',
    platform: 'tiktok',
    type: 'share',
    title: 'Использовать эффект',
    description: 'Используйте эффект из наших TikTok видео',
    coins: 170,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 12,
    minimumTime: 25,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_dm_send',
    platform: 'instagram',
    type: 'share',
    title: 'Отправить сообщение',
    description: 'Отправьте нам сообщение в Instagram Direct',
    coins: 90,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 12,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_profile_visit_deep',
    platform: 'tiktok',
    type: 'view',
    title: 'Глубокий просмотр профиля',
    description: 'Посетите наш профиль и просмотрите все разделы',
    coins: 60,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 20,
    minimumTime: 35,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_highlight_view',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр сохраненных историй',
    description: 'Просмотрите все наши сохраненные истории',
    coins: 50,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 25,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_collab_request',
    platform: 'tiktok',
    type: 'comment',
    title: 'Запрос на коллаборацию',
    description: 'Предложите идею для совместного видео в комментариях',
    coins: 250,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 10,
    minimumTime: 30,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_business_question',
    platform: 'instagram',
    type: 'comment',
    title: 'Вопрос о бизнесе',
    description: 'Задайте вопрос о развитии бизнеса в комментариях',
    coins: 100,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 8,
    minimumTime: 20,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_friend_invite',
    platform: 'tiktok',
    type: 'share',
    title: 'Пригласить друга',
    description: 'Пригласите друга подписаться на наш TikTok',
    coins: 180,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 15,
    minimumTime: 30,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_friend_tag',
    platform: 'instagram',
    type: 'comment',
    title: 'Отметить друга',
    description: 'Отметьте друга в комментариях к нашему посту',
    coins: 85,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 10,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_weekly_watch',
    platform: 'tiktok',
    type: 'view',
    title: 'Еженедельный просмотр',
    description: 'Просматривайте наши видео каждую неделю',
    coins: 200,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 30,
    minimumTime: 60,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'instagram_carousel_swipe',
    platform: 'instagram',
    type: 'view',
    title: 'Просмотр карусели',
    description: 'Просмотрите все слайды в наших Instagram карусели',
    coins: 55,
    url: 'https://instagram.com/web4tg',
    completed: false,
    timeLimit: 8,
    minimumTime: 15,
    verificationStatus: 'pending',
    attempts: 0
  },
  {
    id: 'tiktok_notification_enable',
    platform: 'tiktok',
    type: 'follow',
    title: 'Включить уведомления',
    description: 'Включите уведомления о новых видео',
    coins: 120,
    url: 'https://tiktok.com/@web4tg',
    completed: false,
    timeLimit: 5,
    minimumTime: 10,
    verificationStatus: 'pending',
    attempts: 0
  }
];

const RewardsContext = createContext<RewardsContextType | undefined>(undefined);

export function RewardsProvider({ children }: { children: React.ReactNode }) {
  const [userStats, setUserStats] = useState<UserStats>(() => {
    // Try to load from localStorage
    const saved = localStorage.getItem('userRewardsStats');
    if (saved) {
      return JSON.parse(saved);
    }
    return {
      totalCoins: 0,
      tasksCompleted: 0,
      currentStreak: 0,
      level: 1,
      totalSaved: 0
    };
  });

  const [tasks, setTasks] = useState<Task[]>(() => {
    // Try to load from localStorage
    const saved = localStorage.getItem('userTasks');
    if (saved) {
      return JSON.parse(saved);
    }
    return defaultTasks;
  });

  // Persist to localStorage on changes
  useEffect(() => {
    localStorage.setItem('userRewardsStats', JSON.stringify(userStats));
  }, [userStats]);

  useEffect(() => {
    localStorage.setItem('userTasks', JSON.stringify(tasks));
  }, [tasks]);

  const updateStats = (newStats: Partial<UserStats>) => {
    setUserStats(prev => ({ ...prev, ...newStats }));
  };

  const startTask = (taskId: string) => {
    setTasks(prevTasks => 
      prevTasks.map(task => 
        task.id === taskId 
          ? { 
              ...task, 
              startTime: Date.now(), 
              verificationStatus: 'pending' as const,
              attempts: (task.attempts || 0) + 1,
              lastAttempt: Date.now()
            }
          : task
      )
    );
  };

  const verifyTask = async (taskId: string): Promise<boolean> => {
    const task = tasks.find(t => t.id === taskId);
    if (!task || !task.startTime) return false;

    // Check minimum time spent
    const timeSpent = Date.now() - task.startTime;
    const minimumTimeMs = (task.minimumTime || 5) * 1000;
    
    if (timeSpent < minimumTimeMs) {
      setTasks(prevTasks => 
        prevTasks.map(t => 
          t.id === taskId 
            ? { ...t, verificationStatus: 'failed' as const }
            : t
        )
      );
      return false;
    }

    // Check if too many attempts
    if ((task.attempts || 0) > 3) {
      setTasks(prevTasks => 
        prevTasks.map(t => 
          t.id === taskId 
            ? { ...t, verificationStatus: 'failed' as const }
            : t
        )
      );
      return false;
    }

    // Check cooldown period (prevent spam)
    if (task.lastAttempt && Date.now() - task.lastAttempt < 30000) {
      return false;
    }

    // Mark as verified and complete
    setTasks(prevTasks => 
      prevTasks.map(t => 
        t.id === taskId 
          ? { ...t, verificationStatus: 'verified' as const, completed: true }
          : t
      )
    );

    // Award coins
    setUserStats(prevStats => ({
      ...prevStats,
      totalCoins: prevStats.totalCoins + task.coins,
      tasksCompleted: prevStats.tasksCompleted + 1,
      currentStreak: prevStats.currentStreak + 1,
      level: Math.floor((prevStats.tasksCompleted + 1) / 5) + 1
    }));

    return true;
  };

  const completeTask = (taskId: string) => {
    verifyTask(taskId);
  };

  const value = {
    userStats,
    tasks,
    completeTask,
    updateStats,
    startTask,
    verifyTask
  };

  return (
    <RewardsContext.Provider value={value}>
      {children}
    </RewardsContext.Provider>
  );
}

export function useRewards() {
  const context = useContext(RewardsContext);
  if (context === undefined) {
    throw new Error('useRewards must be used within a RewardsProvider');
  }
  return context;
}```

### contexts/XPNotificationContext.tsx
```tsx
import { createContext, useContext, useState, useCallback, useEffect, ReactNode } from 'react';
import { XPNotification, AchievementNotification } from '@/components/XPNotification';
import {
  Compass,
  Telescope,
  Star,
  Flame,
  Wrench,
  Layers,
  Rocket,
  Zap
} from 'lucide-react';

interface XPNotif {
  id: string;
  amount: number;
  message: string;
}

interface AchievementNotif {
  id: string;
  name: string;
  description: string;
  iconName: string;
}

interface XPNotificationContextValue {
  showXPNotification: (amount: number, message: string) => void;
  showAchievementNotification: (name: string, description: string, iconName: string) => void;
}

const XPNotificationContext = createContext<XPNotificationContextValue | undefined>(undefined);

const iconMap: Record<string, ReactNode> = {
  'compass': <Compass className="w-16 h-16 text-amber-400" />,
  'telescope': <Telescope className="w-16 h-16 text-blue-400" />,
  'star': <Star className="w-16 h-16 text-yellow-400" />,
  'flame': <Flame className="w-16 h-16 text-orange-400" />,
  'wrench': <Wrench className="w-16 h-16 text-emerald-400" />,
  'layers': <Layers className="w-16 h-16 text-purple-400" />,
  'rocket': <Rocket className="w-16 h-16 text-cyan-400" />,
  'zap': <Zap className="w-16 h-16 text-yellow-400" />
};

export function XPNotificationProvider({ children }: { children: ReactNode }) {
  const [xpNotifs, setXpNotifs] = useState<XPNotif[]>([]);
  const [achievementNotifs, setAchievementNotifs] = useState<AchievementNotif[]>([]);

  const showXPNotification = useCallback((amount: number, message: string) => {
    const id = Date.now().toString() + Math.random();
    setXpNotifs(prev => [...prev, { id, amount, message }]);
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
      setXpNotifs(prev => prev.filter(n => n.id !== id));
    }, 3000);
  }, []);

  const showAchievementNotification = useCallback((name: string, description: string, iconName: string) => {
    const id = Date.now().toString() + Math.random();
    setAchievementNotifs(prev => [...prev, { id, name, description, iconName }]);
    
    // Auto-remove after 4 seconds
    setTimeout(() => {
      setAchievementNotifs(prev => prev.filter(n => n.id !== id));
    }, 4000);
  }, []);

  // Listen to gamification update events
  useEffect(() => {
    const handleGamificationUpdate = (e: Event) => {
      const customEvent = e as CustomEvent;
      const { unlockedAchievements } = customEvent.detail || {};
      
      if (unlockedAchievements && unlockedAchievements.length > 0) {
        unlockedAchievements.forEach((achievement: any) => {
          setTimeout(() => {
            showAchievementNotification(
              achievement.name,
              achievement.description,
              achievement.icon
            );
          }, 500);
        });
      }
    };

    window.addEventListener('gamification_update', handleGamificationUpdate);
    return () => {
      window.removeEventListener('gamification_update', handleGamificationUpdate);
    };
  }, [showAchievementNotification]);

  const closeXPNotif = useCallback((id: string) => {
    setXpNotifs(prev => prev.filter(n => n.id !== id));
  }, []);

  const closeAchievementNotif = useCallback((id: string) => {
    setAchievementNotifs(prev => prev.filter(n => n.id !== id));
  }, []);

  return (
    <XPNotificationContext.Provider value={{ showXPNotification, showAchievementNotification }}>
      {children}
      
      {/* Render XP Notifications */}
      {xpNotifs.map((notif, index) => (
        <div key={notif.id} style={{ top: `${6 + index * 5}rem` }} className="fixed left-1/2 -translate-x-1/2 z-50">
          <XPNotification
            amount={notif.amount}
            message={notif.message}
            show={true}
            onClose={() => closeXPNotif(notif.id)}
          />
        </div>
      ))}
      
      {/* Render Achievement Notifications */}
      {achievementNotifs.map((notif, index) => (
        <div key={notif.id} style={{ top: `${6 + index * 6}rem` }} className="fixed left-1/2 -translate-x-1/2 z-50">
          <AchievementNotification
            name={notif.name}
            description={notif.description}
            icon={iconMap[notif.iconName] || <Star className="w-16 h-16 text-yellow-400" />}
            show={true}
            onClose={() => closeAchievementNotif(notif.id)}
          />
        </div>
      ))}
    </XPNotificationContext.Provider>
  );
}

export function useXPNotifications() {
  const context = useContext(XPNotificationContext);
  if (!context) {
    throw new Error('useXPNotifications must be used within XPNotificationProvider');
  }
  return context;
}
```

## УТИЛИТЫ (Utils)

### utils/errorMonitoring.ts
```tsx
class ErrorMonitor {
  private errors: Array<{ message: string; stack?: string; timestamp: number }> = [];
  private readonly MAX_ERRORS = 100;
  
  init() {
    window.addEventListener('error', (event) => {
      this.logError({
        message: event.message,
        stack: event.error?.stack,
        timestamp: Date.now()
      });
    });
    
    window.addEventListener('unhandledrejection', (event) => {
      this.logError({
        message: `Unhandled Promise Rejection: ${event.reason}`,
        timestamp: Date.now()
      });
    });
  }
  
  logError(error: { message: string; stack?: string; timestamp: number }) {
    this.errors.push(error);
    
    if (this.errors.length > this.MAX_ERRORS) {
      this.errors.shift();
    }
    
    if ((window as any).Sentry) {
      (window as any).Sentry.captureException(new Error(error.message));
    }
    
    console.error('[Error Monitor]', error);
  }
  
  getErrors() {
    return this.errors;
  }
  
  clearErrors() {
    this.errors = [];
  }
}

export const errorMonitor = new ErrorMonitor();
```

### utils/imageUtils.ts
```tsx
// Универсальные fallback изображения для разных категорий
const FALLBACK_IMAGES = {
  // Общий fallback
  default: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  
  // Специфические fallback для категорий
  banking: 'https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  beauty: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  bookstore: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  carwash: 'https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  clothing: 'https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  coffee: 'https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  courses: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  electronics: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  fitness: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  florist: 'https://images.unsplash.com/photo-1487070183336-b8eb9220e21a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  hotel: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  pharmacy: 'https://images.unsplash.com/photo-1576091160550-2173dba999ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  realty: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  restaurant: 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
  taxi: 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400'
};

/**
 * Создает обработчик ошибок для изображений с fallback
 * @param category - категория приложения для выбора подходящего fallback
 * @returns обработчик ошибки изображения
 */
export const createImageErrorHandler = (category: keyof typeof FALLBACK_IMAGES = 'default') => {
  return (e: React.SyntheticEvent<HTMLImageElement, Event>) => {
    const target = e.currentTarget;
    const fallbackImage = FALLBACK_IMAGES[category] || FALLBACK_IMAGES.default;
    
    // Избегаем бесконечного цикла ошибок
    if (target.src !== fallbackImage) {
      target.src = fallbackImage;
    }
  };
};

/**
 * Создает обработчик ошибок для изображений товаров/услуг с дополнительными fallback
 * @param category - категория для выбора fallback
 * @param productType - тип товара/услуги (опционально)
 * @returns обработчик ошибки изображения
 */
export const createProductImageErrorHandler = (
  category: keyof typeof FALLBACK_IMAGES = 'default',
  productType?: string
) => {
  return (e: React.SyntheticEvent<HTMLImageElement, Event>) => {
    const target = e.currentTarget;
    let fallbackImage = FALLBACK_IMAGES[category] || FALLBACK_IMAGES.default;
    
    // Специальные fallback для типов товаров
    if (productType) {
      const productFallbacks = {
        food: 'https://images.unsplash.com/photo-1498837167922-ddd27525d352?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
        drink: 'https://images.unsplash.com/photo-1544145945-f90425340c7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
        book: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
        tech: 'https://images.unsplash.com/photo-1498049794561-7780e7231661?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400',
        service: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400'
      };
      
      fallbackImage = productFallbacks[productType as keyof typeof productFallbacks] || fallbackImage;
    }
    
    // Избегаем бесконечного цикла ошибок
    if (target.src !== fallbackImage) {
      target.src = fallbackImage;
    }
  };
};

/**
 * Валидирует и нормализует URL изображения
 * @param imageUrl - URL изображения
 * @param category - категория для fallback
 * @returns валидный URL изображения
 */
export const validateImageUrl = (
  imageUrl: string | undefined | null,
  category: keyof typeof FALLBACK_IMAGES = 'default'
): string => {
  if (!imageUrl || imageUrl.trim() === '') {
    return FALLBACK_IMAGES[category] || FALLBACK_IMAGES.default;
  }
  
  // Проверяем, что URL выглядит валидным
  try {
    new URL(imageUrl);
    return imageUrl;
  } catch {
    return FALLBACK_IMAGES[category] || FALLBACK_IMAGES.default;
  }
};

export { FALLBACK_IMAGES };

// ==================== PERFORMANCE OPTIMIZATION UTILITIES ====================

export interface ImageOptimizationOptions {
  width?: number;
  height?: number;
  quality?: number;
  format?: 'webp' | 'jpg' | 'png' | 'auto';
  blur?: number;
  dpr?: number; // Device pixel ratio
}

// Optimize Unsplash images with query parameters
export const optimizeUnsplashImage = (
  url: string, 
  options: ImageOptimizationOptions = {}
): string => {
  if (!url.includes('images.unsplash.com')) {
    return url;
  }

  const {
    width = 400,
    height,
    quality = 80,
    format = 'auto',
    blur,
    dpr = 2
  } = options;

  const urlObj = new URL(url);
  
  // Add optimization parameters
  urlObj.searchParams.set('auto', 'format,compress');
  urlObj.searchParams.set('q', quality.toString());
  urlObj.searchParams.set('w', width.toString());
  
  if (height) {
    urlObj.searchParams.set('h', height.toString());
    urlObj.searchParams.set('fit', 'crop');
  }
  
  if (format !== 'auto') {
    urlObj.searchParams.set('fm', format);
  }
  
  if (blur) {
    urlObj.searchParams.set('blur', blur.toString());
  }
  
  urlObj.searchParams.set('dpr', dpr.toString());
  
  return urlObj.toString();
};

// Generate responsive image sources
export const generateResponsiveImages = (
  baseUrl: string,
  sizes: number[] = [320, 640, 960, 1280]
): Array<{ src: string; width: number; media?: string }> => {
  return sizes.map((size, index) => ({
    src: optimizeUnsplashImage(baseUrl, { width: size, quality: 85 }),
    width: size,
    media: index === sizes.length - 1 ? undefined : `(max-width: ${size}px)`
  }));
};

// Create optimized placeholder for lazy loading
export const createOptimizedPlaceholder = (width: number = 400, height: number = 300): string => {
  const svg = `<svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="${width}" height="${height}" fill="#f3f4f6"/><circle cx="${width/2}" cy="${height/2}" r="20" fill="#d1d5db"/></svg>`;
  return `data:image/svg+xml;base64,${btoa(svg)}`;
};

// Blur placeholder for smooth transitions
export const createBlurPlaceholder = (originalUrl: string): string => {
  if (originalUrl.includes('images.unsplash.com')) {
    return optimizeUnsplashImage(originalUrl, { 
      width: 40, 
      height: 30, 
      quality: 20,
      blur: 5 
    });
  }
  return createOptimizedPlaceholder(40, 30);
};

// Responsive breakpoints for mobile optimization
export const RESPONSIVE_BREAKPOINTS = {
  mobile: 320,
  tablet: 768,
  desktop: 1024,
  large: 1280
} as const;

export type BreakpointKey = keyof typeof RESPONSIVE_BREAKPOINTS;

// Get image for specific breakpoint with mobile optimization
export const getResponsiveImage = (
  baseUrl: string,
  breakpoint: BreakpointKey,
  options: Omit<ImageOptimizationOptions, 'width'> = {}
): string => {
  return optimizeUnsplashImage(baseUrl, {
    ...options,
    width: RESPONSIVE_BREAKPOINTS[breakpoint],
    quality: breakpoint === 'mobile' ? 75 : 85 // Lower quality for mobile
  });
};

// Preload critical images for better performance
export const preloadCriticalImages = (urls: string[]): void => {
  urls.forEach(url => {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'image';
    link.href = optimizeUnsplashImage(url, { width: 400, quality: 80 });
    document.head.appendChild(link);
  });
};```

### utils/motionConfig.ts
```tsx
import { MotionConfig } from '@/utils/LazyMotionProvider';
import { DesignTokens } from '@/design-tokens';

export const appleEasing = {
  default: [0.25, 0.1, 0.25, 1],
  in: [0.42, 0, 1, 1],
  out: [0, 0, 0.58, 1],
  inOut: [0.42, 0, 0.58, 1],
  springBounce: [0.68, -0.55, 0.265, 1.55],
  springSmooth: [0.34, 1.56, 0.64, 1],
};

export const appleSpring = DesignTokens.spring;

export const motionConfig = {
  transition: {
    type: 'tween',
    duration: 0.25,
    ease: appleEasing.default
  },
  reducedMotion: 'user'
};

export const fadeInUp = {
  initial: { 
    opacity: 0, 
    y: 20,
    translateZ: 0
  },
  animate: { 
    opacity: 1, 
    y: 0,
    translateZ: 0,
    transition: {
      duration: 0.25,
      ease: appleEasing.out
    }
  },
  exit: { 
    opacity: 0, 
    y: -20,
    translateZ: 0,
    transition: {
      duration: 0.2,
      ease: appleEasing.in
    }
  }
};

export const scaleIn = {
  initial: { 
    scale: 0.95, 
    opacity: 0,
    translateZ: 0
  },
  animate: { 
    scale: 1, 
    opacity: 1,
    translateZ: 0,
    transition: {
      type: 'spring',
      ...appleSpring.default
    }
  },
  exit: {
    scale: 0.95,
    opacity: 0,
    translateZ: 0,
    transition: {
      duration: 0.2,
      ease: appleEasing.in
    }
  }
};

export const slideIn = {
  initial: { 
    x: -20, 
    opacity: 0,
    translateZ: 0
  },
  animate: { 
    x: 0, 
    opacity: 1,
    translateZ: 0,
    transition: {
      duration: 0.25,
      ease: appleEasing.out
    }
  },
  exit: {
    x: 20,
    opacity: 0,
    translateZ: 0,
    transition: {
      duration: 0.2,
      ease: appleEasing.in
    }
  }
};

export const modalFromBottom = {
  initial: {
    opacity: 0,
    y: 100,
    scale: 0.95,
    translateZ: 0
  },
  animate: {
    opacity: 1,
    y: 0,
    scale: 1,
    translateZ: 0,
    transition: {
      type: 'spring',
      ...appleSpring.default
    }
  },
  exit: {
    opacity: 0,
    y: 100,
    scale: 0.95,
    translateZ: 0,
    transition: {
      duration: 0.2,
      ease: appleEasing.in
    }
  }
};

export const layoutTransition = {
  layout: true,
  transition: {
    layout: { 
      duration: 0.25,
      ease: appleEasing.out
    }
  }
};

export const hoverScale = {
  scale: 1.02,
  transition: {
    duration: 0.15,
    ease: appleEasing.out
  }
};

export const tapScale = {
  scale: 0.98,
  transition: {
    duration: 0.1,
    ease: appleEasing.in
  }
};

export function MotionProvider({ children }: { children: React.ReactNode }) {
  return children;
}
```

### utils/performanceMonitor.ts
```tsx
class PerformanceMonitor {
  private static instance: PerformanceMonitor;
  private metrics: Map<string, number[]> = new Map();
  
  static getInstance() {
    if (!this.instance) {
      this.instance = new PerformanceMonitor();
    }
    return this.instance;
  }
  
  measure<T>(name: string, fn: () => T): T {
    const start = performance.now();
    const result = fn();
    const duration = performance.now() - start;
    
    if (!this.metrics.has(name)) {
      this.metrics.set(name, []);
    }
    this.metrics.get(name)!.push(duration);
    
    if (duration > 16.67) {
      console.warn(`⚠️ Slow operation: ${name} took ${duration.toFixed(2)}ms`);
    }
    
    return result;
  }
  
  async measureAsync<T>(name: string, fn: () => Promise<T>): Promise<T> {
    const start = performance.now();
    const result = await fn();
    const duration = performance.now() - start;
    
    if (!this.metrics.has(name)) {
      this.metrics.set(name, []);
    }
    this.metrics.get(name)!.push(duration);
    
    return result;
  }
  
  getStats(name: string) {
    const metrics = this.metrics.get(name) || [];
    if (metrics.length === 0) return null;
    
    const avg = metrics.reduce((a, b) => a + b, 0) / metrics.length;
    const min = Math.min(...metrics);
    const max = Math.max(...metrics);
    
    return { avg, min, max, count: metrics.length };
  }
  
  getMemoryUsage() {
    if ('memory' in performance) {
      const memory = (performance as any).memory;
      return {
        used: (memory.usedJSHeapSize / 1048576).toFixed(2) + ' MB',
        total: (memory.totalJSHeapSize / 1048576).toFixed(2) + ' MB',
        limit: (memory.jsHeapSizeLimit / 1048576).toFixed(2) + ' MB'
      };
    }
    return null;
  }
  
  measureFPS(callback: (fps: number) => void) {
    let lastTime = performance.now();
    let frames = 0;
    
    const measureFrame = () => {
      frames++;
      const currentTime = performance.now();
      
      if (currentTime >= lastTime + 1000) {
        const fps = Math.round((frames * 1000) / (currentTime - lastTime));
        callback(fps);
        
        frames = 0;
        lastTime = currentTime;
      }
      
      requestAnimationFrame(measureFrame);
    };
    
    requestAnimationFrame(measureFrame);
  }
}

export const performanceMonitor = PerformanceMonitor.getInstance();
```

### utils/webVitals.ts
```tsx
import { onCLS, onLCP, onFCP, onTTFB, onINP } from 'web-vitals';

function sendToAnalytics(metric: any) {
  if (typeof window !== 'undefined' && (window as any).gtag) {
    (window as any).gtag('event', metric.name, {
      event_category: 'Web Vitals',
      value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
      event_label: metric.id,
      non_interaction: true
    });
  }
  
  if (process.env.NODE_ENV === 'development') {
    console.log(`[Web Vitals] ${metric.name}:`, metric.value);
  }
}

export function initWebVitals() {
  onCLS(sendToAnalytics);
  onLCP(sendToAnalytics);
  onFCP(sendToAnalytics);
  onTTFB(sendToAnalytics);
  onINP(sendToAnalytics);
}
```

### utils/LazyMotionProvider.tsx
```tsx
import { LazyMotion, domAnimation, m, MotionConfig } from 'framer-motion';
import { ReactNode } from 'react';
import { appleEasing } from './motionConfig';

/**
 * LazyMotion Provider - Reduces bundle size by 40-60%
 * Only loads animation features when needed
 * 
 * Usage:
 * - Wrap your app with <LazyMotionProvider>
 * - Use 'm' instead of 'motion' for animated components
 * - Import all framer-motion exports from this file
 */
export function LazyMotionProvider({ children }: { children: ReactNode }) {
  return (
    <LazyMotion features={domAnimation} strict>
      <MotionConfig 
        reducedMotion="user"
        transition={{ duration: 0.25, ease: appleEasing.default as any }}
      >
        {children}
      </MotionConfig>
    </LazyMotion>
  );
}

// Export optimized motion component and all necessary utilities
export { m };

// Re-export all commonly used framer-motion utilities
export {
  AnimatePresence,
  useMotionValue,
  useSpring,
  useTransform,
  useScroll,
  useInView,
  useReducedMotion
} from 'framer-motion';

// Export 'm' as 'motion' for easier migration
export { m as motion };

/**
 * Bundle size comparison:
 * - Regular motion: ~80-100KB (gzipped)
 * - LazyMotion + domAnimation: ~30-40KB (gzipped)
 * Savings: ~50KB (40-60% reduction)
 */
```

## СЕРВЕР (Server)

### server/db.ts
```typescript
// Referenced from javascript_database blueprint
import { Pool, neonConfig } from '@neondatabase/serverless';
import { drizzle } from 'drizzle-orm/neon-serverless';
import ws from "ws";
import * as schema from "../shared/schema";

neonConfig.webSocketConstructor = ws;

if (!process.env.DATABASE_URL) {
  throw new Error(
    "DATABASE_URL must be set. Did you forget to provision a database?",
  );
}

export const pool = new Pool({ connectionString: process.env.DATABASE_URL });
export const db = drizzle({ client: pool, schema });
```

### server/index.ts
```typescript
import express, { type Request, Response, NextFunction } from "express";
import compression from "compression";
import { registerRoutes } from "./routes";
import { setupVite, serveStatic, log } from "./vite";

const app = express();

// Brotli/Gzip compression for all responses
app.use(compression({
  level: 6, // Compression level (0-9)
  threshold: 1024, // Only compress files > 1KB
  filter: (req, res) => {
    // Don't compress if client doesn't support it
    if (req.headers['x-no-compression']) {
      return false;
    }
    // Use compression filter function
    return compression.filter(req, res);
  }
}));

app.use(express.json());
app.use(express.urlencoded({ extended: false }));

// Disable caching ONLY in development to ensure fresh content
if (process.env.NODE_ENV === 'development') {
  app.use((req, res, next) => {
    res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
    res.setHeader('Pragma', 'no-cache');
    res.setHeader('Expires', '0');
    next();
  });
}

app.use((req, res, next) => {
  const start = Date.now();
  const path = req.path;
  let capturedJsonResponse: Record<string, any> | undefined = undefined;

  const originalResJson = res.json;
  res.json = function (bodyJson, ...args) {
    capturedJsonResponse = bodyJson;
    return originalResJson.apply(res, [bodyJson, ...args]);
  };

  res.on("finish", () => {
    const duration = Date.now() - start;
    if (path.startsWith("/api")) {
      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;
      if (capturedJsonResponse) {
        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;
      }

      if (logLine.length > 80) {
        logLine = logLine.slice(0, 79) + "…";
      }

      log(logLine);
    }
  });

  next();
});

(async () => {
  const server = await registerRoutes(app);

  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {
    const status = err.status || err.statusCode || 500;
    const message = err.message || "Internal Server Error";

    res.status(status).json({ message });
    throw err;
  });

  // importantly only setup vite in development and after
  // setting up all the other routes so the catch-all route
  // doesn't interfere with the other routes
  if (app.get("env") === "development") {
    await setupVite(app, server);
  } else {
    serveStatic(app);
  }

  // ALWAYS serve the app on the port specified in the environment variable PORT
  // Other ports are firewalled. Default to 5000 if not specified.
  // this serves both the API and the client.
  // It is the only port that is not firewalled.
  const port = parseInt(process.env.PORT || '5000', 10);
  server.listen({
    port,
    host: "0.0.0.0",
    reusePort: true,
  }, () => {
    log(`serving on port ${port}`);
  });
})();
```

### server/objectAcl.ts
```typescript
// Referenced from javascript_object_storage blueprint
import { File } from "@google-cloud/storage";

const ACL_POLICY_METADATA_KEY = "custom:aclPolicy";

export enum ObjectAccessGroupType {}

export interface ObjectAccessGroup {
  type: ObjectAccessGroupType;
  id: string;
}

export enum ObjectPermission {
  READ = "read",
  WRITE = "write",
}

export interface ObjectAclRule {
  group: ObjectAccessGroup;
  permission: ObjectPermission;
}

export interface ObjectAclPolicy {
  owner: string;
  visibility: "public" | "private";
  aclRules?: Array<ObjectAclRule>;
}

function isPermissionAllowed(
  requested: ObjectPermission,
  granted: ObjectPermission,
): boolean {
  if (requested === ObjectPermission.READ) {
    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);
  }
  return granted === ObjectPermission.WRITE;
}

abstract class BaseObjectAccessGroup implements ObjectAccessGroup {
  constructor(
    public readonly type: ObjectAccessGroupType,
    public readonly id: string,
  ) {}

  public abstract hasMember(userId: string): Promise<boolean>;
}

function createObjectAccessGroup(
  group: ObjectAccessGroup,
): BaseObjectAccessGroup {
  switch (group.type) {
    default:
      throw new Error(`Unknown access group type: ${group.type}`);
  }
}

export async function setObjectAclPolicy(
  objectFile: File,
  aclPolicy: ObjectAclPolicy,
): Promise<void> {
  const [exists] = await objectFile.exists();
  if (!exists) {
    throw new Error(`Object not found: ${objectFile.name}`);
  }

  await objectFile.setMetadata({
    metadata: {
      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),
    },
  });
}

export async function getObjectAclPolicy(
  objectFile: File,
): Promise<ObjectAclPolicy | null> {
  const [metadata] = await objectFile.getMetadata();
  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];
  if (!aclPolicy) {
    return null;
  }
  return JSON.parse(aclPolicy as string);
}

export async function canAccessObject({
  userId,
  objectFile,
  requestedPermission,
}: {
  userId?: string;
  objectFile: File;
  requestedPermission: ObjectPermission;
}): Promise<boolean> {
  const aclPolicy = await getObjectAclPolicy(objectFile);
  if (!aclPolicy) {
    return false;
  }

  if (
    aclPolicy.visibility === "public" &&
    requestedPermission === ObjectPermission.READ
  ) {
    return true;
  }

  if (!userId) {
    return false;
  }

  if (aclPolicy.owner === userId) {
    return true;
  }

  for (const rule of aclPolicy.aclRules || []) {
    const accessGroup = createObjectAccessGroup(rule.group);
    if (
      (await accessGroup.hasMember(userId)) &&
      isPermissionAllowed(requestedPermission, rule.permission)
    ) {
      return true;
    }
  }

  return false;
}
```

### server/objectStorage.ts
```typescript
// Referenced from javascript_object_storage blueprint
import { Storage, File } from "@google-cloud/storage";
import { Response } from "express";
import { randomUUID } from "crypto";
import {
  ObjectAclPolicy,
  ObjectPermission,
  canAccessObject,
  getObjectAclPolicy,
  setObjectAclPolicy,
} from "./objectAcl";

const REPLIT_SIDECAR_ENDPOINT = "http://127.0.0.1:1106";

// The object storage client is used to interact with the object storage service.
export const objectStorageClient = new Storage({
  credentials: {
    audience: "replit",
    subject_token_type: "access_token",
    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,
    type: "external_account",
    credential_source: {
      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,
      format: {
        type: "json",
        subject_token_field_name: "access_token",
      },
    },
    universe_domain: "googleapis.com",
  },
  projectId: "",
});

export class ObjectNotFoundError extends Error {
  constructor() {
    super("Object not found");
    this.name = "ObjectNotFoundError";
    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);
  }
}

// The object storage service is used to interact with the object storage service.
export class ObjectStorageService {
  constructor() {}

  // Gets the public object search paths.
  getPublicObjectSearchPaths(): Array<string> {
    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || "";
    const paths = Array.from(
      new Set(
        pathsStr
          .split(",")
          .map((path) => path.trim())
          .filter((path) => path.length > 0)
      )
    );
    if (paths.length === 0) {
      throw new Error(
        "PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' " +
          "tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths)."
      );
    }
    return paths;
  }

  // Gets the private object directory.
  getPrivateObjectDir(): string {
    const dir = process.env.PRIVATE_OBJECT_DIR || "";
    if (!dir) {
      throw new Error(
        "PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' " +
          "tool and set PRIVATE_OBJECT_DIR env var."
      );
    }
    return dir;
  }

  // Search for a public object from the search paths.
  async searchPublicObject(filePath: string): Promise<File | null> {
    for (const searchPath of this.getPublicObjectSearchPaths()) {
      const fullPath = `${searchPath}/${filePath}`;

      // Full path format: /<bucket_name>/<object_name>
      const { bucketName, objectName } = parseObjectPath(fullPath);
      const bucket = objectStorageClient.bucket(bucketName);
      const file = bucket.file(objectName);

      // Check if file exists
      const [exists] = await file.exists();
      if (exists) {
        return file;
      }
    }

    return null;
  }

  // Downloads an object to the response.
  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {
    try {
      // Get file metadata
      const [metadata] = await file.getMetadata();
      // Get the ACL policy for the object.
      const aclPolicy = await getObjectAclPolicy(file);
      const isPublic = aclPolicy?.visibility === "public";
      // Set appropriate headers
      res.set({
        "Content-Type": metadata.contentType || "application/octet-stream",
        "Content-Length": metadata.size,
        "Cache-Control": `${
          isPublic ? "public" : "private"
        }, max-age=${cacheTtlSec}`,
      });

      // Stream the file to the response
      const stream = file.createReadStream();

      stream.on("error", (err) => {
        console.error("Stream error:", err);
        if (!res.headersSent) {
          res.status(500).json({ error: "Error streaming file" });
        }
      });

      stream.pipe(res);
    } catch (error) {
      console.error("Error downloading file:", error);
      if (!res.headersSent) {
        res.status(500).json({ error: "Error downloading file" });
      }
    }
  }

  // Gets the upload URL for an object entity.
  async getObjectEntityUploadURL(): Promise<string> {
    const privateObjectDir = this.getPrivateObjectDir();
    if (!privateObjectDir) {
      throw new Error(
        "PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' " +
          "tool and set PRIVATE_OBJECT_DIR env var."
      );
    }

    const objectId = randomUUID();
    const fullPath = `${privateObjectDir}/uploads/${objectId}`;

    const { bucketName, objectName } = parseObjectPath(fullPath);

    // Sign URL for PUT method with TTL
    return signObjectURL({
      bucketName,
      objectName,
      method: "PUT",
      ttlSec: 900,
    });
  }

  // Gets the object entity file from the object path.
  async getObjectEntityFile(objectPath: string): Promise<File> {
    if (!objectPath.startsWith("/objects/")) {
      throw new ObjectNotFoundError();
    }

    const parts = objectPath.slice(1).split("/");
    if (parts.length < 2) {
      throw new ObjectNotFoundError();
    }

    const entityId = parts.slice(1).join("/");
    let entityDir = this.getPrivateObjectDir();
    if (!entityDir.endsWith("/")) {
      entityDir = `${entityDir}/`;
    }
    const objectEntityPath = `${entityDir}${entityId}`;
    const { bucketName, objectName } = parseObjectPath(objectEntityPath);
    const bucket = objectStorageClient.bucket(bucketName);
    const objectFile = bucket.file(objectName);
    const [exists] = await objectFile.exists();
    if (!exists) {
      throw new ObjectNotFoundError();
    }
    return objectFile;
  }

  normalizeObjectEntityPath(rawPath: string): string {
    if (!rawPath.startsWith("https://storage.googleapis.com/")) {
      return rawPath;
    }

    // Extract the path from the URL by removing query parameters and domain
    const url = new URL(rawPath);
    const rawObjectPath = url.pathname;

    let objectEntityDir = this.getPrivateObjectDir();
    if (!objectEntityDir.endsWith("/")) {
      objectEntityDir = `${objectEntityDir}/`;
    }

    if (!rawObjectPath.startsWith(objectEntityDir)) {
      return rawObjectPath;
    }

    // Extract the entity ID from the path
    const entityId = rawObjectPath.slice(objectEntityDir.length);
    return `/objects/${entityId}`;
  }

  // Tries to set the ACL policy for the object entity and return the normalized path.
  async trySetObjectEntityAclPolicy(
    rawPath: string,
    aclPolicy: ObjectAclPolicy
  ): Promise<string> {
    const normalizedPath = this.normalizeObjectEntityPath(rawPath);
    if (!normalizedPath.startsWith("/")) {
      return normalizedPath;
    }

    const objectFile = await this.getObjectEntityFile(normalizedPath);
    await setObjectAclPolicy(objectFile, aclPolicy);
    return normalizedPath;
  }

  // Checks if the user can access the object entity.
  async canAccessObjectEntity({
    userId,
    objectFile,
    requestedPermission,
  }: {
    userId?: string;
    objectFile: File;
    requestedPermission?: ObjectPermission;
  }): Promise<boolean> {
    return canAccessObject({
      userId,
      objectFile,
      requestedPermission: requestedPermission ?? ObjectPermission.READ,
    });
  }
}

function parseObjectPath(path: string): {
  bucketName: string;
  objectName: string;
} {
  if (!path.startsWith("/")) {
    path = `/${path}`;
  }
  const pathParts = path.split("/");
  if (pathParts.length < 3) {
    throw new Error("Invalid path: must contain at least a bucket name");
  }

  const bucketName = pathParts[1];
  const objectName = pathParts.slice(2).join("/");

  return {
    bucketName,
    objectName,
  };
}

async function signObjectURL({
  bucketName,
  objectName,
  method,
  ttlSec,
}: {
  bucketName: string;
  objectName: string;
  method: "GET" | "PUT" | "DELETE" | "HEAD";
  ttlSec: number;
}): Promise<string> {
  const request = {
    bucket_name: bucketName,
    object_name: objectName,
    method,
    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),
  };
  const response = await fetch(
    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(request),
    }
  );
  if (!response.ok) {
    throw new Error(
      `Failed to sign object URL, errorcode: ${response.status}, ` +
        `make sure you're running on Replit`
    );
  }

  const { signed_url: signedURL } = await response.json();
  return signedURL;
}
```

### server/routes.ts
```typescript
import type { Express } from "express";
import { createServer, type Server } from "http";
import crypto from "crypto";
import { db } from "./db";
import { photos, insertPhotoSchema, users, referrals, gamificationStats, dailyTasks, tasksProgress, userCoinsBalance } from "../shared/schema";
import { ObjectStorageService, ObjectNotFoundError } from "./objectStorage";
import { desc, eq, and, sql } from "drizzle-orm";

// Initialize Stripe only if secret key is available
let stripe: any = null;
if (process.env.STRIPE_SECRET_KEY) {
  const Stripe = require('stripe');
  stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {
    apiVersion: "2023-10-16",
  });
}

// Validate Telegram WebApp initData
function validateTelegramInitData(initData: string, botToken: string): any {
  try {
    const urlParams = new URLSearchParams(initData);
    const hash = urlParams.get('hash');
    if (!hash) return null;

    // Remove hash from params for validation
    urlParams.delete('hash');

    // Create data-check string (sorted keys)
    const dataCheckString = Array.from(urlParams.entries())
      .sort(([a], [b]) => a.localeCompare(b))
      .map(([key, value]) => `${key}=${value}`)
      .join('\n');

    // Calculate secret key
    const secretKey = crypto
      .createHmac('sha256', 'WebAppData')
      .update(botToken)
      .digest();

    // Calculate hash
    const calculatedHash = crypto
      .createHmac('sha256', secretKey)
      .update(dataCheckString)
      .digest('hex');

    // Verify hash
    if (calculatedHash !== hash) {
      return null;
    }

    // Parse user data
    const userParam = urlParams.get('user');
    if (!userParam) return null;

    const user = JSON.parse(userParam);
    return user;
  } catch (error) {
    console.error('Error validating Telegram initData:', error);
    return null;
  }
}

// Middleware to verify Telegram user
function verifyTelegramUser(req: any, res: any, next: any) {
  const botToken = process.env.TELEGRAM_BOT_TOKEN;
  if (!botToken) {
    return res.status(503).json({ error: 'Telegram bot not configured' });
  }

  const initData = req.headers['x-telegram-init-data'] || req.body.initData;
  if (!initData) {
    return res.status(401).json({ error: 'Missing Telegram init data' });
  }

  const user = validateTelegramInitData(initData, botToken);
  if (!user) {
    return res.status(401).json({ error: 'Invalid Telegram init data' });
  }

  // Attach verified user to request
  req.telegramUser = user;
  next();
}

export async function registerRoutes(app: Express): Promise<Server> {
  // Telegram Mini App routes
  const TELEGRAM_BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN;

  // Telegram webhook endpoint
  app.post("/api/telegram/webhook", async (req, res) => {
    if (!TELEGRAM_BOT_TOKEN) {
      return res.status(503).json({ error: "Telegram bot not configured" });
    }

    try {
      const update = req.body;
      console.log('Telegram webhook:', JSON.stringify(update, null, 2));
      
      const webAppUrl = process.env.RAILWAY_PUBLIC_DOMAIN 
        ? `https://${process.env.RAILWAY_PUBLIC_DOMAIN}`
        : process.env.REPLIT_DEV_DOMAIN 
        ? `https://${process.env.REPLIT_DEV_DOMAIN}`
        : 'https://telegram-mini-app-showcase-production.up.railway.app';
      
      // Premium Welcome Message Helper
      const sendPremiumMessage = async (chatId: number, text: string, extraButtons: any[] = []) => {
        const keyboard = [
          [{ text: '💎 Launch Premium Suite', web_app: { url: webAppUrl } }],
          ...extraButtons
        ];
        
        return await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            chat_id: chatId,
            text: text,
            parse_mode: 'HTML',
            reply_markup: { inline_keyboard: keyboard }
          })
        });
      };
      
      // Handle callback queries from inline buttons
      if (update.callback_query) {
        const callbackQuery = update.callback_query;
        const chatId = callbackQuery.message.chat.id;
        const data = callbackQuery.data;
        
        // Answer callback query immediately
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/answerCallbackQuery`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            callback_query_id: callbackQuery.id,
            text: '✨ Loading...'
          })
        });
        
        // Handle different callback actions
        if (data === 'showcase') {
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: `💎 <b>ПОРТФОЛИО ЭКСКЛЮЗИВНЫХ РЕШЕНИЙ</b>\n\n` +
                    `<i>Авторские приложения премиум-класса</i>\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `🏆 <b>FASHION & LUXURY</b>\n` +
                    `Gucci • Nike • Adidas • Premium Brands\n` +
                    `Индивидуальный дизайн для каждого бренда\n\n` +
                    `🍾 <b>HOSPITALITY & WELLNESS</b>\n` +
                    `Рестораны мирового уровня • Spa • Fitness\n` +
                    `Безупречный пользовательский опыт\n\n` +
                    `🤖 <b>AI-POWERED SOLUTIONS</b>\n` +
                    `Умные агенты • Персонализация • Аналитика\n` +
                    `Технологии завтрашнего дня — сегодня\n\n` +
                    `🏡 <b>REAL ESTATE & FINTECH</b>\n` +
                    `Недвижимость премиум-класса • Инвестиции\n` +
                    `Элитный сервис для элитных клиентов\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `<i>Откройте приложение для полного погружения</i>`,
              parse_mode: 'HTML',
              reply_markup: {
                inline_keyboard: [
                  [{ text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }],
                  [
                    { text: '💰 Рефералы', callback_data: 'referral' },
                    { text: '🎯 Задания', callback_data: 'tasks' }
                  ],
                  [{ text: '🏠 Главное меню', callback_data: 'start' }]
                ]
              }
            })
          });
        } else if (data === 'referral') {
          const telegramIdRef = Number(chatId);
          const referralStats = await db.select().from(referrals)
            .where(eq(referrals.referrerTelegramId, telegramIdRef));
          const totalReferrals = referralStats.length;
          const totalEarned = referralStats.reduce((sum, ref) => sum + Number(ref.bonusAmount || 0), 0);
          
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: `🎁 <b>ПАРТНЁРСКАЯ ПРОГРАММА</b>\n\n` +
                    `<i>Эксклюзивные условия для наших партнёров</i>\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `💰 <b>ВАША СТАТИСТИКА</b>\n` +
                    `Приглашено: ${totalReferrals} чел.\n` +
                    `Заработано: ${totalEarned.toFixed(2)} RUB\n\n` +
                    `💎 <b>ПРЕМИАЛЬНЫЕ УСЛОВИЯ</b>\n` +
                    `• 20% от первого заказа партнёра\n` +
                    `• 10% пожизненные отчисления\n` +
                    `• Безлимитная партнёрская сеть\n` +
                    `• Моментальные выплаты\n\n` +
                    `🏆 <b>VIP СТАТУСЫ</b>\n` +
                    `Bronze: 5+ партнёров → +2% бонус\n` +
                    `Silver: 20+ партнёров → +5% бонус\n` +
                    `Gold: 50+ партнёров → +10% бонус\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `<i>Откройте приложение для вашей реферальной ссылки</i>`,
              parse_mode: 'HTML',
              reply_markup: {
                inline_keyboard: [
                  [{ text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }],
                  [
                    { text: '💎 Портфолио', callback_data: 'showcase' },
                    { text: '🎯 Задания', callback_data: 'tasks' }
                  ],
                  [{ text: '🏠 Главное меню', callback_data: 'start' }]
                ]
              }
            })
          });
        } else if (data === 'tasks') {
          const telegramIdTasks = Number(chatId);
          const userStats = await db.select().from(gamificationStats)
            .where(eq(gamificationStats.telegramId, telegramIdTasks)).limit(1);
          const coinsDataTasks = await db.select().from(userCoinsBalance)
            .where(eq(userCoinsBalance.telegramId, telegramIdTasks)).limit(1);
          const completedTasks = await db.select().from(tasksProgress)
            .where(and(
              eq(tasksProgress.telegramId, telegramIdTasks),
              eq(tasksProgress.completed, true)
            ));
          const availableTasks = await db.select().from(dailyTasks)
            .where(and(
              eq(dailyTasks.telegramId, telegramIdTasks),
              eq(dailyTasks.completed, false)
            ));
          
          const coins = coinsDataTasks[0]?.availableCoins || 0;
          const level = userStats[0]?.level || 1;
          const streak = coinsDataTasks[0]?.currentStreak || 0;
          
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: `🎯 <b>ЗАДАНИЯ & ВОЗНАГРАЖДЕНИЯ</b>\n\n` +
                    `<i>Эксклюзивная система лояльности</i>\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `💎 <b>ВАШ БАЛАНС</b>\n` +
                    `${coins} монет • Уровень ${level}\n` +
                    `Серия: ${streak} дней 🔥\n\n` +
                    `✅ <b>ПРОГРЕСС</b>\n` +
                    `Выполнено: ${completedTasks.length} заданий\n` +
                    `Доступно: ${availableTasks.length} новых\n\n` +
                    `🏆 <b>КАТЕГОРИИ ЗАДАНИЙ</b>\n` +
                    `• Социальные сети — до 100 монет\n` +
                    `• Ежедневные миссии — до 250 монет\n` +
                    `• Партнёрская программа — до 500 монет\n` +
                    `• Эксклюзивные задания — до 1000 монет\n\n` +
                    `💰 <b>МОНЕТЫ → РАЗРАБОТКА</b>\n` +
                    `Используйте монеты для заказа вашего\n` +
                    `собственного Telegram приложения!\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `<i>Откройте приложение для выполнения заданий</i>`,
              parse_mode: 'HTML',
              reply_markup: {
                inline_keyboard: [
                  [{ text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }],
                  [
                    { text: '💰 Рефералы', callback_data: 'referral' },
                    { text: '👤 Профиль', callback_data: 'profile' }
                  ],
                  [{ text: '🏠 Главное меню', callback_data: 'start' }]
                ]
              }
            })
          });
        } else if (data === 'profile') {
          const telegramIdProfile = Number(chatId);
          const profileUser = await db.select().from(users)
            .where(eq(users.telegramId, telegramIdProfile)).limit(1);
          const profileStats = await db.select().from(gamificationStats)
            .where(eq(gamificationStats.telegramId, telegramIdProfile)).limit(1);
          const coinsDataProfile = await db.select().from(userCoinsBalance)
            .where(eq(userCoinsBalance.telegramId, telegramIdProfile)).limit(1);
          const profileReferrals = await db.select().from(referrals)
            .where(eq(referrals.referrerTelegramId, telegramIdProfile));
          const profileTasks = await db.select().from(tasksProgress)
            .where(and(
              eq(tasksProgress.telegramId, telegramIdProfile),
              eq(tasksProgress.completed, true)
            ));
          
          const userName = profileUser[0]?.firstName || 'Пользователь';
          const userCoinsProfile = coinsDataProfile[0]?.availableCoins || 0;
          const userLevelProfile = profileStats[0]?.level || 1;
          const userXP = profileStats[0]?.xp || 0;
          const userStreak = coinsDataProfile[0]?.currentStreak || 0;
          const totalReferralsProfile = profileReferrals.length;
          const totalTasksProfile = profileTasks.length;
          
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: `👤 <b>ЛИЧНЫЙ КАБИНЕТ VIP</b>\n\n` +
                    `<i>Добро пожаловать, ${userName}</i>\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `💎 <b>СТАТУС & ДОСТИЖЕНИЯ</b>\n` +
                    `Уровень: ${userLevelProfile} ⭐\n` +
                    `Опыт: ${userXP} XP\n` +
                    `Баланс: ${userCoinsProfile} монет\n` +
                    `Серия: ${userStreak} дней подряд 🔥\n\n` +
                    `📊 <b>СТАТИСТИКА</b>\n` +
                    `Выполнено заданий: ${totalTasksProfile}\n` +
                    `Приглашено партнёров: ${totalReferralsProfile}\n` +
                    `Активность: ${userStreak > 7 ? 'Высокая 🚀' : userStreak > 3 ? 'Средняя 📈' : 'Начальная 🌱'}\n\n` +
                    `🏆 <b>ВАШИ ПРИВИЛЕГИИ</b>\n` +
                    `• Доступ к эксклюзивным заданиям\n` +
                    `• Приоритетная поддержка 24/7\n` +
                    `• Персональные скидки на разработку\n` +
                    `• VIP-статус в партнёрской программе\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `<i>Откройте приложение для полной аналитики</i>`,
              parse_mode: 'HTML',
              reply_markup: {
                inline_keyboard: [
                  [{ text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }],
                  [
                    { text: '💰 Рефералы', callback_data: 'referral' },
                    { text: '🎯 Задания', callback_data: 'tasks' }
                  ],
                  [{ text: '🏠 Главное меню', callback_data: 'start' }]
                ]
              }
            })
          });
        } else if (data === 'help') {
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: `❓ <b>РУКОВОДСТВО VIP</b>\n\n` +
                    `<i>Навигация по эксклюзивной платформе</i>\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `🎯 <b>БЫСТРЫЙ СТАРТ</b>\n` +
                    `1. Откройте приложение через меню\n` +
                    `2. Изучите 18+ премиум решений\n` +
                    `3. Выполняйте задания → зарабатывайте\n` +
                    `4. Делитесь ссылкой → получайте бонусы\n` +
                    `5. Тратьте монеты на разработку\n\n` +
                    `💎 <b>КОМАНДЫ ПЛАТФОРМЫ</b>\n` +
                    `/start — Главное меню\n` +
                    `/showcase — Портфолио решений\n` +
                    `/referral — Партнёрская программа\n` +
                    `/tasks — Задания & награды\n` +
                    `/profile — Личный кабинет\n` +
                    `/help — Это руководство\n\n` +
                    `🏆 <b>VIP ПОДДЕРЖКА 24/7</b>\n` +
                    `Telegram: @YourSupportBot\n` +
                    `Приоритетное обслуживание\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `<i>Создано для амбициозных предпринимателей</i>`,
              parse_mode: 'HTML',
              reply_markup: {
                inline_keyboard: [
                  [{ text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }],
                  [
                    { text: '💎 Портфолио', callback_data: 'showcase' },
                    { text: '👤 Профиль', callback_data: 'profile' }
                  ],
                  [{ text: '🏠 Главное меню', callback_data: 'start' }]
                ]
              }
            })
          });
        } else if (data === 'start') {
          // Back to main menu
          const telegramIdNum = Number(chatId);
          const stats = await db.select().from(gamificationStats).where(eq(gamificationStats.telegramId, telegramIdNum)).limit(1);
          const coinsData = await db.select().from(userCoinsBalance).where(eq(userCoinsBalance.telegramId, telegramIdNum)).limit(1);
          const userCoins = coinsData[0]?.availableCoins || 0;
          const userLevel = stats[0]?.level || 1;
          
          await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: `✨ <b>ЭКСКЛЮЗИВНАЯ СТУДИЯ</b>\n` +
                    `<b>TELEGRAM APPLICATIONS</b>\n\n` +
                    `<i>Создаём будущее вашего бизнеса</i>\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `🎨 <b>АВТОРСКИЙ ВИЗУАЛЬНЫЙ ДИЗАЙН</b>\n` +
                    `Уникальная эстетика, которой нет ни у кого.\n` +
                    `Каждый пиксель создан для превосходства.\n\n` +
                    `💼 <b>18+ ПРЕМИУМ РЕШЕНИЙ</b>\n` +
                    `Fashion • E-commerce • Wellness • AI\n` +
                    `Недвижимость • Рестораны • Финтех\n\n` +
                    `💎 <b>ВАШ СТАТУС</b>\n` +
                    `Уровень: ${userLevel} | Баланс: ${userCoins} монет\n\n` +
                    `━━━━━━━━━━━━━━━━━━━━\n\n` +
                    `<i>Эксклюзивный доступ. Безупречное исполнение.</i>`,
              parse_mode: 'HTML',
              reply_markup: {
                inline_keyboard: [
                  [{ text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }],
                  [
                    { text: '💎 Портфолио', callback_data: 'showcase' },
                    { text: '🎯 Задания', callback_data: 'tasks' }
                  ],
                  [
                    { text: '💰 Рефералы', callback_data: 'referral' },
                    { text: '👤 Профиль', callback_data: 'profile' }
                  ],
                  [{ text: '❓ Помощь', callback_data: 'help' }]
                ]
              }
            })
          });
        }
      }
      
      // Handle text messages and commands
      if (update.message && update.message.text) {
        const chatId = update.message.chat.id;
        const command = update.message.text.split(' ')[0];
        
        switch(command) {
          case '/start':
            // Get or create user in database
            const telegramIdNum = Number(chatId);
            let user = await db.select().from(users).where(eq(users.telegramId, telegramIdNum)).limit(1);
            
            if (user.length === 0) {
              // Generate unique referral code
              const referralCode = `REF${telegramIdNum}`;
              
              // Create new user
              await db.insert(users).values({
                telegramId: telegramIdNum,
                username: update.message?.from?.username || null,
                firstName: update.message?.from?.first_name || null,
                lastName: update.message?.from?.last_name || null,
                referralCode
              });
              
              // Initialize gamification stats
              await db.insert(gamificationStats).values({
                telegramId: telegramIdNum
              });
              
              // Initialize coins balance
              await db.insert(userCoinsBalance).values({
                telegramId: telegramIdNum
              });
            }
            
            // Get user stats
            const stats = await db.select().from(gamificationStats).where(eq(gamificationStats.telegramId, telegramIdNum)).limit(1);
            const coinsData = await db.select().from(userCoinsBalance).where(eq(userCoinsBalance.telegramId, telegramIdNum)).limit(1);
            const userCoins = coinsData[0]?.availableCoins || 0;
            const userLevel = stats[0]?.level || 1;
            
            // Send message with navigation buttons
            await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                chat_id: chatId,
                text: `✨ <b>ЭКСКЛЮЗИВНАЯ СТУДИЯ</b>\n` +
                      `<b>TELEGRAM APPLICATIONS</b>\n\n` +
                      `<i>Создаём будущее вашего бизнеса</i>\n\n` +
                      `━━━━━━━━━━━━━━━━━━━━\n\n` +
                      `🎨 <b>АВТОРСКИЙ ВИЗУАЛЬНЫЙ ДИЗАЙН</b>\n` +
                      `Уникальная эстетика, которой нет ни у кого.\n` +
                      `Каждый пиксель создан для превосходства.\n\n` +
                      `💼 <b>18+ ПРЕМИУМ РЕШЕНИЙ</b>\n` +
                      `Fashion • E-commerce • Wellness • AI\n` +
                      `Недвижимость • Рестораны • Финтех\n\n` +
                      `💎 <b>ВАШ СТАТУС</b>\n` +
                      `Уровень: ${userLevel} | Баланс: ${userCoins} монет\n\n` +
                      `━━━━━━━━━━━━━━━━━━━━\n\n` +
                      `<i>Эксклюзивный доступ. Безупречное исполнение.</i>`,
                parse_mode: 'HTML',
                reply_markup: {
                  inline_keyboard: [
                    [
                      { text: '🚀 Открыть приложение', web_app: { url: webAppUrl } }
                    ],
                    [
                      { text: '💎 Портфолио', callback_data: 'showcase' },
                      { text: '🎯 Задания', callback_data: 'tasks' }
                    ],
                    [
                      { text: '💰 Рефералы', callback_data: 'referral' },
                      { text: '👤 Профиль', callback_data: 'profile' }
                    ],
                    [
                      { text: '❓ Помощь', callback_data: 'help' }
                    ]
                  ]
                }
              })
            });
            break;
            
          case '/showcase':
            await sendPremiumMessage(
              chatId,
              `💎 <b>ПОРТФОЛИО ЭКСКЛЮЗИВНЫХ РЕШЕНИЙ</b>\n\n` +
              `<i>Авторские приложения премиум-класса</i>\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `🏆 <b>FASHION & LUXURY</b>\n` +
              `Gucci • Nike • Adidas • Premium Brands\n` +
              `Индивидуальный дизайн для каждого бренда\n\n` +
              `🍾 <b>HOSPITALITY & WELLNESS</b>\n` +
              `Рестораны мирового уровня • Spa • Fitness\n` +
              `Безупречный пользовательский опыт\n\n` +
              `🤖 <b>AI-POWERED SOLUTIONS</b>\n` +
              `Умные агенты • Персонализация • Аналитика\n` +
              `Технологии завтрашнего дня — сегодня\n\n` +
              `🏡 <b>REAL ESTATE & FINTECH</b>\n` +
              `Недвижимость премиум-класса • Инвестиции\n` +
              `Элитный сервис для элитных клиентов\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `<i>Откройте приложение для полного погружения</i>`
            );
            break;
            
          case '/referral':
            // Get referral stats
            const telegramIdRef = Number(chatId);
            const referralStats = await db.select().from(referrals)
              .where(eq(referrals.referrerTelegramId, telegramIdRef));
            const totalReferrals = referralStats.length;
            const totalEarned = referralStats.reduce((sum, ref) => sum + Number(ref.bonusAmount || 0), 0);
            
            await sendPremiumMessage(
              chatId,
              `🎁 <b>ПАРТНЁРСКАЯ ПРОГРАММА</b>\n\n` +
              `<i>Эксклюзивные условия для наших партнёров</i>\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `💰 <b>ВАША СТАТИСТИКА</b>\n` +
              `Приглашено: ${totalReferrals} чел.\n` +
              `Заработано: ${totalEarned.toFixed(2)} RUB\n\n` +
              `💎 <b>ПРЕМИАЛЬНЫЕ УСЛОВИЯ</b>\n` +
              `• 20% от первого заказа партнёра\n` +
              `• 10% пожизненные отчисления\n` +
              `• Безлимитная партнёрская сеть\n` +
              `• Моментальные выплаты\n\n` +
              `🏆 <b>VIP СТАТУСЫ</b>\n` +
              `Bronze: 5+ партнёров → +2% бонус\n` +
              `Silver: 20+ партнёров → +5% бонус\n` +
              `Gold: 50+ партнёров → +10% бонус\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `<i>Откройте приложение для вашей реферальной ссылки</i>`
            );
            break;
            
          case '/tasks':
            // Get user tasks stats
            const telegramIdTasks = Number(chatId);
            const userStats = await db.select().from(gamificationStats)
              .where(eq(gamificationStats.telegramId, telegramIdTasks)).limit(1);
            const coinsDataTasks = await db.select().from(userCoinsBalance)
              .where(eq(userCoinsBalance.telegramId, telegramIdTasks)).limit(1);
            const completedTasks = await db.select().from(tasksProgress)
              .where(and(
                eq(tasksProgress.telegramId, telegramIdTasks),
                eq(tasksProgress.completed, true)
              ));
            // Get available tasks for THIS user only
            const availableTasks = await db.select().from(dailyTasks)
              .where(and(
                eq(dailyTasks.telegramId, telegramIdTasks),
                eq(dailyTasks.completed, false)
              ));
            
            const coins = coinsDataTasks[0]?.availableCoins || 0;
            const level = userStats[0]?.level || 1;
            const streak = coinsDataTasks[0]?.currentStreak || 0;
            
            await sendPremiumMessage(
              chatId,
              `🎯 <b>ЗАДАНИЯ & ВОЗНАГРАЖДЕНИЯ</b>\n\n` +
              `<i>Эксклюзивная система лояльности</i>\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `💎 <b>ВАШ БАЛАНС</b>\n` +
              `${coins} монет • Уровень ${level}\n` +
              `Серия: ${streak} дней 🔥\n\n` +
              `✅ <b>ПРОГРЕСС</b>\n` +
              `Выполнено: ${completedTasks.length} заданий\n` +
              `Доступно: ${availableTasks.length} новых\n\n` +
              `🏆 <b>КАТЕГОРИИ ЗАДАНИЙ</b>\n` +
              `• Социальные сети — до 100 монет\n` +
              `• Ежедневные миссии — до 250 монет\n` +
              `• Партнёрская программа — до 500 монет\n` +
              `• Эксклюзивные задания — до 1000 монет\n\n` +
              `💰 <b>МОНЕТЫ → РАЗРАБОТКА</b>\n` +
              `Используйте монеты для заказа вашего\n` +
              `собственного Telegram приложения!\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `<i>Откройте приложение для выполнения заданий</i>`
            );
            break;
            
          case '/profile':
            // Get full user profile
            const telegramIdProfile = Number(chatId);
            const profileUser = await db.select().from(users)
              .where(eq(users.telegramId, telegramIdProfile)).limit(1);
            const profileStats = await db.select().from(gamificationStats)
              .where(eq(gamificationStats.telegramId, telegramIdProfile)).limit(1);
            const coinsDataProfile = await db.select().from(userCoinsBalance)
              .where(eq(userCoinsBalance.telegramId, telegramIdProfile)).limit(1);
            const profileReferrals = await db.select().from(referrals)
              .where(eq(referrals.referrerTelegramId, telegramIdProfile));
            const profileTasks = await db.select().from(tasksProgress)
              .where(and(
                eq(tasksProgress.telegramId, telegramIdProfile),
                eq(tasksProgress.completed, true)
              ));
            
            const userName = profileUser[0]?.firstName || 'Пользователь';
            const userCoinsProfile = coinsDataProfile[0]?.availableCoins || 0;
            const userLevelProfile = profileStats[0]?.level || 1;
            const userXP = profileStats[0]?.xp || 0;
            const userStreak = coinsDataProfile[0]?.currentStreak || 0;
            const totalReferralsProfile = profileReferrals.length;
            const totalTasksProfile = profileTasks.length;
            
            await sendPremiumMessage(
              chatId,
              `👤 <b>ЛИЧНЫЙ КАБИНЕТ VIP</b>\n\n` +
              `<i>Добро пожаловать, ${userName}</i>\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `💎 <b>СТАТУС & ДОСТИЖЕНИЯ</b>\n` +
              `Уровень: ${userLevelProfile} ⭐\n` +
              `Опыт: ${userXP} XP\n` +
              `Баланс: ${userCoinsProfile} монет\n` +
              `Серия: ${userStreak} дней подряд 🔥\n\n` +
              `📊 <b>СТАТИСТИКА</b>\n` +
              `Выполнено заданий: ${totalTasksProfile}\n` +
              `Приглашено партнёров: ${totalReferralsProfile}\n` +
              `Активность: ${userStreak > 7 ? 'Высокая 🚀' : userStreak > 3 ? 'Средняя 📈' : 'Начальная 🌱'}\n\n` +
              `🏆 <b>ВАШИ ПРИВИЛЕГИИ</b>\n` +
              `• Доступ к эксклюзивным заданиям\n` +
              `• Приоритетная поддержка 24/7\n` +
              `• Персональные скидки на разработку\n` +
              `• VIP-статус в партнёрской программе\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `<i>Откройте приложение для полной аналитики</i>`
            );
            break;
            
          case '/help':
            await sendPremiumMessage(
              chatId,
              `❓ <b>РУКОВОДСТВО VIP</b>\n\n` +
              `<i>Навигация по эксклюзивной платформе</i>\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `🎯 <b>БЫСТРЫЙ СТАРТ</b>\n` +
              `1. Откройте приложение через меню\n` +
              `2. Изучите 18+ премиум решений\n` +
              `3. Выполняйте задания → зарабатывайте\n` +
              `4. Делитесь ссылкой → получайте бонусы\n` +
              `5. Тратьте монеты на разработку\n\n` +
              `💎 <b>КОМАНДЫ ПЛАТФОРМЫ</b>\n` +
              `/start — Главное меню\n` +
              `/showcase — Портфолио решений\n` +
              `/referral — Партнёрская программа\n` +
              `/tasks — Задания & награды\n` +
              `/profile — Личный кабинет\n` +
              `/help — Это руководство\n\n` +
              `🏆 <b>VIP ПОДДЕРЖКА 24/7</b>\n` +
              `Telegram: @YourSupportBot\n` +
              `Приоритетное обслуживание\n\n` +
              `━━━━━━━━━━━━━━━━━━━━\n\n` +
              `<i>Создано для амбициозных предпринимателей</i>`
            );
            break;
            
          default:
            // Unknown command - show help
            if (command.startsWith('/')) {
              await sendPremiumMessage(
                chatId,
                `🤔 <b>Неизвестная команда</b>\n\n` +
                `Извините, я не понимаю эту команду.\n\n` +
                `Попробуйте одну из этих:\n` +
                `/start - Главное меню\n` +
                `/showcase - Каталог приложений\n` +
                `/help - Помощь`
              );
            }
        }
      }
      
      res.json({ ok: true });
    } catch (error: any) {
      console.error('Telegram webhook error:', error);
      res.status(500).json({ error: error.message });
    }
  });

  // Set Telegram bot commands
  app.post("/api/telegram/setup", async (req, res) => {
    if (!TELEGRAM_BOT_TOKEN) {
      return res.status(503).json({ error: "Telegram bot not configured" });
    }

    try {
      const webAppUrl = process.env.RAILWAY_PUBLIC_DOMAIN 
        ? `https://${process.env.RAILWAY_PUBLIC_DOMAIN}`
        : process.env.REPLIT_DEV_DOMAIN 
        ? `https://${process.env.REPLIT_DEV_DOMAIN}`
        : 'https://telegram-mini-app-showcase-production.up.railway.app';
      
      // Set bot menu commands
      const commandsResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/setMyCommands`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          commands: [
            { command: 'start', description: '🏠 Запустить Telegram Mini Apps' },
            { command: 'showcase', description: '💎 Открыть каталог приложений' },
            { command: 'referral', description: '💰 Реферальная программа' },
            { command: 'tasks', description: '🎯 Задания и награды' },
            { command: 'profile', description: '👤 Мой профиль' },
            { command: 'help', description: '❓ Помощь' }
          ]
        })
      });

      // Set webhook
      const webhookUrl = process.env.RAILWAY_PUBLIC_DOMAIN 
        ? `https://${process.env.RAILWAY_PUBLIC_DOMAIN}/api/telegram/webhook`
        : process.env.REPLIT_DEV_DOMAIN 
        ? `https://${process.env.REPLIT_DEV_DOMAIN}/api/telegram/webhook`
        : 'https://telegram-mini-app-showcase-production.up.railway.app/api/telegram/webhook';
      const webhookResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/setWebhook`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          url: webhookUrl
        })
      });

      const commandsResult = await commandsResponse.json();
      const webhookResult = await webhookResponse.json();
      
      res.json({
        success: true,
        webAppUrl,
        webhookUrl,
        commands: commandsResult,
        webhook: webhookResult
      });
    } catch (error: any) {
      console.error('Telegram setup error:', error);
      res.status(500).json({ error: error.message });
    }
  });

  // Service Worker Reset Endpoint - CRITICAL for Railway black screen fix
  // This endpoint is served with headers that prevent SW caching
  // It helps users escape from stuck service workers
  app.get("/sw-reset", (_req, res) => {
    res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate');
    res.setHeader('Clear-Site-Data', '"cache", "storage"');
    res.setHeader('Content-Type', 'text/html; charset=utf-8');
    
    res.send(`
<!DOCTYPE html>
<html>
<head>
  <title>Resetting...</title>
  <meta charset="UTF-8">
  <style>
    body { 
      background: #0A0A0B; 
      color: #10B981; 
      font-family: system-ui; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      height: 100vh; 
      margin: 0; 
    }
    .container { text-align: center; }
    .spinner { 
      border: 4px solid rgba(16, 185, 129, 0.3);
      border-top: 4px solid #10B981;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="spinner"></div>
    <h2>Clearing cache and reloading...</h2>
    <p>Please wait a moment</p>
  </div>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(regs => {
        Promise.all(regs.map(reg => reg.unregister()))
          .then(() => console.log('[SW-Reset] Unregistered all workers'));
      });
      
      if ('caches' in window) {
        caches.keys().then(names => {
          Promise.all(names.map(name => caches.delete(name)))
            .then(() => console.log('[SW-Reset] Cleared all caches'));
        });
      }
    }
    
    // Redirect to home after 2 seconds
    setTimeout(() => {
      window.location.href = '/';
    }, 2000);
  </script>
</body>
</html>
    `);
  });

  // Get Telegram bot info
  app.get("/api/telegram/info", async (req, res) => {
    if (!TELEGRAM_BOT_TOKEN) {
      return res.status(503).json({ error: "Telegram bot not configured" });
    }

    try {
      const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getMe`);
      const botInfo = await response.json();
      
      const webAppUrl = process.env.RAILWAY_PUBLIC_DOMAIN 
        ? `https://${process.env.RAILWAY_PUBLIC_DOMAIN}`
        : process.env.REPLIT_DEV_DOMAIN 
        ? `https://${process.env.REPLIT_DEV_DOMAIN}`
        : 'https://telegram-mini-app-showcase-production.up.railway.app';
      
      res.json({
        bot: botInfo.result,
        webAppUrl,
        configured: true
      });
    } catch (error: any) {
      console.error('Telegram info error:', error);
      res.status(500).json({ error: error.message });
    }
  });

  // Stripe payment routes
  app.post("/api/create-payment-intent", async (req, res) => {
    if (!stripe) {
      return res.status(503).json({ 
        error: "Payment processing is not available. Stripe not configured." 
      });
    }

    try {
      const { amount, project_name, features } = req.body;
      
      // Convert amount to cents (Stripe expects cents)
      const amountInCents = Math.round(amount * 100);
      
      const paymentIntent = await stripe.paymentIntents.create({
        amount: amountInCents,
        currency: "rub", // Russian Ruble
        metadata: {
          project_name: project_name || 'WEB4TG Project',
          features: JSON.stringify(features || []),
          service: 'WEB4TG Development'
        },
        description: `WEB4TG Development: ${project_name}`,
      });
      
      res.json({ 
        clientSecret: paymentIntent.client_secret,
        paymentIntentId: paymentIntent.id
      });
    } catch (error: any) {
      console.error('Stripe payment intent creation error:', error);
      res.status(500).json({ 
        error: "Error creating payment intent: " + error.message 
      });
    }
  });

  // Payment success webhook (for future use)
  app.post("/api/payment-success", async (req, res) => {
    try {
      const { paymentIntentId, projectName, features } = req.body;
      
      // Here you would typically:
      // 1. Verify payment with Stripe
      // 2. Create project record in database
      // 3. Send confirmation email
      // 4. Trigger development workflow
      
      console.log('Payment successful for project:', projectName);
      res.json({ success: true });
    } catch (error: any) {
      console.error('Payment success handling error:', error);
      res.status(500).json({ error: error.message });
    }
  });

  // Health check for payment system
  app.get("/api/payment-status", (req, res) => {
    res.json({ 
      stripe_available: !!stripe,
      environment: process.env.NODE_ENV || 'development'
    });
  });

  // In-memory storage for user projects (in production use database)
  const userProjects = new Map<string, any[]>();

  // Получение проектов пользователя по Telegram ID
  app.get("/api/user-projects/:telegramId", (req, res) => {
    try {
      const { telegramId } = req.params;
      
      // Получаем проекты пользователя из памяти
      const projects = userProjects.get(telegramId) || [];
      
      res.json(projects);
    } catch (error) {
      console.error('Error fetching user projects:', error);
      res.status(500).json({ error: 'Failed to fetch projects' });
    }
  });

  // Создание нового проекта после оплаты
  app.post("/api/create-project", (req, res) => {
    try {
      const { telegramId, projectName, projectType, features, paymentIntentId } = req.body;
      
      // Создаем новый проект
      const newProject = {
        id: Date.now(),
        name: projectName || 'Новый проект',
        type: projectType || 'basic',
        status: 'Оплачено',
        progress: 10,
        createdAt: new Date().toISOString(),
        features: features || [],
        paymentIntentId,
        telegramUserId: telegramId
      };
      
      // Сохраняем проект
      const existingProjects = userProjects.get(telegramId) || [];
      existingProjects.push(newProject);
      userProjects.set(telegramId, existingProjects);
      
      console.log(`Created project for user ${telegramId}:`, projectName);
      res.json({ success: true, project: newProject });
    } catch (error) {
      console.error('Error creating project:', error);
      res.status(500).json({ error: 'Failed to create project' });
    }
  });

  // Обновление статуса проекта (для имитации прогресса разработки)
  app.post("/api/update-project-status", (req, res) => {
    try {
      const { telegramId, projectId, status, progress } = req.body;
      
      const projects = userProjects.get(telegramId) || [];
      const projectIndex = projects.findIndex(p => p.id === projectId);
      
      if (projectIndex !== -1) {
        projects[projectIndex].status = status || projects[projectIndex].status;
        projects[projectIndex].progress = progress !== undefined ? progress : projects[projectIndex].progress;
        projects[projectIndex].updatedAt = new Date().toISOString();
        
        userProjects.set(telegramId, projects);
        
        res.json({ success: true, project: projects[projectIndex] });
      } else {
        res.status(404).json({ error: 'Project not found' });
      }
    } catch (error) {
      console.error('Error updating project status:', error);
      res.status(500).json({ error: 'Failed to update project' });
    }
  });

  // Добавление тестовых данных (для демонстрации)
  app.post("/api/init-demo-projects/:telegramId", (req, res) => {
    try {
      const { telegramId } = req.params;
      
      const demoProjects = [
        {
          id: 1001,
          name: 'Магазин одежды',
          type: 'ecommerce',
          status: 'В разработке',
          progress: 75,
          createdAt: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
          features: ['catalog', 'cart', 'payment'],
          telegramUserId: telegramId
        },
        {
          id: 1002,
          name: 'Ресторан доставки',
          type: 'restaurant',
          status: 'Готово',
          progress: 100,
          createdAt: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
          features: ['menu', 'orders', 'delivery'],
          telegramUserId: telegramId
        },
        {
          id: 1003,
          name: 'Фитнес-клуб',
          type: 'fitness',
          status: 'Планирование',
          progress: 25,
          createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
          features: ['booking', 'memberships'],
          telegramUserId: telegramId
        }
      ];
      
      userProjects.set(telegramId, demoProjects);
      
      res.json({ success: true, projects: demoProjects });
    } catch (error) {
      console.error('Error initializing demo projects:', error);
      res.status(500).json({ error: 'Failed to initialize demo projects' });
    }
  });

  // ============ PHOTO GALLERY API ============
  // Referenced from javascript_object_storage blueprint

  // Endpoint для получения presigned URL для загрузки фотографии
  app.post("/api/photos/upload-url", async (req, res) => {
    try {
      const objectStorageService = new ObjectStorageService();
      const uploadURL = await objectStorageService.getObjectEntityUploadURL();
      res.json({ uploadURL });
    } catch (error) {
      console.error('Error getting upload URL:', error);
      res.status(500).json({ error: 'Failed to get upload URL' });
    }
  });

  // Endpoint для сохранения метаданных фотографии после загрузки
  app.post("/api/photos", async (req, res) => {
    try {
      const validatedData = insertPhotoSchema.parse(req.body);
      
      // Normalize the object path from the upload URL
      const objectStorageService = new ObjectStorageService();
      const normalizedPath = objectStorageService.normalizeObjectEntityPath(validatedData.objectPath);
      
      // Устанавливаем ACL политику (публичный доступ для фотографий)
      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(
        validatedData.objectPath,
        {
          owner: validatedData.userId || "anonymous",
          visibility: "public",
        }
      );

      // Сохраняем метаданные в БД
      const [photo] = await db.insert(photos).values({
        ...validatedData,
        objectPath: objectPath,
      }).returning();

      res.json(photo);
    } catch (error) {
      console.error('Error creating photo:', error);
      res.status(500).json({ error: 'Failed to create photo' });
    }
  });

  // Endpoint для получения всех фотографий
  app.get("/api/photos", async (req, res) => {
    try {
      const allPhotos = await db.select().from(photos).orderBy(desc(photos.uploadedAt));
      res.json(allPhotos);
    } catch (error) {
      console.error('Error fetching photos:', error);
      res.status(500).json({ error: 'Failed to fetch photos' });
    }
  });

  // Endpoint для получения конкретной фотографии по ID
  app.get("/api/photos/:id", async (req, res) => {
    try {
      const photoId = parseInt(req.params.id);
      const [photo] = await db.select().from(photos).where(eq(photos.id, photoId));
      
      if (!photo) {
        return res.status(404).json({ error: 'Photo not found' });
      }
      
      res.json(photo);
    } catch (error) {
      console.error('Error fetching photo:', error);
      res.status(500).json({ error: 'Failed to fetch photo' });
    }
  });

  // Endpoint для скачивания фотографии (публичный доступ)
  app.get("/objects/:objectPath(*)", async (req, res) => {
    const objectStorageService = new ObjectStorageService();
    try {
      const objectFile = await objectStorageService.getObjectEntityFile(req.path);
      objectStorageService.downloadObject(objectFile, res);
    } catch (error) {
      console.error("Error downloading object:", error);
      if (error instanceof ObjectNotFoundError) {
        return res.sendStatus(404);
      }
      return res.sendStatus(500);
    }
  });

  // Endpoint для удаления фотографии
  app.delete("/api/photos/:id", async (req, res) => {
    try {
      const photoId = parseInt(req.params.id);
      const [deletedPhoto] = await db.delete(photos).where(eq(photos.id, photoId)).returning();
      
      if (!deletedPhoto) {
        return res.status(404).json({ error: 'Photo not found' });
      }
      
      res.json({ success: true, photo: deletedPhoto });
    } catch (error) {
      console.error('Error deleting photo:', error);
      res.status(500).json({ error: 'Failed to delete photo' });
    }
  });

  // ===== REFERRAL PROGRAM API =====

  // Генерация уникального реферального кода
  function generateReferralCode(): string {
    return 'WEB4TG' + Math.random().toString(36).substring(2, 8).toUpperCase();
  }

  // Определение уровня по количеству рефералов
  function calculateTier(totalReferrals: number): string {
    if (totalReferrals >= 100) return 'Platinum';
    if (totalReferrals >= 30) return 'Gold';
    if (totalReferrals >= 10) return 'Silver';
    return 'Bronze';
  }

  // Рассчитать XP для следующего уровня
  function calculateXpToNextLevel(level: number): number {
    return Math.floor(100 * Math.pow(1.5, level - 1));
  }

  // Инициализация пользователя (создание или получение)
  app.post("/api/referrals/user/init", verifyTelegramUser, async (req: any, res) => {
    try {
      const telegram_id = req.telegramUser.id;
      const username = req.telegramUser.username;
      const first_name = req.telegramUser.first_name;
      const last_name = req.telegramUser.last_name;
      const { referred_by_code } = req.body;

      if (!telegram_id) {
        return res.status(400).json({ error: 'telegram_id is required' });
      }

      // Проверить, существует ли пользователь
      const [existingUser] = await db.select().from(users).where(eq(users.telegramId, telegram_id));

      if (existingUser) {
        return res.json(existingUser);
      }

      // Создать нового пользователя
      const referralCode = generateReferralCode();
      
      const [newUser] = await db.insert(users).values({
        telegramId: telegram_id,
        username,
        firstName: first_name,
        lastName: last_name,
        referralCode: referralCode,
        referredByCode: referred_by_code || null,
      }).returning();

      // Если пользователь был приглашен, создать запись в referrals
      if (referred_by_code) {
        const [referrer] = await db.select().from(users).where(eq(users.referralCode, referred_by_code));

        if (referrer) {
          // Создать запись реферала
          await db.insert(referrals).values({
            referrerTelegramId: referrer.telegramId,
            referredTelegramId: telegram_id,
            bonusAmount: "100",
            status: 'active',
          });

          // Обновить статистику реферера
          const newTotalReferrals = (referrer.totalReferrals || 0) + 1;
          await db.update(users)
            .set({
              totalReferrals: newTotalReferrals,
              activeReferrals: (referrer.activeReferrals || 0) + 1,
              totalEarnings: sql`${users.totalEarnings} + 100`,
              tier: calculateTier(newTotalReferrals),
            })
            .where(eq(users.telegramId, referrer.telegramId));

          // Начислить монеты реферу (100 монет за приглашение)
          const REFERRAL_COINS_REWARD = 100;
          let [referrerBalance] = await db
            .select()
            .from(userCoinsBalance)
            .where(eq(userCoinsBalance.telegramId, referrer.telegramId));

          if (!referrerBalance) {
            await db.insert(userCoinsBalance).values({
              telegramId: referrer.telegramId,
              totalCoins: REFERRAL_COINS_REWARD,
              availableCoins: REFERRAL_COINS_REWARD,
              tasksCompleted: 0,
              lastActivityDate: new Date().toISOString().split('T')[0],
            });
          } else {
            await db
              .update(userCoinsBalance)
              .set({
                totalCoins: (referrerBalance.totalCoins || 0) + REFERRAL_COINS_REWARD,
                availableCoins: (referrerBalance.availableCoins || 0) + REFERRAL_COINS_REWARD,
                lastActivityDate: new Date().toISOString().split('T')[0],
              })
              .where(eq(userCoinsBalance.telegramId, referrer.telegramId));
          }

          // Начислить приветственный бонус новому пользователю (50 монет)
          const WELCOME_BONUS = 50;
          await db.insert(userCoinsBalance).values({
            telegramId: telegram_id,
            totalCoins: WELCOME_BONUS,
            availableCoins: WELCOME_BONUS,
            tasksCompleted: 0,
            lastActivityDate: new Date().toISOString().split('T')[0],
          }).onConflictDoNothing();
        }
      }

      // Создать gamification stats для нового пользователя
      await db.insert(gamificationStats).values({
        telegramId: telegram_id,
      }).onConflictDoNothing();

      res.json(newUser);
    } catch (error) {
      console.error('Error initializing user:', error);
      res.status(500).json({ error: 'Failed to initialize user' });
    }
  });

  // Получить статистику реферальной программы
  app.get("/api/referrals/stats/:telegram_id", verifyTelegramUser, async (req: any, res) => {
    try {
      const telegram_id = req.telegramUser.id;
      const [user] = await db.select().from(users).where(eq(users.telegramId, telegram_id));

      if (!user) {
        return res.status(404).json({ error: 'User not found' });
      }

      res.json(user);
    } catch (error) {
      console.error('Error fetching referral stats:', error);
      res.status(500).json({ error: 'Failed to fetch stats' });
    }
  });

  // Получить список рефералов
  app.get("/api/referrals/referrals/:telegram_id", async (req, res) => {
    try {
      const telegram_id = parseInt(req.params.telegram_id);

      const referralsList = await db
        .select({
          telegramId: users.telegramId,
          username: users.username,
          firstName: users.firstName,
          lastName: users.lastName,
          bonusAmount: referrals.bonusAmount,
          status: referrals.status,
          createdAt: referrals.createdAt,
        })
        .from(referrals)
        .innerJoin(users, eq(referrals.referredTelegramId, users.telegramId))
        .where(eq(referrals.referrerTelegramId, telegram_id))
        .orderBy(desc(referrals.createdAt));

      res.json(referralsList);
    } catch (error) {
      console.error('Error fetching referrals:', error);
      res.status(500).json({ error: 'Failed to fetch referrals' });
    }
  });

  // ===== GAMIFICATION API =====

  // Получить gamification stats
  app.get("/api/gamification/stats/:telegram_id", async (req, res) => {
    try {
      const telegram_id = parseInt(req.params.telegram_id);

      let [stats] = await db.select().from(gamificationStats).where(eq(gamificationStats.telegramId, telegram_id));

      if (!stats) {
        // Создать если не существует
        [stats] = await db.insert(gamificationStats).values({
          telegramId: telegram_id,
        }).returning();
      }

      // Обновить streak
      const currentDate = new Date().toISOString().split('T')[0];
      const lastVisit = stats.lastVisitDate;
      const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

      if (lastVisit !== currentDate) {
        let newStreak = stats.currentStreak || 1;
        
        if (lastVisit === yesterday) {
          newStreak += 1;
        } else {
          newStreak = 1;
        }

        const bestStreak = Math.max(stats.bestStreak || 1, newStreak);

        [stats] = await db.update(gamificationStats)
          .set({
            currentStreak: newStreak,
            bestStreak: bestStreak,
            lastVisitDate: currentDate,
          })
          .where(eq(gamificationStats.telegramId, telegram_id))
          .returning();
      }

      res.json(stats);
    } catch (error) {
      console.error('Error fetching gamification stats:', error);
      res.status(500).json({ error: 'Failed to fetch gamification stats' });
    }
  });

  // Начислить XP
  app.post("/api/gamification/award-xp", async (req, res) => {
    try {
      const { telegram_id, xp } = req.body;

      if (!telegram_id || !xp) {
        return res.status(400).json({ error: 'telegram_id and xp are required' });
      }

      const [stats] = await db.select().from(gamificationStats).where(eq(gamificationStats.telegramId, telegram_id));

      if (!stats) {
        return res.status(404).json({ error: 'Stats not found' });
      }

      let newXp = (stats.xp || 0) + xp;
      let newLevel = stats.level || 1;
      let newTotalXp = (stats.totalXp || 0) + xp;
      let xpToNextLevel = stats.xpToNextLevel || 100;

      // Проверка повышения уровня
      while (newXp >= xpToNextLevel) {
        newXp -= xpToNextLevel;
        newLevel += 1;
        xpToNextLevel = calculateXpToNextLevel(newLevel);
      }

      const [updated] = await db.update(gamificationStats)
        .set({
          xp: newXp,
          level: newLevel,
          totalXp: newTotalXp,
          xpToNextLevel: xpToNextLevel,
        })
        .where(eq(gamificationStats.telegramId, telegram_id))
        .returning();

      res.json(updated);
    } catch (error) {
      console.error('Error awarding XP:', error);
      res.status(500).json({ error: 'Failed to award XP' });
    }
  });

  // Получить ежедневные задачи
  app.get("/api/gamification/daily-tasks/:telegram_id", async (req, res) => {
    try {
      const telegram_id = parseInt(req.params.telegram_id);
      const today = new Date().toISOString().split('T')[0];

      // Получить задачи на сегодня
      let tasks = await db.select().from(dailyTasks).where(
        and(
          eq(dailyTasks.telegramId, telegram_id),
          eq(dailyTasks.taskDate, today)
        )
      );

      // Если задач нет, создать новые
      if (tasks.length === 0) {
        const defaultTasks = [
          { task_id: 'view-demos', task_name: 'Просмотрите 3 демо', description: 'Изучите минимум 3 демо-приложения', xp_reward: 50, max_progress: 3 },
          { task_id: 'customize-project', task_name: 'Настройте проект', description: 'Откройте конструктор и настройте проект', xp_reward: 100, max_progress: 1 },
          { task_id: 'share', task_name: 'Поделитесь с другом', description: 'Отправьте ссылку другу', xp_reward: 150, max_progress: 1 }
        ];

        for (const task of defaultTasks) {
          await db.insert(dailyTasks).values({
            telegramId: telegram_id,
            taskId: task.task_id,
            taskName: task.task_name,
            description: task.description,
            xpReward: task.xp_reward,
            maxProgress: task.max_progress,
            taskDate: today,
          });
        }

        tasks = await db.select().from(dailyTasks).where(
          and(
            eq(dailyTasks.telegramId, telegram_id),
            eq(dailyTasks.taskDate, today)
          )
        );
      }

      res.json(tasks);
    } catch (error) {
      console.error('Error fetching daily tasks:', error);
      res.status(500).json({ error: 'Failed to fetch daily tasks' });
    }
  });

  // Выполнить задачу
  app.post("/api/gamification/complete-task", async (req, res) => {
    try {
      const { telegram_id, task_id } = req.body;
      const today = new Date().toISOString().split('T')[0];

      const [task] = await db.select().from(dailyTasks).where(
        and(
          eq(dailyTasks.telegramId, telegram_id),
          eq(dailyTasks.taskId, task_id),
          eq(dailyTasks.taskDate, today)
        )
      );

      if (!task) {
        return res.status(404).json({ error: 'Task not found' });
      }

      if (task.completed) {
        return res.status(400).json({ error: 'Task already completed' });
      }

      // Отметить задачу как выполненную
      await db.update(dailyTasks)
        .set({
          completed: true,
          progress: task.maxProgress,
        })
        .where(
          and(
            eq(dailyTasks.telegramId, telegram_id),
            eq(dailyTasks.taskId, task_id),
            eq(dailyTasks.taskDate, today)
          )
        );

      // Начислить XP
      const xpReward = task.xpReward || 0;
      await db.update(gamificationStats)
        .set({
          totalXp: sql`${gamificationStats.totalXp} + ${xpReward}`,
          xp: sql`${gamificationStats.xp} + ${xpReward}`,
          completedTasks: sql`${gamificationStats.completedTasks} + 1`,
        })
        .where(eq(gamificationStats.telegramId, telegram_id));

      // Проверить повышение уровня
      const [stats] = await db.select().from(gamificationStats).where(eq(gamificationStats.telegramId, telegram_id));

      let newXp = stats.xp || 0;
      let newLevel = stats.level || 1;
      let xpToNextLevel = stats.xpToNextLevel || 100;

      while (newXp >= xpToNextLevel) {
        newXp -= xpToNextLevel;
        newLevel += 1;
        xpToNextLevel = calculateXpToNextLevel(newLevel);
      }

      if (newLevel !== stats.level) {
        await db.update(gamificationStats)
          .set({
            xp: newXp,
            level: newLevel,
            xpToNextLevel: xpToNextLevel,
          })
          .where(eq(gamificationStats.telegramId, telegram_id));
      }

      res.json({ success: true, xp_awarded: xpReward });
    } catch (error) {
      console.error('Error completing task:', error);
      res.status(500).json({ error: 'Failed to complete task' });
    }
  });

  // Получить leaderboard
  app.get("/api/gamification/leaderboard", async (req, res) => {
    try {
      const top = await db
        .select({
          telegramId: gamificationStats.telegramId,
          level: gamificationStats.level,
          totalXp: gamificationStats.totalXp,
          username: users.username,
          firstName: users.firstName,
        })
        .from(gamificationStats)
        .innerJoin(users, eq(gamificationStats.telegramId, users.telegramId))
        .orderBy(desc(gamificationStats.totalXp))
        .limit(100);

      res.json(top);
    } catch (error) {
      console.error('Error fetching leaderboard:', error);
      res.status(500).json({ error: 'Failed to fetch leaderboard' });
    }
  });

  // ===== TASKS & COINS API =====

  // Получить баланс монет пользователя
  app.get("/api/tasks/balance", verifyTelegramUser, async (req: any, res) => {
    try {
      const telegram_id = req.telegramUser.id;

      let [balance] = await db.select().from(userCoinsBalance).where(eq(userCoinsBalance.telegramId, telegram_id));

      // Создать баланс если не существует
      if (!balance) {
        [balance] = await db.insert(userCoinsBalance).values({
          telegramId: telegram_id,
          totalCoins: 0,
          availableCoins: 0,
          spentCoins: 0,
          tasksCompleted: 0,
          currentStreak: 0,
        }).returning();
      }

      res.json(balance);
    } catch (error) {
      console.error('Error fetching balance:', error);
      res.status(500).json({ error: 'Failed to fetch balance' });
    }
  });

  // Получить прогресс по заданиям
  app.get("/api/tasks/progress", verifyTelegramUser, async (req: any, res) => {
    try {
      const telegram_id = req.telegramUser.id;

      const progress = await db
        .select()
        .from(tasksProgress)
        .where(eq(tasksProgress.telegramId, telegram_id));

      res.json(progress);
    } catch (error) {
      console.error('Error fetching tasks progress:', error);
      res.status(500).json({ error: 'Failed to fetch tasks progress' });
    }
  });

  // Начать задание
  app.post("/api/tasks/start", verifyTelegramUser, async (req: any, res) => {
    try {
      const telegram_id = req.telegramUser.id;
      const { task_id, platform, task_type, coins_reward } = req.body;

      if (!task_id) {
        return res.status(400).json({ error: 'task_id is required' });
      }

      // Проверить существующий прогресс
      const [existing] = await db
        .select()
        .from(tasksProgress)
        .where(
          and(
            eq(tasksProgress.telegramId, telegram_id),
            eq(tasksProgress.taskId, task_id)
          )
        );

      if (existing) {
        // Проверить кулдаун (30 секунд между попытками)
        if (existing.lastAttemptAt) {
          const timeSinceLastAttempt = Date.now() - new Date(existing.lastAttemptAt).getTime();
          if (timeSinceLastAttempt < 30000) {
            return res.status(429).json({ 
              error: 'Too many attempts',
              retry_after: Math.ceil((30000 - timeSinceLastAttempt) / 1000)
            });
          }
        }

        // Проверить лимит попыток
        if ((existing.attempts || 0) >= 3) {
          return res.status(403).json({ error: 'Max attempts reached' });
        }

        // Обновить существующую запись
        await db
          .update(tasksProgress)
          .set({
            verificationStatus: 'verifying',
            startedAt: new Date(),
            lastAttemptAt: new Date(),
            attempts: (existing.attempts || 0) + 1,
          })
          .where(
            and(
              eq(tasksProgress.telegramId, telegram_id),
              eq(tasksProgress.taskId, task_id)
            )
          );

        res.json({ success: true, status: 'started', attempts: (existing.attempts || 0) + 1 });
      } else {
        // Создать новую запись
        await db.insert(tasksProgress).values({
          telegramId: telegram_id,
          taskId: task_id,
          platform: platform || 'unknown',
          taskType: task_type || 'unknown',
          coinsReward: coins_reward || 0,
          completed: false,
          verificationStatus: 'verifying',
          attempts: 1,
          startedAt: new Date(),
          lastAttemptAt: new Date(),
        });

        res.json({ success: true, status: 'started', attempts: 1 });
      }
    } catch (error) {
      console.error('Error starting task:', error);
      res.status(500).json({ error: 'Failed to start task' });
    }
  });

  // Проверить и подтвердить выполнение задания
  app.post("/api/tasks/verify", verifyTelegramUser, async (req: any, res) => {
    try {
      const telegram_id = req.telegramUser.id;
      const { task_id } = req.body;

      if (!task_id) {
        return res.status(400).json({ error: 'task_id is required' });
      }

      // Получить прогресс задания
      const [taskProgress] = await db
        .select()
        .from(tasksProgress)
        .where(
          and(
            eq(tasksProgress.telegramId, telegram_id),
            eq(tasksProgress.taskId, task_id)
          )
        );

      if (!taskProgress) {
        return res.status(404).json({ error: 'Task not found' });
      }

      if (taskProgress.completed) {
        return res.status(400).json({ error: 'Task already completed' });
      }

      // Проверка времени выполнения (минимум 5 секунд с момента старта)
      const timeSpent = taskProgress.startedAt 
        ? Date.now() - new Date(taskProgress.startedAt).getTime()
        : 0;

      const minimumTime = 5000; // 5 секунд минимум

      if (timeSpent < minimumTime) {
        await db
          .update(tasksProgress)
          .set({
            verificationStatus: 'failed',
          })
          .where(
            and(
              eq(tasksProgress.telegramId, telegram_id),
              eq(tasksProgress.taskId, task_id)
            )
          );

        return res.json({ 
          success: false, 
          verified: false,
          reason: 'Insufficient time spent on task'
        });
      }

      // Простая верификация: если прошло достаточно времени, считаем задание выполненным
      // В реальном приложении здесь можно добавить интеграцию с API социальных сетей
      const verified = timeSpent >= minimumTime;

      if (verified) {
        // Обновить прогресс задания
        await db
          .update(tasksProgress)
          .set({
            completed: true,
            verificationStatus: 'verified',
            completedAt: new Date(),
          })
          .where(
            and(
              eq(tasksProgress.telegramId, telegram_id),
              eq(tasksProgress.taskId, task_id)
            )
          );

        // Обновить баланс монет
        let [balance] = await db
          .select()
          .from(userCoinsBalance)
          .where(eq(userCoinsBalance.telegramId, telegram_id));

        if (!balance) {
          [balance] = await db.insert(userCoinsBalance).values({
            telegramId: telegram_id,
            totalCoins: taskProgress.coinsReward,
            availableCoins: taskProgress.coinsReward,
            spentCoins: 0,
            tasksCompleted: 1,
            currentStreak: 1,
            lastActivityDate: new Date().toISOString().split('T')[0],
          }).returning();
        } else {
          await db
            .update(userCoinsBalance)
            .set({
              totalCoins: (balance.totalCoins || 0) + taskProgress.coinsReward,
              availableCoins: (balance.availableCoins || 0) + taskProgress.coinsReward,
              tasksCompleted: (balance.tasksCompleted || 0) + 1,
              lastActivityDate: new Date().toISOString().split('T')[0],
            })
            .where(eq(userCoinsBalance.telegramId, telegram_id));
        }

        res.json({ 
          success: true, 
          verified: true,
          coins_awarded: taskProgress.coinsReward,
          new_balance: (balance.totalCoins || 0) + taskProgress.coinsReward
        });
      } else {
        await db
          .update(tasksProgress)
          .set({
            verificationStatus: 'failed',
          })
          .where(
            and(
              eq(tasksProgress.telegramId, telegram_id),
              eq(tasksProgress.taskId, task_id)
            )
          );

        res.json({ success: false, verified: false, reason: 'Verification failed' });
      }
    } catch (error) {
      console.error('Error verifying task:', error);
      res.status(500).json({ error: 'Failed to verify task' });
    }
  });

  const httpServer = createServer(app);

  return httpServer;
}
```

### server/storage.ts
```typescript
import { type User, type InsertUser } from "@shared/schema";
import { randomUUID } from "crypto";

// modify the interface with any CRUD methods
// you might need

export interface IStorage {
  getUser(id: string): Promise<User | undefined>;
  getUserByUsername(username: string): Promise<User | undefined>;
  createUser(user: InsertUser): Promise<User>;
}

export class MemStorage implements IStorage {
  private users: Map<string, User>;

  constructor() {
    this.users = new Map();
  }

  async getUser(id: string): Promise<User | undefined> {
    return this.users.get(id);
  }

  async getUserByUsername(username: string): Promise<User | undefined> {
    return Array.from(this.users.values()).find(
      (user) => user.username === username,
    );
  }

  async createUser(insertUser: InsertUser): Promise<User> {
    const id = randomUUID();
    const user: User = { ...insertUser, id };
    this.users.set(id, user);
    return user;
  }
}

export const storage = new MemStorage();
```

### server/vite.ts
```typescript
import express, { type Express } from "express";
import fs from "fs";
import path from "path";
import { createServer as createViteServer, createLogger } from "vite";
import { type Server } from "http";
import viteConfig from "../vite.config";
import { nanoid } from "nanoid";

const viteLogger = createLogger();

export function log(message: string, source = "express") {
  const formattedTime = new Date().toLocaleTimeString("en-US", {
    hour: "numeric",
    minute: "2-digit",
    second: "2-digit",
    hour12: true,
  });

  console.log(`${formattedTime} [${source}] ${message}`);
}

export async function setupVite(app: Express, server: Server) {
  const serverOptions = {
    middlewareMode: true,
    hmr: { server },
    allowedHosts: true as const,
  };

  const vite = await createViteServer({
    ...viteConfig,
    configFile: false,
    customLogger: {
      ...viteLogger,
      error: (msg, options) => {
        viteLogger.error(msg, options);
        process.exit(1);
      },
    },
    server: serverOptions,
    appType: "custom",
  });

  app.use(vite.middlewares);
  app.use("*", async (req, res, next) => {
    const url = req.originalUrl;

    try {
      const clientTemplate = path.resolve(
        import.meta.dirname,
        "..",
        "client",
        "index.html",
      );

      // always reload the index.html file from disk incase it changes
      let template = await fs.promises.readFile(clientTemplate, "utf-8");
      template = template.replace(
        `src="/src/main.tsx"`,
        `src="/src/main.tsx?v=${nanoid()}"`,
      );
      const page = await vite.transformIndexHtml(url, template);
      res.status(200).set({ "Content-Type": "text/html" }).end(page);
    } catch (e) {
      vite.ssrFixStacktrace(e as Error);
      next(e);
    }
  });
}

export function serveStatic(app: Express) {
  const distPath = path.resolve(import.meta.dirname, "..", "dist");

  if (!fs.existsSync(distPath)) {
    throw new Error(
      `Could not find the build directory: ${distPath}, make sure to build the client first`,
    );
  }

  // Serve static assets with aggressive caching
  app.use('/assets', express.static(path.join(distPath, 'assets'), {
    maxAge: '1y', // 1 year for hashed assets
    immutable: true,
    etag: true,
    lastModified: true,
    setHeaders: (res, filepath) => {
      // Hashed assets never change
      res.setHeader('Cache-Control', 'public, max-age=31536000, immutable');
    }
  }));

  // Serve other static files with moderate caching
  app.use(express.static(distPath, {
    maxAge: '1h', // 1 hour for other files
    etag: true,
    lastModified: true,
    setHeaders: (res, filepath) => {
      // HTML files should not be cached (SPA routing)
      if (filepath.endsWith('.html')) {
        res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
      }
    }
  }));

  // fall through to index.html if the file doesn't exist
  app.use("*", (_req, res) => {
    res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
    // CRITICAL: Clear all client-side storage including Service Workers
    res.setHeader('Clear-Site-Data', '"cache", "storage"');
    res.sendFile(path.resolve(distPath, "index.html"));
  });
}
```

## СХЕМА ДАННЫХ (Shared)

### shared/schema.ts
```typescript
// Схема БД для хранения метаданных фотографий
import { pgTable, serial, varchar, text, timestamp, bigint, integer, decimal, boolean, date, jsonb } from "drizzle-orm/pg-core";
import { createInsertSchema } from "drizzle-zod";
import { z } from "zod";

// Таблица для хранения метаданных фотографий
export const photos = pgTable("photos", {
  id: serial("id").primaryKey(),
  title: varchar("title", { length: 255 }).notNull(),
  description: text("description"),
  objectPath: varchar("object_path", { length: 500 }).notNull(), // Путь к фото в Object Storage
  thumbnailPath: varchar("thumbnail_path", { length: 500 }), // Опционально: путь к миниатюре
  uploadedAt: timestamp("uploaded_at").defaultNow().notNull(),
  userId: varchar("user_id", { length: 100 }), // ID пользователя из Telegram (опционально)
});

// Zod schemas для валидации
export const insertPhotoSchema = createInsertSchema(photos).omit({
  id: true,
  uploadedAt: true,
});

export const selectPhotoSchema = createInsertSchema(photos);

// TypeScript типы
export type Photo = typeof photos.$inferSelect;
export type InsertPhoto = z.infer<typeof insertPhotoSchema>;

// Таблица пользователей
export const users = pgTable("users", {
  id: serial("id").primaryKey(),
  telegramId: bigint("telegram_id", { mode: "number" }).unique().notNull(),
  username: varchar("username", { length: 255 }),
  firstName: varchar("first_name", { length: 255 }),
  lastName: varchar("last_name", { length: 255 }),
  referralCode: varchar("referral_code", { length: 50 }).unique().notNull(),
  referredByCode: varchar("referred_by_code", { length: 50 }),
  totalReferrals: integer("total_referrals").default(0).notNull(),
  activeReferrals: integer("active_referrals").default(0).notNull(),
  totalEarnings: decimal("total_earnings", { precision: 10, scale: 2 }).default("0").notNull(),
  pendingRewards: decimal("pending_rewards", { precision: 10, scale: 2 }).default("0").notNull(),
  tier: varchar("tier", { length: 50 }).default("Bronze").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
});

// Таблица рефералов
export const referrals = pgTable("referrals", {
  id: serial("id").primaryKey(),
  referrerTelegramId: bigint("referrer_telegram_id", { mode: "number" }).notNull(),
  referredTelegramId: bigint("referred_telegram_id", { mode: "number" }).notNull(),
  bonusAmount: decimal("bonus_amount", { precision: 10, scale: 2 }).default("0").notNull(),
  status: varchar("status", { length: 50 }).default("pending").notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
});

// Таблица статистики геймификации
export const gamificationStats = pgTable("gamification_stats", {
  id: serial("id").primaryKey(),
  telegramId: bigint("telegram_id", { mode: "number" }).unique().notNull(),
  level: integer("level").default(1).notNull(),
  xp: integer("xp").default(0).notNull(),
  xpToNextLevel: integer("xp_to_next_level").default(100).notNull(),
  totalXp: integer("total_xp").default(0).notNull(),
  currentStreak: integer("current_streak").default(1).notNull(),
  bestStreak: integer("best_streak").default(1).notNull(),
  lastVisitDate: date("last_visit_date").defaultNow().notNull(),
  completedTasks: integer("completed_tasks").default(0).notNull(),
  achievements: jsonb("achievements").default([]).notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
});

// Таблица ежедневных задач
export const dailyTasks = pgTable("daily_tasks", {
  id: serial("id").primaryKey(),
  telegramId: bigint("telegram_id", { mode: "number" }).notNull(),
  taskId: varchar("task_id", { length: 100 }).notNull(),
  taskName: varchar("task_name", { length: 255 }).notNull(),
  description: text("description"),
  xpReward: integer("xp_reward").default(0).notNull(),
  progress: integer("progress").default(0).notNull(),
  maxProgress: integer("max_progress").default(1).notNull(),
  completed: boolean("completed").default(false).notNull(),
  taskDate: date("task_date").defaultNow().notNull(),
  createdAt: timestamp("created_at").defaultNow().notNull(),
});

// Zod schemas
export const insertUserSchema = createInsertSchema(users).omit({
  id: true,
  createdAt: true,
  updatedAt: true,
});

export const insertReferralSchema = createInsertSchema(referrals).omit({
  id: true,
  createdAt: true,
});

export const insertGamificationStatsSchema = createInsertSchema(gamificationStats).omit({
  id: true,
  createdAt: true,
  updatedAt: true,
});

export const insertDailyTaskSchema = createInsertSchema(dailyTasks).omit({
  id: true,
  createdAt: true,
});

// Таблица прогресса выполнения заданий
export const tasksProgress = pgTable("tasks_progress", {
  id: serial("id").primaryKey(),
  telegramId: bigint("telegram_id", { mode: "number" }).notNull(),
  taskId: varchar("task_id", { length: 100 }).notNull(),
  platform: varchar("platform", { length: 50 }).notNull(),
  taskType: varchar("task_type", { length: 50 }).notNull(),
  coinsReward: integer("coins_reward").notNull(),
  completed: boolean("completed").default(false).notNull(),
  verificationStatus: varchar("verification_status", { length: 50 }).default("pending").notNull(),
  attempts: integer("attempts").default(0).notNull(),
  lastAttemptAt: timestamp("last_attempt_at"),
  startedAt: timestamp("started_at"),
  completedAt: timestamp("completed_at"),
  verificationData: jsonb("verification_data"),
  createdAt: timestamp("created_at").defaultNow().notNull(),
});

// Таблица баланса монет пользователей
export const userCoinsBalance = pgTable("user_coins_balance", {
  id: serial("id").primaryKey(),
  telegramId: bigint("telegram_id", { mode: "number" }).unique().notNull(),
  totalCoins: integer("total_coins").default(0).notNull(),
  availableCoins: integer("available_coins").default(0).notNull(),
  spentCoins: integer("spent_coins").default(0).notNull(),
  tasksCompleted: integer("tasks_completed").default(0).notNull(),
  currentStreak: integer("current_streak").default(0).notNull(),
  lastActivityDate: date("last_activity_date"),
  createdAt: timestamp("created_at").defaultNow().notNull(),
  updatedAt: timestamp("updated_at").defaultNow().notNull(),
});

// Zod schemas
export const insertTasksProgressSchema = createInsertSchema(tasksProgress).omit({
  id: true,
  createdAt: true,
});

export const insertUserCoinsBalanceSchema = createInsertSchema(userCoinsBalance).omit({
  id: true,
  createdAt: true,
  updatedAt: true,
});

// TypeScript types
export type User = typeof users.$inferSelect;
export type InsertUser = z.infer<typeof insertUserSchema>;
export type Referral = typeof referrals.$inferSelect;
export type InsertReferral = z.infer<typeof insertReferralSchema>;
export type GamificationStats = typeof gamificationStats.$inferSelect;
export type InsertGamificationStats = z.infer<typeof insertGamificationStatsSchema>;
export type DailyTask = typeof dailyTasks.$inferSelect;
export type InsertDailyTask = z.infer<typeof insertDailyTaskSchema>;
export type TasksProgress = typeof tasksProgress.$inferSelect;
export type InsertTasksProgress = z.infer<typeof insertTasksProgressSchema>;
export type UserCoinsBalance = typeof userCoinsBalance.$inferSelect;
export type InsertUserCoinsBalance = z.infer<typeof insertUserCoinsBalanceSchema>;
```

## КОНФИГУРАЦИЯ

### vite.config.ts
```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";
import { visualizer } from "rollup-plugin-visualizer";
import { compression } from "vite-plugin-compression2";

export default defineConfig({
  base: '/',
  plugins: [
    react({
      jsxRuntime: 'automatic',
    }),
    
    // Brotli compression
    compression({
      algorithms: ['brotliCompress'],
      exclude: [/\.(br)$/, /\.(gz)$/],
      threshold: 1024
    }),
    
    // Gzip compression fallback
    compression({
      algorithms: ['gzip'],
      exclude: [/\.(br)$/, /\.(gz)$/],
      threshold: 1024
    }),
    
    // Bundle analyzer (only in build)
    process.env.ANALYZE === 'true' && visualizer({
      filename: './dist/stats.html',
      open: false,
      gzipSize: true,
      brotliSize: true
    })
  ].filter(Boolean),
  
  resolve: {
    alias: {
      "@": path.resolve(import.meta.dirname, "client", "src"),
      "@shared": path.resolve(import.meta.dirname, "shared"),
      "@assets": path.resolve(import.meta.dirname, "attached_assets"),
    },
  },
  
  root: path.resolve(import.meta.dirname, "client"),
  
  build: {
    outDir: path.resolve(import.meta.dirname, "dist"),
    emptyOutDir: true,
    target: 'es2020',
    minify: 'terser',
    
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
        pure_funcs: ['console.log', 'console.info', 'console.debug', 'console.trace'],
        passes: 2,
      },
      mangle: {
        safari10: true
      },
      format: {
        comments: false
      }
    },
    
    rollupOptions: {
      output: {
        manualChunks: (id) => {
          // Vendor chunks - strict splitting to prevent initialization errors
          if (id.includes('node_modules')) {
            // ✅ CRITICAL: All React-dependent libraries MUST be in vendor chunk
            // This includes: react, react-dom, zustand, @uppy/react, swiper, cmdk, etc.
            if (
              id.includes('react') || 
              id.includes('scheduler') ||
              id.includes('zustand') ||
              id.includes('@uppy/react') ||
              id.includes('swiper') ||
              id.includes('cmdk') ||
              id.includes('@hookform') ||
              id.includes('react-hook-form') ||
              id.includes('wouter') ||
              id.includes('next-themes')
            ) {
              return 'vendor';
            }
            
            // ✅ Radix UI - depends on React, separate chunk
            if (id.includes('@radix-ui')) {
              return 'ui-vendor';
            }
            
            // ✅ Framer Motion - heavy animation lib
            if (id.includes('framer-motion')) {
              return 'animation-vendor';
            }
            
            // ✅ TanStack - React Query ecosystem
            if (id.includes('@tanstack')) {
              return 'tanstack-vendor';
            }
            
            // ✅ Icons - pure components
            if (id.includes('lucide-react') || id.includes('react-icons') || id.includes('phosphor-react')) {
              return 'icons-vendor';
            }
            
            // ✅ Pure utilities ONLY - NO React dependencies!
            // Safe: date-fns, zod, clsx, nanoid, class-variance-authority
            if (
              id.includes('date-fns') ||
              id.includes('zod') ||
              id.includes('clsx') ||
              id.includes('tailwind-merge') ||
              id.includes('class-variance-authority') ||
              id.includes('nanoid')
            ) {
              return 'utils-vendor';
            }
            
            // ✅ Everything else goes to vendor (safe default)
            return 'vendor';
          }
          
          // ✅ Let Rollup auto-split ShowcasePage into smaller chunks
          // Don't force entire ShowcasePage into single chunk
          
          // Route-based splitting for other pages
          if (id.includes('/src/components/ProjectsPage')) {
            return 'projects';
          }
          if (id.includes('/src/components/demos/')) {
            // Group demos by category
            if (id.includes('Clothing') || id.includes('Electronics') || id.includes('Gadget')) {
              return 'demos-ecommerce';
            }
            if (id.includes('Beauty') || id.includes('Restaurant') || id.includes('Hotel')) {
              return 'demos-services';
            }
            return 'demos-other';
          }
        },
        
        chunkFileNames: 'assets/[name]-[hash].js',
        entryFileNames: 'assets/[name]-[hash].js',
        assetFileNames: 'assets/[name]-[hash].[ext]'
      }
    },
    
    chunkSizeWarningLimit: 500,
    sourcemap: 'hidden',
    reportCompressedSize: true,
    cssCodeSplit: true,
    assetsInlineLimit: 4096
  },
  
  optimizeDeps: {
    include: [
      'react',
      'react-dom',
      'react-dom/client',
      'wouter'
    ],
    exclude: [
      'framer-motion',
      '@radix-ui/react-dialog',
      '@radix-ui/react-select'
    ]
  },
  
  server: {
    host: "0.0.0.0",
    port: 5000,
    strictPort: true,
    hmr: {
      clientPort: 443,
      overlay: false
    },
    allowedHosts: true,
    fs: {
      strict: true,
      deny: ["**/.*"],
    },
  },
});
```

### tailwind.config.ts
```typescript
import type { Config } from "tailwindcss";

export default {
  darkMode: ["class"],
  content: ["./client/index.html", "./client/src/**/*.{js,jsx,ts,tsx}"],
  theme: {
    extend: {
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      colors: {
        background: "var(--background)",
        foreground: "var(--foreground)",
        card: {
          DEFAULT: "var(--card)",
          foreground: "var(--card-foreground)",
        },
        popover: {
          DEFAULT: "var(--popover)",
          foreground: "var(--popover-foreground)",
        },
        primary: {
          DEFAULT: "var(--primary)",
          foreground: "var(--primary-foreground)",
        },
        secondary: {
          DEFAULT: "var(--secondary)",
          foreground: "var(--secondary-foreground)",
        },
        muted: {
          DEFAULT: "var(--muted)",
          foreground: "var(--muted-foreground)",
        },
        accent: {
          DEFAULT: "var(--accent)",
          foreground: "var(--accent-foreground)",
        },
        destructive: {
          DEFAULT: "var(--destructive)",
          foreground: "var(--destructive-foreground)",
        },
        border: "var(--border)",
        input: "var(--input)",
        ring: "var(--ring)",
        chart: {
          "1": "var(--chart-1)",
          "2": "var(--chart-2)",
          "3": "var(--chart-3)",
          "4": "var(--chart-4)",
          "5": "var(--chart-5)",
        },
        sidebar: {
          DEFAULT: "var(--sidebar)",
          foreground: "var(--sidebar-foreground)",
          primary: "var(--sidebar-primary)",
          "primary-foreground": "var(--sidebar-primary-foreground)",
          accent: "var(--sidebar-accent)",
          "accent-foreground": "var(--sidebar-accent-foreground)",
          border: "var(--sidebar-border)",
          ring: "var(--sidebar-ring)",
        },
      },
      fontFamily: {
        sans: ["Inter", "system-ui", "-apple-system", "BlinkMacSystemFont", "Segoe UI", "Roboto", "sans-serif"],
        heading: ["Inter", "system-ui", "sans-serif"],
        luxury: ["Playfair Display", "Georgia", "serif"],
        elegant: ["Cormorant Garamond", "Garamond", "serif"],
        mono: ["JetBrains Mono", "Fira Code", "monospace"],
      },
      keyframes: {
        "accordion-down": {
          from: {
            height: "0",
          },
          to: {
            height: "var(--radix-accordion-content-height)",
          },
        },
        "accordion-up": {
          from: {
            height: "var(--radix-accordion-content-height)",
          },
          to: {
            height: "0",
          },
        },
        float: {
          "0%": { transform: "rotate(0deg)" },
          "100%": { transform: "rotate(360deg)" },
        },
        fadeIn: {
          to: { opacity: "1" },
        },
        slideUp: {
          to: { 
            transform: "translateY(0)",
            opacity: "1",
          },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        float: "float 20s linear infinite",
        "fade-in": "fadeIn 0.6s ease-out forwards",
        "slide-up": "slideUp 0.4s ease-out forwards",
      },
    },
  },
  plugins: [require("tailwindcss-animate"), require("@tailwindcss/typography")],
} satisfies Config;
```

### index.css
```css
/* Fonts - 2025 Premium Typography */
@import '@fontsource/inter/latin-400.css';
@import '@fontsource/inter/latin-500.css';
@import '@fontsource/inter/latin-600.css';
@import '@fontsource/inter/latin-700.css';
@import '@fontsource/inter/latin-800.css';
@import '@fontsource/inter/latin-900.css';
@import '@fontsource/playfair-display/latin-400.css';
@import '@fontsource/playfair-display/latin-600.css';
@import '@fontsource/playfair-display/latin-700.css';
@import '@fontsource/playfair-display/latin-800.css';
@import '@fontsource/cormorant-garamond/latin-300.css';
@import '@fontsource/cormorant-garamond/latin-400.css';
@import '@fontsource/cormorant-garamond/latin-600.css';
@import '@fontsource/orbitron';

/* Apple Quality Standards */
@import './styles/apple.css';

@tailwind base;
@tailwind components;
@tailwind utilities;

/* === PERFORMANCE OPTIMIZATIONS FOR TELEGRAM === */

/* CRITICAL: Telegram Mini App scroll hierarchy 
   - html/body: overflow hidden to prevent app collapse
   - #root: enable scrolling here only
   This prevents Telegram from interpreting scroll as "close app" gesture
*/
html {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden; /* CRITICAL: Prevent app collapse */
  overscroll-behavior: none;
  
  /* Fast touch response */
  touch-action: manipulation;
}

body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden; /* CRITICAL: Prevent app collapse */
  overscroll-behavior: none;
  
  /* Optimize text rendering */
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Enable scrolling ONLY on root app container */
#root {
  width: 100%;
  height: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  
  /* iOS momentum scrolling (smooth native feel) */
  -webkit-overflow-scrolling: touch;
  
  /* Contain scroll within app */
  overscroll-behavior: contain;
  
  /* Instant touch response (no 300ms delay) */
  touch-action: pan-y;
}

:root {
  /* === 2025 PREMIUM COLOR PALETTE === */
  
  /* Core Background Colors (not pure black - better for modern displays) */
  --background: #0f0f11;           /* Deep premium black */
  --background-primary: #0f0f11;
  --background-secondary: #111113;   /* For cards */
  --background-tertiary: #1A1A1E;    /* For modals */
  --background-elevated: #242429;    /* For hover states */
  
  /* iOS 17 Color Tokens - Dark Theme */
  --foreground: #FFFFFF;
  --card: rgba(255, 255, 255, 0.1);
  --card-foreground: #FFFFFF;
  --popover: rgba(255, 255, 255, 0.1);
  --popover-foreground: #FFFFFF;
  --primary: #10B981;
  --primary-foreground: #FFFFFF;
  --secondary: rgba(255, 255, 255, 0.1);
  --secondary-foreground: #FFFFFF;
  --muted: rgba(255, 255, 255, 0.05);
  --muted-foreground: rgba(255, 255, 255, 0.7);
  --accent: #10B981;
  --accent-foreground: #FFFFFF;
  --destructive: #FF3B30;
  --destructive-foreground: #FFFFFF;
  --border: rgba(255, 255, 255, 0.2);
  --input: rgba(255, 255, 255, 0.1);
  --ring: #10B981;
  
  /* iOS System Colors */
  --system-blue: #10B981;
  --system-green: #10B981;
  --system-indigo: #5856D6;
  --system-orange: #FF9500;
  --system-pink: #FF2D92;
  --system-purple: #AF52DE;
  --system-red: #FF3B30;
  --system-teal: #5AC8FA;
  --system-yellow: #FFCC00;
  
  /* === 2025 EXTENDED COLOR PALETTE === */
  
  /* Emerald Spectrum (full spectrum) */
  --emerald-50: #ECFDF5;
  --emerald-100: #D1FAE5;
  --emerald-200: #A7F3D0;
  --emerald-300: #6EE7B7;
  --emerald-400: #34D399;
  --emerald-500: #10B981;   /* Primary brand color */
  --emerald-600: #059669;
  --emerald-700: #047857;
  --emerald-800: #065F46;
  --emerald-900: #064E3B;
  --emerald-950: #022C22;
  
  /* Complementary Accent Colors (2025 trending) */
  --electric-cyan: #06B6D4;
  --neon-purple: #A855F7;
  --hot-pink: #EC4899;
  --sunset-orange: #F97316;
  --lime-green: #84CC16;
  
  /* Semantic Colors (for UI states) */
  --success: #10B981;
  --warning: #F59E0B;
  --error: #EF4444;
  --info: #3B82F6;
  
  /* Additional Accent Colors */
  --teal-500: #14B8A6;
  --cyan-500: #06B6D4;
  --lime-500: #84CC16;
  --amber-500: #F59E0B;
  --orange-500: #F97316;
  --rose-500: #F43F5E;
  --purple-500: #A855F7;
  --pink-500: #EC4899;
  --blue-500: #3B82F6;
  
  /* Neutral Tones (Better than pure black) */
  --neutral-900: #171717;
  --neutral-800: #262626;
  --neutral-700: #404040;
  --neutral-100: #F5F5F5;
  --neutral-50: #FAFAFA;
  
  /* iOS Label Colors - Dark Theme */
  --label: #FFFFFF;
  --secondary-label: rgba(255, 255, 255, 0.7);
  --tertiary-label: rgba(255, 255, 255, 0.4);
  --quaternary-label: rgba(255, 255, 255, 0.2);
  
  /* iOS Separator Colors - Dark Theme */
  --separator: rgba(255, 255, 255, 0.2);
  --opaque-separator: rgba(255, 255, 255, 0.3);
  
  /* iOS Fill Colors - Dark Theme */
  --system-fill: rgba(255, 255, 255, 0.1);
  --secondary-system-fill: rgba(255, 255, 255, 0.08);
  --tertiary-system-fill: rgba(255, 255, 255, 0.06);
  --quaternary-system-fill: rgba(255, 255, 255, 0.04);
  
  /* === 2025 PREMIUM GRADIENT SYSTEM === */
  
  /* Aurora Gradient - Multi-stop premium effect */
  --gradient-aurora: linear-gradient(
    135deg, 
    #10B981 0%,
    #14B8A6 25%,
    #06B6D4 50%,
    #8B5CF6 75%,
    #EC4899 100%
  );
  
  /* Mesh Gradients (Multi-layer depth - 2025 trend) */
  --gradient-mesh: 
    radial-gradient(at 0% 0%, rgba(16, 185, 129, 0.15) 0px, transparent 50%),
    radial-gradient(at 50% 0%, rgba(6, 182, 212, 0.15) 0px, transparent 50%),
    radial-gradient(at 100% 0%, rgba(168, 85, 247, 0.15) 0px, transparent 50%);
  
  /* Glass Gradient */
  --gradient-glass: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.1) 0%,
    rgba(255, 255, 255, 0.05) 100%
  );
  
  /* Gradient with Noise Texture */
  --gradient-noise: 
    linear-gradient(135deg, #10B981 0%, #059669 100%),
    url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' /%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
  
  /* Emerald-Cyan Gradient */
  --gradient-emerald-cyan: linear-gradient(to right, #10B981, #14B8A6, #06B6D4);
  
  /* Emerald-Purple Gradient */
  --gradient-emerald-purple: linear-gradient(to right, #10B981, #06B6D4, #A855F7);
  
  /* Aurora Premium Gradient */
  --gradient-aurora-premium: linear-gradient(45deg, #10B981 0%, #06B6D4 50%, #8B5CF6 100%);
  
  /* Primary Gradient */
  --primary-gradient: linear-gradient(135deg, #10B981 0%, #14B8A6 25%, #06B6D4 50%, #0EA5E9 75%, #10B981 100%);
  
  /* Mesh Gradient Background */
  --mesh-bg-1: radial-gradient(at 47% 33%, hsla(162, 77%, 40%, 0.2) 0, transparent 59%);
  --mesh-bg-2: radial-gradient(at 82% 65%, hsla(198, 100%, 50%, 0.15) 0, transparent 55%);
  --mesh-bg-3: radial-gradient(at 22% 89%, hsla(280, 78%, 60%, 0.1) 0, transparent 45%);
  
  /* Adaptive Contrast System */
  --adaptive-bg: color-mix(in srgb, var(--background) 80%, currentColor 20%);
  
  /* Neuromorphic Effects */
  --neuro-light: #1a1a1a;
  --neuro-dark: #0A0A0B;
  --neuro-highlight: rgba(16, 185, 129, 0.1);
  
  /* Fluid Typography with clamp() - 2025 Enhanced */
  --text-xs: clamp(0.75rem, 1vw, 0.875rem);
  --text-sm: clamp(0.875rem, 1.5vw, 1rem);
  --text-base: clamp(1rem, 1.5vw, 1.125rem);
  --text-lg: clamp(1.125rem, 2vw, 1.25rem);
  --text-xl: clamp(1.25rem, 2.5vw, 1.75rem);
  --text-2xl: clamp(1.5rem, 3vw, 2rem);
  --text-3xl: clamp(2rem, 4vw, 3rem);
  --text-4xl: clamp(2.5rem, 5vw, 4rem);
  --text-hero: clamp(2.5rem, 5vw, 4rem);
  --text-h1: clamp(2rem, 4vw, 3rem);
  --text-h2: clamp(1.5rem, 3vw, 2rem);
  --text-h3: clamp(1.25rem, 2.5vw, 1.75rem);
  
  /* Line Heights */
  --leading-tight: 1.2;
  --leading-normal: 1.5;
  --leading-relaxed: 1.75;
  
  /* Letter Spacing */
  --tracking-tighter: -0.02em;
  --tracking-tight: -0.01em;
  --tracking-normal: 0;
  --tracking-wide: 0.025em;
  --tracking-wider: 0.05em;
  
  /* Typography */
  --font-system: -apple-system, BlinkMacSystemFont, 'Inter', system-ui, sans-serif;
  --font-montserrat: 'Montserrat', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  --font-primary: 'Inter Variable', system-ui, sans-serif;
  
  /* iOS Radius */
  --radius-large: 20px;
  --radius-medium: 12px;
  --radius-small: 8px;
  --radius-mini: 4px;
  
  /* Glass Effects - Dark Theme - Upgraded to 2.0 */
  --glass-background: rgba(255, 255, 255, 0.1);
  --glass-background-strong: rgba(255, 255, 255, 0.15);
  --glass-border: rgba(255, 255, 255, 0.2);
  --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  --glass-nav-background: rgba(255, 255, 255, 0.1);
  --glass-nav-border: rgba(255, 255, 255, 0.2);
  --glass-nav-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
  
  /* Glassmorphism 2.0 - Five Levels */
  /* Level 1: Subtle (navigation bars) */
  --glass-subtle-bg: rgba(255, 255, 255, 0.08);
  --glass-subtle-border: rgba(255, 255, 255, 0.18);
  --glass-subtle-blur: blur(20px) saturate(180%);
  --glass-subtle-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  
  /* Level 2: Medium (cards) */
  --glass-medium-bg: rgba(255, 255, 255, 0.12);
  --glass-medium-border: rgba(255, 255, 255, 0.22);
  --glass-medium-blur: blur(24px) saturate(200%);
  --glass-medium-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  
  /* Level 3: Strong (modals) */
  --glass-strong-bg: rgba(255, 255, 255, 0.15);
  --glass-strong-border: rgba(255, 255, 255, 0.25);
  --glass-strong-blur: blur(32px) saturate(200%);
  --glass-strong-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  
  /* Level 4: Gradient Glass (premium cards) */
  --glass-gradient-bg: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.08) 100%);
  --glass-gradient-border: rgba(16, 185, 129, 0.3);
  --glass-gradient-blur: blur(28px) saturate(180%);
  --glass-gradient-shadow: 0 15px 45px rgba(16, 185, 129, 0.1);
  
  /* Level 5: Frosted Glass (overlays) */
  --glass-frosted-bg: rgba(255, 255, 255, 0.1);
  --glass-frosted-border: rgba(255, 255, 255, 0.2);
  --glass-frosted-blur: blur(30px) saturate(150%);
  --glass-frosted-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  
  /* Aurora Glassmorphism */
  --aurora-bg: rgba(255, 255, 255, 0.05);
  --aurora-border: rgba(255, 255, 255, 0.1);
  --aurora-blur: blur(20px) saturate(180%);
  
  /* === CATEGORY COLOR CODING (2025) === */
  
  /* E-commerce/Fashion/Retail */
  --category-ecommerce-primary: #EC4899;    /* Hot Pink */
  --category-ecommerce-secondary: #DB2777;
  --category-ecommerce-gradient: linear-gradient(135deg, #EC4899, #DB2777, #BE185D);
  
  /* Business/Professional/Corporate */
  --category-business-primary: #3B82F6;     /* Blue */
  --category-business-secondary: #2563EB;
  --category-business-gradient: linear-gradient(135deg, #3B82F6, #2563EB, #1D4ED8);
  
  /* Portfolio/Creative/Personal */
  --category-portfolio-primary: #A855F7;    /* Purple */
  --category-portfolio-secondary: #9333EA;
  --category-portfolio-gradient: linear-gradient(135deg, #A855F7, #9333EA, #7E22CE);
  
  /* Restaurant/Food/Culinary */
  --category-restaurant-primary: #F97316;   /* Orange */
  --category-restaurant-secondary: #EA580C;
  --category-restaurant-gradient: linear-gradient(135deg, #F97316, #EA580C, #C2410C);
  
  /* Technology/Startup */
  --category-tech-primary: #10B981;         /* Emerald */
  --category-tech-secondary: #059669;
  --category-tech-gradient: linear-gradient(135deg, #10B981, #059669, #047857);
  
  /* Fitness/Health/Wellness */
  --category-fitness-primary: #84CC16;      /* Lime */
  --category-fitness-secondary: #65A30D;
  --category-fitness-gradient: linear-gradient(135deg, #84CC16, #65A30D, #4D7C0F);
  
  /* === 2025 SPACING SYSTEM (8px Grid) === */
  --space-0: 0;
  --space-1: 0.25rem;  /* 4px */
  --space-2: 0.5rem;   /* 8px - Base grid */
  --space-3: 0.75rem;  /* 12px */
  --space-4: 1rem;     /* 16px */
  --space-5: 1.25rem;  /* 20px */
  --space-6: 1.5rem;   /* 24px */
  --space-8: 2rem;     /* 32px */
  --space-10: 2.5rem;  /* 40px */
  --space-12: 3rem;    /* 48px */
  --space-16: 4rem;    /* 64px */
  --space-20: 5rem;    /* 80px */
  --space-24: 6rem;    /* 96px */
  
  /* Adaptive Spacing with clamp() */
  --space-adaptive-xs: clamp(0.5rem, 2vw, 1rem);
  --space-adaptive-sm: clamp(1rem, 3vw, 1.5rem);
  --space-adaptive-md: clamp(1.5rem, 4vw, 2.5rem);
  --space-adaptive-lg: clamp(2rem, 5vw, 4rem);
  --space-adaptive-xl: clamp(3rem, 8vw, 6rem);
  
  /* === ORGANIC BORDER RADIUS (2025) === */
  --radius-xs: 4px;
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
  --radius-2xl: 24px;
  --radius-3xl: 32px;
  --radius-full: 9999px;
  
  /* Organic/Asymmetric Radius */
  --radius-organic-1: 16px 24px 20px 28px;
  --radius-organic-2: 20px 32px 28px 24px;
  --radius-squircle: 20px;  /* Use with smooth corners */
}

/* Montserrat Typography Classes */
.font-montserrat {
  font-family: var(--font-montserrat);
}

.montserrat-title {
  font-family: var(--font-montserrat);
  font-weight: 800;
  letter-spacing: -0.02em;
}

.montserrat-heading {
  font-family: var(--font-montserrat);
  font-weight: 700;
  letter-spacing: -0.01em;
}

.montserrat-subheading {
  font-family: var(--font-montserrat);
  font-weight: 600;
  letter-spacing: -0.005em;
}

.montserrat-body {
  font-family: var(--font-montserrat);
  font-weight: 500;
}

.montserrat-caption {
  font-family: var(--font-montserrat);
  font-weight: 400;
}

@layer base {
  * {
    border-color: var(--border);
  }

  body {
    @apply antialiased bg-background text-foreground;
    font-family: var(--font-system);
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }
}

@layer components {
  /* iOS 17 Typography */
  .ios-large-title {
    font-size: 34px;
    line-height: 38px;
    font-weight: 700;
    letter-spacing: -0.02em;
  }
  
  .ios-title1 {
    font-size: 28px;
    line-height: 32px;
    font-weight: 700;
    letter-spacing: -0.015em;
  }
  
  .ios-title2 {
    font-size: 22px;
    line-height: 28px;
    font-weight: 700;
    letter-spacing: -0.01em;
  }
  
  .ios-title3 {
    font-size: 20px;
    line-height: 26px;
    font-weight: 600;
    letter-spacing: -0.005em;
  }
  
  .ios-headline {
    font-size: 17px;
    line-height: 22px;
    font-weight: 600;
  }
  
  .ios-body {
    font-size: 17px;
    line-height: 22px;
    font-weight: 400;
  }
  
  .ios-callout {
    font-size: 16px;
    line-height: 21px;
    font-weight: 400;
  }
  
  .ios-subheadline {
    font-size: 15px;
    line-height: 20px;
    font-weight: 400;
  }
  
  .ios-footnote {
    font-size: 13px;
    line-height: 18px;
    font-weight: 400;
  }
  
  .ios-caption1 {
    font-size: 12px;
    line-height: 16px;
    font-weight: 400;
  }
  
  .ios-caption2 {
    font-size: 11px;
    line-height: 13px;
    font-weight: 400;
  }

  /* iOS 17 Cards - Dark Theme */
  .ios-card {
    @apply rounded-large border border-separator transition-all duration-200;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(16px);
    box-shadow: none;
  }
  
  .ios-card-elevated {
    @apply ios-card;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
  }
  
  .ios-card-group {
    @apply ios-card overflow-hidden;
  }

  /* iOS 17 Lists - Dark Theme */
  .ios-list {
    @apply rounded-large overflow-hidden;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(16px);
    border: 1px solid var(--separator);
  }
  
  .ios-list-item {
    @apply px-4 py-3 border-b border-separator last:border-b-0 transition-colors;
    background: transparent;
  }
  
  .ios-list-item:active {
    background: var(--system-fill);
  }
  
  .ios-list-header {
    @apply px-4 py-2;
    background: transparent;
    color: var(--secondary-label);
    font-size: 13px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  /* iOS 17 Buttons */
  .ios-button {
    @apply px-6 py-3 rounded-large font-semibold transition-all duration-200;
    font-size: 17px;
    line-height: 22px;
  }
  
  .ios-button-filled {
    @apply ios-button bg-system-blue text-white;
  }
  
  .ios-button-filled:hover {
    @apply opacity-80;
  }
  
  .ios-button-filled:active {
    @apply opacity-60;
  }
  
  .ios-button-tinted {
    @apply ios-button text-system-blue;
    background: rgba(10, 132, 255, 0.1);
  }
  
  .ios-button-tinted:hover {
    background: rgba(10, 132, 255, 0.15);
  }
  
  .ios-button-tinted:active {
    background: rgba(10, 132, 255, 0.2);
  }
  
  .ios-button-plain {
    @apply ios-button text-system-blue bg-transparent;
  }

  /* Glass Components */
  .glass-card {
    background: var(--glass-background);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--radius-medium);
    transition: all 0.3s ease;
  }

  .glass-card-strong {
    background: var(--glass-background-strong);
    backdrop-filter: blur(30px);
    -webkit-backdrop-filter: blur(30px);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: var(--radius-medium);
    transition: all 0.3s ease;
  }

  .glass-floating {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  }

  .glass-floating:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 50px rgba(0, 0, 0, 0.2);
  }

  /* Hide scroll indicators */
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }

  /* Game Card Styles */
  .game-card {
    width: 200px;
    height: 320px;
    flex-shrink: 0;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .game-card:hover {
    transform: scale(1.05) translateY(-8px);
  }
  
  .ios-button-plain:hover {
    @apply opacity-80;
  }
  
  .ios-button-plain:active {
    @apply opacity-60;
  }

  /* iOS 17 Navigation - Dark Theme */
  .ios-navbar {
    @apply border-b border-separator px-4 py-2;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(16px);
    transition: all 200ms ease-out;
  }
  
  .ios-navbar-large {
    @apply ios-navbar pb-4;
  }
  
  .ios-navbar-compact {
    @apply ios-navbar;
  }
  
  .ios-navbar-title {
    @apply ios-large-title text-center;
  }
  
  .ios-navbar-title-compact {
    @apply ios-headline text-center;
  }

  /* iOS 17 Tab Bar - Dark Theme */
  .ios-tabbar {
    @apply border-t border-separator px-2 py-1;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
  }

  /* Ultra Glass Navigation */
  .glass-navigation {
    background: var(--glass-nav-background);
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border-top: 1px solid var(--glass-nav-border);
    box-shadow: var(--glass-nav-shadow);
    transition: all 0.3s ease;
  }

  .glass-nav-button {
    font-family: var(--font-montserrat);
    color: rgba(255, 255, 255, 0.7);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .glass-nav-button-active {
    font-family: var(--font-montserrat);
    color: #FFFFFF;
    font-weight: 600;
  }

  /* Modern Landing Animations */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
  }

  @keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
    50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes nav-bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }


  .animate-float {
    animation: float 6s ease-in-out infinite;
  }

  .animate-pulse-glow {
    animation: pulse-glow 3s ease-in-out infinite;
  }

  .animate-gradient {
    background-size: 400% 400%;
    animation: gradient-shift 8s ease infinite;
  }

  .animate-nav-bounce {
    animation: nav-bounce 0.6s ease-in-out;
  }

  /* Modern Glass Effects */
  .glass-modern {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }

  /* Smooth Reveal Animations */
  .reveal-up {
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .reveal-up.in-view {
    opacity: 1;
    transform: translateY(0);
  }
  
  .ios-tabbar-item {
    @apply flex flex-col items-center p-1 rounded-medium transition-all;
    min-height: 49px;
  }
  
  .ios-tabbar-item:active {
    background: var(--system-fill);
  }
  
  .ios-tabbar-icon {
    @apply w-6 h-6 mb-1;
    color: var(--secondary-label);
  }
  
  .ios-tabbar-icon-active {
    @apply w-6 h-6 mb-1;
    color: var(--system-blue);
  }
  
  .ios-tabbar-label {
    @apply ios-caption2;
    color: var(--secondary-label);
  }
  
  .ios-tabbar-label-active {
    @apply ios-caption2;
    color: var(--system-blue);
  }

  /* iOS Switch */
  .ios-switch {
    @apply relative inline-flex h-8 w-12 items-center rounded-full transition-colors duration-200 ease-in-out cursor-pointer;
    background-color: rgba(120, 120, 128, 0.16);
  }

  .ios-switch-active {
    background-color: rgb(52, 199, 89);
  }

  .ios-switch-thumb {
    @apply absolute left-1 h-6 w-6 rounded-full bg-white shadow-lg transition-transform duration-200 ease-in-out;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15), 0 1px 1px rgba(0, 0, 0, 0.06);
  }

  .ios-switch-active .ios-switch-thumb {
    transform: translateX(16px);
  }

  /* iOS 17 Segmented Control */
  .ios-segmented {
    @apply bg-system-fill rounded-medium p-1 flex;
  }
  
  .ios-segmented-item {
    @apply flex-1 px-4 py-2 rounded-small transition-all ios-footnote font-medium text-center;
    color: var(--label);
  }
  
  .ios-segmented-item-active {
    @apply ios-segmented-item shadow-sm;
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
  }

  /* iOS 17 Fields */
  .ios-field {
    @apply bg-system-fill rounded-medium px-4 py-3 border-0 transition-all;
    font-size: 17px;
    line-height: 22px;
  }
  
  .ios-field:focus {
    @apply outline-none;
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 0 0 2px var(--system-blue);
  }
  
  .ios-field-group {
    @apply space-y-2;
  }
  
  .ios-field-label {
    @apply ios-footnote block mb-1;
    color: var(--secondary-label);
  }

  /* iOS 17 Specific Components */
  .ios-hero-section {
    @apply text-center py-16 px-6 space-y-6;
  }
  
  .ios-feature-grid {
    @apply grid gap-4 px-4;
  }
  
  .ios-feature-card {
    @apply ios-card p-6 text-center space-y-3;
  }
  
  .ios-stats-grid {
    @apply grid grid-cols-3 gap-4 px-4;
  }
  
  .ios-stat-card {
    @apply ios-card p-4 text-center;
  }

  /* iOS 17 CTA Bar - Dark Theme */
  .ios-cta-bar {
    @apply border-t border-separator p-4;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
  }

  /* Animations */
  .ios-slide-up {
    animation: iosSlideUp 300ms ease-out;
  }
  
  @keyframes iosSlideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .ios-fade-in {
    animation: iosFadeIn 400ms ease-out;
  }
  
  @keyframes iosFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Utility Classes - Native Safe Area */
  .safe-area-top {
    padding-top: env(safe-area-inset-top);
  }
  
  .safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .safe-area-left {
    padding-left: env(safe-area-inset-left);
  }
  
  .safe-area-right {
    padding-right: env(safe-area-inset-right);
  }

  /* Telegram Safe Area Utilities */
  .tg-safe-top {
    padding-top: max(var(--sat, 0px), var(--csat, 0px));
  }
  
  .tg-safe-bottom {
    padding-bottom: max(var(--sab, 0px), var(--csab, 0px));
  }
  
  .tg-safe-left {
    padding-left: max(var(--sal, 0px), var(--csal, 0px));
  }
  
  .tg-safe-right {
    padding-right: max(var(--sar, 0px), var(--csar, 0px));
  }

  /* Telegram Content Safe Area (для учета Telegram UI элементов) */
  .tg-content-safe-top {
    padding-top: var(--csat, 0px);
  }
  
  .tg-content-safe-bottom {
    padding-bottom: var(--csab, 0px);
  }
  
  /* Telegram Full Height (с учетом safe areas) */
  .tg-full-height {
    height: calc(var(--vh, 1vh) * 100);
    min-height: -webkit-fill-available;
  }
}

@layer utilities {
  /* === DEMO APP SAFE NAVIGATION === */
  /* Класс для верхней навигации в демо-приложениях */
  /* Учитывает safe area + дополнительный padding для fullscreen режима Telegram */
  /* Left padding увеличен до 70px чтобы избежать перекрытия кнопкой закрытия Telegram */
  .demo-nav-safe {
    padding-top: max(env(safe-area-inset-top, 0px), 3.5rem);
    padding-left: max(env(safe-area-inset-left, 0px), 4.5rem);
    padding-right: max(env(safe-area-inset-right, 0px), 1.5rem);
    padding-bottom: 1.5rem;
  }

  /* === TELEGRAM MINI APP ACTIVE STATES === */
  /* Универсальный класс для интерактивных элементов */
  /* Добавляет visual + tactile feedback при нажатии */
  .tg-interactive {
    transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), 
                opacity 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .tg-interactive:active {
    transform: scale(0.98);
    opacity: 0.85;
  }
  
  /* Альтернативный стиль - только затемнение без scale */
  .tg-interactive-darken {
    transition: opacity 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .tg-interactive-darken:active {
    opacity: 0.7;
  }
  
  /* Интенсивный feedback для важных действий */
  .tg-interactive-strong {
    transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1), 
                opacity 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    user-select: none;
    -webkit-user-select: none;
  }
  
  .tg-interactive-strong:active {
    transform: scale(0.95);
    opacity: 0.8;
  }

  /* === 2025 GLASSMORPHISM UTILITIES === */
  
  /* Glass Card - Subtle */
  .glass-card {
    background: var(--glass-subtle-bg);
    border: 1px solid var(--glass-subtle-border);
    backdrop-filter: var(--glass-subtle-blur);
    -webkit-backdrop-filter: var(--glass-subtle-blur);
    box-shadow: var(--glass-subtle-shadow);
  }
  
  /* Glass Card - Medium */
  .glass-card-medium {
    background: var(--glass-medium-bg);
    border: 1px solid var(--glass-medium-border);
    backdrop-filter: var(--glass-medium-blur);
    -webkit-backdrop-filter: var(--glass-medium-blur);
    box-shadow: var(--glass-medium-shadow);
  }
  
  /* Glass Card - Strong */
  .glass-card-strong {
    background: var(--glass-strong-bg);
    border: 1px solid var(--glass-strong-border);
    backdrop-filter: var(--glass-strong-blur);
    -webkit-backdrop-filter: var(--glass-strong-blur);
    box-shadow: var(--glass-strong-shadow);
  }
  
  /* Glass Gradient Card */
  .glass-gradient-card {
    background: var(--glass-gradient-bg);
    border: 1px solid var(--glass-gradient-border);
    backdrop-filter: var(--glass-gradient-blur);
    -webkit-backdrop-filter: var(--glass-gradient-blur);
    box-shadow: var(--glass-gradient-shadow);
  }
  
  /* Aurora Glass Effect */
  .glass-aurora {
    position: relative;
    background: var(--aurora-bg);
    border: 1px solid var(--aurora-border);
    backdrop-filter: var(--aurora-blur);
    -webkit-backdrop-filter: var(--aurora-blur);
    overflow: hidden;
  }
  
  .glass-aurora::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: conic-gradient(
      from 0deg,
      transparent 0%,
      rgba(16, 185, 129, 0.3) 25%,
      rgba(6, 182, 212, 0.3) 50%,
      rgba(168, 85, 247, 0.3) 75%,
      transparent 100%
    );
    border-radius: inherit;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
  }
  
  .glass-aurora:hover::before {
    opacity: 1;
    animation: rotate-aurora 3s linear infinite;
  }
  
  @keyframes rotate-aurora {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  /* === 2025 NEUMORPHISM UTILITIES === */
  
  /* Neumorphic Card */
  .neu-card {
    background: var(--background-secondary);
    border-radius: 20px;
    box-shadow: 
      8px 8px 16px rgba(0, 0, 0, 0.5),
      -8px -8px 16px rgba(255, 255, 255, 0.05);
  }
  
  /* Neumorphic Inset */
  .neu-inset {
    background: var(--background-primary);
    border-radius: 20px;
    box-shadow: 
      inset 4px 4px 8px rgba(0, 0, 0, 0.6),
      inset -4px -4px 8px rgba(255, 255, 255, 0.05);
  }
  
  /* Elevated Card with Premium Shadow */
  .elevated-card {
    background: var(--background-secondary);
    border-radius: 20px;
    box-shadow: 
      0 20px 60px rgba(0, 0, 0, 0.4),
      0 8px 16px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
  }
  
  .elevated-card:hover {
    transform: translateY(-4px);
    box-shadow: 
      0 24px 80px rgba(0, 0, 0, 0.5),
      0 12px 24px rgba(0, 0, 0, 0.4);
  }
  
  /* Gradient Border Effect */
  .gradient-border {
    position: relative;
    background: var(--background-secondary);
    border-radius: 20px;
  }
  
  .gradient-border::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 2px;
    background: var(--gradient-aurora);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask-composite: xor;
  }
  
  /* Floating Card */
  .floating-card {
    background: var(--background-secondary);
    border-radius: 20px;
    animation: float 3s ease-in-out infinite;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  /* === 2025 MICRO-INTERACTIONS === */
  
  /* Spring-In Animation */
  .spring-in {
    animation: spring-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
  }
  
  @keyframes spring-in {
    0% {
      opacity: 0;
      transform: scale(0.5);
    }
    50% {
      transform: scale(1.1);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  /* Magnetic Button Effect */
  .magnetic-button {
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  /* Ripple Effect (for buttons) */
  .ripple-effect {
    position: relative;
    overflow: hidden;
  }
  
  .ripple-effect::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }
  
  .ripple-effect:active::before {
    width: 300px;
    height: 300px;
  }
  
  /* Smooth Hover Lift */
  .hover-lift {
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
  }
  
  .hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
  }
  
  /* Subtle Scale on Hover */
  .hover-scale {
    transition: transform 0.2s ease;
  }
  
  .hover-scale:hover {
    transform: scale(1.05);
  }
  
  /* Glow on Hover */
  .hover-glow {
    transition: box-shadow 0.3s ease, filter 0.3s ease;
  }
  
  .hover-glow:hover {
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
    filter: brightness(1.1);
  }
  
  /* Organic Border Radius */
  .organic-radius {
    border-radius: var(--radius-organic-1);
  }
  
  /* Squircle Effect (iOS-style smooth corners) */
  .squircle {
    border-radius: var(--radius-squircle);
    -webkit-mask-image: paint(squircle);
  }
  
  /* Text gradient utilities */
  .gradient-text {
    background: linear-gradient(135deg, #10B981, #06B6D4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .gradient-text-animated {
    background: linear-gradient(
      90deg,
      #10B981 0%,
      #14B8A6 25%,
      #06B6D4 50%,
      #0EA5E9 75%,
      #10B981 100%
    );
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-shift 3s linear infinite;
  }
  
  @keyframes gradient-shift {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
  }
  
  .glow-text {
    color: #10B981;
    text-shadow: 
      0 0 10px rgba(16, 185, 129, 0.5),
      0 0 20px rgba(16, 185, 129, 0.3),
      0 0 30px rgba(16, 185, 129, 0.2);
  }
  
  .stroke-text {
    color: transparent;
    -webkit-text-stroke: 2px #10B981;
    text-stroke: 2px #10B981;
    font-weight: 700;
  }
  
  @keyframes text-reveal {
    0% {
      clip-path: polygon(0 0, 0 0, 0 100%, 0% 100%);
    }
    100% {
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
    }
  }
  
  .kinetic-text {
    animation: text-reveal 0.8s cubic-bezier(0.77, 0, 0.175, 1) forwards;
  }
  
  /* Glitch animation keyframes */
  @keyframes glitch-1 {
    0% { clip-path: inset(40% 0 61% 0); transform: translate(-2px, 2px); }
    20% { clip-path: inset(92% 0 1% 0); transform: translate(2px, -2px); }
    40% { clip-path: inset(43% 0 1% 0); transform: translate(-2px, 2px); }
    60% { clip-path: inset(25% 0 58% 0); transform: translate(2px, -2px); }
    80% { clip-path: inset(54% 0 7% 0); transform: translate(-2px, 2px); }
    100% { clip-path: inset(58% 0 43% 0); transform: translate(2px, -2px); }
  }
  
  @keyframes glitch-2 {
    0% { clip-path: inset(50% 0 20% 0); transform: translate(2px, -2px); }
    20% { clip-path: inset(10% 0 80% 0); transform: translate(-2px, 2px); }
    40% { clip-path: inset(70% 0 15% 0); transform: translate(2px, -2px); }
    60% { clip-path: inset(30% 0 60% 0); transform: translate(-2px, 2px); }
    80% { clip-path: inset(80% 0 10% 0); transform: translate(2px, -2px); }
    100% { clip-path: inset(40% 0 50% 0); transform: translate(-2px, 2px); }
  }
  
  .animate-glitch-1 {
    animation: glitch-1 0.3s infinite;
  }
  
  .animate-glitch-2 {
    animation: glitch-2 0.3s infinite;
  }
  
  /* Slow falling dollar animation */
  @keyframes fall-dollar-realistic {
    0% {
      transform: translateY(0) translateX(0) rotate(var(--rotate-start, 0deg));
      opacity: 0;
    }
    8% {
      opacity: 1;
    }
    92% {
      opacity: 1;
    }
    100% {
      transform: translateY(650px) translateX(var(--drift-x-1, 0px)) rotate(calc(var(--rotate-start, 0deg) + 15deg));
      opacity: 0;
    }
  }
  
  .animate-fall-dollar-realistic {
    animation: fall-dollar-realistic ease-in infinite;
    will-change: transform, opacity;
  }
  /* Aurora Glassmorphism Effects */
  .glass-aurora {
    position: relative;
    background: var(--aurora-bg);
    backdrop-filter: var(--aurora-blur);
    -webkit-backdrop-filter: var(--aurora-blur);
    border: 1px solid var(--aurora-border);
  }
  
  .glass-aurora::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: conic-gradient(
      from 180deg at 50% 50%,
      rgba(16, 185, 129, 0.25) 0deg,
      rgba(20, 184, 166, 0.25) 60deg,
      rgba(6, 182, 212, 0.25) 120deg,
      rgba(168, 85, 247, 0.25) 180deg,
      rgba(236, 72, 153, 0.25) 240deg,
      rgba(16, 185, 129, 0.25) 360deg
    );
    border-radius: inherit;
    filter: blur(40px);
    opacity: 0;
    transition: opacity 0.5s ease;
    z-index: -1;
  }
  
  .glass-aurora:hover::before {
    opacity: 1;
  }
  
  /* Glassmorphism 2.0 - Five Level Utility Classes */
  /* Level 1: Subtle */
  .glass-subtle {
    background: var(--glass-subtle-bg);
    backdrop-filter: var(--glass-subtle-blur);
    -webkit-backdrop-filter: var(--glass-subtle-blur);
    border: 1px solid var(--glass-subtle-border);
    box-shadow: var(--glass-subtle-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }
  
  /* Level 2: Medium */
  .glass-medium {
    background: var(--glass-medium-bg);
    backdrop-filter: var(--glass-medium-blur);
    -webkit-backdrop-filter: var(--glass-medium-blur);
    border: 1px solid var(--glass-medium-border);
    box-shadow: var(--glass-medium-shadow), 
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
  }
  
  /* Level 3: Strong */
  .glass-strong {
    background: var(--glass-strong-bg);
    backdrop-filter: var(--glass-strong-blur);
    -webkit-backdrop-filter: var(--glass-strong-blur);
    border: 1px solid var(--glass-strong-border);
    box-shadow: var(--glass-strong-shadow),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  }
  
  /* Level 4: Gradient Glass */
  .glass-gradient {
    background: var(--glass-gradient-bg);
    backdrop-filter: var(--glass-gradient-blur);
    -webkit-backdrop-filter: var(--glass-gradient-blur);
    border: 1px solid var(--glass-gradient-border);
    box-shadow: var(--glass-gradient-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }
  
  /* Level 5: Frosted Glass */
  .glass-frosted {
    background: var(--glass-frosted-bg);
    backdrop-filter: var(--glass-frosted-blur);
    -webkit-backdrop-filter: var(--glass-frosted-blur);
    border: 1px solid var(--glass-frosted-border);
    box-shadow: var(--glass-frosted-shadow);
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
  }
  
  /* Extended Color Utilities */
  .text-teal {
    color: var(--teal-500);
  }
  
  .text-cyan {
    color: var(--cyan-500);
  }
  
  .text-lime {
    color: var(--lime-500);
  }
  
  .text-amber {
    color: var(--amber-500);
  }
  
  .text-orange {
    color: var(--orange-500);
  }
  
  .text-rose {
    color: var(--rose-500);
  }
  
  .bg-teal {
    background-color: var(--teal-500);
  }
  
  .bg-cyan {
    background-color: var(--cyan-500);
  }
  
  .bg-lime {
    background-color: var(--lime-500);
  }
  
  .bg-amber {
    background-color: var(--amber-500);
  }
  
  .bg-orange {
    background-color: var(--orange-500);
  }
  
  .bg-rose {
    background-color: var(--rose-500);
  }
  
  /* Gradient Text Utilities */
  .gradient-text {
    background: linear-gradient(135deg, #fff 0%, #E0E0E0 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .gradient-text-emerald {
    background: linear-gradient(135deg, #10B981 0%, #14B8A6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .gradient-text-aurora {
    background: linear-gradient(135deg, #10B981 0%, #06B6D4 50%, #8B5CF6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* iOS Color Utilities */
  .text-system-blue {
    color: var(--system-blue);
  }
  
  .text-system-green {
    color: var(--system-green);
  }
  
  .text-system-red {
    color: var(--system-red);
  }
  
  .text-system-orange {
    color: var(--system-orange);
  }
  
  .text-label {
    color: var(--label);
  }
  
  .text-secondary-label {
    color: var(--secondary-label);
  }
  
  .text-tertiary-label {
    color: var(--tertiary-label);
  }
  
  .bg-system-blue {
    background-color: var(--system-blue);
  }
  
  .bg-system-green {
    background-color: var(--system-green);
  }
  
  .bg-system-orange {
    background-color: var(--system-orange);
  }
  
  .border-system-orange {
    border-color: var(--system-orange);
  }
  
  .border-system-green {
    border-color: var(--system-green);
  }
  
  .bg-system-fill {
    background-color: var(--system-fill);
  }
  
  .bg-secondary-system-fill {
    background-color: var(--secondary-system-fill);
  }
  
  .border-separator {
    border-color: var(--separator);
  }
  
  .rounded-large {
    border-radius: var(--radius-large);
  }
  
  .rounded-medium {
    border-radius: var(--radius-medium);
  }
  
  .rounded-small {
    border-radius: var(--radius-small);
  }
  
  .rounded-mini {
    border-radius: var(--radius-mini);
  }
}

/* ===== WOW HOMEPAGE EFFECTS ===== */

/* Animated Background Gradients */
.wow-bg-animated {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  z-index: -1;
  opacity: 0.3;
  background: conic-gradient(
    from 0deg at 50% 50%,
    #667eea 0deg,
    #764ba2 60deg,
    #f093fb 120deg,
    #f5576c 180deg,
    #4facfe 240deg,
    #00f2fe 300deg,
    #667eea 360deg
  );
  animation: wow-bg-spin 20s linear infinite;
  filter: blur(80px);
}

.wow-bg-mesh {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100vh;
  z-index: -1;
  opacity: 0.15;
  background: 
    radial-gradient(circle at 20% 50%, #667eea 20%, transparent 50%),
    radial-gradient(circle at 80% 20%, #f093fb 20%, transparent 50%),
    radial-gradient(circle at 40% 80%, #4facfe 20%, transparent 50%);
  animation: wow-mesh-float 15s ease-in-out infinite alternate;
  filter: blur(60px);
}

@keyframes wow-bg-spin {
  0% { transform: rotate(0deg) scale(1); }
  33% { transform: rotate(120deg) scale(1.1); }
  66% { transform: rotate(240deg) scale(0.9); }
  100% { transform: rotate(360deg) scale(1); }
}

@keyframes wow-mesh-float {
  0% { 
    transform: translate(0, 0) rotate(0deg);
    opacity: 0.15;
  }
  50% { 
    transform: translate(-20px, -30px) rotate(3deg);
    opacity: 0.25;
  }
  100% { 
    transform: translate(30px, 20px) rotate(-2deg);
    opacity: 0.1;
  }
}

/* Morphing Blobs */
.wow-blob {
  position: absolute;
  border-radius: 50%;
  filter: blur(40px);
  mix-blend-mode: multiply;
  animation: wow-blob-morph 8s ease-in-out infinite;
}

.wow-blob-1 {
  top: 10%;
  left: 20%;
  width: 200px;
  height: 200px;
  background: linear-gradient(45deg, #667eea, #764ba2);
  animation-delay: 0s;
}

.wow-blob-2 {
  top: 60%;
  right: 20%;
  width: 150px;
  height: 150px;
  background: linear-gradient(45deg, #f093fb, #f5576c);
  animation-delay: 2s;
}

.wow-blob-3 {
  bottom: 20%;
  left: 50%;
  width: 180px;
  height: 180px;
  background: linear-gradient(45deg, #4facfe, #00f2fe);
  animation-delay: 4s;
}

@keyframes wow-blob-morph {
  0%, 100% { 
    border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    transform: translate(0, 0) rotate(0deg);
  }
  50% { 
    border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%;
    transform: translate(-20px, 20px) rotate(180deg);
  }
}

/* Hero Section Enhancements */
.wow-hero-container {
  position: relative;
  min-height: 70vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  overflow: hidden;
}

.wow-gradient-text {
  background: linear-gradient(
    135deg,
    #667eea 0%,
    #764ba2 25%,
    #f093fb 50%,
    #f5576c 75%,
    #4facfe 100%
  );
  background-size: 400% 400%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: wow-gradient-flow 6s ease-in-out infinite;
}

@keyframes wow-gradient-flow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.wow-shimmer {
  position: relative;
  overflow: hidden;
}

.wow-shimmer::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.2),
    transparent
  );
  animation: wow-shimmer-slide 3s infinite;
}

@keyframes wow-shimmer-slide {
  0% { left: -100%; }
  100% { left: 100%; }
}

/* Floating Cards */
.wow-floating-card {
  animation: wow-float 6s ease-in-out infinite;
  will-change: transform;
}

.wow-floating-card:nth-child(2) {
  animation-delay: 1s;
}

.wow-floating-card:nth-child(3) {
  animation-delay: 2s;
}

@keyframes wow-float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  50% { transform: translateY(-20px) rotate(1deg); }
}

/* 3D Gallery Effects */
.wow-gallery-3d {
  perspective: 1000px;
  overflow-x: auto;
  padding: 20px 0;
}

.wow-card-3d {
  transform-style: preserve-3d;
  transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
  will-change: transform;
}

.wow-card-3d:hover {
  transform: translateY(-10px) rotateX(5deg) rotateY(5deg) scale(1.02);
  box-shadow: 
    0 25px 50px -12px rgba(0, 0, 0, 0.25),
    0 0 0 1px rgba(255, 255, 255, 0.1);
}

.wow-card-active {
  transform: scale(1.05) translateZ(50px);
  z-index: 10;
}

/* Count-up Stats */
.wow-stat {
  transform: translateY(30px);
  opacity: 0;
  transition: all 0.8s cubic-bezier(0.23, 1, 0.320, 1);
}

.wow-stat.visible {
  transform: translateY(0);
  opacity: 1;
}

.wow-count {
  font-variant-numeric: tabular-nums;
  transition: all 0.3s ease;
}

/* Pulse Ring Animation */
.wow-pulse-ring {
  position: relative;
}

.wow-pulse-ring::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 100%;
  height: 100%;
  border: 2px solid currentColor;
  border-radius: 50%;
  transform: translate(-50%, -50%);
  animation: wow-pulse 2s infinite;
}

@keyframes wow-pulse {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(-50%, -50%) scale(1.5);
    opacity: 0;
  }
}

/* Marquee */
.wow-marquee {
  overflow: hidden;
  white-space: nowrap;
}

.wow-marquee-inner {
  display: inline-block;
  animation: wow-marquee-scroll 30s linear infinite;
}

.wow-marquee:hover .wow-marquee-inner {
  animation-play-state: paused;
}

@keyframes wow-marquee-scroll {
  0% { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}

/* Enhanced 3D Gallery */
.wow-gallery-3d {
  perspective: 1000px;
  overflow-x: auto;
  padding: 20px 0;
}

.wow-card-3d {
  transform-style: preserve-3d;
  transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
  will-change: transform;
}


/* FINAL COMPREHENSIVE REDUCED MOTION OVERRIDE - SINGLE BLOCK */
@media (prefers-reduced-motion: reduce) {
  html, body, .scroll-smooth { 
    scroll-behavior: auto !important; 
  }
  
  *, *::before, *::after { 
    animation: none !important; 
    transition: none !important; 
    transform: none !important; 
  }
  
  [style*="transition"], 
  [style*="animation"], 
  [style*="transform"] { 
    transition: none !important; 
    animation: none !important; 
    transform: none !important; 
  }
  
  .wow-bg-animated, 
  .wow-bg-mesh, 
  .wow-blob, 
  .wow-shimmer, 
  .wow-floating-card, 
  .marquee, 
  .parallax { 
    animation: none !important; 
    background-position: initial !important; 
    transform: none !important; 
    opacity: 1 !important; 
  }
  
  .transition, 
  .transition-all, 
  .transition-opacity, 
  .transition-transform, 
  [class*="duration-"], 
  [class*="delay-"], 
  .ease-in,
  .ease-out, 
  .ease-in-out,
  .group:hover *, 
  .hover\\:scale-110,
  .hover\\:opacity-80,
  .hover\\:opacity-100,
  .focus\\:scale-110,
  .active\\:scale-110 { 
    transition: none !important; 
    transform: none !important; 
    animation: none !important;
    opacity: revert-layer;
  }
  
  .wow-card-3d[style*="transform"] { 
    transform: none !important; 
  }
}

/* Hide scrollbar for horizontal scroll */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* 3D Carousel Duration Classes */
.duration-600 {
  transition-duration: 600ms;
}

/* ===== INSANE TECHNO ANIMATIONS ===== */
@keyframes neon-pulse {
  0%, 100% { 
    box-shadow: 0 0 5px #10B981, 0 0 20px #10B981, 0 0 35px #10B981;
    transform: scale(1);
  }
  50% { 
    box-shadow: 0 0 10px #10B981, 0 0 40px #10B981, 0 0 80px #10B981;
    transform: scale(1.02);
  }
}

@keyframes matrix-fall {
  0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

@keyframes scan-line {
  0% { transform: translateX(-100%); opacity: 0; }
  50% { opacity: 1; }
  100% { transform: translateX(400%); opacity: 0; }
}

@keyframes barcode-shift {
  0% { transform: translateX(0) scaleY(1); }
  25% { transform: translateX(2px) scaleY(1.1); }
  50% { transform: translateX(0) scaleY(0.9); }
  75% { transform: translateX(-2px) scaleY(1.1); }
  100% { transform: translateX(0) scaleY(1); }
}

@keyframes glitch-text {
  0%, 98% { transform: translate(0); }
  2% { transform: translate(2px, 0) skew(0.5deg); }
  4% { transform: translate(-2px, 0) skew(-0.5deg); }
  6% { transform: translate(2px, 0) skew(0.5deg); }
  8% { transform: translate(-1px, 0) skew(-0.3deg); }
  10% { transform: translate(1px, 0) skew(0.3deg); }
}

@keyframes float-3d {
  0%, 100% { transform: rotateX(0deg) rotateY(0deg) translateZ(0px); }
  25% { transform: rotateX(5deg) rotateY(5deg) translateZ(10px); }
  50% { transform: rotateX(0deg) rotateY(10deg) translateZ(5px); }
  75% { transform: rotateX(-5deg) rotateY(5deg) translateZ(15px); }
}

@keyframes hologram {
  0%, 100% { opacity: 1; transform: skew(0deg, 0deg); }
  25% { opacity: 0.8; transform: skew(1deg, 0deg); }
  50% { opacity: 0.9; transform: skew(0deg, 1deg); }
  75% { opacity: 0.85; transform: skew(-1deg, 0deg); }
}

@keyframes data-stream {
  0% { transform: translateY(0) rotate(0deg); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(-100vh) rotate(180deg); opacity: 0; }
}

@keyframes electric-surge {
  0%, 100% { filter: brightness(1) contrast(1); }
  50% { filter: brightness(1.3) contrast(1.2) hue-rotate(10deg); }
}

@keyframes cyber-flicker {
  0%, 100% { opacity: 1; }
  1% { opacity: 0.9; }
  2% { opacity: 1; }
  3% { opacity: 0.8; }
  4% { opacity: 1; }
  95% { opacity: 1; }
  96% { opacity: 0.95; }
  97% { opacity: 1; }
  98% { opacity: 0.9; }
  99% { opacity: 1; }
}

@keyframes gradient-border {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

@keyframes noise-scroll {
  0% { transform: translate(0, 0); }
  10% { transform: translate(-5px, -5px); }
  20% { transform: translate(-10px, 5px); }
  30% { transform: translate(5px, -10px); }
  40% { transform: translate(-5px, 15px); }
  50% { transform: translate(10px, 5px); }
  60% { transform: translate(5px, -15px); }
  70% { transform: translate(-10px, -5px); }
  80% { transform: translate(15px, 10px); }
  90% { transform: translate(-15px, -10px); }
  100% { transform: translate(0, 0); }
}

.techno-block {
  animation: neon-pulse 2s ease-in-out infinite;
  position: relative;
  overflow: hidden;
}

.techno-block::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, transparent, #fff, transparent);
  animation: scan-line 3s linear infinite;
  z-index: 10;
}

.techno-block::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, transparent 48%, rgba(182, 255, 0, 0.1) 49%, rgba(182, 255, 0, 0.1) 51%, transparent 52%);
  animation: cyber-flicker 4s ease-in-out infinite;
  pointer-events: none;
}

.matrix-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
  overflow: hidden;
}

.matrix-char {
  position: absolute;
  color: #10B981;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  animation: data-stream 6s linear infinite;
  opacity: 0.4;
  text-shadow: 0 0 5px #10B981;
}

.barcode-animated {
  animation: barcode-shift 1.5s ease-in-out infinite;
}

.glitch-text {
  animation: glitch-text 3s ease-in-out infinite;
  position: relative;
}

.floating-3d {
  animation: float-3d 4s ease-in-out infinite;
  transform-style: preserve-3d;
}

.hologram-effect {
  animation: hologram 2.5s ease-in-out infinite;
  background: linear-gradient(135deg, rgba(182, 255, 0, 0.1) 0%, transparent 50%, rgba(182, 255, 0, 0.1) 100%);
}

.hover-intense:hover {
  transform: scale(1.05) rotateX(5deg) rotateY(5deg);
  box-shadow: 0 0 30px #10B981, 0 0 60px #10B981, 0 0 90px #10B981;
  transition: all 0.3s ease;
  animation: electric-surge 0.5s ease-in-out;
}

.perspective-container {
  perspective: 1000px;
  transform-style: preserve-3d;
}

.neon-glow {
  box-shadow: 
    0 0 5px #10B981,
    0 0 10px #10B981,
    0 0 20px #10B981,
    inset 0 0 10px rgba(182, 255, 0, 0.1);
}

.cyber-border {
  position: relative;
}

.cyber-border::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(45deg, #10B981, transparent, #10B981, transparent, #10B981);
  background-size: 400% 400%;
  animation: gradient-border 3s linear infinite;
  border-radius: inherit;
  z-index: -1;
}

.digital-noise {
  position: relative;
}

.digital-noise::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.03;
  background-image: 
    radial-gradient(circle at 1px 1px, #10B981 1px, transparent 0);
  background-size: 20px 20px;
  animation: noise-scroll 10s linear infinite;
  pointer-events: none;
}

/* Falling Pixel Dollars */
@keyframes pixel-dollar-fall {
  0% { 
    transform: translateY(-50px); 
    opacity: 1; 
  }
  100% { 
    transform: translateY(200px); 
    opacity: 0; 
  }
}

.pixel-dollar {
  position: absolute;
  top: -50px;
  animation: pixel-dollar-fall 3s linear infinite;
  pointer-events: none;
  z-index: 5;
}

.pixel-dollar-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  pointer-events: none;
}

/* Flying Planes - Multi-directional Flight */

/* Left to Right */
@keyframes plane-left-to-right {
  0% { 
    transform: translateX(-120px) translateY(0px) rotate(0deg); 
    opacity: 0; 
  }
  10% { 
    opacity: 1; 
  }
  90% { 
    opacity: 1; 
  }
  100% { 
    transform: translateX(120px) translateY(0px) rotate(0deg); 
    opacity: 0; 
  }
}

/* Right to Left */
@keyframes plane-right-to-left {
  0% { 
    transform: translateX(120px) translateY(0px) rotate(180deg); 
    opacity: 0; 
  }
  10% { 
    opacity: 1; 
  }
  90% { 
    opacity: 1; 
  }
  100% { 
    transform: translateX(-120px) translateY(0px) rotate(180deg); 
    opacity: 0; 
  }
}

/* Top to Bottom */
@keyframes plane-top-to-bottom {
  0% { 
    transform: translateX(0px) translateY(-60px) rotate(90deg); 
    opacity: 0; 
  }
  10% { 
    opacity: 1; 
  }
  90% { 
    opacity: 1; 
  }
  100% { 
    transform: translateX(0px) translateY(60px) rotate(90deg); 
    opacity: 0; 
  }
}

/* Bottom to Top */
@keyframes plane-bottom-to-top {
  0% { 
    transform: translateX(0px) translateY(60px) rotate(-90deg); 
    opacity: 0; 
  }
  10% { 
    opacity: 1; 
  }
  90% { 
    opacity: 1; 
  }
  100% { 
    transform: translateX(0px) translateY(-60px) rotate(-90deg); 
    opacity: 0; 
  }
}

/* Plane 1 - Left to Right */
.telegram-plane-1 {
  animation: plane-left-to-right 8s linear infinite;
  top: 40%;
  animation-delay: 0s;
}

/* Plane 2 - Right to Left */
.telegram-plane-2 {
  animation: plane-right-to-left 8s linear infinite;
  top: 55%;
  animation-delay: 2s;
}

/* Plane 3 - Top to Bottom */
.telegram-plane-3 {
  animation: plane-top-to-bottom 8s linear infinite;
  top: 30%;
  left: 30%;
  animation-delay: 4s;
}

/* Plane 4 - Bottom to Top */
.telegram-plane-4 {
  animation: plane-bottom-to-top 8s linear infinite;
  top: 40%;
  left: 70%;
  animation-delay: 6s;
}

/* ========================================
   2025 MODERNIZATION - NEW EFFECTS
   ======================================== */

/* ANIMATED GRADIENTS */
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.accent-animated {
  background: var(--primary-gradient);
  background-size: 200% 200%;
  animation: gradientShift 3s ease infinite;
}

.gradient-mesh {
  background-image: var(--mesh-bg-1), var(--mesh-bg-2), var(--mesh-bg-3);
  background-attachment: fixed;
}

/* NEUROMORPHIC CARDS */
.neuromorphic-card {
  background: linear-gradient(145deg, #0a0a0a, #141414);
  box-shadow: 
    8px 8px 16px #000000,
    -8px -8px 16px #1a1a1a,
    inset 1px 1px 2px rgba(16, 185, 129, 0.1);
  border-radius: 16px;
  transition: all 0.3s ease;
}

.neuromorphic-card:hover {
  box-shadow: 
    12px 12px 24px #000000,
    -12px -12px 24px #1a1a1a,
    inset 1px 1px 3px rgba(16, 185, 129, 0.15);
}

/* AURORA GLASSMORPHISM */
.glass-aurora {
  position: relative;
  background: var(--aurora-bg);
  backdrop-filter: var(--aurora-blur);
  -webkit-backdrop-filter: var(--aurora-blur);
  border: 1px solid var(--aurora-border);
  border-radius: 16px;
}

.glass-aurora::before {
  content: '';
  position: absolute;
  inset: -2px;
  background: conic-gradient(
    from 180deg at 50% 50%,
    rgba(16, 185, 129, 0.25) 0deg,
    rgba(20, 184, 166, 0.25) 60deg,
    rgba(6, 182, 212, 0.25) 120deg,
    rgba(168, 85, 247, 0.25) 180deg,
    rgba(236, 72, 153, 0.25) 240deg,
    rgba(16, 185, 129, 0.25) 360deg
  );
  border-radius: inherit;
  filter: blur(40px);
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: -1;
  pointer-events: none;
}

.glass-aurora:hover::before {
  opacity: 1;
}

/* MAGNETIC BUTTON EFFECT */
.magnetic-button {
  position: relative;
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
}

.magnetic-button::before {
  content: '';
  position: absolute;
  inset: -50%;
  pointer-events: none;
}

/* LIQUID BUTTON EFFECT */
.liquid-button {
  position: relative;
  overflow: hidden;
}

.liquid-button::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.liquid-button:hover::before {
  width: 300px;
  height: 300px;
}

/* MODERN TYPOGRAPHY UTILITIES */
.fluid-text {
  font-size: var(--text-base);
}

.fluid-text-sm {
  font-size: var(--text-sm);
}

.fluid-text-lg {
  font-size: var(--text-lg);
}

.fluid-text-xl {
  font-size: var(--text-xl);
}

.fluid-text-2xl {
  font-size: var(--text-2xl);
}

.fluid-text-3xl {
  font-size: var(--text-3xl);
}

.modern-heading {
  font-weight: 700;
  letter-spacing: -0.02em;
  text-transform: none;
}

.dynamic-text {
  font-variation-settings: 
    'wght' var(--font-weight, 400),
    'slnt' var(--font-slant, 0),
    'wdth' var(--font-width, 100);
  transition: font-variation-settings 0.3s ease;
}

.dynamic-text:hover {
  --font-weight: 600;
  --font-slant: -10;
  --font-width: 105;
}

/* 3D TRANSFORM UTILITIES */
.transform-3d {
  transform-style: preserve-3d;
  perspective: 1000px;
}

.layer-bg {
  transform: translateZ(-50px) scale(1.05);
}

.layer-content {
  transform: translateZ(0px);
}

.layer-fg {
  transform: translateZ(50px);
}

/* SPRING ANIMATION HELPERS */
@keyframes spring-bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.spring-bounce {
  animation: spring-bounce 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

/* SHIMMER ANIMATION for progressive image loading */
@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.shimmer-animation {
  animation: shimmer 2s infinite ease-in-out;
}

/* STAGGER ANIMATION UTILITIES */
.stagger-item {
  opacity: 0;
  transform: translateY(20px);
  filter: blur(10px);
  animation: stagger-fade-in 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes stagger-fade-in {
  to {
    opacity: 1;
    transform: translateY(0);
    filter: blur(0);
  }
}

.stagger-item:nth-child(1) { animation-delay: 0.05s; }
.stagger-item:nth-child(2) { animation-delay: 0.1s; }
.stagger-item:nth-child(3) { animation-delay: 0.15s; }
.stagger-item:nth-child(4) { animation-delay: 0.2s; }
.stagger-item:nth-child(5) { animation-delay: 0.25s; }
.stagger-item:nth-child(6) { animation-delay: 0.3s; }

/* GRADIENT TEXT */
.gradient-text {
  background: var(--gradient-emerald-cyan);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.gradient-text-aurora {
  background: var(--gradient-aurora);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* PERFORMANCE OPTIMIZATIONS */
.gpu-accelerated {
  will-change: transform;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* SMOOTH SCROLL */
.smooth-scroll {
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* ===== РАСШИРЕННЫЕ АНИМАЦИИ ===== */

/* ENTRANCE ANIMATIONS */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.85);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes zoomIn {
  from {
    opacity: 0;
    transform: scale(0.5);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* GESTURE ANIMATIONS */
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
  20%, 40%, 60%, 80% { transform: translateX(10px); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes wiggle {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(-5deg); }
  75% { transform: rotate(5deg); }
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  10%, 30% { transform: scale(0.9); }
  20%, 40% { transform: scale(1.1); }
}

/* LOADING ANIMATIONS */
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes dotsLoading {
  0%, 20% { opacity: 0; }
  50% { opacity: 1; }
  100% { opacity: 0; }
}

@keyframes barPulse {
  0%, 100% { height: 20%; }
  50% { height: 100%; }
}

@keyframes skeletonPulse {
  0% { opacity: 0.6; }
  50% { opacity: 1; }
  100% { opacity: 0.6; }
}

/* SUCCESS ANIMATIONS */
@keyframes checkmark {
  0% {
    stroke-dashoffset: 100;
    opacity: 0;
  }
  50% {
    stroke-dashoffset: 0;
    opacity: 1;
  }
  100% {
    stroke-dashoffset: 0;
    opacity: 1;
  }
}

@keyframes successScale {
  0% { transform: scale(0); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

@keyframes confetti {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) rotate(720deg);
    opacity: 0;
  }
}

/* UTILITY CLASSES */
.animate-fade-in-up {
  animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-fade-in-down {
  animation: fadeInDown 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-slide-in-left {
  animation: slideInLeft 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-slide-in-right {
  animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-scale-in {
  animation: scaleIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-zoom-in {
  animation: zoomIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-bounce {
  animation: bounce 1s ease-in-out infinite;
}

.animate-shake {
  animation: shake 0.5s ease-in-out;
}

.animate-pulse {
  animation: pulse 2s ease-in-out infinite;
}

.animate-wiggle {
  animation: wiggle 0.5s ease-in-out;
}

.animate-heartbeat {
  animation: heartbeat 1.5s ease-in-out infinite;
}

.animate-spin {
  animation: spin 1s linear infinite;
}

.animate-success-scale {
  animation: successScale 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* LOADING SPINNER */
.spinner {
  border: 3px solid rgba(255, 255, 255, 0.1);
  border-top-color: var(--emerald-500);
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 0.8s linear infinite;
}

/* DOTS LOADING */
.dots-loading {
  display: flex;
  gap: 8px;
}

.dots-loading span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--emerald-500);
  animation: dotsLoading 1.4s ease-in-out infinite;
}

.dots-loading span:nth-child(1) { animation-delay: 0s; }
.dots-loading span:nth-child(2) { animation-delay: 0.2s; }
.dots-loading span:nth-child(3) { animation-delay: 0.4s; }

/* SKELETON LOADER */
.skeleton {
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.05) 0%,
    rgba(255, 255, 255, 0.1) 50%,
    rgba(255, 255, 255, 0.05) 100%
  );
  background-size: 200% 100%;
  animation: skeletonPulse 1.5s ease-in-out infinite;
}

/* DELAY UTILITIES */
.delay-100 { animation-delay: 100ms; }
.delay-200 { animation-delay: 200ms; }
.delay-300 { animation-delay: 300ms; }
.delay-400 { animation-delay: 400ms; }
.delay-500 { animation-delay: 500ms; }

/* === LIQUID GLASS ANIMATIONS === */
@keyframes liquid-morph {
  0%, 100% {
    border-radius: 45% 55% 50% 50% / 50% 50% 45% 55%;
    transform: scale(1) rotate(0deg);
  }
  25% {
    border-radius: 50% 45% 55% 50% / 45% 55% 50% 50%;
    transform: scale(1.05) rotate(2deg);
  }
  50% {
    border-radius: 55% 50% 45% 55% / 50% 45% 55% 50%;
    transform: scale(1.1) rotate(-2deg);
  }
  75% {
    border-radius: 50% 55% 50% 45% / 55% 50% 50% 45%;
    transform: scale(1.05) rotate(1deg);
  }
}

@keyframes liquid-morph-reverse {
  0%, 100% {
    border-radius: 50% 45% 55% 50% / 55% 50% 50% 45%;
    transform: scale(1) rotate(0deg);
  }
  25% {
    border-radius: 55% 50% 45% 55% / 50% 55% 45% 50%;
    transform: scale(1.08) rotate(-2deg);
  }
  50% {
    border-radius: 45% 55% 50% 50% / 45% 50% 55% 50%;
    transform: scale(1.12) rotate(2deg);
  }
  75% {
    border-radius: 50% 50% 55% 45% / 50% 45% 50% 55%;
    transform: scale(1.08) rotate(-1deg);
  }
}

/* === LIQUID GLASS CARD EFFECT === */
.liquid-glass-card {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.15) 0%,
    rgba(255, 255, 255, 0.08) 100%
  ) !important;
  backdrop-filter: blur(16px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(16px) saturate(180%) !important;
  border: 1px solid rgba(255, 255, 255, 0.25) !important;
  box-shadow: 
    0 8px 32px 0 rgba(0, 0, 0, 0.37),
    inset 0 1px 0 0 rgba(255, 255, 255, 0.3),
    inset 0 -1px 0 0 rgba(0, 0, 0, 0.15),
    0 0 40px rgba(16, 185, 129, 0.1) !important;
}

.liquid-glass-card-elevated {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.2) 0%,
    rgba(255, 255, 255, 0.1) 100%
  ) !important;
  backdrop-filter: blur(20px) saturate(200%) !important;
  -webkit-backdrop-filter: blur(20px) saturate(200%) !important;
  border: 1px solid rgba(255, 255, 255, 0.3) !important;
  box-shadow: 
    0 12px 40px 0 rgba(0, 0, 0, 0.45),
    inset 0 2px 0 0 rgba(255, 255, 255, 0.4),
    inset 0 -2px 0 0 rgba(0, 0, 0, 0.2),
    0 0 60px rgba(16, 185, 129, 0.15) !important;
}

.liquid-glass-shimmer {
  position: relative;
  overflow: hidden;
}

.liquid-glass-shimmer::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent 0%,
    rgba(255, 255, 255, 0.1) 50%,
    transparent 100%
  );
  animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

/* Бегущая строка - Liquid Glass Ticker */
@keyframes marquee {
  0% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(-33.333%);
  }
}

.animate-marquee {
  animation: marquee 30s linear infinite;
}

/* Gradient Rotation for Liquid Glass Glowing Border */
@keyframes gradientRotate {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* Rotating Conic Gradient Border */
@property --angle {
  syntax: '<angle>';
  inherits: false;
  initial-value: 0deg;
}

@keyframes rotateBorder {
  0% {
    --angle: 0deg;
  }
  100% {
    --angle: 360deg;
  }
}

/* Glass Shine Animation */
@keyframes glassShine {
  0%, 100% {
    opacity: 0.3;
    transform: translateX(-100%);
  }
  50% {
    opacity: 0.6;
    transform: translateX(100%);
  }
}

/* Pulse Glow Animation */
@keyframes pulseGlow {
  0%, 100% {
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), 
                0 0 40px rgba(25, 118, 237, 0.2),
                0 0 60px rgba(138, 43, 226, 0.1);
  }
  50% {
    box-shadow: 0 0 30px rgba(0, 217, 255, 0.5), 
                0 0 60px rgba(25, 118, 237, 0.3),
                0 0 80px rgba(138, 43, 226, 0.2);
  }
}

/* Matrix Rain Animation */
@keyframes matrixRain {
  0% {
    transform: translateY(-100%);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(100%);
    opacity: 0;
  }
}

/* Shimmer Waves Animation */
@keyframes shimmerWave {
  0% {
    transform: translateX(-100%) translateY(-100%) rotate(45deg);
  }
  100% {
    transform: translateX(200%) translateY(200%) rotate(45deg);
  }
}

/* Premium Gradient Shift 2025 */
@keyframes gradientShift {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

/* Floating Animation */
@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* Neon Pulse */
@keyframes neonPulse {
  0%, 100% {
    text-shadow: 
      0 0 10px rgba(59, 130, 246, 0.5),
      0 0 20px rgba(16, 185, 129, 0.3),
      0 0 30px rgba(236, 72, 153, 0.2);
  }
  50% {
    text-shadow: 
      0 0 20px rgba(59, 130, 246, 0.8),
      0 0 40px rgba(16, 185, 129, 0.5),
      0 0 60px rgba(236, 72, 153, 0.4);
  }
}

/* Premium Border Glow Animation */
@keyframes borderGlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ========================================
   SCROLL PERFORMANCE OPTIMIZATIONS
   ======================================== */

/* Auto-optimize off-screen content rendering */
.demo-card,
.bento-item,
[data-scroll-optimize] {
  /* Browser skips rendering off-screen elements */
  content-visibility: auto;
  
  /* Hint approximate size to prevent layout shifts */
  contain-intrinsic-size: auto 400px;
}

/* Reduce GPU load during scroll by pausing animations */
@media (prefers-reduced-motion: no-preference) {
  /* Pause heavy animations when scrolling */
  @supports (animation-timeline: scroll()) {
    .scroll-pause-animations {
      animation-play-state: paused;
    }
  }
}

/* Optimize images for scroll performance */
img, video {
  /* Hint browser about decoding strategy */
  image-rendering: auto;
  
  /* Optimize rendering */
  rendering-intent: auto;
}

/* Improve scroll smoothness on touch devices */
@media (hover: none) and (pointer: coarse) {
  html {
    /* Enhanced touch scrolling */
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }
  
  /* Reduce work during scroll */
  * {
    -webkit-tap-highlight-color: transparent;
  }
}```

### package.json
```json
{
  "name": "rest-express",
  "version": "1.0.0",
  "type": "module",
  "license": "MIT",
  "scripts": {
    "dev": "NODE_ENV=development tsx server/index.ts",
    "build": "vite build",
    "build:analyze": "ANALYZE=true vite build",
    "check": "tsc",
    "db:push": "drizzle-kit push"
  },
  "dependencies": {
    "@fontsource/cormorant-garamond": "^5.2.11",
    "@fontsource/inter": "^5.2.8",
    "@fontsource/montserrat": "^5.2.8",
    "@fontsource/orbitron": "^5.2.8",
    "@fontsource/playfair-display": "^5.2.8",
    "@fontsource/press-start-2p": "^5.2.7",
    "@google-cloud/storage": "^7.17.2",
    "@hookform/resolvers": "^3.10.0",
    "@jridgewell/trace-mapping": "^0.3.25",
    "@neondatabase/serverless": "^0.10.4",
    "@radix-ui/react-accordion": "^1.2.4",
    "@radix-ui/react-alert-dialog": "^1.1.7",
    "@radix-ui/react-aspect-ratio": "^1.1.3",
    "@radix-ui/react-avatar": "^1.1.4",
    "@radix-ui/react-checkbox": "^1.1.5",
    "@radix-ui/react-collapsible": "^1.1.4",
    "@radix-ui/react-context-menu": "^2.2.7",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-dropdown-menu": "^2.1.7",
    "@radix-ui/react-hover-card": "^1.1.7",
    "@radix-ui/react-label": "^2.1.3",
    "@radix-ui/react-menubar": "^1.1.7",
    "@radix-ui/react-navigation-menu": "^1.2.6",
    "@radix-ui/react-popover": "^1.1.7",
    "@radix-ui/react-progress": "^1.1.3",
    "@radix-ui/react-radio-group": "^1.2.4",
    "@radix-ui/react-scroll-area": "^1.2.4",
    "@radix-ui/react-select": "^2.1.7",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slider": "^1.2.4",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.1.4",
    "@radix-ui/react-tabs": "^1.1.4",
    "@radix-ui/react-toast": "^1.2.15",
    "@radix-ui/react-toggle": "^1.1.3",
    "@radix-ui/react-toggle-group": "^1.1.3",
    "@radix-ui/react-tooltip": "^1.2.0",
    "@stripe/react-stripe-js": "^4.0.2",
    "@stripe/stripe-js": "^7.9.0",
    "@tanstack/react-query": "^5.90.6",
    "@tanstack/react-virtual": "^3.13.12",
    "@twa-dev/sdk": "^8.0.2",
    "@types/compression": "^1.8.1",
    "@uppy/aws-s3": "^4.3.2",
    "@uppy/core": "^4.5.3",
    "@uppy/dashboard": "^4.4.3",
    "@uppy/drag-drop": "^4.2.2",
    "@uppy/file-input": "^4.2.2",
    "@uppy/progress-bar": "^4.3.2",
    "@uppy/react": "^4.5.2",
    "@uppy/status-bar": "^4.2.3",
    "@vitejs/plugin-react-swc": "^4.2.1",
    "archiver": "^7.0.1",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "compression": "^1.8.1",
    "date-fns": "^3.6.0",
    "drizzle-kit": "^0.31.6",
    "drizzle-orm": "^0.44.7",
    "drizzle-zod": "^0.8.3",
    "embla-carousel-react": "^8.6.0",
    "express": "^4.21.2",
    "framer-motion": "^11.18.2",
    "google-auth-library": "^10.4.1",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.453.0",
    "nanoid": "^5.1.6",
    "next-themes": "^0.4.6",
    "phosphor-react": "^1.4.1",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-helmet-async": "^2.0.5",
    "react-hook-form": "^7.55.0",
    "react-icons": "^5.5.0",
    "react-resizable-panels": "^2.1.7",
    "recharts": "^2.15.2",
    "rollup-plugin-visualizer": "^6.0.5",
    "stripe": "^18.5.0",
    "swiper": "^12.0.3",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "terser": "^5.44.0",
    "tw-animate-css": "^1.2.5",
    "vaul": "^1.1.2",
    "vite-plugin-compression": "^0.5.1",
    "vite-plugin-compression2": "^2.3.0",
    "web-vitals": "^5.1.0",
    "wouter": "^3.7.1",
    "ws": "^8.18.0",
    "zod": "^3.25.76",
    "zod-validation-error": "^3.4.0",
    "zustand": "^5.0.8"
  },
  "devDependencies": {
    "@replit/vite-plugin-cartographer": "^0.3.1",
    "@replit/vite-plugin-dev-banner": "^0.1.1",
    "@replit/vite-plugin-runtime-error-modal": "^0.0.3",
    "@tailwindcss/typography": "^0.5.15",
    "@tailwindcss/vite": "^4.1.3",
    "@types/connect-pg-simple": "^7.0.3",
    "@types/express": "4.17.21",
    "@types/express-session": "^1.18.0",
    "@types/node": "20.16.11",
    "@types/react": "^18.3.11",
    "@types/react-dom": "^18.3.1",
    "@types/ws": "^8.5.13",
    "@vitejs/plugin-react": "^4.7.0",
    "autoprefixer": "^10.4.20",
    "esbuild": "^0.25.0",
    "postcss": "^8.4.47",
    "tailwindcss": "^3.4.18",
    "tsx": "^4.20.6",
    "typescript": "5.6.3",
    "vite": "^5.4.21"
  },
  "optionalDependencies": {
    "bufferutil": "^4.0.8"
  }
}
```

### Caddyfile
```
{
    auto_https off
}

:{$PORT} {
    root * /app/dist
    encode gzip
    
    @assets {
        path *.css *.js *.jpg *.jpeg *.png *.svg *.gif *.webp *.avif *.woff *.woff2 *.ico *.pdf *.mp4 *.webm
    }
    
    @html {
        path /
        path *.html
    }
    
    header @assets Cache-Control "public, max-age=31536000, immutable"
    
    header @html Cache-Control "no-cache, no-store, must-revalidate"
    header @html Pragma "no-cache"
    header @html Expires "0"
    
    try_files {path} /index.html
    
    file_server
}
```


## ДОПОЛНИТЕЛЬНЫЕ КОМПОНЕНТЫ (2025)

### 2025/AdvancedEffects.tsx
```tsx
import React, { useState, useEffect, useRef } from 'react';
import { motion } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';
import { useTelegram } from '@/hooks/useTelegram';

// === LIQUID BUTTON (SVG morphing effect) ===
interface LiquidButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
}

export const LiquidButton: React.FC<LiquidButtonProps> = ({
  children,
  className,
  ...props
}) => {
  const [isHovered, setIsHovered] = useState(false);
  const { hapticFeedback } = useTelegram();
  
  return (
    <button
      className={cn('relative px-8 py-4 overflow-visible', className)}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
      onClick={(e) => {
        hapticFeedback.medium();
        props.onClick?.(e);
      }}
      {...props}
    >
      <svg 
        className="absolute inset-0 w-full h-full" 
        viewBox="0 0 200 60" 
        preserveAspectRatio="none"
      >
        <motion.path
          d={isHovered 
            ? "M 0 30 Q 50 10 100 30 T 200 30 L 200 60 L 0 60 Z"
            : "M 0 30 Q 50 30 100 30 T 200 30 L 200 60 L 0 60 Z"
          }
          fill="url(#liquidGradient)"
          animate={{
            d: isHovered
              ? ["M 0 30 Q 50 30 100 30 T 200 30 L 200 60 L 0 60 Z", 
                 "M 0 30 Q 50 10 100 30 T 200 30 L 200 60 L 0 60 Z",
                 "M 0 30 Q 50 40 100 30 T 200 30 L 200 60 L 0 60 Z",
                 "M 0 30 Q 50 10 100 30 T 200 30 L 200 60 L 0 60 Z"]
              : ["M 0 30 Q 50 10 100 30 T 200 30 L 200 60 L 0 60 Z",
                 "M 0 30 Q 50 30 100 30 T 200 30 L 200 60 L 0 60 Z"]
          }}
          transition={{
            duration: isHovered ? 2 : 0.6,
            repeat: isHovered ? Infinity : 0,
            ease: 'easeInOut'
          }}
        />
        <defs>
          <linearGradient id="liquidGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stopColor="#10B981" />
            <stop offset="50%" stopColor="#06B6D4" />
            <stop offset="100%" stopColor="#8B5CF6" />
          </linearGradient>
        </defs>
      </svg>
      <span className="relative z-10 text-white font-semibold">{children}</span>
    </button>
  );
};

// === CURSOR FOLLOWER ===
interface CursorFollowerProps {
  size?: number;
  color?: string;
  blur?: number;
}

export const CursorFollower: React.FC<CursorFollowerProps> = ({
  size = 20,
  color = 'rgba(16, 185, 129, 0.3)',
  blur = 30
}) => {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [isVisible, setIsVisible] = useState(false);
  
  useEffect(() => {
    const handleMouseMove = (e: MouseEvent) => {
      setPosition({ x: e.clientX, y: e.clientY });
      setIsVisible(true);
    };
    
    const handleMouseLeave = () => {
      setIsVisible(false);
    };
    
    window.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseleave', handleMouseLeave);
    
    return () => {
      window.removeEventListener('mousemove', handleMouseMove);
      document.removeEventListener('mouseleave', handleMouseLeave);
    };
  }, []);
  
  if (!isVisible) return null;
  
  return (
    <motion.div
      className="fixed pointer-events-none z-50 rounded-full"
      style={{
        width: size,
        height: size,
        backgroundColor: color,
        filter: `blur(${blur}px)`,
        left: position.x - size / 2,
        top: position.y - size / 2
      }}
      animate={{
        x: position.x - size / 2,
        y: position.y - size / 2
      }}
      transition={{
        type: 'spring',
        stiffness: 500,
        damping: 28
      }}
    />
  );
};

// === ANIMATED CHART (simple bar chart with animation) ===
interface AnimatedChartProps {
  data: { label: string; value: number; color?: string }[];
  maxValue?: number;
  className?: string;
}

export const AnimatedChart: React.FC<AnimatedChartProps> = ({
  data,
  maxValue,
  className
}) => {
  const max = maxValue || Math.max(...data.map(d => d.value));
  
  return (
    <div className={cn('space-y-3', className)}>
      {data.map((item, index) => (
        <div key={index} className="space-y-1">
          <div className="flex justify-between text-sm text-white/80">
            <span>{item.label}</span>
            <span className="font-semibold">{item.value}</span>
          </div>
          <div className="h-2 bg-white/5 rounded-full overflow-hidden">
            <motion.div
              className="h-full rounded-full"
              style={{
                background: item.color || 'linear-gradient(90deg, #10B981, #06B6D4)'
              }}
              initial={{ width: 0 }}
              whileInView={{ width: `${(item.value / max) * 100}%` }}
              viewport={{ once: true }}
              transition={{ duration: 1, delay: index * 0.1, ease: 'easeOut' }}
            />
          </div>
        </div>
      ))}
    </div>
  );
};

// === CIRCULAR PROGRESS ===
interface CircularProgressProps {
  value: number;
  max?: number;
  size?: number;
  strokeWidth?: number;
  className?: string;
  showValue?: boolean;
}

export const CircularProgress: React.FC<CircularProgressProps> = ({
  value,
  max = 100,
  size = 120,
  strokeWidth = 8,
  className,
  showValue = true
}) => {
  const radius = (size - strokeWidth) / 2;
  const circumference = radius * 2 * Math.PI;
  const progress = (value / max) * 100;
  const offset = circumference - (progress / 100) * circumference;
  
  return (
    <div className={cn('relative inline-flex items-center justify-center', className)}>
      <svg width={size} height={size} className="transform -rotate-90">
        {/* Background circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke="rgba(255, 255, 255, 0.1)"
          strokeWidth={strokeWidth}
          fill="none"
        />
        
        {/* Progress circle */}
        <motion.circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke="url(#circularGradient)"
          strokeWidth={strokeWidth}
          fill="none"
          strokeLinecap="round"
          initial={{ strokeDashoffset: circumference }}
          animate={{ strokeDashoffset: offset }}
          transition={{ duration: 1, ease: 'easeOut' }}
          style={{
            strokeDasharray: circumference
          }}
        />
        
        <defs>
          <linearGradient id="circularGradient">
            <stop offset="0%" stopColor="#10B981" />
            <stop offset="100%" stopColor="#06B6D4" />
          </linearGradient>
        </defs>
      </svg>
      
      {showValue && (
        <div className="absolute inset-0 flex items-center justify-center">
          <span className="text-2xl font-bold text-white">
            {Math.round(progress)}%
          </span>
        </div>
      )}
    </div>
  );
};
```

### 2025/AIChatbot.tsx
```tsx
import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';
import { useTelegram } from '@/hooks/useTelegram';
import { MessageCircle, Send, X, Loader2 } from 'lucide-react';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: Date;
}

interface AIChatbotProps {
  onSendMessage?: (message: string) => Promise<string>;
  placeholder?: string;
  className?: string;
}

export const AIChatbot: React.FC<AIChatbotProps> = ({
  onSendMessage,
  placeholder = 'Ask me anything...',
  className
}) => {
  const [isOpen, setIsOpen] = useState(false);
  const [messages, setMessages] = useState<Message[]>([
    {
      id: '1',
      role: 'assistant',
      content: 'Hello! How can I help you today?',
      timestamp: new Date()
    }
  ]);
  const [input, setInput] = useState('');
  const [isTyping, setIsTyping] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);
  const { hapticFeedback } = useTelegram();
  
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };
  
  useEffect(() => {
    scrollToBottom();
  }, [messages]);
  
  const handleSend = async () => {
    if (!input.trim()) return;
    
    hapticFeedback.light();
    
    const userMessage: Message = {
      id: Date.now().toString(),
      role: 'user',
      content: input,
      timestamp: new Date()
    };
    
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setIsTyping(true);
    
    try {
      const response = onSendMessage 
        ? await onSendMessage(input)
        : `I received your message: "${input}". This is a demo response.`;
      
      const assistantMessage: Message = {
        id: (Date.now() + 1).toString(),
        role: 'assistant',
        content: response,
        timestamp: new Date()
      };
      
      setTimeout(() => {
        setMessages(prev => [...prev, assistantMessage]);
        setIsTyping(false);
        hapticFeedback.light();
      }, 1000);
    } catch (error) {
      setIsTyping(false);
      console.error('AI Chatbot error:', error);
    }
  };
  
  return (
    <>
      {/* Floating chat button */}
      <AnimatePresence>
        {!isOpen && (
          <motion.button
            className={cn(
              'fixed bottom-20 right-4 z-50',
              'w-14 h-14 rounded-full',
              'bg-gradient-to-br from-emerald-500 to-cyan-500',
              'text-white shadow-lg',
              'flex items-center justify-center',
              className
            )}
            onClick={() => {
              setIsOpen(true);
              hapticFeedback.medium();
            }}
            initial={{ scale: 0, opacity: 0 }}
            animate={{ scale: 1, opacity: 1 }}
            exit={{ scale: 0, opacity: 0 }}
            whileHover={{ scale: 1.1 }}
            whileTap={{ scale: 0.9 }}
          >
            <MessageCircle className="w-6 h-6" />
          </motion.button>
        )}
      </AnimatePresence>
      
      {/* Chat window */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            className="fixed inset-x-4 bottom-20 z-50 max-w-md mx-auto"
            initial={{ y: 100, opacity: 0, scale: 0.9 }}
            animate={{ y: 0, opacity: 1, scale: 1 }}
            exit={{ y: 100, opacity: 0, scale: 0.9 }}
            transition={{ type: 'spring', stiffness: 300, damping: 30 }}
          >
            <div className="glass-card-strong rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[500px]">
              {/* Header */}
              <div className="flex items-center justify-between p-4 border-b border-white/10">
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-full bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                    <MessageCircle className="w-5 h-5 text-white" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-white">AI Assistant</h3>
                    <p className="text-xs text-white/60">Always here to help</p>
                  </div>
                </div>
                <button
                  onClick={() => {
                    setIsOpen(false);
                    hapticFeedback.light();
                  }}
                  className="p-2 hover:bg-white/10 rounded-lg transition-colors"
                >
                  <X className="w-5 h-5 text-white/60" />
                </button>
              </div>
              
              {/* Messages */}
              <div className="flex-1 overflow-y-auto p-4 space-y-4">
                {messages.map((message) => (
                  <motion.div
                    key={message.id}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className={cn(
                      'flex',
                      message.role === 'user' ? 'justify-end' : 'justify-start'
                    )}
                  >
                    <div
                      className={cn(
                        'max-w-[80%] rounded-2xl px-4 py-2',
                        message.role === 'user'
                          ? 'bg-gradient-to-r from-emerald-500 to-cyan-500 text-white'
                          : 'glass-card-medium text-white'
                      )}
                    >
                      <p className="text-sm">{message.content}</p>
                      <p className="text-xs opacity-60 mt-1">
                        {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                      </p>
                    </div>
                  </motion.div>
                ))}
                
                {isTyping && (
                  <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    className="flex justify-start"
                  >
                    <div className="glass-card-medium rounded-2xl px-4 py-3 flex gap-1">
                      <motion.div
                        className="w-2 h-2 bg-emerald-500 rounded-full"
                        animate={{ scale: [1, 1.5, 1] }}
                        transition={{ duration: 1, repeat: Infinity, delay: 0 }}
                      />
                      <motion.div
                        className="w-2 h-2 bg-emerald-500 rounded-full"
                        animate={{ scale: [1, 1.5, 1] }}
                        transition={{ duration: 1, repeat: Infinity, delay: 0.2 }}
                      />
                      <motion.div
                        className="w-2 h-2 bg-emerald-500 rounded-full"
                        animate={{ scale: [1, 1.5, 1] }}
                        transition={{ duration: 1, repeat: Infinity, delay: 0.4 }}
                      />
                    </div>
                  </motion.div>
                )}
                
                <div ref={messagesEndRef} />
              </div>
              
              {/* Input */}
              <div className="p-4 border-t border-white/10">
                <div className="flex gap-2">
                  <input
                    type="text"
                    value={input}
                    onChange={(e) => setInput(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && handleSend()}
                    placeholder={placeholder}
                    className="flex-1 px-4 py-3 rounded-xl bg-white/5 border border-white/10 text-white placeholder:text-white/40 focus:outline-none focus:border-emerald-500 transition-colors"
                  />
                  <button
                    onClick={handleSend}
                    disabled={!input.trim() || isTyping}
                    className="px-4 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-cyan-500 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg transition-shadow"
                  >
                    <Send className="w-5 h-5" />
                  </button>
                </div>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </>
  );
};
```

### 2025/AnimatedElements.tsx
```tsx
import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';
import { useTelegram } from '@/hooks/useTelegram';

// === ANIMATED ICON ===
interface AnimatedIconProps {
  icon: React.ReactNode;
  size?: number;
  withGlow?: boolean;
  withRing?: boolean;
  className?: string;
}

export const AnimatedIcon: React.FC<AnimatedIconProps> = ({
  icon,
  size = 40,
  withGlow = true,
  withRing = true,
  className
}) => {
  return (
    <div className={cn('relative inline-flex', className)} style={{ width: size, height: size }}>
      {/* Animated ring */}
      {withRing && (
        <motion.div
          className="absolute inset-0 rounded-full border-2 border-emerald-500/50"
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{
            scale: [0.8, 1.2, 0.8],
            opacity: [0, 1, 0]
          }}
          transition={{
            duration: 2,
            repeat: Infinity,
            ease: 'easeInOut'
          }}
        />
      )}
      
      {/* Icon with glow */}
      <motion.div
        className={cn(
          'relative z-10 flex items-center justify-center',
          'w-full h-full rounded-full',
          withGlow && 'shadow-[0_0_20px_rgba(16,185,129,0.5)]'
        )}
        style={{
          background: 'linear-gradient(135deg, #10B981, #06B6D4)',
        }}
        whileHover={{ scale: 1.1, rotate: 5 }}
        whileTap={{ scale: 0.95 }}
      >
        <div className="text-white">{icon}</div>
      </motion.div>
    </div>
  );
};

// === LIKE BUTTON WITH PARTICLES ===
interface LikeButtonProps {
  initialLiked?: boolean;
  onLike?: (liked: boolean) => void;
  size?: number;
}

interface Particle {
  id: number;
  x: number;
  y: number;
}

export const LikeButton: React.FC<LikeButtonProps> = ({
  initialLiked = false,
  onLike,
  size = 40
}) => {
  const [isLiked, setIsLiked] = useState(initialLiked);
  const [particles, setParticles] = useState<Particle[]>([]);
  const { hapticFeedback } = useTelegram();
  
  const handleClick = () => {
    const newLiked = !isLiked;
    setIsLiked(newLiked);
    onLike?.(newLiked);
    
    if (newLiked) {
      hapticFeedback.heavy();
      
      // Create particles
      const newParticles = Array.from({ length: 8 }, (_, i) => ({
        id: Date.now() + i,
        x: Math.cos((i / 8) * Math.PI * 2) * 30,
        y: Math.sin((i / 8) * Math.PI * 2) * 30
      }));
      
      setParticles(newParticles);
      
      // Remove particles after animation
      setTimeout(() => setParticles([]), 800);
    } else {
      hapticFeedback.light();
    }
  };
  
  return (
    <div className="relative inline-flex" style={{ width: size, height: size }}>
      {/* Particles */}
      <AnimatePresence>
        {particles.map((particle) => (
          <motion.div
            key={particle.id}
            className="absolute w-2 h-2 rounded-full bg-pink-500"
            initial={{ x: 0, y: 0, scale: 1, opacity: 1 }}
            animate={{
              x: particle.x,
              y: particle.y,
              scale: 0,
              opacity: 0
            }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.8, ease: 'easeOut' }}
            style={{
              left: '50%',
              top: '50%',
              marginLeft: -4,
              marginTop: -4
            }}
          />
        ))}
      </AnimatePresence>
      
      {/* Heart button */}
      <motion.button
        className={cn(
          'w-full h-full rounded-full flex items-center justify-center',
          'transition-colors duration-300',
          isLiked ? 'bg-gradient-to-br from-pink-500 to-red-500' : 'bg-white/10'
        )}
        whileHover={{ scale: 1.1 }}
        whileTap={{ scale: 0.9 }}
        onClick={handleClick}
      >
        <motion.svg
          width={size * 0.6}
          height={size * 0.6}
          viewBox="0 0 24 24"
          fill={isLiked ? 'white' : 'none'}
          stroke={isLiked ? 'white' : 'currentColor'}
          strokeWidth="2"
          initial={false}
          animate={{
            scale: isLiked ? [1, 1.2, 1] : 1
          }}
          transition={{ duration: 0.3 }}
        >
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
        </motion.svg>
      </motion.button>
    </div>
  );
};

// === SPLIT TEXT REVEAL ===
interface SplitTextRevealProps {
  children: string;
  delay?: number;
  className?: string;
}

export const SplitTextReveal: React.FC<SplitTextRevealProps> = ({
  children,
  delay = 0,
  className
}) => {
  const words = children.split(' ');
  
  return (
    <motion.span className={cn('inline-block', className)}>
      {words.map((word, i) => (
        <motion.span
          key={i}
          className="inline-block mr-2"
          initial={{ y: 50, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{
            duration: 0.5,
            delay: delay + i * 0.05,
            ease: [0.33, 1, 0.68, 1]
          }}
        >
          {word}
        </motion.span>
      ))}
    </motion.span>
  );
};

// === TYPEWRITER TEXT ===
interface TypewriterTextProps {
  text: string;
  speed?: number;
  className?: string;
  onComplete?: () => void;
}

export const TypewriterText: React.FC<TypewriterTextProps> = ({
  text,
  speed = 50,
  className,
  onComplete
}) => {
  const [displayText, setDisplayText] = useState('');
  const [currentIndex, setCurrentIndex] = useState(0);
  
  useEffect(() => {
    if (currentIndex < text.length) {
      const timeout = setTimeout(() => {
        setDisplayText((prev) => prev + text[currentIndex]);
        setCurrentIndex((prev) => prev + 1);
      }, speed);
      
      return () => clearTimeout(timeout);
    } else if (onComplete) {
      onComplete();
    }
  }, [currentIndex, text, speed, onComplete]);
  
  return (
    <span className={className}>
      {displayText}
      <motion.span
        animate={{ opacity: [1, 0] }}
        transition={{ duration: 0.5, repeat: Infinity }}
        className="inline-block w-0.5 h-5 bg-current ml-1"
      />
    </span>
  );
};

// === GLITCH TEXT ===
interface GlitchTextProps {
  children: string;
  className?: string;
}

export const GlitchText: React.FC<GlitchTextProps> = ({
  children,
  className
}) => {
  return (
    <div className={cn('relative inline-block', className)}>
      <span className="relative z-10">{children}</span>
      <span 
        className="absolute top-0 left-0 text-cyan-500 opacity-70 pointer-events-none animate-glitch-1"
        aria-hidden="true"
        style={{
          clipPath: 'polygon(0 0, 100% 0, 100% 45%, 0 45%)',
          animation: 'glitch-1 0.3s infinite'
        }}
      >
        {children}
      </span>
      <span 
        className="absolute top-0 left-0 text-pink-500 opacity-70 pointer-events-none animate-glitch-2"
        aria-hidden="true"
        style={{
          clipPath: 'polygon(0 55%, 100% 55%, 100% 100%, 0 100%)',
          animation: 'glitch-2 0.3s infinite'
        }}
      >
        {children}
      </span>
    </div>
  );
};
```

### 2025/OptimizedImage.tsx
```tsx
import React, { useState, useEffect } from 'react';
import { motion } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';

interface OptimizedImageProps {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  className?: string;
  priority?: boolean;
  fallback?: string;
  skeleton?: boolean;
  onLoad?: () => void;
  onError?: () => void;
}

export const OptimizedImage: React.FC<OptimizedImageProps> = ({
  src,
  alt,
  width,
  height,
  className,
  priority = false,
  fallback = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 400 300\'%3E%3Crect fill=\'%23111\' width=\'400\' height=\'300\'/%3E%3Ctext fill=\'%23666\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dominant-baseline=\'middle\' font-family=\'sans-serif\' font-size=\'18\'%3EImage%3C/text%3E%3C/svg%3E',
  skeleton = true,
  onLoad,
  onError
}) => {
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(false);
  const [imageSrc, setImageSrc] = useState(priority ? src : fallback);
  
  useEffect(() => {
    if (!priority) {
      const img = new Image();
      img.src = src;
      img.onload = () => {
        setImageSrc(src);
        setIsLoading(false);
        onLoad?.();
      };
      img.onerror = () => {
        setError(true);
        setIsLoading(false);
        onError?.();
      };
    } else {
      setIsLoading(false);
    }
  }, [src, priority, onLoad, onError]);
  
  return (
    <div className={cn('relative overflow-hidden', className)} style={{ width, height }}>
      {isLoading && skeleton && (
        <motion.div
          className="absolute inset-0 bg-gradient-to-r from-white/5 via-white/10 to-white/5"
          animate={{
            x: ['-100%', '100%']
          }}
          transition={{
            duration: 1.5,
            repeat: Infinity,
            ease: 'linear'
          }}
        />
      )}
      
      <motion.img
        src={error ? fallback : imageSrc}
        alt={alt}
        className={cn('w-full h-full object-cover', className)}
        initial={{ opacity: 0, scale: 1.1 }}
        animate={{ opacity: isLoading ? 0 : 1, scale: 1 }}
        transition={{ duration: 0.4 }}
        loading={priority ? 'eager' : 'lazy'}
        onLoad={() => {
          setIsLoading(false);
          onLoad?.();
        }}
        onError={() => {
          setError(true);
          onError?.();
        }}
      />
    </div>
  );
};

// === PROGRESSIVE IMAGE (with blur-up effect) ===
interface ProgressiveImageProps {
  src: string;
  placeholder: string;
  alt: string;
  className?: string;
}

export const ProgressiveImage: React.FC<ProgressiveImageProps> = ({
  src,
  placeholder,
  alt,
  className
}) => {
  const [isLoaded, setIsLoaded] = useState(false);
  
  return (
    <div className={cn('relative overflow-hidden', className)}>
      <motion.img
        src={placeholder}
        alt={alt}
        className="absolute inset-0 w-full h-full object-cover blur-lg"
        style={{ filter: isLoaded ? 'blur(0px)' : 'blur(20px)' }}
      />
      
      <motion.img
        src={src}
        alt={alt}
        className="relative w-full h-full object-cover"
        initial={{ opacity: 0 }}
        animate={{ opacity: isLoaded ? 1 : 0 }}
        transition={{ duration: 0.6 }}
        onLoad={() => setIsLoaded(true)}
      />
    </div>
  );
};
```

### 2025/PremiumButtons.tsx
```tsx
import React, { useRef, useState, useEffect } from 'react';
import { motion } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';
import { useTelegram } from '@/hooks/useTelegram';

// === GRADIENT BUTTON ===
interface GradientButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'aurora' | 'emerald-cyan' | 'emerald-purple';
  size?: 'sm' | 'md' | 'lg';
  children: React.ReactNode;
}

export const GradientButton: React.FC<GradientButtonProps> = ({
  variant = 'primary',
  size = 'md',
  children,
  className,
  ...props
}) => {
  const { hapticFeedback } = useTelegram();
  
  const gradients = {
    primary: 'bg-gradient-to-r from-emerald-500 to-teal-500',
    aurora: 'bg-gradient-to-r from-emerald-500 via-cyan-500 to-purple-500',
    'emerald-cyan': 'bg-gradient-to-r from-emerald-500 to-cyan-500',
    'emerald-purple': 'bg-gradient-to-r from-emerald-500 via-cyan-500 to-purple-500'
  };
  
  const sizes = {
    sm: 'px-4 py-2 text-sm',
    md: 'px-6 py-3 text-base',
    lg: 'px-8 py-4 text-lg'
  };
  
  return (
    <motion.button
      className={cn(
        'relative rounded-full font-semibold text-white',
        'shadow-lg hover:shadow-xl',
        'transition-all duration-300',
        'ripple-effect',
        gradients[variant],
        sizes[size],
        className
      )}
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      onClick={(e) => {
        hapticFeedback.medium();
        props.onClick?.(e);
      }}
      {...props}
    >
      <span className="relative z-10">{children}</span>
    </motion.button>
  );
};

// === GLASS BUTTON ===
interface GlassButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'subtle' | 'medium' | 'strong';
  children: React.ReactNode;
  icon?: React.ReactNode;
}

export const GlassButton: React.FC<GlassButtonProps> = ({
  variant = 'medium',
  children,
  icon,
  className,
  ...props
}) => {
  const { hapticFeedback } = useTelegram();
  
  const variants = {
    subtle: 'glass-card',
    medium: 'glass-card-medium',
    strong: 'glass-card-strong'
  };
  
  return (
    <motion.button
      className={cn(
        'relative px-6 py-3 rounded-full',
        'font-medium text-white',
        'transition-all duration-300',
        'hover:bg-white/20',
        variants[variant],
        className
      )}
      whileHover={{ scale: 1.05, y: -2 }}
      whileTap={{ scale: 0.95 }}
      onClick={(e) => {
        hapticFeedback.light();
        props.onClick?.(e);
      }}
      {...props}
    >
      <div className="flex items-center justify-center gap-2">
        {icon && <span>{icon}</span>}
        <span>{children}</span>
      </div>
    </motion.button>
  );
};

// === MORPHING BUTTON ===
interface MorphingButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  isLoading?: boolean;
  loadingText?: string;
  children: React.ReactNode;
}

export const MorphingButton: React.FC<MorphingButtonProps> = ({
  isLoading = false,
  loadingText = 'Loading...',
  children,
  className,
  ...props
}) => {
  const { hapticFeedback } = useTelegram();
  
  return (
    <motion.button
      className={cn(
        'relative px-6 py-3 rounded-full',
        'bg-gradient-to-r from-emerald-500 to-teal-500',
        'font-semibold text-white',
        'shadow-lg overflow-hidden',
        'disabled:opacity-50 disabled:cursor-not-allowed',
        className
      )}
      animate={{
        width: isLoading ? 48 : 'auto'
      }}
      onClick={(e) => {
        if (!isLoading) {
          hapticFeedback.medium();
          props.onClick?.(e);
        }
      }}
      disabled={isLoading || props.disabled}
      {...props}
    >
      <motion.div
        initial={false}
        animate={{
          opacity: isLoading ? 0 : 1
        }}
      >
        {children}
      </motion.div>
      
      {isLoading && (
        <motion.div
          className="absolute inset-0 flex items-center justify-center"
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
        >
          <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
        </motion.div>
      )}
    </motion.button>
  );
};

// === MAGNETIC BUTTON ===
interface MagneticButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  strength?: number;
  children: React.ReactNode;
}

export const MagneticButton: React.FC<MagneticButtonProps> = ({
  strength = 20,
  children,
  className,
  ...props
}) => {
  const ref = useRef<HTMLButtonElement>(null);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const { hapticFeedback } = useTelegram();
  
  const handleMouseMove = (e: React.MouseEvent<HTMLButtonElement>) => {
    if (!ref.current) return;
    
    const rect = ref.current.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    const deltaX = (e.clientX - centerX) / rect.width;
    const deltaY = (e.clientY - centerY) / rect.height;
    
    setPosition({
      x: deltaX * strength,
      y: deltaY * strength
    });
  };
  
  const handleMouseLeave = () => {
    setPosition({ x: 0, y: 0 });
  };
  
  return (
    <motion.button
      ref={ref}
      className={cn(
        'relative px-6 py-3 rounded-full',
        'bg-gradient-to-r from-purple-500 to-pink-500',
        'font-semibold text-white',
        'shadow-lg hover:shadow-xl',
        'transition-shadow duration-300',
        'magnetic-button',
        className
      )}
      onMouseMove={handleMouseMove}
      onMouseLeave={handleMouseLeave}
      animate={{
        x: position.x,
        y: position.y
      }}
      transition={{
        type: 'spring',
        stiffness: 400,
        damping: 20
      }}
      onClick={(e) => {
        hapticFeedback.heavy();
        props.onClick?.(e);
      }}
      {...props}
    >
      {children}
    </motion.button>
  );
};

// === FLOATING ACTION BUTTON (FAB) ===
interface FABProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  icon: React.ReactNode;
  position?: 'bottom-right' | 'bottom-left' | 'top-right' | 'top-left';
}

export const FAB: React.FC<FABProps> = ({
  icon,
  position = 'bottom-right',
  className,
  ...props
}) => {
  const { hapticFeedback } = useTelegram();
  
  const positions = {
    'bottom-right': 'bottom-20 right-4',
    'bottom-left': 'bottom-20 left-4',
    'top-right': 'top-4 right-4',
    'top-left': 'top-4 left-4'
  };
  
  return (
    <motion.button
      className={cn(
        'fixed z-50',
        'w-14 h-14 rounded-full',
        'bg-gradient-to-br from-emerald-500 to-teal-500',
        'text-white shadow-lg',
        'flex items-center justify-center',
        positions[position],
        className
      )}
      whileHover={{ scale: 1.1 }}
      whileTap={{ scale: 0.9 }}
      initial={{ scale: 0, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      transition={{
        type: 'spring',
        stiffness: 400,
        damping: 17
      }}
      onClick={(e) => {
        hapticFeedback.heavy();
        props.onClick?.(e);
      }}
      {...props}
    >
      {icon}
    </motion.button>
  );
};

// === PULSE BUTTON ===
interface PulseButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
  pulseColor?: string;
}

export const PulseButton: React.FC<PulseButtonProps> = ({
  children,
  pulseColor = 'rgba(16, 185, 129, 0.5)',
  className,
  ...props
}) => {
  const { hapticFeedback } = useTelegram();
  
  return (
    <motion.button
      className={cn(
        'relative px-6 py-3 rounded-full',
        'bg-emerald-500 hover:bg-emerald-600',
        'font-semibold text-white',
        'transition-colors duration-300',
        className
      )}
      onClick={(e) => {
        hapticFeedback.medium();
        props.onClick?.(e);
      }}
      {...props}
    >
      {/* Pulse rings */}
      <span className="absolute inset-0 rounded-full animate-ping opacity-75" 
            style={{ backgroundColor: pulseColor }} />
      <span className="absolute inset-0 rounded-full animate-pulse" 
            style={{ backgroundColor: pulseColor }} />
      
      {/* Button content */}
      <span className="relative z-10">{children}</span>
    </motion.button>
  );
};
```

### 2025/PremiumCards.tsx
```tsx
import React, { useRef, useState } from 'react';
import { motion, useMotionValue, useSpring, useTransform } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';

// === GLASS CARD ===
interface GlassCardProps {
  children: React.ReactNode;
  variant?: 'subtle' | 'medium' | 'strong' | 'gradient' | 'frosted';
  className?: string;
  hover?: boolean;
}

export const GlassCard: React.FC<GlassCardProps> = ({
  children,
  variant = 'medium',
  className,
  hover = true
}) => {
  const variants = {
    subtle: 'glass-card',
    medium: 'glass-card-medium',
    strong: 'glass-card-strong',
    gradient: 'glass-card-gradient',
    frosted: 'glass-card-frosted'
  };
  
  return (
    <motion.div
      className={cn(
        'rounded-xl p-6',
        variants[variant],
        hover && 'hover-lift',
        className
      )}
      whileHover={hover ? { y: -4 } : undefined}
      transition={{ duration: 0.3, ease: 'easeOut' }}
    >
      {children}
    </motion.div>
  );
};

// === TILT CARD (3D effect on hover) ===
interface TiltCardProps {
  children: React.ReactNode;
  className?: string;
  maxTilt?: number;
}

export const TiltCard: React.FC<TiltCardProps> = ({
  children,
  className,
  maxTilt = 15
}) => {
  const ref = useRef<HTMLDivElement>(null);
  const x = useMotionValue(0);
  const y = useMotionValue(0);
  
  const rotateX = useSpring(useTransform(y, [-0.5, 0.5], [maxTilt, -maxTilt]));
  const rotateY = useSpring(useTransform(x, [-0.5, 0.5], [-maxTilt, maxTilt]));
  
  const handleMouseMove = (event: React.MouseEvent<HTMLDivElement>) => {
    if (!ref.current) return;
    
    const rect = ref.current.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    x.set((event.clientX - centerX) / rect.width);
    y.set((event.clientY - centerY) / rect.height);
  };
  
  const handleMouseLeave = () => {
    x.set(0);
    y.set(0);
  };
  
  return (
    <motion.div
      ref={ref}
      className={cn('glass-card-medium rounded-xl p-6', className)}
      style={{
        rotateX,
        rotateY,
        transformStyle: 'preserve-3d'
      }}
      onMouseMove={handleMouseMove}
      onMouseLeave={handleMouseLeave}
      whileHover={{ scale: 1.02 }}
    >
      <div style={{ transform: 'translateZ(50px)' }}>
        {children}
      </div>
    </motion.div>
  );
};

// === MORPHING CARD (shape changes on hover) ===
interface MorphingCardProps {
  children: React.ReactNode;
  className?: string;
}

export const MorphingCard: React.FC<MorphingCardProps> = ({
  children,
  className
}) => {
  const [isHovered, setIsHovered] = useState(false);
  
  return (
    <motion.div
      className={cn('glass-card-medium p-6 relative overflow-hidden', className)}
      onHoverStart={() => setIsHovered(true)}
      onHoverEnd={() => setIsHovered(false)}
      animate={{
        borderRadius: isHovered ? '24px' : '16px'
      }}
      transition={{ duration: 0.4, ease: 'easeInOut' }}
    >
      <motion.div
        className="absolute inset-0 bg-gradient-to-br from-emerald-500/20 to-cyan-500/20"
        initial={{ opacity: 0 }}
        animate={{ opacity: isHovered ? 1 : 0 }}
        transition={{ duration: 0.3 }}
      />
      <div className="relative z-10">{children}</div>
    </motion.div>
  );
};

// === PARALLAX CARD (depth layers) ===
interface ParallaxCardProps {
  children: React.ReactNode;
  backgroundLayer?: React.ReactNode;
  className?: string;
}

export const ParallaxCard: React.FC<ParallaxCardProps> = ({
  children,
  backgroundLayer,
  className
}) => {
  const ref = useRef<HTMLDivElement>(null);
  const x = useMotionValue(0);
  const y = useMotionValue(0);
  
  const backgroundX = useSpring(useTransform(x, [-0.5, 0.5], [-20, 20]));
  const backgroundY = useSpring(useTransform(y, [-0.5, 0.5], [-20, 20]));
  const contentX = useSpring(useTransform(x, [-0.5, 0.5], [-5, 5]));
  const contentY = useSpring(useTransform(y, [-0.5, 0.5], [-5, 5]));
  
  const handleMouseMove = (event: React.MouseEvent<HTMLDivElement>) => {
    if (!ref.current) return;
    
    const rect = ref.current.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    
    x.set((event.clientX - centerX) / rect.width);
    y.set((event.clientY - centerY) / rect.height);
  };
  
  const handleMouseLeave = () => {
    x.set(0);
    y.set(0);
  };
  
  return (
    <div
      ref={ref}
      className={cn('relative rounded-xl overflow-hidden', className)}
      onMouseMove={handleMouseMove}
      onMouseLeave={handleMouseLeave}
    >
      {backgroundLayer && (
        <motion.div
          className="absolute inset-0"
          style={{ x: backgroundX, y: backgroundY }}
        >
          {backgroundLayer}
        </motion.div>
      )}
      <motion.div
        className="relative z-10 glass-card-medium p-6"
        style={{ x: contentX, y: contentY }}
      >
        {children}
      </motion.div>
    </div>
  );
};

// === FLIP CARD (flip animation) ===
interface FlipCardProps {
  front: React.ReactNode;
  back: React.ReactNode;
  className?: string;
}

export const FlipCard: React.FC<FlipCardProps> = ({
  front,
  back,
  className
}) => {
  const [isFlipped, setIsFlipped] = useState(false);
  
  return (
    <div className={cn('relative h-full cursor-pointer', className)} onClick={() => setIsFlipped(!isFlipped)}>
      <motion.div
        className="w-full h-full"
        initial={false}
        animate={{ rotateY: isFlipped ? 180 : 0 }}
        transition={{ duration: 0.6, type: 'spring' }}
        style={{ transformStyle: 'preserve-3d' }}
      >
        <div
          className="absolute w-full h-full glass-card-medium rounded-xl p-6"
          style={{ backfaceVisibility: 'hidden' }}
        >
          {front}
        </div>
        
        <div
          className="absolute w-full h-full glass-card-strong rounded-xl p-6"
          style={{
            backfaceVisibility: 'hidden',
            transform: 'rotateY(180deg)'
          }}
        >
          {back}
        </div>
      </motion.div>
    </div>
  );
};

// === EXPANDABLE PANEL ===
interface ExpandablePanelProps {
  title: React.ReactNode;
  children: React.ReactNode;
  defaultExpanded?: boolean;
  className?: string;
}

export const ExpandablePanel: React.FC<ExpandablePanelProps> = ({
  title,
  children,
  defaultExpanded = false,
  className
}) => {
  const [isExpanded, setIsExpanded] = useState(defaultExpanded);
  
  return (
    <div className={cn('glass-card-medium rounded-xl overflow-hidden', className)}>
      <button
        className="w-full p-6 flex items-center justify-between text-left hover:bg-white/5 transition-colors"
        onClick={() => setIsExpanded(!isExpanded)}
      >
        <div>{title}</div>
        <motion.div
          animate={{ rotate: isExpanded ? 180 : 0 }}
          transition={{ duration: 0.3 }}
        >
          ▼
        </motion.div>
      </button>
      
      <motion.div
        initial={false}
        animate={{
          height: isExpanded ? 'auto' : 0,
          opacity: isExpanded ? 1 : 0
        }}
        transition={{ duration: 0.3, ease: 'easeInOut' }}
        style={{ overflow: 'hidden' }}
      >
        <div className="px-6 pb-6">
          {children}
        </div>
      </motion.div>
    </div>
  );
};

// === BLOB CARD (organic shape with animated blob) ===
interface BlobCardProps {
  children: React.ReactNode;
  className?: string;
  blobColor?: string;
}

export const BlobCard: React.FC<BlobCardProps> = ({
  children,
  className,
  blobColor = 'rgba(16, 185, 129, 0.2)'
}) => {
  return (
    <div className={cn('relative glass-card-medium rounded-3xl p-6 overflow-hidden', className)}>
      <svg
        className="absolute top-0 left-0 w-full h-full opacity-50"
        viewBox="0 0 200 200"
        xmlns="http://www.w3.org/2000/svg"
      >
        <motion.path
          fill={blobColor}
          d="M44.3,-76.7C58.1,-69.3,70.7,-58.4,78.9,-44.8C87.1,-31.2,90.9,-15.6,89.8,-0.7C88.7,14.2,82.7,28.4,74.4,41.2C66.1,54,55.5,65.4,42.7,72.8C29.9,80.2,14.9,83.6,0.5,82.7C-13.9,81.8,-27.8,76.6,-40.9,69.4C-54,62.2,-66.3,53,-74.5,40.8C-82.7,28.6,-86.8,14.3,-86.3,0.3C-85.8,-13.7,-80.7,-27.4,-72.8,-39.6C-64.9,-51.8,-54.2,-62.5,-41.5,-70.4C-28.8,-78.3,-14.4,-83.4,0.6,-84.4C15.6,-85.4,31.2,-82.3,44.3,-76.7Z"
          animate={{
            d: [
              "M44.3,-76.7C58.1,-69.3,70.7,-58.4,78.9,-44.8C87.1,-31.2,90.9,-15.6,89.8,-0.7C88.7,14.2,82.7,28.4,74.4,41.2C66.1,54,55.5,65.4,42.7,72.8C29.9,80.2,14.9,83.6,0.5,82.7C-13.9,81.8,-27.8,76.6,-40.9,69.4C-54,62.2,-66.3,53,-74.5,40.8C-82.7,28.6,-86.8,14.3,-86.3,0.3C-85.8,-13.7,-80.7,-27.4,-72.8,-39.6C-64.9,-51.8,-54.2,-62.5,-41.5,-70.4C-28.8,-78.3,-14.4,-83.4,0.6,-84.4C15.6,-85.4,31.2,-82.3,44.3,-76.7Z",
              "M51.1,-85.8C65.4,-77.1,75.9,-61.5,82.5,-44.8C89.1,-28.1,91.8,-10.3,89.2,6.4C86.6,23.1,78.7,38.7,68.1,51.8C57.5,64.9,44.2,75.5,29.3,80.8C14.4,86.1,-2.1,86.1,-17.8,82.3C-33.5,78.5,-48.4,70.9,-60.8,59.5C-73.2,48.1,-83.1,32.9,-86.5,16.3C-89.9,-0.3,-86.8,-18.3,-79.2,-34.3C-71.6,-50.3,-59.5,-64.3,-44.7,-72.7C-29.9,-81.1,-12.5,-83.9,3.8,-89.7C20.1,-95.5,36.8,-94.5,51.1,-85.8Z",
              "M44.3,-76.7C58.1,-69.3,70.7,-58.4,78.9,-44.8C87.1,-31.2,90.9,-15.6,89.8,-0.7C88.7,14.2,82.7,28.4,74.4,41.2C66.1,54,55.5,65.4,42.7,72.8C29.9,80.2,14.9,83.6,0.5,82.7C-13.9,81.8,-27.8,76.6,-40.9,69.4C-54,62.2,-66.3,53,-74.5,40.8C-82.7,28.6,-86.8,14.3,-86.3,0.3C-85.8,-13.7,-80.7,-27.4,-72.8,-39.6C-64.9,-51.8,-54.2,-62.5,-41.5,-70.4C-28.8,-78.3,-14.4,-83.4,0.6,-84.4C15.6,-85.4,31.2,-82.3,44.3,-76.7Z"
            ]
          }}
          transition={{
            duration: 10,
            repeat: Infinity,
            repeatType: 'reverse',
            ease: 'easeInOut'
          }}
        />
      </svg>
      <div className="relative z-10">{children}</div>
    </div>
  );
};

// === NOISE CARD (with grain texture effect) ===
interface NoiseCardProps {
  children: React.ReactNode;
  className?: string;
  noiseOpacity?: number;
}

export const NoiseCard: React.FC<NoiseCardProps> = ({
  children,
  className,
  noiseOpacity = 0.05
}) => {
  return (
    <div className={cn('relative glass-card-medium rounded-xl p-6 overflow-hidden', className)}>
      <div
        className="absolute inset-0 pointer-events-none"
        style={{
          backgroundImage: 'url("data:image/svg+xml,%3Csvg viewBox=\'0 0 400 400\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.9\' numOctaves=\'4\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\'/%3E%3C/svg%3E")',
          opacity: noiseOpacity
        }}
      />
      <div className="relative z-10">{children}</div>
    </div>
  );
};
```

### 2025/PremiumLayouts.tsx
```tsx
import React, { ReactNode } from 'react';
import { motion } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';

// === BENTO GRID ===
interface BentoGridProps {
  children: ReactNode;
  className?: string;
  columns?: 2 | 3 | 4;
}

export const BentoGrid: React.FC<BentoGridProps> = ({
  children,
  className,
  columns = 3
}) => {
  const gridCols = {
    2: 'grid-cols-1 md:grid-cols-2',
    3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
    4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4'
  };
  
  return (
    <div className={cn(
      'grid gap-4',
      gridCols[columns],
      className
    )}>
      {children}
    </div>
  );
};

// === BENTO GRID ITEM ===
interface BentoGridItemProps {
  children: ReactNode;
  className?: string;
  span?: {
    cols?: 1 | 2 | 3 | 4;
    rows?: 1 | 2 | 3;
  };
}

export const BentoGridItem: React.FC<BentoGridItemProps> = ({
  children,
  className,
  span = { cols: 1, rows: 1 }
}) => {
  const colSpan = {
    1: 'col-span-1',
    2: 'col-span-1 md:col-span-2',
    3: 'col-span-1 md:col-span-2 lg:col-span-3',
    4: 'col-span-1 md:col-span-2 lg:col-span-4'
  };
  
  const rowSpan = {
    1: 'row-span-1',
    2: 'row-span-2',
    3: 'row-span-3'
  };
  
  return (
    <motion.div
      className={cn(
        'glass-card-medium rounded-xl p-6',
        span.cols && colSpan[span.cols],
        span.rows && rowSpan[span.rows],
        className
      )}
      initial={{ opacity: 0, y: 20 }}
      whileInView={{ opacity: 1, y: 0 }}
      viewport={{ once: true }}
      transition={{ duration: 0.5 }}
    >
      {children}
    </motion.div>
  );
};

// === MASONRY GRID ===
interface MasonryGridProps {
  children: ReactNode;
  className?: string;
  columns?: 2 | 3 | 4;
  gap?: number;
}

export const MasonryGrid: React.FC<MasonryGridProps> = ({
  children,
  className,
  columns = 3,
  gap = 16
}) => {
  const childrenArray = React.Children.toArray(children);
  const columnWrappers: ReactNode[][] = Array.from({ length: columns }, () => []);
  
  childrenArray.forEach((child, index) => {
    const columnIndex = index % columns;
    columnWrappers[columnIndex].push(child);
  });
  
  return (
    <div 
      className={cn('flex', className)}
      style={{ gap: `${gap}px` }}
    >
      {columnWrappers.map((column, columnIndex) => (
        <div
          key={columnIndex}
          className="flex-1 flex flex-col"
          style={{ gap: `${gap}px` }}
        >
          {column.map((item, itemIndex) => (
            <motion.div
              key={itemIndex}
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ duration: 0.5, delay: itemIndex * 0.1 }}
            >
              {item}
            </motion.div>
          ))}
        </div>
      ))}
    </div>
  );
};

// === STAGGERED CONTAINER (for animated lists) ===
interface StaggeredContainerProps {
  children: ReactNode;
  className?: string;
  staggerDelay?: number;
}

export const StaggeredContainer: React.FC<StaggeredContainerProps> = ({
  children,
  className,
  staggerDelay = 0.1
}) => {
  const childrenArray = React.Children.toArray(children);
  
  return (
    <div className={className}>
      {childrenArray.map((child, index) => (
        <motion.div
          key={index}
          initial={{ opacity: 0, x: -20 }}
          whileInView={{ opacity: 1, x: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.5, delay: index * staggerDelay }}
        >
          {child}
        </motion.div>
      ))}
    </div>
  );
};

// === SPLIT LAYOUT (for hero/feature sections) ===
interface SplitLayoutProps {
  left: ReactNode;
  right: ReactNode;
  className?: string;
  reverse?: boolean;
}

export const SplitLayout: React.FC<SplitLayoutProps> = ({
  left,
  right,
  className,
  reverse = false
}) => {
  return (
    <div className={cn(
      'grid grid-cols-1 lg:grid-cols-2 gap-8 items-center',
      reverse && 'lg:grid-flow-dense',
      className
    )}>
      <motion.div
        initial={{ opacity: 0, x: reverse ? 50 : -50 }}
        whileInView={{ opacity: 1, x: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
        className={reverse ? 'lg:col-start-2' : ''}
      >
        {left}
      </motion.div>
      <motion.div
        initial={{ opacity: 0, x: reverse ? -50 : 50 }}
        whileInView={{ opacity: 1, x: 0 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6, delay: 0.2 }}
        className={reverse ? 'lg:col-start-1 lg:row-start-1' : ''}
      >
        {right}
      </motion.div>
    </div>
  );
};

// === CARD STACK (layered cards effect) ===
interface CardStackProps {
  children: ReactNode;
  className?: string;
}

export const CardStack: React.FC<CardStackProps> = ({
  children,
  className
}) => {
  const childrenArray = React.Children.toArray(children);
  
  return (
    <div className={cn('relative', className)} style={{ minHeight: '200px' }}>
      {childrenArray.map((child, index) => (
        <motion.div
          key={index}
          className="absolute w-full"
          initial={{ 
            y: index * 20, 
            scale: 1 - index * 0.05,
            opacity: 1 - index * 0.2
          }}
          whileHover={{ y: index * 30 }}
          style={{ zIndex: childrenArray.length - index }}
        >
          {child}
        </motion.div>
      ))}
    </div>
  );
};
```

### 2025/PremiumSections.tsx
```tsx
import React, { useRef, useEffect, useState } from 'react';
import { motion, useScroll, useTransform, useSpring, useInView } from '@/utils/LazyMotionProvider';
import { cn } from '@/lib/utils';

// === PREMIUM HERO SECTION ===
interface PremiumHeroProps {
  title: React.ReactNode;
  subtitle?: React.ReactNode;
  cta?: React.ReactNode;
  background?: 'gradient' | 'mesh' | 'aurora' | 'particles';
  className?: string;
}

export const PremiumHero: React.FC<PremiumHeroProps> = ({
  title,
  subtitle,
  cta,
  background = 'gradient',
  className
}) => {
  const backgrounds = {
    gradient: 'bg-gradient-to-br from-emerald-500/20 via-cyan-500/20 to-purple-500/20',
    mesh: 'mesh-gradient',
    aurora: 'aurora-bg',
    particles: 'bg-transparent'
  };
  
  return (
    <motion.section
      className={cn(
        'relative min-h-screen flex items-center justify-center overflow-hidden',
        backgrounds[background],
        className
      )}
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.8 }}
    >
      <div className="relative z-10 text-center max-w-4xl mx-auto px-4">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.2 }}
        >
          {title}
        </motion.div>
        
        {subtitle && (
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.4 }}
            className="mt-6"
          >
            {subtitle}
          </motion.div>
        )}
        
        {cta && (
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.6 }}
            className="mt-10"
          >
            {cta}
          </motion.div>
        )}
      </div>
    </motion.section>
  );
};

// === FLOATING NAVIGATION ===
interface FloatingNavProps {
  items: { label: string; href: string; icon?: React.ReactNode }[];
  className?: string;
}

export const FloatingNav: React.FC<FloatingNavProps> = ({
  items,
  className
}) => {
  const [activeIndex, setActiveIndex] = useState(0);
  const [isVisible, setIsVisible] = useState(true);
  const [lastScrollY, setLastScrollY] = useState(0);
  
  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY;
      setIsVisible(currentScrollY < lastScrollY || currentScrollY < 100);
      setLastScrollY(currentScrollY);
    };
    
    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => window.removeEventListener('scroll', handleScroll);
  }, [lastScrollY]);
  
  return (
    <motion.nav
      className={cn(
        'fixed bottom-8 left-1/2 -translate-x-1/2 z-50',
        'glass-card-frosted rounded-full px-6 py-3',
        'shadow-lg',
        className
      )}
      initial={{ y: 100, opacity: 0 }}
      animate={{ 
        y: isVisible ? 0 : 100,
        opacity: isVisible ? 1 : 0
      }}
      transition={{ duration: 0.3 }}
    >
      <ul className="flex items-center gap-6">
        {items.map((item, index) => (
          <motion.li key={index}>
            <button
              onClick={() => setActiveIndex(index)}
              className={cn(
                'relative px-4 py-2 rounded-full transition-colors',
                activeIndex === index 
                  ? 'text-white' 
                  : 'text-white/60 hover:text-white/80'
              )}
            >
              {activeIndex === index && (
                <motion.div
                  layoutId="activeTab"
                  className="absolute inset-0 bg-emerald-500 rounded-full"
                  transition={{ type: 'spring', stiffness: 380, damping: 30 }}
                />
              )}
              <span className="relative z-10 flex items-center gap-2">
                {item.icon}
                <span className="hidden sm:inline">{item.label}</span>
              </span>
            </button>
          </motion.li>
        ))}
      </ul>
    </motion.nav>
  );
};

// === TAB NAVIGATION ===
interface TabNavigationProps {
  tabs: { label: string; content: React.ReactNode }[];
  className?: string;
}

export const TabNavigation: React.FC<TabNavigationProps> = ({
  tabs,
  className
}) => {
  const [activeTab, setActiveTab] = useState(0);
  
  return (
    <div className={className}>
      <div className="glass-card-medium rounded-xl p-2 inline-flex gap-2">
        {tabs.map((tab, index) => (
          <button
            key={index}
            onClick={() => setActiveTab(index)}
            className={cn(
              'relative px-6 py-2 rounded-lg transition-colors',
              activeTab === index
                ? 'text-white'
                : 'text-white/60 hover:text-white/80'
            )}
          >
            {activeTab === index && (
              <motion.div
                layoutId="activeTabBg"
                className="absolute inset-0 bg-emerald-500 rounded-lg"
                transition={{ type: 'spring', stiffness: 380, damping: 30 }}
              />
            )}
            <span className="relative z-10">{tab.label}</span>
          </button>
        ))}
      </div>
      
      <div className="mt-6">
        <motion.div
          key={activeTab}
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: -10 }}
          transition={{ duration: 0.3 }}
        >
          {tabs[activeTab].content}
        </motion.div>
      </div>
    </div>
  );
};

// === PARALLAX SECTION ===
interface ParallaxSectionProps {
  children: React.ReactNode;
  speed?: number;
  className?: string;
}

export const ParallaxSection: React.FC<ParallaxSectionProps> = ({
  children,
  speed = 0.5,
  className
}) => {
  const ref = useRef<HTMLDivElement>(null);
  const { scrollYProgress } = useScroll({
    target: ref,
    offset: ['start end', 'end start']
  });
  
  const y = useTransform(scrollYProgress, [0, 1], [0, speed * 100]);
  const opacity = useTransform(scrollYProgress, [0, 0.5, 1], [0.3, 1, 0.3]);
  
  return (
    <div ref={ref} className={className}>
      <motion.div style={{ y, opacity }}>
        {children}
      </motion.div>
    </div>
  );
};

// === REVEAL ON SCROLL ===
interface RevealOnScrollProps {
  children: React.ReactNode;
  direction?: 'up' | 'down' | 'left' | 'right';
  delay?: number;
  className?: string;
}

export const RevealOnScroll: React.FC<RevealOnScrollProps> = ({
  children,
  direction = 'up',
  delay = 0,
  className
}) => {
  const ref = useRef<HTMLDivElement>(null);
  const isInView = useInView(ref, { once: true, margin: '-100px' });
  
  const directions = {
    up: { y: 50, x: 0 },
    down: { y: -50, x: 0 },
    left: { y: 0, x: 50 },
    right: { y: 0, x: -50 }
  };
  
  return (
    <motion.div
      ref={ref}
      className={className}
      initial={{ 
        opacity: 0,
        ...directions[direction]
      }}
      animate={isInView ? { 
        opacity: 1, 
        y: 0, 
        x: 0 
      } : {}}
      transition={{ 
        duration: 0.6, 
        delay,
        ease: [0.22, 1, 0.36, 1]
      }}
    >
      {children}
    </motion.div>
  );
};

// === STICKY SECTION ===
interface StickySectionProps {
  children: React.ReactNode;
  className?: string;
  stickyClassName?: string;
}

export const StickySection: React.FC<StickySectionProps> = ({
  children,
  className,
  stickyClassName
}) => {
  const ref = useRef<HTMLDivElement>(null);
  const { scrollYProgress } = useScroll({
    target: ref,
    offset: ['start start', 'end end']
  });
  
  const scale = useSpring(
    useTransform(scrollYProgress, [0, 1], [1, 0.85]),
    { stiffness: 100, damping: 30 }
  );
  
  const opacity = useSpring(
    useTransform(scrollYProgress, [0, 0.5, 1], [1, 1, 0.3]),
    { stiffness: 100, damping: 30 }
  );
  
  return (
    <div ref={ref} className={cn('relative', className)}>
      <motion.div
        className={cn('sticky top-20', stickyClassName)}
        style={{ scale, opacity }}
      >
        {children}
      </motion.div>
    </div>
  );
};

// === SCROLL PROGRESS INDICATOR ===
export const ScrollProgressIndicator: React.FC<{ className?: string }> = ({ className }) => {
  const { scrollYProgress } = useScroll();
  const scaleX = useSpring(scrollYProgress, {
    stiffness: 100,
    damping: 30,
    restDelta: 0.001
  });
  
  return (
    <motion.div
      className={cn(
        'fixed top-0 left-0 right-0 h-1 bg-gradient-to-r from-emerald-500 to-cyan-500',
        'origin-left z-50',
        className
      )}
      style={{ scaleX }}
    />
  );
};
```

## APPLE UI КОМПОНЕНТЫ

### apple-ui/Badge.tsx
```tsx
interface BadgeProps {
  children: React.ReactNode;
  variant?: 'default' | 'success' | 'warning' | 'error';
  size?: 'small' | 'medium';
  className?: string;
}

export function Badge({
  children,
  variant = 'default',
  size = 'medium',
  className = ''
}: BadgeProps) {
  const variants = {
    default: 'bg-white/10 text-white/90',
    success: 'bg-emerald-500/20 text-emerald-400',
    warning: 'bg-amber-500/20 text-amber-400',
    error: 'bg-red-500/20 text-red-400'
  };
  
  const sizes = {
    small: 'px-2 py-1 text-xs rounded-md',
    medium: 'px-3 py-1.5 text-sm rounded-lg'
  };
  
  return (
    <span className={`
      inline-flex items-center font-medium
      ${variants[variant]}
      ${sizes[size]}
      ${className}
    `}>
      {children}
    </span>
  );
}
```

### apple-ui/Button.tsx
```tsx
import { motion } from '@/utils/LazyMotionProvider';
import { hoverScale, tapScale } from '@/utils/motionConfig';

interface ButtonProps {
  variant?: 'primary' | 'secondary' | 'tertiary';
  size?: 'small' | 'medium' | 'large';
  children: React.ReactNode;
  onClick?: () => void;
  disabled?: boolean;
  loading?: boolean;
  className?: string;
}

export function Button({
  variant = 'primary',
  size = 'medium',
  children,
  onClick,
  disabled,
  loading,
  className = ''
}: ButtonProps) {
  const variants = {
    primary: 'bg-emerald-500 text-white hover:bg-emerald-600 shadow-apple-sm hover:shadow-apple-md',
    secondary: 'glass-apple text-white border border-white/20 hover:bg-white/15',
    tertiary: 'bg-transparent text-emerald-500 hover:bg-emerald-500/10'
  };
  
  const sizes = {
    small: 'px-4 py-2 text-sm rounded-lg',
    medium: 'px-6 py-3 text-base rounded-xl',
    large: 'px-8 py-4 text-lg rounded-2xl'
  };
  
  return (
    <motion.button
      className={`
        button-apple font-semibold touch-target
        ${variants[variant]}
        ${sizes[size]}
        ${disabled || loading ? 'opacity-50 cursor-not-allowed' : ''}
        ${className}
      `}
      onClick={onClick}
      disabled={disabled || loading}
      whileHover={!disabled && !loading ? hoverScale : undefined}
      whileTap={!disabled && !loading ? tapScale : undefined}
    >
      {loading ? (
        <div className="inline-flex items-center gap-2">
          <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
          {children}
        </div>
      ) : children}
    </motion.button>
  );
}
```

### apple-ui/Card.tsx
```tsx
import { motion, HTMLMotionProps } from '@/utils/LazyMotionProvider';
import { hoverScale } from '@/utils/motionConfig';

interface CardProps extends HTMLMotionProps<'div'> {
  children: React.ReactNode;
  variant?: 'default' | 'glass' | 'premium';
  hoverable?: boolean;
  className?: string;
}

export function Card({
  children,
  variant = 'default',
  hoverable = false,
  className = '',
  ...props
}: CardProps) {
  const variants = {
    default: 'bg-white/10 border border-white/20',
    glass: 'glass-apple',
    premium: 'card-premium glass-apple'
  };
  
  return (
    <motion.div
      className={`
        rounded-2xl p-6 card-apple
        ${variants[variant]}
        ${className}
      `}
      whileHover={hoverable ? hoverScale : undefined}
      {...props}
    >
      {children}
    </motion.div>
  );
}

export function CardHeader({ children, className = '' }: { children: React.ReactNode; className?: string }) {
  return (
    <div className={`mb-4 ${className}`}>
      {children}
    </div>
  );
}

export function CardTitle({ children, className = '' }: { children: React.ReactNode; className?: string }) {
  return (
    <h3 className={`text-xl font-bold tracking-tight ${className}`}>
      {children}
    </h3>
  );
}

export function CardDescription({ children, className = '' }: { children: React.ReactNode; className?: string }) {
  return (
    <p className={`text-sm text-white/70 mt-2 ${className}`}>
      {children}
    </p>
  );
}

export function CardContent({ children, className = '' }: { children: React.ReactNode; className?: string }) {
  return (
    <div className={className}>
      {children}
    </div>
  );
}
```

### apple-ui/ExpandableSection.tsx
```tsx
import { useState } from 'react';
import { motion, AnimatePresence } from '@/utils/LazyMotionProvider';
import { ChevronDown } from 'lucide-react';

interface ExpandableSectionProps {
  title: string;
  children: React.ReactNode;
  defaultOpen?: boolean;
  className?: string;
}

export function ExpandableSection({ 
  title, 
  children, 
  defaultOpen = false,
  className = ''
}: ExpandableSectionProps) {
  const [isOpen, setIsOpen] = useState(defaultOpen);
  
  return (
    <div className={`expandable-section ${className}`}>
      <button
        className="section-header rounded-xl w-full"
        onClick={() => setIsOpen(!isOpen)}
        aria-expanded={isOpen}
      >
        <span className="section-title">{title}</span>
        <motion.div
          animate={{ rotate: isOpen ? 180 : 0 }}
          transition={{ duration: 0.2, ease: [0.4, 0, 0.2, 1] }}
        >
          <ChevronDown className="w-5 h-5" />
        </motion.div>
      </button>
      
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{
              height: { duration: 0.3, ease: [0.4, 0, 0.2, 1] },
              opacity: { duration: 0.2 }
            }}
            className="overflow-hidden"
          >
            <div className="section-content px-6 py-4">
              {children}
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
```

### apple-ui/LoadingProgress.tsx
```tsx
import { motion } from '@/utils/LazyMotionProvider';

interface LoadingProgressProps {
  progress?: number;
  label?: string;
  indeterminate?: boolean;
}

export function LoadingProgress({ 
  progress = 0, 
  label,
  indeterminate = false 
}: LoadingProgressProps) {
  return (
    <div className="flex flex-col items-center justify-center gap-4 p-8">
      {label && (
        <p className="text-sm text-white/70 font-medium">
          {label}
        </p>
      )}
      
      <div className="w-full max-w-xs">
        <div className="h-1 bg-white/10 rounded-full overflow-hidden">
          {indeterminate ? (
            <motion.div
              className="h-full bg-emerald-500 rounded-full"
              initial={{ x: '-100%' }}
              animate={{ x: '100%' }}
              transition={{
                repeat: Infinity,
                duration: 1.5,
                ease: [0.4, 0, 0.2, 1]
              }}
              style={{ width: '40%' }}
            />
          ) : (
            <motion.div
              className="h-full bg-emerald-500 rounded-full"
              initial={{ width: 0 }}
              animate={{ width: `${progress}%` }}
              transition={{
                duration: 0.3,
                ease: [0.4, 0, 0.2, 1]
              }}
            />
          )}
        </div>
      </div>
      
      {!indeterminate && (
        <p className="text-xs text-white/50 font-medium tabular-nums">
          {Math.round(progress)}%
        </p>
      )}
    </div>
  );
}

export function LoadingSpinner({ size = 'medium', className = '' }: { size?: 'small' | 'medium' | 'large'; className?: string }) {
  const sizes = {
    small: 'w-4 h-4 border-2',
    medium: 'w-8 h-8 border-3',
    large: 'w-12 h-12 border-4'
  };
  
  return (
    <div className={`inline-flex ${className}`}>
      <div className={`
        ${sizes[size]}
        border-white/20
        border-t-emerald-500
        rounded-full
        animate-spin
      `} />
    </div>
  );
}

export function LoadingDots({ className = '' }: { className?: string }) {
  return (
    <div className={`inline-flex items-center gap-2 ${className}`}>
      {[0, 1, 2].map((i) => (
        <motion.div
          key={i}
          className="w-2 h-2 bg-emerald-500 rounded-full"
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.5, 1, 0.5]
          }}
          transition={{
            duration: 1.4,
            repeat: Infinity,
            delay: i * 0.2,
            ease: [0.4, 0, 0.2, 1]
          }}
        />
      ))}
    </div>
  );
}
```

## ДОПОЛНИТЕЛЬНЫЕ ДЕМО (не в основных 13)

### demos/Banking.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m } from "framer-motion";
import { 
  Wallet, 
  Heart, 
  Star, 
  X,
  ChevronLeft,
  CreditCard,
  User,
  TrendingUp,
  ArrowUpRight,
  ArrowDownLeft,
  Bitcoin,
  Zap,
  Shield,
  PiggyBank,
  History,
  Settings
} from "lucide-react";

interface BankingProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Asset {
  id: number;
  name: string;
  symbol: string;
  price: number;
  change24h: number;
  image: string;
  description: string;
  category: 'Криптовалюта' | 'Акции' | 'ETF' | 'Облигации';
  rating: number;
  risk: 'Низкий' | 'Средний' | 'Высокий';
  isNew?: boolean;
  isPopular?: boolean;
}

const assets: Asset[] = [
  { id: 1, name: 'Bitcoin', symbol: 'BTC', price: 5280000, change24h: 5.2, image: 'https://images.unsplash.com/photo-1518546305927-5a555bb7020d?w=800&h=1200&fit=crop&q=90', description: 'Первая криптовалюта', category: 'Криптовалюта', rating: 4.9, risk: 'Высокий', isPopular: true },
  { id: 2, name: 'Ethereum', symbol: 'ETH', price: 175000, change24h: 3.8, image: 'https://images.unsplash.com/photo-1622630998477-20aa696ecb05?w=800&h=1200&fit=crop&q=90', description: 'Платформа смарт-контрактов', category: 'Криптовалюта', rating: 4.8, risk: 'Высокий', isPopular: true },
  { id: 3, name: 'Сбербанк', symbol: 'SBER', price: 28000, change24h: 1.2, image: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=800&h=1200&fit=crop&q=90', description: 'Акции Сбербанка', category: 'Акции', rating: 4.7, risk: 'Средний', isNew: true },
  { id: 4, name: 'Газпром', symbol: 'GAZP', price: 18500, change24h: -0.5, image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=1200&fit=crop&q=90', description: 'Акции Газпрома', category: 'Акции', rating: 4.6, risk: 'Средний', isPopular: true },
  { id: 5, name: 'S&P 500 ETF', symbol: 'SPY', price: 550000, change24h: 0.8, image: 'https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?w=800&h=1200&fit=crop&q=90', description: 'Фонд S&P 500', category: 'ETF', rating: 5.0, risk: 'Средний', isNew: true, isPopular: true },
  { id: 6, name: 'ОФЗ 2030', symbol: 'OFZ', price: 98000, change24h: 0.1, image: 'https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?w=800&h=1200&fit=crop&q=90', description: 'Облигации федерального займа', category: 'Облигации', rating: 4.9, risk: 'Низкий' },
];

const categories = ['Все', 'Криптовалюта', 'Акции', 'ETF', 'Облигации'];

const portfolios = [
  {
    id: 1,
    title: 'Агрессивный рост',
    subtitle: 'Высокая доходность',
    gradient: 'from-blue-600/30 to-cyan-600/30',
    assets: [1, 2, 3],
    returns: '+18.5%'
  },
  {
    id: 2,
    title: 'Сбалансированный',
    subtitle: 'Оптимальный баланс',
    gradient: 'from-green-600/30 to-emerald-600/30',
    assets: [3, 4, 5],
    returns: '+12.3%'
  },
  {
    id: 3,
    title: 'Консервативный',
    subtitle: 'Низкий риск',
    gradient: 'from-purple-600/30 to-indigo-600/30',
    assets: [5, 6],
    returns: '+6.8%'
  },
];

export default memo(function Banking({ activeTab }: BankingProps) {
  const [selectedAsset, setSelectedAsset] = useState<Asset | null>(null);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<Set<number>>(new Set([1, 2]));
  
  const [balance, setBalance] = useState(2450000);
  const [totalGain, setTotalGain] = useState(385000);
  const [gainPercent, setGainPercent] = useState(18.6);

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedAsset(null);
    }
  }, [activeTab]);

  const filteredAssets = assets.filter(a => 
    selectedCategory === 'Все' || a.category === selectedCategory
  );

  const toggleFavorite = (assetId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(assetId)) {
      newFavorites.delete(assetId);
    } else {
      newFavorites.add(assetId);
    }
    setFavorites(newFavorites);
  };

  const buyAsset = (asset: Asset, amount: number) => {
    setBalance(prev => prev - amount);
    setTotalGain(prev => prev + (amount * 0.1));
    setGainPercent(prev => prev + 0.5);
    setSelectedAsset(null);
  };

  if (activeTab === 'home') {
    return (
      <div className="h-full overflow-y-auto">
        <div className="relative h-[280px] bg-gradient-to-br from-blue-600/20 via-cyan-500/20 to-indigo-600/20">
          <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1579621970563-ebec7560ff3e?w=1200&h=800&fit=crop&q=90')] bg-cover bg-center opacity-20" />
          <div className="absolute inset-0 backdrop-blur-xl bg-gradient-to-t from-black/60 to-transparent" />
          
          <div className="relative h-full flex flex-col justify-end p-6 pb-8">
            <m.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              className="space-y-2"
            >
              <div className="flex items-center gap-2">
                <div className="p-2 bg-blue-500/20 backdrop-blur-xl rounded-xl border border-blue-400/30">
                  <Wallet className="w-6 h-6 text-blue-300" />
                </div>
                <h1 className="text-3xl font-bold text-white">MoneyHub</h1>
              </div>
              <p className="text-white/80">Умные инвестиции и крипто</p>
              
              <div className="grid grid-cols-2 gap-2 pt-2">
                <div className="px-3 py-2 bg-blue-500/20 backdrop-blur-xl rounded-xl border border-blue-400/30">
                  <p className="text-blue-200 text-xs">Баланс</p>
                  <p className="text-white text-lg font-bold">{balance.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}</p>
                </div>
                <div className="px-3 py-2 bg-green-500/20 backdrop-blur-xl rounded-xl border border-green-400/30">
                  <p className="text-green-200 text-xs">Доход</p>
                  <p className="text-white text-lg font-bold">+{gainPercent}%</p>
                </div>
              </div>
            </m.div>
          </div>
        </div>

        <div className="p-4 space-y-6">
          <div className="p-4 bg-gradient-to-br from-green-500/10 to-emerald-500/10 backdrop-blur-xl rounded-2xl border border-green-400/30">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <TrendingUp className="w-6 h-6 text-green-600 dark:text-green-500" />
                <div>
                  <h3 className="font-bold text-lg">Прибыль</h3>
                  <p className="text-sm text-green-700 dark:text-green-300">За все время</p>
                </div>
              </div>
              <div className="text-right">
                <p className="text-2xl font-bold text-green-600">+{totalGain.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}</p>
                <p className="text-xs text-green-700 dark:text-green-300">+{gainPercent}%</p>
              </div>
            </div>
          </div>

          <div>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold">Портфели</h2>
              <PiggyBank className="w-5 h-5 text-muted-foreground" />
            </div>
            <div className="grid gap-3">
              {portfolios.map((portfolio) => (
                <m.div
                  key={portfolio.id}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  className="relative h-32 rounded-2xl overflow-hidden hover-elevate active-elevate-2 cursor-pointer bg-card/50 backdrop-blur-xl border border-border/50"
                >
                  <div className={`absolute inset-0 bg-gradient-to-r ${portfolio.gradient}`} />
                  
                  <div className="relative h-full p-5 flex flex-col justify-between">
                    <div>
                      <h3 className="text-xl font-bold mb-1">{portfolio.title}</h3>
                      <p className="text-muted-foreground text-sm">{portfolio.subtitle}</p>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-2xl font-bold text-green-600">{portfolio.returns}</span>
                      <div className="flex gap-2">
                        {assets.filter(a => portfolio.assets.includes(a.id)).slice(0, 3).map(asset => (
                          <div key={asset.id} className="w-8 h-8 rounded-lg bg-card/50 backdrop-blur-xl border border-border/50 flex items-center justify-center">
                            <span className="text-xs font-bold">{asset.symbol.substring(0, 2)}</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                </m.div>
              ))}
            </div>
          </div>

          <div>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold">Популярное</h2>
              <Star className="w-5 h-5 fill-blue-500 text-blue-500" />
            </div>
            <div className="grid grid-cols-2 gap-3">
              {assets.filter(a => a.isPopular).map((asset) => (
                <m.div
                  key={asset.id}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  onClick={() => setSelectedAsset(asset)}
                  className="bg-card/50 backdrop-blur-xl rounded-2xl overflow-hidden border border-border/50 hover-elevate active-elevate-2 cursor-pointer"
                  data-testid={`card-asset-${asset.id}`}
                >
                  <div className="relative aspect-[3/4]">
                    <img src={asset.image} alt={asset.name} className="w-full h-full object-cover" />
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleFavorite(asset.id);
                      }}
                      className="absolute top-2 right-2 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                      data-testid={`button-favorite-${asset.id}`}
                    >
                      <Heart className={`w-4 h-4 ${favorites.has(asset.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
                    </button>
                    <div className={`absolute bottom-2 left-2 px-2 py-1 ${asset.change24h >= 0 ? 'bg-green-500/90' : 'bg-red-500/90'} backdrop-blur-xl rounded-full border ${asset.change24h >= 0 ? 'border-green-400/50' : 'border-red-400/50'}`}>
                      <span className="text-xs font-bold text-white flex items-center gap-1">
                        {asset.change24h >= 0 ? <ArrowUpRight className="w-3 h-3" /> : <ArrowDownLeft className="w-3 h-3" />}
                        {Math.abs(asset.change24h)}%
                      </span>
                    </div>
                  </div>
                  <div className="p-3">
                    <h3 className="font-medium mb-1 line-clamp-1">{asset.name}</h3>
                    <div className="flex items-center justify-between">
                      <span className="text-sm font-bold">{asset.price.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}</span>
                      <span className="text-xs text-muted-foreground">{asset.symbol}</span>
                    </div>
                  </div>
                </m.div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (activeTab === 'catalog') {
    if (selectedAsset) {
      return (
        <div className="h-full flex flex-col bg-background">
          <div className="relative">
            <div className="aspect-[3/4] relative">
              <img src={selectedAsset.image} alt={selectedAsset.name} className="w-full h-full object-cover" />
              <button
                onClick={() => setSelectedAsset(null)}
                className="absolute top-4 left-4 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                data-testid="button-back"
              >
                <ChevronLeft className="w-6 h-6 text-white" />
              </button>
              <button
                onClick={() => toggleFavorite(selectedAsset.id)}
                className="absolute top-4 right-4 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                data-testid={`button-favorite-detail-${selectedAsset.id}`}
              >
                <Heart className={`w-6 h-6 ${favorites.has(selectedAsset.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
              </button>
            </div>
          </div>

          <div className="flex-1 overflow-y-auto p-5 space-y-4">
            <div>
              <div className="flex items-start justify-between mb-2">
                <div>
                  <h1 className="text-2xl font-bold">{selectedAsset.name}</h1>
                  <p className="text-muted-foreground">{selectedAsset.symbol}</p>
                </div>
                <div className={`flex items-center gap-1 px-3 py-1 rounded-full ${selectedAsset.change24h >= 0 ? 'bg-green-500/10' : 'bg-red-500/10'}`}>
                  {selectedAsset.change24h >= 0 ? <ArrowUpRight className="w-4 h-4 text-green-600" /> : <ArrowDownLeft className="w-4 h-4 text-red-600" />}
                  <span className={`font-bold ${selectedAsset.change24h >= 0 ? 'text-green-600' : 'text-red-600'}`}>{Math.abs(selectedAsset.change24h)}%</span>
                </div>
              </div>
              <p className="text-muted-foreground">{selectedAsset.description}</p>
            </div>

            <div className="grid grid-cols-3 gap-3">
              <div className="p-3 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 text-center">
                <p className="text-xs text-muted-foreground mb-1">Категория</p>
                <p className="text-sm font-bold">{selectedAsset.category}</p>
              </div>
              <div className="p-3 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 text-center">
                <Shield className="w-5 h-5 mx-auto mb-1 text-blue-600" />
                <p className="text-xs font-bold">{selectedAsset.risk}</p>
              </div>
              <div className="p-3 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 text-center">
                <Star className="w-5 h-5 mx-auto mb-1 fill-blue-500 text-blue-500" />
                <p className="text-xs font-bold">{selectedAsset.rating}</p>
              </div>
            </div>

            <div className="p-4 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 backdrop-blur-xl rounded-xl border border-blue-400/30">
              <div className="flex items-center gap-2 mb-2">
                <Zap className="w-5 h-5 text-blue-600" />
                <p className="font-semibold text-blue-900 dark:text-blue-100">Быстрая инвестиция</p>
              </div>
              <p className="text-sm text-blue-800 dark:text-blue-200">
                Начните инвестировать с любой суммы • Комиссия 0%
              </p>
            </div>

            <div className="flex items-center justify-between pt-2">
              <div>
                <p className="text-sm text-muted-foreground mb-1">Цена</p>
                <p className="text-3xl font-bold">{selectedAsset.price.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}</p>
              </div>
              <button
                onClick={() => buyAsset(selectedAsset, selectedAsset.price)}
                className="px-8 py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-semibold rounded-2xl hover-elevate active-elevate-2"
                data-testid="button-buy"
              >
                Купить
              </button>
            </div>
          </div>
        </div>
      );
    }

    return (
      <div className="h-full overflow-y-auto">
        <div className="sticky top-0 z-10 bg-background/80 backdrop-blur-xl border-b border-border/50 px-4 py-5">
          <h1 className="text-2xl font-bold mb-4">Активы</h1>
          <div className="flex gap-2 overflow-x-auto pb-2 -mx-4 px-4">
            {categories.map((category) => (
              <button
                key={category}
                onClick={() => setSelectedCategory(category)}
                className={`px-4 py-2 rounded-full whitespace-nowrap transition-all ${
                  selectedCategory === category
                    ? 'bg-blue-600 text-white'
                    : 'bg-card/50 backdrop-blur-xl border border-border/50 hover-elevate'
                }`}
                data-testid={`button-category-${category}`}
              >
                {category}
              </button>
            ))}
          </div>
        </div>

        <div className="p-4 grid grid-cols-2 gap-3">
          {filteredAssets.map((asset) => (
            <m.div
              key={asset.id}
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => setSelectedAsset(asset)}
              className="bg-card/50 backdrop-blur-xl rounded-2xl overflow-hidden border border-border/50 hover-elevate active-elevate-2 cursor-pointer"
              data-testid={`card-catalog-asset-${asset.id}`}
            >
              <div className="relative aspect-[3/4]">
                <img src={asset.image} alt={asset.name} className="w-full h-full object-cover" />
                {asset.isNew && (
                  <div className="absolute top-2 left-2 px-2 py-1 bg-green-500/90 backdrop-blur-xl rounded-full border border-green-400/50">
                    <span className="text-xs font-bold text-white">Новинка</span>
                  </div>
                )}
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(asset.id);
                  }}
                  className="absolute top-2 right-2 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                  data-testid={`button-favorite-catalog-${asset.id}`}
                >
                  <Heart className={`w-4 h-4 ${favorites.has(asset.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
                </button>
                <div className={`absolute bottom-2 left-2 px-2 py-1 ${asset.change24h >= 0 ? 'bg-green-500/90' : 'bg-red-500/90'} backdrop-blur-xl rounded-full border ${asset.change24h >= 0 ? 'border-green-400/50' : 'border-red-400/50'}`}>
                  <span className="text-xs font-bold text-white flex items-center gap-1">
                    {asset.change24h >= 0 ? <ArrowUpRight className="w-3 h-3" /> : <ArrowDownLeft className="w-3 h-3" />}
                    {Math.abs(asset.change24h)}%
                  </span>
                </div>
              </div>
              <div className="p-3">
                <h3 className="font-medium mb-1 line-clamp-1">{asset.name}</h3>
                <p className="text-xs text-muted-foreground mb-2">{asset.category}</p>
                <div className="flex items-center justify-between">
                  <span className="text-sm font-bold">{asset.price.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}</span>
                  <span className="text-xs text-muted-foreground">{asset.symbol}</span>
                </div>
              </div>
            </m.div>
          ))}
        </div>
      </div>
    );
  }

  if (activeTab === 'profile') {
    return (
      <div className="h-full overflow-y-auto">
        <div className="p-6 bg-card/80 backdrop-blur-xl border-b border-border/50">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-blue-600 to-cyan-600 rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-white" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Александр Иванов</h2>
              <p className="text-sm text-muted-foreground">+7 (999) 777-66-55</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-blue-500/10 backdrop-blur-xl rounded-xl border border-blue-400/30">
              <p className="text-sm text-muted-foreground mb-1">Баланс</p>
              <p className="text-2xl font-bold text-blue-600">{balance.toLocaleString('ru-RU', { style: 'currency', currency: 'RUB' })}</p>
            </div>
            <div className="p-4 bg-green-500/10 backdrop-blur-xl rounded-xl border border-green-400/30">
              <p className="text-sm text-muted-foreground mb-1">Доходность</p>
              <p className="text-2xl font-bold text-green-600">+{gainPercent}%</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-2">
          <button className="w-full p-4 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-history">
            <div className="flex items-center gap-3">
              <History className="w-5 h-5 text-muted-foreground" />
              <span className="font-medium">История операций</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-muted-foreground" />
          </button>

          <button className="w-full p-4 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-cards">
            <div className="flex items-center gap-3">
              <CreditCard className="w-5 h-5 text-muted-foreground" />
              <span className="font-medium">Мои карты</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-muted-foreground" />
          </button>

          <button className="w-full p-4 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-settings">
            <div className="flex items-center gap-3">
              <Settings className="w-5 h-5 text-muted-foreground" />
              <span className="font-medium">Настройки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-muted-foreground" />
          </button>
        </div>
      </div>
    );
  }

  return null;
});
```

### demos/Bookstore.tsx
```tsx
import { useState } from "react";
import { 
  BookOpen, 
  Heart, 
  Star, 
  Search, 
  Filter,
  Plus,
  Minus,
  X,
  ChevronRight,
  Award,
  Clock,
  User
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface BookstoreProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  quantity: number;
  image: string;
}

const books = [
  { id: 1, name: 'Атомные привычки', price: 18, image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Книга о том, как небольшие изменения приводят к значительным результатам', category: 'Саморазвитие', author: 'Джеймс Клир', pages: 320, year: 2018, rating: 4.8, language: 'Русский', inStock: 25 },
  { id: 2, name: 'Думай медленно... решай быстро', price: 22, image: 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Исследование того, как работает наше мышление', category: 'Психология', author: 'Даниэль Канеман', pages: 512, year: 2011, rating: 4.7, language: 'Русский', inStock: 18 },
  { id: 3, name: 'Гарри Поттер и философский камень', price: 15, image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Первая книга о юном волшебнике Гарри Поттере', category: 'Фэнтези', author: 'Дж.К. Роулинг', pages: 432, year: 1997, rating: 4.9, language: 'Русский', inStock: 30 },
  { id: 4, name: '1984', price: 16, image: 'https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Антиутопический роман о тоталитарном обществе', category: 'Классика', author: 'Джордж Оруэлл', pages: 328, year: 1949, rating: 4.8, language: 'Русский', inStock: 20 },
  { id: 5, name: 'Код да Винчи', price: 19, image: 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Захватывающий триллер о поисках святого Грааля', category: 'Триллер', author: 'Дэн Браун', pages: 592, year: 2003, rating: 4.5, language: 'Русский', inStock: 15 },
  { id: 6, name: 'Мастер и Маргарита', price: 17, image: 'https://images.unsplash.com/photo-1506880018603-83d5b814b5a6?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Классический роман Михаила Булгакова о добре и зле', category: 'Классика', author: 'Михаил Булгаков', pages: 480, year: 1967, rating: 4.9, language: 'Русский', inStock: 22 },
  { id: 7, name: 'Сто лет одиночества', price: 20, image: 'https://images.unsplash.com/photo-1541963463532-d68292c34d19?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Магический реализм от Гарсиа Маркеса', category: 'Классика', author: 'Габриэль Гарсиа Маркес', pages: 512, year: 1967, rating: 4.6, language: 'Русский', inStock: 12 },
  { id: 8, name: 'Искусство войны', price: 14, image: 'https://images.unsplash.com/photo-1589829545856-d10d557cf95f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Древний трактат о военной стратегии и тактике', category: 'Философия', author: 'Сунь-цзы', pages: 256, year: -500, rating: 4.7, language: 'Русский', inStock: 28 },
  { id: 9, name: 'Автостопом по галактике', price: 16, image: 'https://images.unsplash.com/photo-1519682337058-a94d519337bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Юмористическая научная фантастика', category: 'Научная фантастика', author: 'Дуглас Адамс', pages: 224, year: 1979, rating: 4.5, language: 'Русский', inStock: 16 },
  { id: 10, name: 'Отцы и дети', price: 13, image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Классический роман о конфликте поколений', category: 'Классика', author: 'Иван Тургенев', pages: 384, year: 1862, rating: 4.4, language: 'Русский', inStock: 24 },
  { id: 11, name: 'Краткая история времени', price: 21, image: 'https://images.unsplash.com/photo-1532012197267-da84d127e765?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Популярно о физике и космологии', category: 'Наука', author: 'Стивен Хокинг', pages: 256, year: 1988, rating: 4.6, language: 'Русский', inStock: 14 },
  { id: 12, name: 'Преступление и наказание', price: 18, image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Психологический роман Достоевского', category: 'Классика', author: 'Федор Достоевский', pages: 672, year: 1866, rating: 4.8, language: 'Русский', inStock: 19 },
  { id: 13, name: 'Шерлок Холмс: Этюд в багровых тонах', price: 15, image: 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Первое приключение великого сыщика', category: 'Детектив', author: 'Артур Конан Дойл', pages: 192, year: 1887, rating: 4.7, language: 'Русский', inStock: 26 },
  { id: 14, name: 'Дюна', price: 23, image: 'https://images.unsplash.com/photo-1519682337058-a94d519337bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Эпическая научно-фантастическая сага', category: 'Научная фантастика', author: 'Фрэнк Герберт', pages: 688, year: 1965, rating: 4.9, language: 'Русский', inStock: 11 },
  { id: 15, name: 'Властелин колец: Братство кольца', price: 24, image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Первая часть эпической фэнтези трилогии', category: 'Фэнтези', author: 'Дж.Р.Р. Толкин', pages: 576, year: 1954, rating: 4.9, language: 'Русский', inStock: 17 },
  { id: 16, name: 'Как завоевывать друзей и оказывать влияние на людей', price: 19, image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Классическое пособие по общению и лидерству', category: 'Саморазвитие', author: 'Дейл Карнеги', pages: 352, year: 1936, rating: 4.5, language: 'Русский', inStock: 21 },
  { id: 17, name: 'Убить пересмешника', price: 17, image: 'https://images.unsplash.com/photo-1512820790803-83ca734da794?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Роман о расовой несправедливости и морали', category: 'Классика', author: 'Харпер Ли', pages: 376, year: 1960, rating: 4.8, language: 'Русский', inStock: 13 },
  { id: 18, name: 'Маленький принц', price: 12, image: 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Философская сказка о дружбе и любви', category: 'Классика', author: 'Антуан де Сент-Экзюпери', pages: 128, year: 1943, rating: 4.7, language: 'Русский', inStock: 35 },
  { id: 19, name: 'Три товарища', price: 20, image: 'https://images.unsplash.com/photo-1506880018603-83d5b814b5a6?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Роман о дружбе в послевоенной Германии', category: 'Классика', author: 'Эрих Мария Ремарк', pages: 448, year: 1936, rating: 4.6, language: 'Русский', inStock: 18 },
  { id: 20, name: 'Старик и море', price: 14, image: 'https://images.unsplash.com/photo-1541963463532-d68292c34d19?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Повесть о старом рыбаке и его борьбе с жизнью', category: 'Классика', author: 'Эрнест Хемингуэй', pages: 112, year: 1952, rating: 4.5, language: 'Русский', inStock: 27 }
];

const categories = ['Все', 'Классика', 'Саморазвитие', 'Фэнтези', 'Научная фантастика', 'Психология', 'Триллер', 'Детектив', 'Философия', 'Наука'];

const initialCartItems: CartItem[] = [
  { id: 3, name: 'Гарри Поттер и философский камень', price: 15, quantity: 1, image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60' },
  { id: 1, name: 'Атомные привычки', price: 18, quantity: 1, image: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60' },
];

export default function Bookstore({ activeTab }: BookstoreProps) {
  const [selectedBook, setSelectedBook] = useState<typeof books[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [cartItems, setCartItems] = useState<CartItem[]>(initialCartItems);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([3, 6, 14, 15]);
  const [searchQuery, setSearchQuery] = useState('');

  const openBookModal = (book: typeof books[0]) => {
    setSelectedBook(book);
    setIsModalOpen(true);
  };

  const closeBookModal = () => {
    setIsModalOpen(false);
    setSelectedBook(null);
  };

  const updateQuantity = (itemId: number, newQuantity: number) => {
    if (newQuantity < 1) return;
    setCartItems(prev => 
      prev.map(item => 
        item.id === itemId ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const removeFromCart = (itemId: number) => {
    setCartItems(prev => prev.filter(item => item.id !== itemId));
  };

  const toggleFavorite = (bookId: number) => {
    setFavorites(prev => 
      prev.includes(bookId) 
        ? prev.filter(id => id !== bookId)
        : [...prev, bookId]
    );
  };

  const filteredBooks = books.filter(book => {
    const matchesCategory = selectedCategory === 'Все' || book.category === selectedCategory;
    const matchesSearch = searchQuery === '' || 
      book.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
      book.author.toLowerCase().includes(searchQuery.toLowerCase()) ||
      book.description.toLowerCase().includes(searchQuery.toLowerCase());
    
    return matchesCategory && matchesSearch;
  });

  const cartTotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: books.slice(0, 6).map(item => item.image),
    priority: true
  });


  const renderHomeTab = () => (
    <div className="max-w-md mx-auto px-4 space-y-6">
      {/* Заголовок */}
      <div className="text-center">
        <h1 className="ios-title font-bold mb-2">Книжный Уголок</h1>
        <p className="ios-subheadline text-secondary-label">Мир знаний в каждой книге 📚</p>
      </div>

      {/* Рекомендация дня */}
      <div className="ios-card p-4 bg-gradient-to-r from-purple-500 to-indigo-500 text-white">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="ios-headline font-semibold">Книга дня</h3>
            <p className="ios-body">Атомные привычки - скидка 20%</p>
          </div>
          <Award className="w-8 h-8" />
        </div>
      </div>

      {/* Популярные категории */}
      <div>
        <h2 className="ios-title font-semibold mb-4">Популярные категории</h2>
        <div className="grid grid-cols-2 gap-3">
          {[
            { name: 'Классика', count: '8 книг', color: 'bg-purple-500' },
            { name: 'Саморазвитие', count: '3 книги', color: 'bg-green-500' },
            { name: 'Фэнтези', count: '2 книги', color: 'bg-blue-500' },
            { name: 'Научная фантастика', count: '2 книги', color: 'bg-red-500' }
          ].map((category) => (
            <div 
              key={category.name} 
              className="ios-card p-3 cursor-pointer"
              onClick={() => setSelectedCategory(category.name)}
            >
              <div className={`w-full h-16 ${category.color} rounded-lg mb-2 flex items-center justify-center`}>
                <BookOpen className="w-8 h-8 text-white" />
              </div>
              <h4 className="ios-footnote font-semibold">{category.name}</h4>
              <p className="ios-caption2 text-secondary-label">{category.count}</p>
            </div>
          ))}
        </div>
      </div>

      {/* Бестселлеры */}
      <div>
        <h2 className="ios-title font-semibold mb-4">Бестселлеры недели</h2>
        <div className="space-y-3">
          {books.slice(0, 3).map((book, index) => (
            <div 
              key={book.id} 
              className="ios-card p-3 cursor-pointer flex items-center space-x-3"
              onClick={() => openBookModal(book)}
            >
              <div className="flex-shrink-0 w-8 h-8 bg-system-purple rounded-full flex items-center justify-center">
                <span className="ios-footnote font-bold text-white">{index + 1}</span>
              </div>
              <OptimizedImage src={book.image} alt={book.name} className="w-20 h-20 object-cover rounded" />
              <div className="flex-1">
                <h4 className="ios-body font-semibold line-clamp-1">{book.name}</h4>
                <p className="ios-footnote text-secondary-label">{book.author}</p>
                <div className="flex items-center space-x-2">
                  <div className="flex items-center space-x-1">
                    <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                    <span className="ios-caption2">{book.rating}</span>
                  </div>
                  <span className="ios-caption font-bold text-system-purple">${book.price}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Информация о магазине */}
      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">О нашем магазине</h3>
        <div className="space-y-2">
          <div className="flex items-center space-x-2">
            <BookOpen className="w-4 h-4 text-system-purple" />
            <span className="ios-body">Более 10,000 книг в наличии</span>
          </div>
          <div className="flex items-center space-x-2">
            <Clock className="w-4 h-4 text-system-purple" />
            <span className="ios-body">Быстрая доставка за 1-2 дня</span>
          </div>
          <div className="flex items-center space-x-2">
            <Award className="w-4 h-4 text-system-purple" />
            <span className="ios-body">Лучший книжный магазин 2024</span>
          </div>
        </div>
      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Каталог книг</h1>
      
      {/* Поиск */}
      <div className="relative">
        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-secondary-label" />
        <input
          type="text"
          placeholder="Поиск по названию или автору..."
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
          className="w-full pl-10 pr-4 py-3 bg-quaternary-system-fill rounded-xl ios-body"
        />
      </div>

      {/* Категории */}
      <div className="flex space-x-2 overflow-x-auto pb-2">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setSelectedCategory(category)}
            className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
              selectedCategory === category
                ? 'bg-system-purple text-white'
                : 'bg-quaternary-system-fill text-label'
            }`}
          >
            {category}
          </button>
        ))}
      </div>

      {/* Список книг */}
      <div className="space-y-3">
        {filteredBooks.map((book) => (
          <div 
            key={book.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openBookModal(book)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage src={book.image} alt={book.name} className="w-20 h-20 object-cover rounded" />
              <div className="flex-1">
                <div className="flex items-center justify-between mb-1">
                  <h4 className="ios-body font-semibold line-clamp-1">{book.name}</h4>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(book.id);
                    }}
                    className="p-1"
                  >
                    <Heart 
                      className={`w-4 h-4 ${
                        favorites.includes(book.id) 
                          ? 'fill-red-500 text-red-500' 
                          : 'text-secondary-label'
                      }`} 
                    />
                  </button>
                </div>
                <p className="ios-footnote text-secondary-label mb-1">{book.author}</p>
                <p className="ios-caption2 text-tertiary-label mb-2 line-clamp-2">{book.description}</p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <span className="ios-caption2 px-2 py-1 bg-quaternary-system-fill rounded">{book.category}</span>
                    <div className="flex items-center space-x-1">
                      <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                      <span className="ios-caption2">{book.rating}</span>
                    </div>
                    <span className="ios-caption2 text-secondary-label">{book.pages} стр.</span>
                  </div>
                  <span className="ios-body font-bold text-system-purple">${book.price}</span>
                </div>
              </div>
            </div>
          </div>
        ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Корзина</h1>
      
      {cartItems.length === 0 ? (
        <div className="text-center py-12">
          <BookOpen className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
          <p className="ios-body text-secondary-label">Корзина пуста</p>
          <p className="ios-footnote text-tertiary-label">Добавьте книги из каталога</p>
        </div>
      ) : (
        <>
          <div className="space-y-3">
            {cartItems.map((item) => (
              <div key={item.id} className="ios-card p-4">
                <div className="flex items-center space-x-3">
                  <OptimizedImage src={item.image} alt={item.name} className="w-20 h-20 object-cover rounded" />
                  <div className="flex-1">
                    <h4 className="ios-body font-semibold">{item.name}</h4>
                    <p className="ios-footnote text-secondary-label">${item.price} за книгу</p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <button
                      onClick={() => updateQuantity(item.id, item.quantity - 1)}
                      className="w-8 h-8 rounded-full bg-quaternary-system-fill flex items-center justify-center"
                    >
                      <Minus className="w-4 h-4" />
                    </button>
                    <span className="ios-body font-semibold w-8 text-center">{item.quantity}</span>
                    <button
                      onClick={() => updateQuantity(item.id, item.quantity + 1)}
                      className="w-8 h-8 rounded-full bg-system-purple text-white flex items-center justify-center"
                    >
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                  <div className="text-right">
                    <p className="ios-body font-bold">${(item.price * item.quantity).toFixed(2)}</p>
                    <button
                      onClick={() => removeFromCart(item.id)}
                      className="ios-footnote text-system-red"
                    >
                      Удалить
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div className="ios-card p-4 space-y-3">
            <div className="flex justify-between items-center">
              <span className="ios-body">Подытог:</span>
              <span className="ios-body font-semibold">${cartTotal.toFixed(2)}</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="ios-body">Доставка:</span>
              <span className="ios-body font-semibold">$3.99</span>
            </div>
            <hr className="border-separator" />
            <div className="flex justify-between items-center">
              <span className="ios-headline font-bold">Итого:</span>
              <span className="ios-headline font-bold text-system-purple">${(cartTotal + 3.99).toFixed(2)}</span>
            </div>
            
            <button className="w-full bg-system-purple text-white ios-body font-semibold py-3 rounded-xl">
              Оформить заказ
            </button>
          </div>
        </>
      )}
    </div>
  );

  const renderProfileTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Профиль читателя</h1>
      
      <div className="ios-card p-4">
        <div className="flex items-center space-x-3 mb-4">
          <div className="w-16 h-16 bg-system-purple rounded-full flex items-center justify-center">
            <span className="ios-title font-bold text-white">КУ</span>
          </div>
          <div>
            <h3 className="ios-headline font-semibold">Книголюб</h3>
            <p className="ios-body text-secondary-label">Активный читатель</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center">
            <p className="ios-title font-bold text-system-purple">87</p>
            <p className="ios-footnote text-secondary-label">Прочитано</p>
          </div>
          <div className="text-center">
            <p className="ios-title font-bold text-system-green">23</p>
            <p className="ios-footnote text-secondary-label">В планах</p>
          </div>
        </div>
      </div>

      <div className="space-y-3">
        <h2 className="ios-headline font-semibold">Избранные книги</h2>
        {books.filter(book => favorites.includes(book.id)).map((book) => (
          <div key={book.id} className="ios-card p-3 flex items-center space-x-3">
            <OptimizedImage src={book.image} alt={book.name} className="w-20 h-20 object-cover rounded" />
            <div className="flex-1">
              <h4 className="ios-body font-semibold line-clamp-1">{book.name}</h4>
              <p className="ios-footnote text-secondary-label">{book.author} • ${book.price}</p>
            </div>
            <ChevronRight className="w-5 h-5 text-tertiary-label" />
          </div>
        ))}
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Статистика чтения</h3>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="ios-body">Любимый жанр:</span>
            <span className="ios-body font-medium">Классика</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Прочитано в этом году:</span>
            <span className="ios-body font-medium">24 книги</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Потрачено на книги:</span>
            <span className="ios-body font-medium text-system-purple">$1,456</span>
          </div>
        </div>
      </div>
    </div>
  );

  return (
    <div className="h-full flex flex-col bg-system-background">
      <div className="flex-1 overflow-y-auto p-4">
        {activeTab === 'home' && renderHomeTab()}
        {activeTab === 'catalog' && renderCatalogTab()}
        {activeTab === 'cart' && renderCartTab()}
        {activeTab === 'profile' && renderProfileTab()}
      </div>

      {/* Модальное окно */}
      {isModalOpen && selectedBook && (
        <div className="fixed inset-0 bg-black/50 flex items-end z-50">
          <div className="bg-system-background max-w-md mx-auto w-full rounded-t-3xl p-6 space-y-4 max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-start">
              <h3 className="ios-title font-bold line-clamp-2">{selectedBook.name}</h3>
              <button onClick={closeBookModal}>
                <X className="w-6 h-6 text-secondary-label" />
              </button>
            </div>
            
            <div className="flex space-x-4">
              <OptimizedImage src={selectedBook.image} alt={selectedBook.name} className="w-24 h-32 object-cover rounded-lg" />
              <div className="flex-1 space-y-2">
                <div className="flex items-center space-x-1">
                  <User className="w-4 h-4 text-secondary-label" />
                  <span className="ios-body font-medium">{selectedBook.author}</span>
                </div>
                <div className="flex items-center space-x-1">
                  <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                  <span className="ios-body">{selectedBook.rating} • {selectedBook.year} год</span>
                </div>
                <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-quaternary-system-fill text-label">
                  {selectedBook.category}
                </span>
              </div>
            </div>
            
            <div className="space-y-3">
              <p className="ios-body text-secondary-label">{selectedBook.description}</p>
              
              <div className="grid grid-cols-2 gap-4 ios-card p-3">
                <div className="text-center">
                  <p className="ios-caption2 text-secondary-label">Страниц</p>
                  <p className="ios-body font-semibold">{selectedBook.pages}</p>
                </div>
                <div className="text-center">
                  <p className="ios-caption2 text-secondary-label">Язык</p>
                  <p className="ios-body font-semibold">{selectedBook.language}</p>
                </div>
              </div>
              
              <div className="flex items-center justify-between">
                <span className="ios-title font-bold text-system-purple">${selectedBook.price}</span>
                <span className="ios-footnote text-secondary-label">
                  В наличии: {selectedBook.inStock} шт.
                </span>
              </div>
              
              <button className="w-full bg-system-purple text-white ios-body font-semibold py-3 rounded-xl">
                В корзину
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}```

### demos/CarRental.tsx
```tsx
import React, { useState } from 'react';
import {
  Car,
  Fuel,
  Users,
  Calendar,
  Clock,
  Star,
  Key,
  Shield,
  Navigation,
  Settings,
  Plus,
  MapPin,
  CreditCard
} from 'lucide-react';
import { OptimizedImage } from "../OptimizedImage";

interface CarRentalProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
  onNavigate: (tab: string) => void;
}

interface Vehicle {
  id: number;
  name: string;
  brand: string;
  type: string;
  price: number;
  fuelType: string;
  seats: number;
  transmission: string;
  rating: number;
  image: string;
  available: boolean;
  features: string[];
}

interface CartItem extends Vehicle {
  quantity: number;
  rentalDays: number;
  pickupDate: string;
}

const vehicles: Vehicle[] = [
  {
    id: 1,
    name: 'BMW X5',
    brand: 'BMW',
    type: 'SUV',
    price: 120,
    fuelType: 'Бензин',
    seats: 7,
    transmission: 'Автомат',
    rating: 4.9,
    image: 'https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=500&fit=crop&crop=center',
    available: true,
    features: ['GPS', 'Кондиционер', 'Bluetooth', 'Камера']
  },
  {
    id: 2,
    name: 'Mercedes-Benz E-Class',
    brand: 'Mercedes',
    type: 'Седан',
    price: 100,
    fuelType: 'Бензин',
    seats: 5,
    transmission: 'Автомат',
    rating: 4.8,
    image: 'https://images.unsplash.com/photo-1563720223185-11003d516935?w=800&h=500&fit=crop&crop=center',
    available: true,
    features: ['GPS', 'Кожа', 'Люк', 'Premium Audio']
  },
  {
    id: 3,
    name: 'Tesla Model S',
    brand: 'Tesla',
    type: 'Электро',
    price: 150,
    fuelType: 'Электро',
    seats: 5,
    transmission: 'Автомат',
    rating: 4.7,
    image: 'https://images.unsplash.com/photo-1560958089-b8a1929cea89?w=800&h=500&fit=crop&crop=center',
    available: true,
    features: ['Автопилот', 'Быстрая зарядка', 'Premium Interior', 'OTA Updates']
  },
  {
    id: 4,
    name: 'Toyota Camry',
    brand: 'Toyota',
    type: 'Седан',
    price: 70,
    fuelType: 'Гибрид',
    seats: 5,
    transmission: 'Автомат',
    rating: 4.6,
    image: 'https://images.unsplash.com/photo-1619767886558-efdc259cde1a?w=800&h=500&fit=crop&crop=center',
    available: true,
    features: ['Экономичный', 'Надежный', 'Комфортный', 'Безопасный']
  }
];

const categories = ['Все', 'Седан', 'SUV', 'Электро', 'Гибрид'];

export default function CarRental({ activeTab, onNavigate }: CarRentalProps) {
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [cartItems, setCartItems] = useState<CartItem[]>([]);
  const [selectedVehicle, setSelectedVehicle] = useState<Vehicle | null>(null);

  const filteredVehicles = selectedCategory === 'Все' 
    ? vehicles 
    : vehicles.filter(vehicle => vehicle.type === selectedCategory || vehicle.fuelType === selectedCategory);

  const addToCart = (vehicle: Vehicle) => {
    const existingItem = cartItems.find(item => item.id === vehicle.id);
    if (existingItem) {
      setCartItems(prev => 
        prev.map(item => 
          item.id === vehicle.id ? { ...item, quantity: item.quantity + 1 } : item
        )
      );
    } else {
      setCartItems(prev => [...prev, { ...vehicle, quantity: 1, rentalDays: 1, pickupDate: 'Завтра' }]);
    }
  };

  const removeFromCart = (vehicleId: number) => {
    setCartItems(prev => prev.filter(item => item.id !== vehicleId));
  };

  const updateQuantity = (vehicleId: number, newQuantity: number) => {
    if (newQuantity === 0) {
      removeFromCart(vehicleId);
      return;
    }
    setCartItems(prev => 
      prev.map(item => 
        item.id === vehicleId ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const openVehicleModal = (vehicle: Vehicle) => {
    setSelectedVehicle(vehicle);
  };

  const closeVehicleModal = () => {
    setSelectedVehicle(null);
  };

  const cartTotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity * item.rentalDays), 0);

  const renderHomeTab = () => (
    <div className="min-h-screen bg-red-50 font-montserrat">
      <div className="max-w-md mx-auto">
        
        {/* Car Rental Header */}
        <div className="px-6 pt-20 pb-16 text-center">
          <div className="w-12 h-12 bg-red-600 rounded-xl flex items-center justify-center mx-auto mb-8">
            <Car className="w-6 h-6 text-white" />
          </div>
          <h1 className="text-2xl font-semibold text-red-900 mb-3 tracking-wide">DriveNow</h1>
          <p className="text-red-600 text-sm font-medium">Premium Car Rental Service</p>
        </div>

        {/* Hero Car Rental Section */}
        <div className="px-6 pb-20">
          <div className="aspect-[16/10] rounded-2xl overflow-hidden bg-red-100 mb-12 relative">
            <OptimizedImage 
              src="https://images.unsplash.com/photo-1549317661-bd32c8ce0db2?w=800&h=500&fit=crop&crop=center" 
              alt="Premium Car Rental"
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-red-900/80 via-red-900/40 to-transparent" />
            <div className="absolute bottom-6 left-6 right-6 text-white">
              <h2 className="text-xl font-semibold mb-2">Drive Your Dreams</h2>
              <p className="text-white/80 text-sm mb-4">Premium vehicles for every journey</p>
              <button 
                className="bg-white text-red-900 px-6 py-2 rounded-lg text-sm font-medium hover:bg-red-50 transition-colors"
                onClick={() => openVehicleModal(vehicles[0])}
              >
                Book Now
              </button>
            </div>
          </div>
        </div>

        {/* Car Rental Stats */}
        <div className="px-6 py-20 border-t border-red-200">
          <div className="text-center mb-16">
            <h3 className="text-lg font-semibold text-red-900 mb-4">Premium Car Rental</h3>
            <p className="text-red-600 text-sm font-medium leading-relaxed">
              Luxury vehicles with comprehensive insurance and 24/7 roadside assistance.
            </p>
          </div>
          
          <div className="grid grid-cols-2 gap-12 text-center">
            {[
              { number: '200+', label: 'Vehicles' },
              { number: '50K+', label: 'Customers' },
              { number: '24/7', label: 'Support' },
              { number: '99%', label: 'Satisfaction' }
            ].map((stat, index) => (
              <div key={index}>
                <div className="text-2xl font-bold text-red-600 mb-1">{stat.number}</div>
                <div className="text-red-500 text-xs font-medium">{stat.label}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Featured Vehicles */}
        <div className="px-6 py-20 border-t border-red-200">
          <div className="flex items-center justify-between mb-12">
            <h3 className="text-lg font-semibold text-red-900">Popular Cars</h3>
            <button 
              className="text-red-500 text-sm font-medium hover:text-red-600 transition-colors"
              onClick={() => setSelectedCategory('Все')}
            >
              View all
            </button>
          </div>
          
          <div className="space-y-12">
            {vehicles.slice(0, 2).map((vehicle, index) => (
              <div 
                key={vehicle.id} 
                className="group cursor-pointer"
                onClick={() => openVehicleModal(vehicle)}
              >
                <div className="aspect-[5/3] rounded-xl overflow-hidden bg-red-100 mb-6 relative">
                  <OptimizedImage 
                    src={vehicle.image}
                    alt={vehicle.name}
                    className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                  />
                  <div className="absolute top-3 left-3 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded">
                    {vehicle.type}
                  </div>
                  <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm text-red-900 text-xs font-medium px-2 py-1 rounded flex items-center space-x-1">
                    <Star className="w-3 h-3 text-red-500 fill-current" />
                    <span>{vehicle.rating}</span>
                  </div>
                </div>
                <div className="space-y-3">
                  <div className="flex items-start justify-between">
                    <div>
                      <h4 className="text-red-900 font-semibold text-base">{vehicle.name}</h4>
                      <p className="text-red-500 text-sm font-medium">{vehicle.brand} • {vehicle.seats} мест</p>
                    </div>
                    <div className="text-right">
                      <p className="text-red-900 font-semibold">${vehicle.price}/день</p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Автомобили в аренду</h1>
      
      {/* Categories */}
      <div className="flex space-x-2 overflow-x-auto pb-2">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setSelectedCategory(category)}
            className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
              selectedCategory === category
                ? 'bg-system-red text-white'
                : 'bg-quaternary-system-fill text-label'
            }`}
          >
            {category}
          </button>
        ))}
      </div>

      {/* Vehicles List */}
      <div className="space-y-3">
        {filteredVehicles.map((vehicle) => (
          <div 
            key={vehicle.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openVehicleModal(vehicle)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage
                src={vehicle.image}
                alt={vehicle.name}
                className="w-20 h-20 rounded-lg object-cover"
              />
              <div className="flex-1">
                <h4 className="ios-body font-semibold">{vehicle.name}</h4>
                <p className="ios-footnote text-secondary-label">{vehicle.brand} • {vehicle.transmission}</p>
                <div className="flex items-center space-x-2 mt-1">
                  <div className="flex items-center space-x-1">
                    <Users className="w-3 h-3 text-secondary-label" />
                    <span className="ios-caption2">{vehicle.seats}</span>
                  </div>
                  <div className="flex items-center space-x-1">
                    <Fuel className="w-3 h-3 text-secondary-label" />
                    <span className="ios-caption2">{vehicle.fuelType}</span>
                  </div>
                </div>
              </div>
              <div className="text-right">
                <p className="ios-body font-bold text-system-red">${vehicle.price}/день</p>
                <div className="flex items-center space-x-1 mt-1">
                  <div className={`w-2 h-2 rounded-full ${vehicle.available ? 'bg-system-green' : 'bg-system-red'}`}></div>
                  <span className="ios-caption2">{vehicle.available ? 'Доступен' : 'Занят'}</span>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Корзина аренды</h1>
        
        {cartItems.length === 0 ? (
          <div className="text-center py-12">
            <Car className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
            <h2 className="ios-title font-semibold text-secondary-label mb-2">Корзина пуста</h2>
            <p className="ios-body text-tertiary-label">Выберите автомобиль для аренды</p>
          </div>
        ) : (
          <>
            <div className="space-y-3">
              {cartItems.map((item) => (
                <div key={item.id} className="ios-card p-4">
                  <div className="flex items-center space-x-3">
                    <OptimizedImage
                      src={item.image}
                      alt={item.name}
                      className="w-20 h-20 rounded-lg object-cover"
                    />
                    <div className="flex-1">
                      <h4 className="ios-body font-semibold">{item.name}</h4>
                      <p className="ios-footnote text-secondary-label">{item.brand}</p>
                      <p className="ios-caption2 text-system-red">${item.price}/день × {item.rentalDays} дней</p>
                    </div>
                    <div className="flex items-center space-x-2">
                      <button
                        onClick={() => updateQuantity(item.id, item.quantity - 1)}
                        className="w-8 h-8 rounded-full bg-quaternary-system-fill flex items-center justify-center"
                      >
                        <span className="text-lg font-medium">-</span>
                      </button>
                      <span className="ios-body font-semibold w-8 text-center">{item.quantity}</span>
                      <button
                        onClick={() => updateQuantity(item.id, item.quantity + 1)}
                        className="w-8 h-8 rounded-full bg-system-red flex items-center justify-center"
                      >
                        <Plus className="w-4 h-4 text-white" />
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
            
            <div className="ios-card p-4">
              <div className="flex justify-between items-center">
                <span className="ios-headline font-semibold">Итого</span>
                <span className="ios-headline font-bold text-system-red">${cartTotal}</span>
              </div>
              <button className="w-full bg-system-red text-white ios-body font-semibold py-3 rounded-xl mt-4">
                Оформить аренду
              </button>
            </div>
          </>
        )}
      </div>
    </div>
  );

  const renderProfileTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Профиль водителя</h1>
        
        <div className="ios-card p-6 text-center">
          <div className="w-20 h-20 bg-system-red rounded-full flex items-center justify-center mx-auto mb-4">
            <Key className="w-10 h-10 text-white" />
          </div>
          <h2 className="ios-headline font-semibold mb-1">Алексей Морозов</h2>
          <p className="ios-footnote text-secondary-label">Проверенный водитель</p>
        </div>

        <div className="space-y-1">
          <div className="ios-list-item">
            <Car className="w-5 h-5 text-system-red" />
            <span className="ios-body">История аренды</span>
          </div>
          <div className="ios-list-item">
            <CreditCard className="w-5 h-5 text-system-blue" />
            <span className="ios-body">Способы оплаты</span>
          </div>
          <div className="ios-list-item">
            <Shield className="w-5 h-5 text-system-green" />
            <span className="ios-body">Водительские права</span>
          </div>
        </div>
      </div>
    </div>
  );

  // Vehicle Modal
  if (selectedVehicle) {
    return (
      <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
          <div className="relative">
            <OptimizedImage
              src={selectedVehicle.image}
              alt={selectedVehicle.name}
              className="w-full h-48 object-cover rounded-t-2xl"
            />
            <button
              onClick={closeVehicleModal}
              className="absolute top-4 right-4 w-8 h-8 bg-black/20 rounded-full flex items-center justify-center text-white"
            >
              ×
            </button>
          </div>
          
          <div className="p-6 space-y-4">
            <div>
              <h2 className="ios-title font-bold mb-2">{selectedVehicle.name}</h2>
              <p className="ios-body text-secondary-label">{selectedVehicle.brand}</p>
            </div>
            
            <div className="flex items-center space-x-4">
              <div className="flex items-center space-x-1">
                <Star className="w-4 h-4 text-system-orange" />
                <span className="ios-body">{selectedVehicle.rating}</span>
              </div>
              <div className="flex items-center space-x-1">
                <Users className="w-4 h-4 text-system-blue" />
                <span className="ios-body">{selectedVehicle.seats} мест</span>
              </div>
            </div>
            
            <div className="grid grid-cols-2 gap-4 py-3 border-t border-separator">
              <div className="text-center">
                <Fuel className="w-5 h-5 text-secondary-label mx-auto mb-1" />
                <span className="ios-footnote">{selectedVehicle.fuelType}</span>
              </div>
              <div className="text-center">
                <Settings className="w-5 h-5 text-secondary-label mx-auto mb-1" />
                <span className="ios-footnote">{selectedVehicle.transmission}</span>
              </div>
            </div>
            
            <div className="space-y-2">
              <h3 className="ios-body font-semibold">Особенности:</h3>
              {selectedVehicle.features.map((feature, index) => (
                <div key={index} className="flex items-center space-x-2">
                  <div className="w-1.5 h-1.5 bg-system-red rounded-full"></div>
                  <span className="ios-footnote">{feature}</span>
                </div>
              ))}
            </div>
            
            <div className="flex items-center justify-between py-4 border-t border-separator">
              <span className="ios-headline font-semibold">${selectedVehicle.price}/день</span>
              <button
                onClick={() => {
                  addToCart(selectedVehicle);
                  closeVehicleModal();
                }}
                className="bg-system-red text-white px-6 py-2 rounded-xl ios-body font-semibold"
              >
                Арендовать
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  switch (activeTab) {
    case 'catalog':
      return renderCatalogTab();
    case 'cart':
      return renderCartTab();
    case 'profile':
      return renderProfileTab();
    default:
      return renderHomeTab();
  }
}```

### demos/CarWash.tsx
```tsx
import { useState } from "react";
import { 
  Car, 
  Heart,
  Clock, 
  Star, 
  MapPin, 
  Calendar,
  Plus,
  Minus,
  X,
  ChevronRight,
  Droplets,
  Shield,
  Sparkles,
  Check
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface CarWashProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Booking {
  id: number;
  serviceName: string;
  date: string;
  time: string;
  duration: string;
  price: number;
  status: 'Подтверждено' | 'В работе' | 'Завершено';
}

const services = [
  { id: 1, name: 'Экспресс мойка', price: 15, image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Быстрая наружная мойка кузова и колес', category: 'Базовые услуги', duration: '20 мин', includes: ['Мойка кузова', 'Мойка колес', 'Сушка'], rating: 4.5, popular: true },
  { id: 2, name: 'Стандартная мойка', price: 25, image: 'https://images.unsplash.com/photo-1607616053700-a2d4c9d39c91?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Полная мойка снаружи и пылесос салона', category: 'Базовые услуги', duration: '35 мин', includes: ['Мойка кузова', 'Мойка колес', 'Пылесос салона', 'Протирка панели'], rating: 4.7, popular: true },
  { id: 3, name: 'Комплексная мойка', price: 40, image: 'https://images.unsplash.com/photo-1590362891992-e2ffc2d1de20?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Полная мойка снаружи и внутри с уборкой салона', category: 'Базовые услуги', duration: '50 мин', includes: ['Мойка кузова', 'Мойка колес', 'Полная уборка салона', 'Чистка стекол'], rating: 4.8, popular: true },
  { id: 4, name: 'Мойка двигателя', price: 20, image: 'https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Профессиональная мойка двигателя с защитой электроники', category: 'Дополнительные услуги', duration: '25 мин', includes: ['Защита электроники', 'Мойка двигателя', 'Сушка'], rating: 4.6, popular: false },
  { id: 5, name: 'Воскование кузова', price: 35, image: 'https://images.unsplash.com/photo-1583472759196-02b0c3e1cd7b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Защитное воскование для блеска и защиты лакокрасочного покрытия', category: 'Защитные покрытия', duration: '40 мин', includes: ['Воскование кузова', 'Полировка', 'Защита ЛКП'], rating: 4.9, popular: false },
  { id: 6, name: 'Полировка фар', price: 30, image: 'https://images.unsplash.com/photo-1549317336-206569e8475c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Восстановление прозрачности и яркости фар', category: 'Детейлинг', duration: '30 мин', includes: ['Шлифовка фар', 'Полировка', 'Защитное покрытие'], rating: 4.7, popular: false },
  { id: 7, name: 'Химчистка салона', price: 60, image: 'https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Глубокая химчистка сидений, ковриков и обивки', category: 'Химчистка', duration: '90 мин', includes: ['Химчистка сидений', 'Чистка ковриков', 'Чистка обивки', 'Устранение запахов'], rating: 4.8, popular: true },
  { id: 8, name: 'Озонирование салона', price: 25, image: 'https://images.unsplash.com/photo-1551831961-59b2b121f833?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Дезинфекция и устранение неприятных запахов озоном', category: 'Дополнительные услуги', duration: '30 мин', includes: ['Обработка озоном', 'Дезинфекция', 'Устранение запахов'], rating: 4.5, popular: false },
  { id: 9, name: 'Керамическое покрытие', price: 150, image: 'https://images.unsplash.com/photo-1489824904134-891ab64532f1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Нанесение керамического покрытия для долговременной защиты', category: 'Защитные покрытия', duration: '180 мин', includes: ['Подготовка поверхности', 'Нанесение керамики', 'Полировка', 'Гарантия 2 года'], rating: 4.9, popular: false },
  { id: 10, name: 'Антидождь для стекол', price: 18, image: 'https://images.unsplash.com/photo-1595838541611-e76b73ed3a5c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Обработка стекол водоотталкивающим составом', category: 'Дополнительные услуги', duration: '15 мин', includes: ['Очистка стекол', 'Нанесение состава', 'Полировка'], rating: 4.4, popular: false },
  { id: 11, name: 'Полная полировка кузова', price: 120, image: 'https://images.unsplash.com/photo-1610647752706-3bb12232b3ab?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Профессиональная полировка всего кузова для устранения царапин', category: 'Детейлинг', duration: '150 мин', includes: ['Подготовка поверхности', 'Абразивная полировка', 'Финишная полировка', 'Защитное покрытие'], rating: 4.9, popular: false },
  { id: 12, name: 'Чернение резины и пластика', price: 22, image: 'https://images.unsplash.com/photo-1486831111037-f5e79b97fc26?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Восстановление цвета резиновых и пластиковых элементов', category: 'Детейлинг', duration: '25 мин', includes: ['Очистка поверхности', 'Нанесение состава', 'Полировка'], rating: 4.3, popular: false },
  { id: 13, name: 'Удаление битумных пятен', price: 28, image: 'https://images.unsplash.com/photo-1472851187339-7ece2e80e6a2?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Профессиональное удаление битума и дорожной смолы', category: 'Дополнительные услуги', duration: '35 мин', includes: ['Размягчение битума', 'Удаление пятен', 'Полировка участков'], rating: 4.6, popular: false },
  { id: 14, name: 'Мойка днища', price: 18, image: 'https://images.unsplash.com/photo-1544365638-0d97af0de1ed?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Мойка днища автомобиля от грязи и реагентов', category: 'Дополнительные услуги', duration: '20 мин', includes: ['Мойка днища', 'Удаление реагентов', 'Антикоррозийная обработка'], rating: 4.5, popular: false },
  { id: 15, name: 'Консервация на зиму', price: 45, image: 'https://images.unsplash.com/photo-1570471160066-f740de48f6b9?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Комплекс процедур для подготовки авто к зимнему сезону', category: 'Сезонные услуги', duration: '60 мин', includes: ['Антикоррозийная обработка', 'Защита кузова', 'Обработка замков'], rating: 4.7, popular: false },
  { id: 16, name: 'Подготовка к лету', price: 40, image: 'https://images.unsplash.com/photo-1609378778529-b9d7a3c6b29c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Комплекс услуг для подготовки автомобиля к летнему сезону', category: 'Сезонные услуги', duration: '55 мин', includes: ['Глубокая мойка', 'Кондиционирование салона', 'Защита от УФ'], rating: 4.6, popular: false },
  { id: 17, name: 'Экспресс детейлинг', price: 80, image: 'https://images.unsplash.com/photo-1550913114-f8ba46640c4b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Быстрый детейлинг для придания автомобилю выставочного вида', category: 'Детейлинг', duration: '75 мин', includes: ['Полная мойка', 'Воскование', 'Чистка салона', 'Чернение резины'], rating: 4.8, popular: true },
  { id: 18, name: 'Удаление наклеек', price: 15, image: 'https://images.unsplash.com/photo-1486831111037-f5e79b97fc26?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Профессиональное удаление наклеек без повреждения лакокрасочного покрытия', category: 'Дополнительные услуги', duration: '15 мин', includes: ['Размягчение клея', 'Удаление наклеек', 'Полировка поверхности'], rating: 4.2, popular: false },
  { id: 19, name: 'Антикоррозийная обработка', price: 55, image: 'https://images.unsplash.com/photo-1605515298946-d062f2598d5c?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Защитная обработка металлических элементов от коррозии', category: 'Защитные покрытия', duration: '70 мин', includes: ['Очистка поверхности', 'Нанесение состава', 'Защита скрытых полостей'], rating: 4.7, popular: false },
  { id: 20, name: 'VIP детейлинг', price: 200, image: 'https://images.unsplash.com/photo-1621135802920-133df7cabc62?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Полный комплекс премиум услуг для идеального состояния автомобиля', category: 'VIP услуги', duration: '240 мин', includes: ['Полная полировка', 'Керамическое покрытие', 'Химчистка салона', 'Озонирование', 'Защита всех поверхностей'], rating: 5.0, popular: true }
];

const categories = ['Все', 'Базовые услуги', 'Детейлинг', 'Химчистка', 'Защитные покрытия', 'Дополнительные услуги', 'Сезонные услуги', 'VIP услуги'];

const initialBookings: Booking[] = [
  { id: 1, serviceName: 'Стандартная мойка', date: 'Завтра', time: '10:00', duration: '35 мин', price: 25, status: 'Подтверждено' },
  { id: 2, serviceName: 'Химчистка салона', date: 'Пятница', time: '14:00', duration: '90 мин', price: 60, status: 'Подтверждено' },
];

export default function CarWash({ activeTab }: CarWashProps) {
  const [selectedService, setSelectedService] = useState<typeof services[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [bookings, setBookings] = useState<Booking[]>(initialBookings);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([3, 7, 17, 20]);

  const openServiceModal = (service: typeof services[0]) => {
    setSelectedService(service);
    setIsModalOpen(true);
  };

  const closeServiceModal = () => {
    setIsModalOpen(false);
    setSelectedService(null);
  };

  const toggleFavorite = (serviceId: number) => {
    setFavorites(prev => 
      prev.includes(serviceId) 
        ? prev.filter(id => id !== serviceId)
        : [...prev, serviceId]
    );
  };

  const filteredServices = selectedCategory === 'Все' 
    ? services 
    : services.filter(service => service.category === selectedCategory);

  const popularServices = services.filter(service => service.popular);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: services.slice(0, 6).map(item => item.image),
    priority: true
  });


  const renderHomeTab = () => (
    <div className="max-w-md mx-auto px-4 space-y-6">
      {/* Заголовок */}
      <div className="text-center">
        <h1 className="ios-title font-bold mb-2">Авто Блеск</h1>
        <p className="ios-subheadline text-secondary-label">Профессиональная автомойка 🚗</p>
      </div>

      {/* Быстрое бронирование */}
      <div className="ios-card p-4 bg-gradient-to-r from-orange-500 to-red-500 text-white">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="ios-headline font-semibold">Бронирование онлайн</h3>
            <p className="ios-body">Забронируйте время и приезжайте к назначенному часу</p>
          </div>
          <Calendar className="w-8 h-8" />
        </div>
      </div>

      {/* Популярные услуги */}
      <div>
        <h2 className="ios-title font-semibold mb-4">Популярные услуги</h2>
        <div className="grid grid-cols-2 gap-3">
          {popularServices.slice(0, 4).map((service) => (
            <div 
              key={service.id} 
              className="ios-card p-3 cursor-pointer"
              onClick={() => openServiceModal(service)}
            >
              <OptimizedImage src={service.image} alt={service.name} className="w-full h-32 object-cover rounded-lg mb-2" />
              <h4 className="ios-footnote font-semibold line-clamp-2">{service.name}</h4>
              <p className="ios-caption2 text-secondary-label mb-2">{service.duration}</p>
              <div className="flex items-center justify-between">
                <span className="ios-caption font-bold text-system-orange">${service.price}</span>
                <div className="flex items-center space-x-1">
                  <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                  <span className="ios-caption2">{service.rating}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Быстрые услуги */}
      <div>
        <h2 className="ios-title font-semibold mb-4">Экспресс услуги</h2>
        <div className="space-y-3">
          {services.filter(s => parseInt(s.duration) <= 30).slice(0, 3).map((service) => (
            <div 
              key={service.id} 
              className="ios-card p-3 cursor-pointer flex items-center space-x-3"
              onClick={() => openServiceModal(service)}
            >
              <OptimizedImage src={service.image} alt={service.name} className="w-20 h-20 object-cover rounded-lg" />
              <div className="flex-1">
                <h4 className="ios-body font-semibold">{service.name}</h4>
                <p className="ios-footnote text-secondary-label">{service.duration} • ${service.price}</p>
              </div>
              <ChevronRight className="w-5 h-5 text-tertiary-label" />
            </div>
          ))}
        </div>
      </div>

      {/* Информация о автомойке */}
      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Наши преимущества</h3>
        <div className="space-y-2">
          <div className="flex items-center space-x-2">
            <Clock className="w-4 h-4 text-system-orange" />
            <span className="ios-body">Работаем без выходных 8:00 - 22:00</span>
          </div>
          <div className="flex items-center space-x-2">
            <Shield className="w-4 h-4 text-system-orange" />
            <span className="ios-body">Гарантия качества на все услуги</span>
          </div>
          <div className="flex items-center space-x-2">
            <Sparkles className="w-4 h-4 text-system-orange" />
            <span className="ios-body">Профессиональная косметика и оборудование</span>
          </div>
        </div>
      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Каталог услуг</h1>
      
      {/* Категории */}
      <div className="flex space-x-2 overflow-x-auto pb-2">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setSelectedCategory(category)}
            className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
              selectedCategory === category
                ? 'bg-system-orange text-white'
                : 'bg-quaternary-system-fill text-label'
            }`}
          >
            {category}
          </button>
        ))}
      </div>

      {/* Список услуг */}
      <div className="space-y-3">
        {filteredServices.map((service) => (
          <div 
            key={service.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openServiceModal(service)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage src={service.image} alt={service.name} className="w-20 h-20 object-cover rounded-lg" />
              <div className="flex-1">
                <div className="flex items-center justify-between mb-1">
                  <h4 className="ios-body font-semibold">{service.name}</h4>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(service.id);
                    }}
                    className="p-1"
                  >
                    <Heart 
                      className={`w-4 h-4 ${
                        favorites.includes(service.id) 
                          ? 'fill-red-500 text-red-500' 
                          : 'text-secondary-label'
                      }`} 
                    />
                  </button>
                </div>
                <p className="ios-footnote text-secondary-label mb-2 line-clamp-2">{service.description}</p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <div className="flex items-center space-x-1">
                      <Clock className="w-4 h-4 text-secondary-label" />
                      <span className="ios-caption2">{service.duration}</span>
                    </div>
                    <div className="flex items-center space-x-1">
                      <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                      <span className="ios-caption2">{service.rating}</span>
                    </div>
                    {service.popular && (
                      <span className="px-2 py-1 rounded-full ios-caption2 font-semibold bg-system-orange/10 text-system-orange">
                        Популярно
                      </span>
                    )}
                  </div>
                  <span className="ios-body font-bold text-system-orange">${service.price}</span>
                </div>
              </div>
            </div>
          </div>
        ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Мои записи</h1>
      
      {bookings.length === 0 ? (
        <div className="text-center py-12">
          <Car className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
          <p className="ios-body text-secondary-label">Нет активных записей</p>
          <p className="ios-footnote text-tertiary-label">Забронируйте услугу из каталога</p>
        </div>
      ) : (
        <>
          <div className="space-y-3">
            {bookings.map((booking) => (
              <div key={booking.id} className="ios-card p-4">
                <div className="flex items-center justify-between mb-3">
                  <h4 className="ios-body font-semibold">{booking.serviceName}</h4>
                  <span className={`px-2 py-1 rounded-full ios-caption2 font-semibold ${
                    booking.status === 'Подтверждено' ? 'bg-green-100 text-green-700' :
                    booking.status === 'В работе' ? 'bg-orange-100 text-orange-700' :
                    'bg-blue-100 text-blue-700'
                  }`}>
                    {booking.status}
                  </span>
                </div>
                <div className="space-y-2">
                  <div className="flex items-center space-x-2">
                    <Calendar className="w-4 h-4 text-secondary-label" />
                    <span className="ios-footnote">{booking.date}, {booking.time}</span>
                  </div>
                  <div className="flex items-center space-x-2">
                    <Clock className="w-4 h-4 text-secondary-label" />
                    <span className="ios-footnote">Длительность: {booking.duration}</span>
                  </div>
                  <div className="flex items-center space-x-2">
                    <span className="ios-body font-bold text-system-orange">${booking.price}</span>
                  </div>
                </div>
                <div className="flex space-x-2 mt-3">
                  <button className="flex-1 bg-quaternary-system-fill text-label ios-footnote font-medium py-2 rounded-lg">
                    Перенести
                  </button>
                  <button className="flex-1 bg-system-red text-white ios-footnote font-medium py-2 rounded-lg">
                    Отменить
                  </button>
                </div>
              </div>
            ))}
          </div>

          <div className="ios-card p-4">
            <h3 className="ios-headline font-semibold mb-2">Итого записей: {bookings.length}</h3>
            <p className="ios-body text-secondary-label">Общая стоимость: ${bookings.reduce((sum, booking) => sum + booking.price, 0)}</p>
          </div>

          {/* Адрес автомойки */}
          <div className="ios-card p-4 bg-system-orange/5 border border-system-orange/20">
            <div className="flex items-center space-x-2 mb-2">
              <MapPin className="w-4 h-4 text-system-orange" />
              <span className="ios-body font-semibold text-system-orange">Как нас найти</span>
            </div>
            <p className="ios-footnote text-secondary-label">
              ул. Автомойщиков, 15 (рядом с заправкой Shell)
            </p>
            <p className="ios-footnote text-secondary-label">
              Работаем: 8:00 - 22:00, без выходных
            </p>
          </div>
        </>
      )}
    </div>
  );

  const renderProfileTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Профиль автовладельца</h1>
      
      <div className="ios-card p-4">
        <div className="flex items-center space-x-3 mb-4">
          <div className="w-16 h-16 bg-system-orange rounded-full flex items-center justify-center">
            <span className="ios-title font-bold text-white">АБ</span>
          </div>
          <div>
            <h3 className="ios-headline font-semibold">Авто Блеск VIP</h3>
            <p className="ios-body text-secondary-label">Постоянный клиент</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center">
            <p className="ios-title font-bold text-system-orange">31</p>
            <p className="ios-footnote text-secondary-label">Посещений</p>
          </div>
          <div className="text-center">
            <p className="ios-title font-bold text-system-green">10%</p>
            <p className="ios-footnote text-secondary-label">Скидка</p>
          </div>
        </div>
      </div>

      <div className="space-y-3">
        <h2 className="ios-headline font-semibold">Избранные услуги</h2>
        {services.filter(service => favorites.includes(service.id)).map((service) => (
          <div key={service.id} className="ios-card p-3 flex items-center space-x-3">
            <OptimizedImage src={service.image} alt={service.name} className="w-20 h-20 object-cover rounded-lg" />
            <div className="flex-1">
              <h4 className="ios-body font-semibold">{service.name}</h4>
              <p className="ios-footnote text-secondary-label">${service.price} • {service.duration}</p>
            </div>
            <ChevronRight className="w-5 h-5 text-tertiary-label" />
          </div>
        ))}
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">История обслуживания</h3>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="ios-body">Последнее посещение:</span>
            <span className="ios-body font-medium">14 дек 2024</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Любимая услуга:</span>
            <span className="ios-body font-medium">Комплексная мойка</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Потрачено всего:</span>
            <span className="ios-body font-medium text-system-orange">$1,240</span>
          </div>
        </div>
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Мой автомобиль</h3>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="ios-body">Марка:</span>
            <span className="ios-body font-medium">BMW X5</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Год:</span>
            <span className="ios-body font-medium">2022</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Цвет:</span>
            <span className="ios-body font-medium">Черный металлик</span>
          </div>
        </div>
      </div>
    </div>
  );

  return (
    <div className="h-full flex flex-col bg-system-background">
      <div className="flex-1 overflow-y-auto p-4">
        {activeTab === 'home' && renderHomeTab()}
        {activeTab === 'catalog' && renderCatalogTab()}
        {activeTab === 'cart' && renderCartTab()}
        {activeTab === 'profile' && renderProfileTab()}
      </div>

      {/* Модальное окно */}
      {isModalOpen && selectedService && (
        <div className="fixed inset-0 bg-black/50 flex items-end z-50">
          <div className="bg-system-background max-w-md mx-auto w-full rounded-t-3xl p-6 space-y-4 max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-start">
              <h3 className="ios-title font-bold line-clamp-2">{selectedService.name}</h3>
              <button onClick={closeServiceModal}>
                <X className="w-6 h-6 text-secondary-label" />
              </button>
            </div>
            
            <OptimizedImage src={selectedService.image} alt={selectedService.name} className="w-full h-48 object-cover rounded-xl" />
            
            <div className="space-y-3">
              <p className="ios-body text-secondary-label">{selectedService.description}</p>
              
              <div className="flex items-center space-x-4">
                <div className="flex items-center space-x-1">
                  <Clock className="w-4 h-4 text-secondary-label" />
                  <span className="ios-footnote">{selectedService.duration}</span>
                </div>
                <div className="flex items-center space-x-1">
                  <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                  <span className="ios-footnote">{selectedService.rating}</span>
                </div>
                <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-quaternary-system-fill text-label">
                  {selectedService.category}
                </span>
              </div>
              
              <div className="space-y-2">
                <h4 className="ios-body font-semibold">Что включено:</h4>
                <div className="space-y-1">
                  {selectedService.includes.map((item, index) => (
                    <div key={index} className="flex items-center space-x-2">
                      <Check className="w-4 h-4 text-system-green" />
                      <span className="ios-footnote text-secondary-label">{item}</span>
                    </div>
                  ))}
                </div>
              </div>
              
              <div className="flex items-center justify-between">
                <span className="ios-title font-bold text-system-orange">${selectedService.price}</span>
                {selectedService.popular && (
                  <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-system-orange/10 text-system-orange">
                    Популярная услуга
                  </span>
                )}
              </div>
              
              <button className="w-full bg-system-orange text-white ios-body font-semibold py-3 rounded-xl">
                Забронировать услугу
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}```

### demos/Courses.tsx
```tsx
import { useState } from "react";
import { 
  BookOpen, 
  Heart, 
  Star, 
  Clock, 
  Play,
  Plus,
  Minus,
  X,
  ChevronRight,
  Award,
  Users,
  CheckCircle,
  BarChart3,
  Download
} from "lucide-react";
import { createProductImageErrorHandler } from "@/utils/imageUtils";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface CoursesProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface EnrolledCourse {
  id: number;
  name: string;
  progress: number;
  nextLesson: string;
  image: string;
}

const courses = [
  { id: 1, name: 'Основы программирования на Python', price: 49, image: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Изучите Python с нуля и создайте свои первые программы', category: 'Программирование', instructor: 'Алексей Петров', duration: '12 часов', lessons: 24, students: 15420, rating: 4.8, level: 'Начинающий', certificate: true, language: 'Русский' },
  { id: 2, name: 'Веб-разработка с JavaScript', price: 65, image: 'https://images.unsplash.com/photo-1627398242454-45a1465c2479?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Создание интерактивных веб-сайтов с использованием JavaScript', category: 'Веб-разработка', instructor: 'Мария Иванова', duration: '18 часов', lessons: 36, students: 8965, rating: 4.9, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 3, name: 'Дизайн интерфейсов в Figma', price: 55, image: 'https://images.unsplash.com/photo-1558655146-9f40138edfeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Научитесь создавать красивые и функциональные интерфейсы', category: 'Дизайн', instructor: 'Анна Смирнова', duration: '15 часов', lessons: 30, students: 12340, rating: 4.7, level: 'Начинающий', certificate: true, language: 'Русский' },
  { id: 4, name: 'Машинное обучение для начинающих', price: 89, image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Погрузитесь в мир искусственного интеллекта и машинного обучения', category: 'Data Science', instructor: 'Дмитрий Козлов', duration: '25 часов', lessons: 50, students: 6780, rating: 4.9, level: 'Продвинутый', certificate: true, language: 'Русский' },
  { id: 5, name: 'Цифровой маркетинг 2024', price: 45, image: 'https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Актуальные стратегии продвижения в интернете', category: 'Маркетинг', instructor: 'Елена Волкова', duration: '10 часов', lessons: 20, students: 23450, rating: 4.6, level: 'Начинающий', certificate: true, language: 'Русский' },
  { id: 6, name: 'Фотография и обработка', price: 38, image: 'https://images.unsplash.com/photo-1606983340126-99ab4feaa64a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'От основ фотографии до профессиональной обработки в Lightroom', category: 'Творчество', instructor: 'Игорь Белов', duration: '14 часов', lessons: 28, students: 9876, rating: 4.8, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 7, name: 'Excel для профессионалов', price: 35, image: 'https://images.unsplash.com/photo-1586861848620-bfe73d85fc92?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Продвинутые функции Excel для анализа данных и автоматизации', category: 'Офисные программы', instructor: 'Ольга Крылова', duration: '8 часов', lessons: 16, students: 18920, rating: 4.5, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 8, name: 'Мобильная разработка на React Native', price: 78, image: 'https://images.unsplash.com/photo-1555774698-0b77e0d5fac6?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Создание мобильных приложений для iOS и Android', category: 'Мобильная разработка', instructor: 'Сергей Морозов', duration: '22 часов', lessons: 44, students: 5432, rating: 4.9, level: 'Продвинутый', certificate: true, language: 'Русский' },
  { id: 9, name: 'Блокчейн и криптовалюты', price: 95, image: 'https://images.unsplash.com/photo-1639762681485-074b7f938ba0?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Понимание технологии блокчейн и криптовалютного рынка', category: 'Финтех', instructor: 'Владимир Титов', duration: '16 часов', lessons: 32, students: 3210, rating: 4.7, level: 'Продвинутый', certificate: true, language: 'Русский' },
  { id: 10, name: 'Английский для IT-специалистов', price: 42, image: 'https://images.unsplash.com/photo-1434030216411-0b793f4b4173?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Технический английский для работы в международных IT-компаниях', category: 'Языки', instructor: 'Sarah Johnson', duration: '20 часов', lessons: 40, students: 14680, rating: 4.6, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 11, name: 'Стартап от идеи до продажи', price: 85, image: 'https://images.unsplash.com/photo-1556484687-30636164638b?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Полный цикл создания и развития технологического стартапа', category: 'Бизнес', instructor: 'Андрей Соколов', duration: '30 часов', lessons: 60, students: 7890, rating: 4.8, level: 'Продвинутый', certificate: true, language: 'Русский' },
  { id: 12, name: 'DevOps и облачные технологии', price: 92, image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Автоматизация разработки и развертывания приложений', category: 'DevOps', instructor: 'Максим Зайцев', duration: '28 часов', lessons: 56, students: 4560, rating: 4.9, level: 'Продвинутый', certificate: true, language: 'Русский' },
  { id: 13, name: 'Кибербезопасность для всех', price: 58, image: 'https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Основы защиты информации и этичного хакинга', category: 'Безопасность', instructor: 'Татьяна Белова', duration: '18 часов', lessons: 36, students: 11230, rating: 4.7, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 14, name: 'Анимация и 3D-моделирование', price: 68, image: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Создание 3D-моделей и анимации в Blender', category: 'Творчество', instructor: 'Валентин Орлов', duration: '24 часов', lessons: 48, students: 6750, rating: 4.8, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 15, name: 'Искусственный интеллект и ChatGPT', price: 72, image: 'https://images.unsplash.com/photo-1485827404703-89b55fcc595e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Использование ИИ для повышения продуктивности в работе', category: 'ИИ и автоматизация', instructor: 'Николай Семенов', duration: '12 часов', lessons: 24, students: 19850, rating: 4.9, level: 'Начинающий', certificate: true, language: 'Русский' },
  { id: 16, name: 'Игровая разработка на Unity', price: 75, image: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Создание 2D и 3D игр с использованием движка Unity', category: 'Игровая разработка', instructor: 'Роман Крылов', duration: '35 часов', lessons: 70, students: 8420, rating: 4.8, level: 'Продвинутый', certificate: true, language: 'Русский' },
  { id: 17, name: 'Дата-аналитика в Python', price: 82, image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Анализ данных с использованием Pandas, NumPy и Matplotlib', category: 'Data Science', instructor: 'Светлана Попова', duration: '26 часов', lessons: 52, students: 9630, rating: 4.9, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 18, name: 'UI/UX дизайн мобильных приложений', price: 62, image: 'https://images.unsplash.com/photo-1558655146-d09347e92766?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Проектирование пользовательского опыта для мобильных устройств', category: 'Дизайн', instructor: 'Юлия Волкова', duration: '16 часов', lessons: 32, students: 7890, rating: 4.7, level: 'Средний', certificate: true, language: 'Русский' },
  { id: 19, name: 'Контент-маркетинг и SMM', price: 48, image: 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Создание эффективного контента для социальных сетей', category: 'Маркетинг', instructor: 'Алина Козлова', duration: '14 часов', lessons: 28, students: 16540, rating: 4.6, level: 'Начинающий', certificate: true, language: 'Русский' },
  { id: 20, name: 'Личная эффективность и тайм-менеджмент', price: 32, image: 'https://images.unsplash.com/photo-1586953208448-b95a79798f07?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Техники управления временем и повышения продуктивности', category: 'Саморазвитие', instructor: 'Михаил Титов', duration: '8 часов', lessons: 16, students: 25670, rating: 4.5, level: 'Начинающий', certificate: true, language: 'Русский' }
];

const categories = ['Все', 'Программирование', 'Веб-разработка', 'Дизайн', 'Data Science', 'Маркетинг', 'Творчество', 'Мобильная разработка', 'Бизнес', 'Языки', 'ИИ и автоматизация', 'Саморазвитие'];

const levels = ['Все', 'Начинающий', 'Средний', 'Продвинутый'];

const initialEnrolledCourses: EnrolledCourse[] = [
  { id: 1, name: 'Основы программирования на Python', progress: 75, nextLesson: 'Урок 18: Работа с файлами', image: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60' },
  { id: 3, name: 'Дизайн интерфейсов в Figma', progress: 35, nextLesson: 'Урок 11: Создание компонентов', image: 'https://images.unsplash.com/photo-1558655146-9f40138edfeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60' },
];

export default function Courses({ activeTab }: CoursesProps) {
  const [selectedCourse, setSelectedCourse] = useState<typeof courses[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [enrolledCourses, setEnrolledCourses] = useState<EnrolledCourse[]>(initialEnrolledCourses);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [selectedLevel, setSelectedLevel] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([1, 2, 4, 15]);

  const openCourseModal = (course: typeof courses[0]) => {
    setSelectedCourse(course);
    setIsModalOpen(true);
  };

  const closeCourseModal = () => {
    setIsModalOpen(false);
    setSelectedCourse(null);
  };

  const toggleFavorite = (courseId: number) => {
    setFavorites(prev => 
      prev.includes(courseId) 
        ? prev.filter(id => id !== courseId)
        : [...prev, courseId]
    );
  };

  const filteredCourses = courses.filter(course => {
    const matchesCategory = selectedCategory === 'Все' || course.category === selectedCategory;
    const matchesLevel = selectedLevel === 'Все' || course.level === selectedLevel;
    
    return matchesCategory && matchesLevel;
  });

  const popularCourses = courses.filter(course => course.students > 10000);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: courses.slice(0, 6).map(item => item.image),
    priority: true
  });


  const renderHomeTab = () => (
    <div className="min-h-screen bg-purple-50 font-montserrat">
      <div className="max-w-md mx-auto">
        
        {/* Learning Header */}
        <div className="px-6 pt-20 pb-16 text-center">
          <div className="w-20 h-20 bg-purple-600 rounded-xl flex items-center justify-center mx-auto mb-8">
            <BookOpen className="w-6 h-6 text-white" />
          </div>
          <h1 className="text-2xl font-semibold text-purple-900 mb-3 tracking-wide">LearnHub</h1>
          <p className="text-purple-600 text-sm font-medium">Premium Online Education</p>
        </div>

        {/* Hero Learning Section */}
        <div className="px-6 pb-20">
          <div className="aspect-[16/10] rounded-2xl overflow-hidden bg-purple-100 mb-12 relative">
            <OptimizedImage 
              src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=800&h=500&fit=crop&crop=center" 
              alt="Premium Online Learning"
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-purple-900/80 via-purple-900/40 to-transparent" />
            <div className="absolute bottom-6 left-6 right-6 text-white">
              <h2 className="text-xl font-semibold mb-2">Expand Your Knowledge</h2>
              <p className="text-white/80 text-sm mb-4">Expert-led courses and certifications</p>
              <button 
                className="bg-white text-purple-900 px-6 py-2 rounded-lg text-sm font-medium hover:bg-purple-50 transition-colors"
                onClick={() => openCourseModal(courses[0])}
              >
                Start Learning
              </button>
            </div>
          </div>
        </div>

        {/* Learning Stats */}
        <div className="px-6 py-20 border-t border-purple-200">
          <div className="text-center mb-16">
            <h3 className="text-lg font-semibold text-purple-900 mb-4">Learn With Excellence</h3>
            <p className="text-purple-600 text-sm font-medium leading-relaxed">
              Master new skills with industry-leading instructors and comprehensive curriculums.
            </p>
          </div>
          
          <div className="grid grid-cols-2 gap-12 text-center">
            {[
              { number: '500+', label: 'Courses' },
              { number: '50K+', label: 'Students' },
              { number: '95%', label: 'Completion Rate' },
              { number: '24/7', label: 'Support' }
            ].map((stat, index) => (
              <div key={index}>
                <div className="text-2xl font-bold text-purple-600 mb-1">{stat.number}</div>
                <div className="text-purple-500 text-xs font-medium">{stat.label}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Featured Courses */}
        <div className="px-6 py-20 border-t border-purple-200">
          <div className="flex items-center justify-between mb-12">
            <h3 className="text-lg font-semibold text-purple-900">Popular Courses</h3>
            <button 
              className="text-purple-500 text-sm font-medium hover:text-purple-600 transition-colors"
              onClick={() => setSelectedCategory('Все')}
            >
              View all
            </button>
          </div>
          
          <div className="space-y-12">
            {courses.slice(0, 2).map((course, index) => (
              <div 
                key={course.id} 
                className="group cursor-pointer"
                onClick={() => openCourseModal(course)}
              >
                <div className="aspect-[5/3] rounded-xl overflow-hidden bg-purple-100 mb-6 relative">
                  <OptimizedImage 
                    src={course.image}
                    alt={course.name}
                    className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                  />
                  <div className="absolute top-3 left-3 bg-purple-600 text-white text-xs font-bold px-2 py-1 rounded">
                    {course.duration}
                  </div>
                  <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm text-purple-900 text-xs font-medium px-2 py-1 rounded flex items-center space-x-1">
                    <Star className="w-3 h-3 text-purple-500 fill-current" />
                    <span>{course.rating}</span>
                  </div>
                </div>
                <div className="space-y-3">
                  <div className="flex items-start justify-between">
                    <div>
                      <h4 className="text-purple-900 font-semibold text-base">{course.name}</h4>
                      <p className="text-purple-500 text-sm font-medium">{course.instructor}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-purple-900 font-semibold">${course.price}</p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Каталог курсов</h1>
      
      {/* Фильтры */}
      <div className="space-y-3">
        <div className="flex space-x-2 overflow-x-auto pb-2">
          {categories.map((category) => (
            <button
              key={category}
              onClick={() => setSelectedCategory(category)}
              className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
                selectedCategory === category
                  ? 'bg-system-indigo text-white'
                  : 'bg-quaternary-system-fill text-label'
              }`}
            >
              {category}
            </button>
          ))}
        </div>
        
        <div className="flex space-x-2 overflow-x-auto pb-2">
          {levels.map((level) => (
            <button
              key={level}
              onClick={() => setSelectedLevel(level)}
              className={`px-3 py-1 rounded-full whitespace-nowrap ios-caption2 font-medium ${
                selectedLevel === level
                  ? 'bg-system-purple text-white'
                  : 'bg-fill text-secondary-label'
              }`}
            >
              {level}
            </button>
          ))}
        </div>
      </div>

      {/* Список курсов */}
      <div className="space-y-3">
        {filteredCourses.map((course) => (
          <div 
            key={course.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openCourseModal(course)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage 
                src={course.image} 
                alt={course.name} 
                className="w-20 h-20 object-cover rounded-lg"
                onError={createProductImageErrorHandler('courses', 'service')}
              />
              <div className="flex-1">
                <div className="flex items-center justify-between mb-1">
                  <h4 className="ios-body font-semibold line-clamp-1">{course.name}</h4>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(course.id);
                    }}
                    className="p-1"
                  >
                    <Heart 
                      className={`w-4 h-4 ${
                        favorites.includes(course.id) 
                          ? 'fill-red-500 text-red-500' 
                          : 'text-secondary-label'
                      }`} 
                    />
                  </button>
                </div>
                <p className="ios-footnote text-secondary-label mb-1">{course.instructor}</p>
                <p className="ios-caption2 text-tertiary-label mb-2 line-clamp-1">{course.description}</p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <div className="flex items-center space-x-1">
                      <Clock className="w-3 h-3 text-secondary-label" />
                      <span className="ios-caption2">{course.duration}</span>
                    </div>
                    <div className="flex items-center space-x-1">
                      <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                      <span className="ios-caption2">{course.rating}</span>
                    </div>
                    <span className="ios-caption2 px-2 py-1 bg-quaternary-system-fill rounded">{course.level}</span>
                  </div>
                  <span className="ios-body font-bold text-system-indigo">${course.price}</span>
                </div>
              </div>
            </div>
          </div>
        ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Мои курсы</h1>
      
      {enrolledCourses.length === 0 ? (
        <div className="text-center py-12">
          <BookOpen className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
          <p className="ios-body text-secondary-label">Нет записанных курсов</p>
          <p className="ios-footnote text-tertiary-label">Выберите курс из каталога</p>
        </div>
      ) : (
        <>
          <div className="space-y-3">
            {enrolledCourses.map((course) => (
              <div key={course.id} className="ios-card p-4">
                <div className="flex items-center space-x-3 mb-4">
                  <OptimizedImage 
                    src={course.image} 
                    alt={course.name} 
                    className="w-16 h-16 object-cover rounded-lg"
                    onError={createProductImageErrorHandler('courses', 'service')}
                  />
                  <div className="flex-1">
                    <h4 className="ios-body font-semibold line-clamp-2">{course.name}</h4>
                    <p className="ios-footnote text-secondary-label">{course.nextLesson}</p>
                  </div>
                </div>
                
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="ios-footnote text-secondary-label">Прогресс обучения</span>
                    <span className="ios-footnote font-semibold">{course.progress}%</span>
                  </div>
                  <div className="w-full bg-quaternary-system-fill rounded-full h-2">
                    <div 
                      className="bg-system-indigo h-2 rounded-full" 
                      style={{ width: `${course.progress}%` }}
                    ></div>
                  </div>
                  
                  <div className="flex space-x-2">
                    <button className="flex-1 bg-system-indigo text-white ios-footnote font-semibold py-2 rounded-lg flex items-center justify-center space-x-2">
                      <Play className="w-4 h-4" />
                      <span>Продолжить</span>
                    </button>
                    <button className="flex-1 bg-quaternary-system-fill text-label ios-footnote font-medium py-2 rounded-lg flex items-center justify-center space-x-2">
                      <Download className="w-4 h-4" />
                      <span>Материалы</span>
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div className="ios-card p-4">
            <h3 className="ios-headline font-semibold mb-2">Статистика обучения</h3>
            <div className="grid grid-cols-2 gap-4">
              <div className="text-center">
                <p className="ios-title font-bold text-system-indigo">{enrolledCourses.length}</p>
                <p className="ios-footnote text-secondary-label">Активных курсов</p>
              </div>
              <div className="text-center">
                <p className="ios-title font-bold text-system-green">
                  {Math.round(enrolledCourses.reduce((sum, course) => sum + course.progress, 0) / enrolledCourses.length)}%
                </p>
                <p className="ios-footnote text-secondary-label">Средний прогресс</p>
              </div>
            </div>
          </div>
        </>
      )}
    </div>
  );

  const renderProfileTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Профиль студента</h1>
      
      <div className="ios-card p-4">
        <div className="flex items-center space-x-3 mb-4">
          <div className="w-16 h-16 bg-system-indigo rounded-full flex items-center justify-center">
            <span className="ios-title font-bold text-white">УХ</span>
          </div>
          <div>
            <h3 className="ios-headline font-semibold">Студент Pro</h3>
            <p className="ios-body text-secondary-label">Активный ученик</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center">
            <p className="ios-title font-bold text-system-indigo">8</p>
            <p className="ios-footnote text-secondary-label">Завершено</p>
          </div>
          <div className="text-center">
            <p className="ios-title font-bold text-system-green">12</p>
            <p className="ios-footnote text-secondary-label">Сертификатов</p>
          </div>
        </div>
      </div>

      <div className="space-y-3">
        <h2 className="ios-headline font-semibold">Избранные курсы</h2>
        {courses.filter(course => favorites.includes(course.id)).map((course) => (
          <div key={course.id} className="ios-card p-3 flex items-center space-x-3">
            <OptimizedImage 
              src={course.image} 
              alt={course.name} 
              className="w-20 h-20 object-cover rounded-lg"
              onError={createProductImageErrorHandler('courses', 'service')}
            />
            <div className="flex-1">
              <h4 className="ios-body font-semibold line-clamp-1">{course.name}</h4>
              <p className="ios-footnote text-secondary-label">{course.instructor} • ${course.price}</p>
            </div>
            <ChevronRight className="w-5 h-5 text-tertiary-label" />
          </div>
        ))}
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Достижения</h3>
        <div className="grid grid-cols-3 gap-3">
          {[
            { icon: '🏆', name: 'Первый курс', desc: 'Завершен' },
            { icon: '🔥', name: 'Марафонец', desc: '7 дней подряд' },
            { icon: '💎', name: 'Эксперт', desc: '5 сертификатов' }
          ].map((achievement) => (
            <div key={achievement.name} className="text-center">
              <div className="w-20 h-20 bg-quaternary-system-fill rounded-full flex items-center justify-center mx-auto mb-1">
                <span className="text-xl">{achievement.icon}</span>
              </div>
              <p className="ios-caption2 font-semibold">{achievement.name}</p>
              <p className="ios-caption text-secondary-label">{achievement.desc}</p>
            </div>
          ))}
        </div>
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Статистика обучения</h3>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="ios-body">Общее время обучения:</span>
            <span className="ios-body font-medium">156 часов</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Любимая категория:</span>
            <span className="ios-body font-medium">Программирование</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Потрачено на курсы:</span>
            <span className="ios-body font-medium text-system-indigo">$425</span>
          </div>
        </div>
      </div>
    </div>
  );

  return (
    <div className="h-full flex flex-col bg-system-background">
      <div className="flex-1 overflow-y-auto p-4">
        {activeTab === 'home' && renderHomeTab()}
        {activeTab === 'catalog' && renderCatalogTab()}
        {activeTab === 'cart' && renderCartTab()}
        {activeTab === 'profile' && renderProfileTab()}
      </div>

      {/* Модальное окно */}
      {isModalOpen && selectedCourse && (
        <div className="fixed inset-0 bg-black/50 flex items-end z-50">
          <div className="bg-system-background max-w-md mx-auto w-full rounded-t-3xl p-6 space-y-4 max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-start">
              <h3 className="ios-title font-bold line-clamp-2">{selectedCourse.name}</h3>
              <button onClick={closeCourseModal}>
                <X className="w-6 h-6 text-secondary-label" />
              </button>
            </div>
            
            <OptimizedImage 
              src={selectedCourse.image} 
              alt={selectedCourse.name} 
              className="w-full h-48 object-cover rounded-xl"
              onError={createProductImageErrorHandler('courses', 'service')}
            />
            
            <div className="space-y-3">
              <div className="flex items-center space-x-2">
                <span className="ios-body font-medium">{selectedCourse.instructor}</span>
                <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-quaternary-system-fill text-label">
                  {selectedCourse.level}
                </span>
              </div>
              
              <p className="ios-body text-secondary-label">{selectedCourse.description}</p>
              
              <div className="grid grid-cols-2 gap-4">
                <div className="ios-card p-3">
                  <p className="ios-caption2 text-secondary-label">Длительность</p>
                  <p className="ios-body font-semibold">{selectedCourse.duration}</p>
                </div>
                <div className="ios-card p-3">
                  <p className="ios-caption2 text-secondary-label">Уроков</p>
                  <p className="ios-body font-semibold">{selectedCourse.lessons}</p>
                </div>
              </div>
              
              <div className="flex items-center space-x-4">
                <div className="flex items-center space-x-1">
                  <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                  <span className="ios-footnote">{selectedCourse.rating}</span>
                </div>
                <div className="flex items-center space-x-1">
                  <Users className="w-4 h-4 text-secondary-label" />
                  <span className="ios-footnote">{selectedCourse.students.toLocaleString()} студентов</span>
                </div>
                {selectedCourse.certificate && (
                  <div className="flex items-center space-x-1">
                    <Award className="w-4 h-4 text-system-green" />
                    <span className="ios-footnote text-system-green">Сертификат</span>
                  </div>
                )}
              </div>
              
              <div className="flex items-center justify-between">
                <span className="ios-title font-bold text-system-indigo">${selectedCourse.price}</span>
                <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-system-indigo/10 text-system-indigo">
                  {selectedCourse.category}
                </span>
              </div>
              
              <button className="w-full bg-system-indigo text-white ios-body font-semibold py-3 rounded-xl">
                Записаться
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}```

### demos/Fitness.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m } from "framer-motion";
import { 
  Dumbbell, 
  Heart, 
  Star, 
  X,
  ChevronLeft,
  Calendar,
  User,
  Trophy,
  Flame,
  TrendingUp,
  Clock,
  Target,
  Zap,
  Award
} from "lucide-react";

interface FitnessProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Workout {
  id: number;
  name: string;
  duration: number;
  calories: number;
  image: string;
  description: string;
  category: string;
  level: 'Начальный' | 'Средний' | 'Продвинутый';
  trainer: string;
  rating: number;
  isNew?: boolean;
  isPopular?: boolean;
}

interface Achievement {
  id: number;
  title: string;
  description: string;
  icon: string;
  progress: number;
  total: number;
  unlocked: boolean;
}

const workouts: Workout[] = [
  { id: 1, name: 'HIIT Кардио', duration: 30, calories: 350, image: 'https://images.unsplash.com/photo-1549060279-7e168fcee0c2?w=800&h=1200&fit=crop&q=90', description: 'Интенсивная кардио тренировка', category: 'Кардио', level: 'Средний', trainer: 'Анна Петрова', rating: 4.9, isPopular: true },
  { id: 2, name: 'Йога для начинающих', duration: 45, calories: 180, image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=800&h=1200&fit=crop&q=90', description: 'Мягкая йога для гибкости', category: 'Йога', level: 'Начальный', trainer: 'Мария Иванова', rating: 4.8, isPopular: true },
  { id: 3, name: 'Силовая тренировка', duration: 60, calories: 420, image: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=800&h=1200&fit=crop&q=90', description: 'Тренировка всех групп мышц', category: 'Силовые', level: 'Продвинутый', trainer: 'Дмитрий Соколов', rating: 5.0, isNew: true, isPopular: true },
  { id: 4, name: 'Пилатес', duration: 40, calories: 200, image: 'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=800&h=1200&fit=crop&q=90', description: 'Укрепление кора и осанки', category: 'Пилатес', level: 'Средний', trainer: 'Елена Волкова', rating: 4.7, isNew: true },
  { id: 5, name: 'Бокс для фитнеса', duration: 45, calories: 500, image: 'https://images.unsplash.com/photo-1549719386-74dfcbf7dbed?w=800&h=1200&fit=crop&q=90', description: 'Боксерская тренировка', category: 'Кардио', level: 'Продвинутый', trainer: 'Игорь Петров', rating: 4.9, isPopular: true },
  { id: 6, name: 'Растяжка', duration: 25, calories: 100, image: 'https://images.unsplash.com/photo-1518310383802-640c2de311b2?w=800&h=1200&fit=crop&q=90', description: 'Глубокая растяжка мышц', category: 'Растяжка', level: 'Начальный', trainer: 'Ольга Смирнова', rating: 4.6 },
  { id: 7, name: 'Функциональный тренинг', duration: 50, calories: 380, image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&h=1200&fit=crop&q=90', description: 'Упражнения для повседневной жизни', category: 'Функциональные', level: 'Средний', trainer: 'Сергей Новиков', rating: 4.8, isNew: true },
  { id: 8, name: 'Табата', duration: 20, calories: 280, image: 'https://images.unsplash.com/photo-1599058945522-28d584b6f0ff?w=800&h=1200&fit=crop&q=90', description: 'Интервальная высокоинтенсивная тренировка', category: 'Кардио', level: 'Продвинутый', trainer: 'Анна Петрова', rating: 5.0, isPopular: true },
];

const categories = ['Все', 'Кардио', 'Силовые', 'Йога', 'Пилатес', 'Растяжка', 'Функциональные'];

const collections = [
  {
    id: 1,
    title: 'Жиросжигание',
    subtitle: 'Интенсивные тренировки',
    image: 'https://images.unsplash.com/photo-1549060279-7e168fcee0c2?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-orange-600/30 to-red-600/30',
    workouts: [1, 5, 8]
  },
  {
    id: 2,
    title: 'Сила и выносливость',
    subtitle: 'Мощные тренировки',
    image: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-purple-600/30 to-indigo-600/30',
    workouts: [3, 7]
  },
  {
    id: 3,
    title: 'Гибкость и баланс',
    subtitle: 'Спокойные практики',
    image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=1200&h=800&fit=crop&q=90',
    gradient: 'from-green-600/30 to-emerald-600/30',
    workouts: [2, 4, 6]
  },
];

export default memo(function Fitness({ activeTab }: FitnessProps) {
  const [selectedWorkout, setSelectedWorkout] = useState<Workout | null>(null);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<Set<number>>(new Set([1, 2, 3]));
  
  const [stats, setStats] = useState({
    workoutsCompleted: 47,
    totalMinutes: 1840,
    caloriesBurned: 15680,
    streak: 12,
  });

  const [achievements] = useState<Achievement[]>([
    { id: 1, title: 'Первая тренировка', description: 'Завершите свою первую тренировку', icon: '🎯', progress: 1, total: 1, unlocked: true },
    { id: 2, title: 'Марафонец', description: 'Завершите 50 тренировок', icon: '🏃', progress: 47, total: 50, unlocked: false },
    { id: 3, title: 'Мастер огня', description: 'Сожгите 20000 калорий', icon: '🔥', progress: 15680, total: 20000, unlocked: false },
    { id: 4, title: 'Стальная воля', description: 'Серия из 30 дней', icon: '💪', progress: 12, total: 30, unlocked: false },
  ]);

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedWorkout(null);
    }
  }, [activeTab]);

  const filteredWorkouts = workouts.filter(w => 
    selectedCategory === 'Все' || w.category === selectedCategory
  );

  const toggleFavorite = (workoutId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(workoutId)) {
      newFavorites.delete(workoutId);
    } else {
      newFavorites.add(workoutId);
    }
    setFavorites(newFavorites);
  };

  const startWorkout = (workout: Workout) => {
    setStats(prev => ({
      workoutsCompleted: prev.workoutsCompleted + 1,
      totalMinutes: prev.totalMinutes + workout.duration,
      caloriesBurned: prev.caloriesBurned + workout.calories,
      streak: prev.streak,
    }));
    setSelectedWorkout(null);
  };

  if (activeTab === 'home') {
    return (
      <div className="h-full overflow-y-auto">
        <div className="relative h-[280px] bg-gradient-to-br from-orange-600/20 via-red-500/20 to-pink-600/20">
          <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1200&h=800&fit=crop&q=90')] bg-cover bg-center opacity-30" />
          <div className="absolute inset-0 backdrop-blur-xl bg-gradient-to-t from-black/60 to-transparent" />
          
          <div className="relative h-full flex flex-col justify-end p-6 pb-8">
            <m.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              className="space-y-2"
            >
              <div className="flex items-center gap-2">
                <div className="p-2 bg-orange-500/20 backdrop-blur-xl rounded-xl border border-orange-400/30">
                  <Dumbbell className="w-6 h-6 text-orange-300" />
                </div>
                <h1 className="text-3xl font-bold text-white">FitPro</h1>
              </div>
              <p className="text-white/80">Твой путь к идеальной форме</p>
              
              <div className="grid grid-cols-2 gap-2 pt-2">
                <div className="px-3 py-2 bg-orange-500/20 backdrop-blur-xl rounded-xl border border-orange-400/30">
                  <p className="text-orange-200 text-xs">Тренировок</p>
                  <p className="text-white text-lg font-bold">{stats.workoutsCompleted}</p>
                </div>
                <div className="px-3 py-2 bg-red-500/20 backdrop-blur-xl rounded-xl border border-red-400/30">
                  <p className="text-red-200 text-xs">Калорий</p>
                  <p className="text-white text-lg font-bold">{stats.caloriesBurned.toLocaleString('ru-RU')}</p>
                </div>
              </div>
            </m.div>
          </div>
        </div>

        <div className="p-4 space-y-6">
          <div className="p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10 backdrop-blur-xl rounded-2xl border border-orange-400/30">
            <div className="flex items-center justify-between mb-3">
              <div className="flex items-center gap-2">
                <Flame className="w-6 h-6 text-orange-600 dark:text-orange-500" />
                <div>
                  <h3 className="font-bold text-lg">{stats.streak} дней</h3>
                  <p className="text-sm text-orange-700 dark:text-orange-300">Текущая серия</p>
                </div>
              </div>
              <div className="text-right">
                <p className="text-2xl font-bold text-orange-600">{stats.totalMinutes}</p>
                <p className="text-xs text-orange-700 dark:text-orange-300">минут всего</p>
              </div>
            </div>
            <div className="h-2 bg-orange-900/20 rounded-full overflow-hidden">
              <div 
                className="h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full"
                style={{ width: `${(stats.streak / 30) * 100}%` }}
              />
            </div>
            <p className="text-xs text-orange-700 dark:text-orange-300 mt-2">До достижения "Стальная воля": {30 - stats.streak} дней</p>
          </div>

          <div>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold">Программы тренировок</h2>
              <TrendingUp className="w-5 h-5 text-muted-foreground" />
            </div>
            <div className="grid gap-3">
              {collections.map((collection) => (
                <m.div
                  key={collection.id}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  className="relative h-32 rounded-2xl overflow-hidden hover-elevate active-elevate-2 cursor-pointer"
                >
                  <div className="absolute inset-0 bg-cover bg-center" style={{ backgroundImage: `url(${collection.image})` }} />
                  <div className="absolute inset-0 backdrop-blur-xl bg-gradient-to-r from-black/60 to-transparent" />
                  <div className={`absolute inset-0 bg-gradient-to-r ${collection.gradient}`} />
                  
                  <div className="relative h-full p-5 flex flex-col justify-between">
                    <div>
                      <h3 className="text-xl font-bold text-white mb-1">{collection.title}</h3>
                      <p className="text-white/80 text-sm">{collection.subtitle}</p>
                    </div>
                    <div className="flex gap-2">
                      {workouts.filter(w => collection.workouts.includes(w.id)).slice(0, 3).map(workout => (
                        <div key={workout.id} className="w-12 h-12 rounded-lg overflow-hidden border-2 border-white/30">
                          <img src={workout.image} alt="" className="w-full h-full object-cover" />
                        </div>
                      ))}
                    </div>
                  </div>
                </m.div>
              ))}
            </div>
          </div>

          <div>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-lg font-semibold">Популярное</h2>
              <Star className="w-5 h-5 fill-orange-500 text-orange-500" />
            </div>
            <div className="grid grid-cols-2 gap-3">
              {workouts.filter(w => w.isPopular).map((workout) => (
                <m.div
                  key={workout.id}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                  onClick={() => setSelectedWorkout(workout)}
                  className="bg-card/50 backdrop-blur-xl rounded-2xl overflow-hidden border border-border/50 hover-elevate active-elevate-2 cursor-pointer"
                  data-testid={`card-workout-${workout.id}`}
                >
                  <div className="relative aspect-[3/4]">
                    <img src={workout.image} alt={workout.name} className="w-full h-full object-cover" />
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        toggleFavorite(workout.id);
                      }}
                      className="absolute top-2 right-2 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                      data-testid={`button-favorite-${workout.id}`}
                    >
                      <Heart className={`w-4 h-4 ${favorites.has(workout.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
                    </button>
                    <div className="absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-xl rounded-full border border-white/20">
                      <span className="text-xs font-bold text-white flex items-center gap-1">
                        <Flame className="w-3 h-3" />
                        {workout.calories} ккал
                      </span>
                    </div>
                  </div>
                  <div className="p-3">
                    <h3 className="font-medium mb-1 line-clamp-1">{workout.name}</h3>
                    <div className="flex items-center justify-between text-sm text-muted-foreground">
                      <span className="flex items-center gap-1">
                        <Clock className="w-3 h-3" />
                        {workout.duration} мин
                      </span>
                      <div className="flex items-center gap-1">
                        <Star className="w-3 h-3 fill-orange-500 text-orange-500" />
                        <span>{workout.rating}</span>
                      </div>
                    </div>
                  </div>
                </m.div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (activeTab === 'catalog') {
    if (selectedWorkout) {
      return (
        <div className="h-full flex flex-col bg-background">
          <div className="relative">
            <div className="aspect-[3/4] relative">
              <img src={selectedWorkout.image} alt={selectedWorkout.name} className="w-full h-full object-cover" />
              <button
                onClick={() => setSelectedWorkout(null)}
                className="absolute top-4 left-4 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                data-testid="button-back"
              >
                <ChevronLeft className="w-6 h-6 text-white" />
              </button>
              <button
                onClick={() => toggleFavorite(selectedWorkout.id)}
                className="absolute top-4 right-4 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                data-testid={`button-favorite-detail-${selectedWorkout.id}`}
              >
                <Heart className={`w-6 h-6 ${favorites.has(selectedWorkout.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
              </button>
            </div>
          </div>

          <div className="flex-1 overflow-y-auto p-5 space-y-4">
            <div>
              <div className="flex items-start justify-between mb-2">
                <h1 className="text-2xl font-bold">{selectedWorkout.name}</h1>
                <div className="flex items-center gap-1 px-3 py-1 bg-orange-500/10 rounded-full">
                  <Star className="w-4 h-4 fill-orange-500 text-orange-500" />
                  <span className="font-bold text-orange-600">{selectedWorkout.rating}</span>
                </div>
              </div>
              <p className="text-muted-foreground mb-3">{selectedWorkout.description}</p>
              <p className="text-sm text-muted-foreground">Тренер: {selectedWorkout.trainer}</p>
            </div>

            <div className="grid grid-cols-3 gap-3">
              <div className="p-3 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 text-center">
                <Clock className="w-5 h-5 mx-auto mb-1 text-orange-600" />
                <p className="text-sm font-bold">{selectedWorkout.duration} мин</p>
              </div>
              <div className="p-3 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 text-center">
                <Flame className="w-5 h-5 mx-auto mb-1 text-red-600" />
                <p className="text-sm font-bold">{selectedWorkout.calories} ккал</p>
              </div>
              <div className="p-3 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 text-center">
                <Target className="w-5 h-5 mx-auto mb-1 text-blue-600" />
                <p className="text-xs font-bold">{selectedWorkout.level}</p>
              </div>
            </div>

            <div className="p-4 bg-gradient-to-br from-orange-500/10 to-red-500/10 backdrop-blur-xl rounded-xl border border-orange-400/30">
              <div className="flex items-center gap-2 mb-2">
                <Trophy className="w-5 h-5 text-orange-600" />
                <p className="font-semibold text-orange-900 dark:text-orange-100">Трекер достижений</p>
              </div>
              <p className="text-sm text-orange-800 dark:text-orange-200">
                Завершите эту тренировку и получите +{selectedWorkout.calories} калорий к статистике
              </p>
            </div>

            <button
              onClick={() => startWorkout(selectedWorkout)}
              className="w-full py-4 bg-gradient-to-r from-orange-600 to-red-600 text-white font-semibold rounded-2xl hover-elevate active-elevate-2 flex items-center justify-center gap-2"
              data-testid="button-start-workout"
            >
              <Zap className="w-5 h-5" />
              Начать тренировку
            </button>
          </div>
        </div>
      );
    }

    return (
      <div className="h-full overflow-y-auto">
        <div className="sticky top-0 z-10 bg-background/80 backdrop-blur-xl border-b border-border/50 px-4 py-5">
          <h1 className="text-2xl font-bold mb-4">Тренировки</h1>
          <div className="flex gap-2 overflow-x-auto pb-2 -mx-4 px-4">
            {categories.map((category) => (
              <button
                key={category}
                onClick={() => setSelectedCategory(category)}
                className={`px-4 py-2 rounded-full whitespace-nowrap transition-all ${
                  selectedCategory === category
                    ? 'bg-orange-600 text-white'
                    : 'bg-card/50 backdrop-blur-xl border border-border/50 hover-elevate'
                }`}
                data-testid={`button-category-${category}`}
              >
                {category}
              </button>
            ))}
          </div>
        </div>

        <div className="p-4 grid grid-cols-2 gap-3">
          {filteredWorkouts.map((workout) => (
            <m.div
              key={workout.id}
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => setSelectedWorkout(workout)}
              className="bg-card/50 backdrop-blur-xl rounded-2xl overflow-hidden border border-border/50 hover-elevate active-elevate-2 cursor-pointer"
              data-testid={`card-catalog-workout-${workout.id}`}
            >
              <div className="relative aspect-[3/4]">
                <img src={workout.image} alt={workout.name} className="w-full h-full object-cover" />
                {workout.isNew && (
                  <div className="absolute top-2 left-2 px-2 py-1 bg-green-500/90 backdrop-blur-xl rounded-full border border-green-400/50">
                    <span className="text-xs font-bold text-white">Новинка</span>
                  </div>
                )}
                <button
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(workout.id);
                  }}
                  className="absolute top-2 right-2 p-2 bg-black/50 backdrop-blur-xl rounded-full border border-white/20"
                  data-testid={`button-favorite-catalog-${workout.id}`}
                >
                  <Heart className={`w-4 h-4 ${favorites.has(workout.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
                </button>
                <div className="absolute bottom-2 left-2 px-2 py-1 bg-black/50 backdrop-blur-xl rounded-full border border-white/20">
                  <span className="text-xs font-bold text-white flex items-center gap-1">
                    <Flame className="w-3 h-3" />
                    {workout.calories} ккал
                  </span>
                </div>
              </div>
              <div className="p-3">
                <h3 className="font-medium mb-1 line-clamp-1">{workout.name}</h3>
                <p className="text-xs text-muted-foreground mb-2 line-clamp-1">{workout.description}</p>
                <div className="flex items-center justify-between text-sm">
                  <span className="flex items-center gap-1 text-muted-foreground">
                    <Clock className="w-3 h-3" />
                    {workout.duration} мин
                  </span>
                  <div className="flex items-center gap-1">
                    <Star className="w-3 h-3 fill-orange-500 text-orange-500" />
                    <span className="text-sm font-medium">{workout.rating}</span>
                  </div>
                </div>
              </div>
            </m.div>
          ))}
        </div>
      </div>
    );
  }

  if (activeTab === 'profile') {
    return (
      <div className="h-full overflow-y-auto">
        <div className="p-6 bg-card/80 backdrop-blur-xl border-b border-border/50">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-orange-600 to-red-600 rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-white" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Алексей Кузнецов</h2>
              <p className="text-sm text-muted-foreground">+7 (999) 888-77-66</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3 mb-4">
            <div className="p-4 bg-orange-500/20 backdrop-blur-xl rounded-xl border border-orange-400/30">
              <p className="text-sm text-muted-foreground mb-1">Тренировки</p>
              <p className="text-2xl font-bold text-orange-600">{stats.workoutsCompleted}</p>
            </div>
            <div className="p-4 bg-red-500/20 backdrop-blur-xl rounded-xl border border-red-400/30">
              <p className="text-sm text-muted-foreground mb-1">Калорий</p>
              <p className="text-2xl font-bold text-red-600">{stats.caloriesBurned.toLocaleString('ru-RU')}</p>
            </div>
            <div className="p-4 bg-purple-500/20 backdrop-blur-xl rounded-xl border border-purple-400/30">
              <p className="text-sm text-muted-foreground mb-1">Минут</p>
              <p className="text-2xl font-bold text-purple-600">{stats.totalMinutes}</p>
            </div>
            <div className="p-4 bg-green-500/20 backdrop-blur-xl rounded-xl border border-green-400/30">
              <p className="text-sm text-muted-foreground mb-1">Серия</p>
              <p className="text-2xl font-bold text-green-600">{stats.streak} дней</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-4">
          <div>
            <h3 className="font-semibold mb-3 flex items-center gap-2">
              <Award className="w-5 h-5 text-orange-600" />
              Достижения
            </h3>
            <div className="grid gap-3">
              {achievements.map((achievement) => (
                <div 
                  key={achievement.id}
                  className={`p-4 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 ${
                    achievement.unlocked ? 'bg-green-500/5 border-green-400/30' : ''
                  }`}
                  data-testid={`achievement-${achievement.id}`}
                >
                  <div className="flex items-start gap-3">
                    <div className="text-3xl">{achievement.icon}</div>
                    <div className="flex-1">
                      <div className="flex items-center justify-between mb-1">
                        <h4 className="font-medium">{achievement.title}</h4>
                        {achievement.unlocked && (
                          <span className="text-xs px-2 py-1 bg-green-500/20 text-green-600 rounded-full">
                            Получено
                          </span>
                        )}
                      </div>
                      <p className="text-sm text-muted-foreground mb-2">{achievement.description}</p>
                      <div className="flex items-center gap-2">
                        <div className="flex-1 h-2 bg-muted rounded-full overflow-hidden">
                          <div 
                            className="h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full"
                            style={{ width: `${(achievement.progress / achievement.total) * 100}%` }}
                          />
                        </div>
                        <span className="text-xs text-muted-foreground whitespace-nowrap">
                          {achievement.progress}/{achievement.total}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <button className="w-full p-4 bg-card/50 backdrop-blur-xl rounded-xl border border-border/50 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-history">
            <div className="flex items-center gap-3">
              <Calendar className="w-5 h-5 text-muted-foreground" />
              <span className="font-medium">История тренировок</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-muted-foreground" />
          </button>
        </div>
      </div>
    );
  }

  return null;
});
```

### demos/Florist.tsx
```tsx
import { useState } from "react";
import { 
  Flower, 
  Heart, 
  Star, 
  MapPin, 
  Clock,
  Plus,
  Minus,
  X,
  ChevronRight,
  Gift,
  Truck,
  Calendar
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface FloristProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  quantity: number;
  image: string;
}

const flowers = [
  { id: 1, name: 'Букет из красных роз', price: 45, image: 'https://images.unsplash.com/photo-1490750967868-88aa4486c946?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Классический букет из 15 красных роз премиум качества', category: 'Розы', occasion: 'Романтика', size: 'Средний', freshness: '7 дней', rating: 4.9, inStock: 12 },
  { id: 2, name: 'Белые пионы', price: 38, image: 'https://images.unsplash.com/photo-1463320726281-696a485928c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Нежный букет из белых пионов для особых моментов', category: 'Пионы', occasion: 'Свадьба', size: 'Большой', freshness: '5 дней', rating: 4.8, inStock: 8 },
  { id: 3, name: 'Микс из тюльпанов', price: 32, image: 'https://images.unsplash.com/photo-1582794543139-8ac9cb0f7b11?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Яркий весенний букет из разноцветных тюльпанов', category: 'Тюльпаны', occasion: 'Весна', size: 'Средний', freshness: '4 дня', rating: 4.7, inStock: 15 },
  { id: 4, name: 'Орхидея в горшке', price: 55, image: 'https://images.unsplash.com/photo-1583624719088-e7ee3b0ad466?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Элегантная орхидея фаленопсис в декоративном горшке', category: 'Горшечные', occasion: 'Подарок', size: 'Маленький', freshness: '30 дней', rating: 4.8, inStock: 6 },
  { id: 5, name: 'Букет невесты', price: 85, image: 'https://images.unsplash.com/photo-1594736797933-d0d4bce9b91a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Изысканный свадебный букет из белых роз и эустомы', category: 'Свадебные', occasion: 'Свадьба', size: 'Большой', freshness: '8 дней', rating: 4.9, inStock: 4 },
  { id: 6, name: 'Хризантемы осенние', price: 28, image: 'https://images.unsplash.com/photo-1571043733612-39d1e4d57447?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Яркие осенние хризантемы в теплых оттенках', category: 'Хризантемы', occasion: 'Осень', size: 'Средний', freshness: '10 дней', rating: 4.5, inStock: 20 },
  { id: 7, name: 'Лилии белые', price: 42, image: 'https://images.unsplash.com/photo-1574159103905-55b657e045cf?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Ароматные белые лилии с утонченным ароматом', category: 'Лилии', occasion: 'Траур', size: 'Большой', freshness: '6 дней', rating: 4.6, inStock: 10 },
  { id: 8, name: 'Полевые цветы', price: 25, image: 'https://images.unsplash.com/photo-1586136867486-b9da8c85c8c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Романтичный букет из полевых цветов и зелени', category: 'Полевые', occasion: 'Романтика', size: 'Маленький', freshness: '3 дня', rating: 4.4, inStock: 25 },
  { id: 9, name: 'Гортензия синяя', price: 48, image: 'https://images.unsplash.com/photo-1463320898994-e8e8ac0e3534?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Пышная синяя гортензия в элегантном оформлении', category: 'Гортензии', occasion: 'Подарок', size: 'Большой', freshness: '8 дней', rating: 4.7, inStock: 7 },
  { id: 10, name: 'Подсолнухи', price: 35, image: 'https://images.unsplash.com/photo-1597848212624-e6bf2c8b4d8a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Солнечные подсолнухи для поднятия настроения', category: 'Подсолнухи', occasion: 'Радость', size: 'Большой', freshness: '5 дней', rating: 4.6, inStock: 18 },
  { id: 11, name: 'Композиция в коробке', price: 65, image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Стильная композиция из роз и эвкалипта в шляпной коробке', category: 'Композиции', occasion: 'VIP подарок', size: 'Средний', freshness: '7 дней', rating: 4.8, inStock: 9 },
  { id: 12, name: 'Эустома разноцветная', price: 40, image: 'https://images.unsplash.com/photo-1492552264149-86a37d023ceb?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Нежная эустома в пастельных тонах', category: 'Эустома', occasion: 'Нежность', size: 'Средний', freshness: '6 дней', rating: 4.5, inStock: 14 },
  { id: 13, name: 'Каллы элегантные', price: 52, image: 'https://images.unsplash.com/photo-1518709268805-4e9042af2ac1?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Изысканные белые каллы для торжественных событий', category: 'Каллы', occasion: 'Торжество', size: 'Большой', freshness: '7 дней', rating: 4.7, inStock: 6 },
  { id: 14, name: 'Герберы яркие', price: 30, image: 'https://images.unsplash.com/photo-1516205651411-aef33a44f7c2?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Радостные герберы в ярких летних цветах', category: 'Герберы', occasion: 'Радость', size: 'Средний', freshness: '5 дней', rating: 4.4, inStock: 22 },
  { id: 15, name: 'Фрезии ароматные', price: 36, image: 'https://images.unsplash.com/photo-1511713847398-1b5e9c03035e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Ароматные фрезии с утонченным запахом', category: 'Фрезии', occasion: 'Романтика', size: 'Маленький', freshness: '4 дня', rating: 4.6, inStock: 16 },
  { id: 16, name: 'Антуриум красный', price: 58, image: 'https://images.unsplash.com/photo-1463320726281-696a485928c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Экзотический красный антуриум для особого случая', category: 'Экзотические', occasion: 'VIP подарок', size: 'Средний', freshness: '10 дней', rating: 4.8, inStock: 5 },
  { id: 17, name: 'Букет "Весенний бриз"', price: 44, image: 'https://images.unsplash.com/photo-1582794543139-8ac9cb0f7b11?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Свежий букет из нарциссов, тюльпанов и зелени', category: 'Сезонные', occasion: 'Весна', size: 'Большой', freshness: '5 дней', rating: 4.5, inStock: 11 },
  { id: 18, name: 'Протея экзотическая', price: 72, image: 'https://images.unsplash.com/photo-1583624719088-e7ee3b0ad466?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Редкая экзотическая протея из Южной Африки', category: 'Экзотические', occasion: 'Коллекционирование', size: 'Маленький', freshness: '14 дней', rating: 4.9, inStock: 3 },
  { id: 19, name: 'Сухоцветы винтаж', price: 38, image: 'https://images.unsplash.com/photo-1586136867486-b9da8c85c8c7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Стильная композиция из сухоцветов в винтажном стиле', category: 'Сухоцветы', occasion: 'Декор', size: 'Средний', freshness: '365 дней', rating: 4.3, inStock: 13 },
  { id: 20, name: 'Букет "Радужный"', price: 50, image: 'https://images.unsplash.com/photo-1597848212624-e6bf2c8b4d8a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', description: 'Многоцветный букет из разных видов цветов для яркого настроения', category: 'Микс', occasion: 'Радость', size: 'Большой', freshness: '6 дней', rating: 4.7, inStock: 8 }
];

const categories = ['Все', 'Розы', 'Тюльпаны', 'Пионы', 'Лилии', 'Свадебные', 'Горшечные', 'Экзотические', 'Сухоцветы', 'Композиции'];

const occasions = ['Все', 'Романтика', 'Свадьба', 'Подарок', 'VIP подарок', 'Весна', 'Радость', 'Торжество', 'Декор'];

const initialCartItems: CartItem[] = [
  { id: 1, name: 'Букет из красных роз', price: 45, quantity: 1, image: 'https://images.unsplash.com/photo-1490750967868-88aa4486c946?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60' },
  { id: 11, name: 'Композиция в коробке', price: 65, quantity: 1, image: 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=60&h=60' },
];

export default function Florist({ activeTab }: FloristProps) {
  const [selectedFlower, setSelectedFlower] = useState<typeof flowers[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [cartItems, setCartItems] = useState<CartItem[]>(initialCartItems);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [selectedOccasion, setSelectedOccasion] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([1, 5, 11, 18]);

  const openFlowerModal = (flower: typeof flowers[0]) => {
    setSelectedFlower(flower);
    setIsModalOpen(true);
  };

  const closeFlowerModal = () => {
    setIsModalOpen(false);
    setSelectedFlower(null);
  };

  const updateQuantity = (itemId: number, newQuantity: number) => {
    if (newQuantity < 1) return;
    setCartItems(prev => 
      prev.map(item => 
        item.id === itemId ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const removeFromCart = (itemId: number) => {
    setCartItems(prev => prev.filter(item => item.id !== itemId));
  };

  const toggleFavorite = (flowerId: number) => {
    setFavorites(prev => 
      prev.includes(flowerId) 
        ? prev.filter(id => id !== flowerId)
        : [...prev, flowerId]
    );
  };

  const filteredFlowers = flowers.filter(flower => {
    const matchesCategory = selectedCategory === 'Все' || flower.category === selectedCategory;
    const matchesOccasion = selectedOccasion === 'Все' || flower.occasion === selectedOccasion;
    
    return matchesCategory && matchesOccasion;
  });

  const cartTotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: flowers.slice(0, 6).map(item => item.image),
    priority: true
  });


  const renderHomeTab = () => (
    <div className="max-w-md mx-auto px-4 space-y-6">
      {/* Заголовок */}
      <div className="text-center">
        <h1 className="ios-title font-bold mb-2">Цветочный Рай</h1>
        <p className="ios-subheadline text-secondary-label">Свежие цветы каждый день 🌸</p>
      </div>

      {/* Быстрая доставка */}
      <div className="ios-card p-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="ios-headline font-semibold">Доставка за 2 часа</h3>
            <p className="ios-body">Свежие цветы прямо к вашей двери</p>
          </div>
          <Truck className="w-8 h-8" />
        </div>
      </div>

      {/* Популярные категории */}
      <div>
        <h2 className="ios-title font-semibold mb-4">Популярные букеты</h2>
        <div className="grid grid-cols-2 gap-3">
          {flowers.slice(0, 4).map((flower) => (
            <div 
              key={flower.id} 
              className="ios-card p-3 cursor-pointer"
              onClick={() => openFlowerModal(flower)}
            >
              <OptimizedImage src={flower.image} alt={flower.name} className="w-full h-32 object-cover rounded-lg mb-2" />
              <h4 className="ios-footnote font-semibold line-clamp-2">{flower.name}</h4>
              <p className="ios-caption2 text-secondary-label mb-2">{flower.category}</p>
              <div className="flex items-center justify-between">
                <span className="ios-caption font-bold text-system-green">${flower.price}</span>
                <div className="flex items-center space-x-1">
                  <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                  <span className="ios-caption2">{flower.rating}</span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Случаи для букетов */}
      <div>
        <h2 className="ios-title font-semibold mb-4">Букеты по случаю</h2>
        <div className="grid grid-cols-3 gap-3">
          {[
            { name: 'Романтика', icon: '💕', color: 'bg-pink-500' },
            { name: 'Свадьба', icon: '💒', color: 'bg-purple-500' },
            { name: 'VIP подарок', icon: '👑', color: 'bg-yellow-500' },
            { name: 'Радость', icon: '🌈', color: 'bg-orange-500' },
            { name: 'Торжество', icon: '🎉', color: 'bg-blue-500' },
            { name: 'Декор', icon: '🏠', color: 'bg-green-500' }
          ].map((occasion) => (
            <div 
              key={occasion.name} 
              className="ios-card p-3 text-center cursor-pointer"
              onClick={() => setSelectedOccasion(occasion.name)}
            >
              <div className={`w-10 h-10 ${occasion.color} rounded-full flex items-center justify-center mx-auto mb-2`}>
                <span className="text-lg">{occasion.icon}</span>
              </div>
              <span className="ios-caption2 font-medium">{occasion.name}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Информация о магазине */}
      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Почему выбирают нас</h3>
        <div className="space-y-2">
          <div className="flex items-center space-x-2">
            <Flower className="w-4 h-4 text-system-green" />
            <span className="ios-body">Свежие цветы каждое утро</span>
          </div>
          <div className="flex items-center space-x-2">
            <Clock className="w-4 h-4 text-system-green" />
            <span className="ios-body">Доставка 24/7 по городу</span>
          </div>
          <div className="flex items-center space-x-2">
            <Gift className="w-4 h-4 text-system-green" />
            <span className="ios-body">Красивая упаковка в подарок</span>
          </div>
        </div>
      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Каталог цветов</h1>
      
      {/* Фильтры */}
      <div className="space-y-3">
        <div className="flex space-x-2 overflow-x-auto pb-2">
          {categories.map((category) => (
            <button
              key={category}
              onClick={() => setSelectedCategory(category)}
              className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
                selectedCategory === category
                  ? 'bg-system-green text-white'
                  : 'bg-quaternary-system-fill text-label'
              }`}
            >
              {category}
            </button>
          ))}
        </div>
        
        <div className="flex space-x-2 overflow-x-auto pb-2">
          {occasions.map((occasion) => (
            <button
              key={occasion}
              onClick={() => setSelectedOccasion(occasion)}
              className={`px-3 py-1 rounded-full whitespace-nowrap ios-caption2 font-medium ${
                selectedOccasion === occasion
                  ? 'bg-system-emerald text-white'
                  : 'bg-fill text-secondary-label'
              }`}
            >
              {occasion}
            </button>
          ))}
        </div>
      </div>

      {/* Список букетов */}
      <div className="space-y-3">
        {filteredFlowers.map((flower) => (
          <div 
            key={flower.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openFlowerModal(flower)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage src={flower.image} alt={flower.name} className="w-20 h-20 object-cover rounded-lg" />
              <div className="flex-1">
                <div className="flex items-center justify-between mb-1">
                  <h4 className="ios-body font-semibold line-clamp-1">{flower.name}</h4>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(flower.id);
                    }}
                    className="p-1"
                  >
                    <Heart 
                      className={`w-4 h-4 ${
                        favorites.includes(flower.id) 
                          ? 'fill-red-500 text-red-500' 
                          : 'text-secondary-label'
                      }`} 
                    />
                  </button>
                </div>
                <p className="ios-footnote text-secondary-label mb-2 line-clamp-2">{flower.description}</p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <span className="ios-caption2 px-2 py-1 bg-quaternary-system-fill rounded">{flower.category}</span>
                    <div className="flex items-center space-x-1">
                      <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                      <span className="ios-caption2">{flower.rating}</span>
                    </div>
                    <span className="ios-caption2 text-secondary-label">{flower.freshness}</span>
                  </div>
                  <span className="ios-body font-bold text-system-green">${flower.price}</span>
                </div>
              </div>
            </div>
          </div>
        ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Корзина</h1>
      
      {cartItems.length === 0 ? (
        <div className="text-center py-12">
          <Flower className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
          <p className="ios-body text-secondary-label">Корзина пуста</p>
          <p className="ios-footnote text-tertiary-label">Добавьте букеты из каталога</p>
        </div>
      ) : (
        <>
          <div className="space-y-3">
            {cartItems.map((item) => (
              <div key={item.id} className="ios-card p-4">
                <div className="flex items-center space-x-3">
                  <OptimizedImage src={item.image} alt={item.name} className="w-20 h-20 object-cover rounded-lg" />
                  <div className="flex-1">
                    <h4 className="ios-body font-semibold">{item.name}</h4>
                    <p className="ios-footnote text-secondary-label">${item.price} за букет</p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <button
                      onClick={() => updateQuantity(item.id, item.quantity - 1)}
                      className="w-8 h-8 rounded-full bg-quaternary-system-fill flex items-center justify-center"
                    >
                      <Minus className="w-4 h-4" />
                    </button>
                    <span className="ios-body font-semibold w-8 text-center">{item.quantity}</span>
                    <button
                      onClick={() => updateQuantity(item.id, item.quantity + 1)}
                      className="w-8 h-8 rounded-full bg-system-green text-white flex items-center justify-center"
                    >
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                  <div className="text-right">
                    <p className="ios-body font-bold">${(item.price * item.quantity).toFixed(2)}</p>
                    <button
                      onClick={() => removeFromCart(item.id)}
                      className="ios-footnote text-system-red"
                    >
                      Удалить
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>

          {/* Время доставки */}
          <div className="ios-card p-4 bg-system-green/5 border border-system-green/20">
            <div className="flex items-center space-x-2 mb-2">
              <Clock className="w-4 h-4 text-system-green" />
              <span className="ios-body font-semibold text-system-green">Быстрая доставка</span>
            </div>
            <p className="ios-footnote text-secondary-label">
              Заказ будет доставлен в течение 2 часов
            </p>
          </div>

          <div className="ios-card p-4 space-y-3">
            <div className="flex justify-between items-center">
              <span className="ios-body">Подытог:</span>
              <span className="ios-body font-semibold">${cartTotal.toFixed(2)}</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="ios-body">Доставка:</span>
              <span className="ios-body font-semibold">$8.00</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="ios-body">Упаковка:</span>
              <span className="ios-body font-semibold text-system-green">Бесплатно</span>
            </div>
            <hr className="border-separator" />
            <div className="flex justify-between items-center">
              <span className="ios-headline font-bold">Итого:</span>
              <span className="ios-headline font-bold text-system-green">${(cartTotal + 8).toFixed(2)}</span>
            </div>
            
            <button className="w-full bg-system-green text-white ios-body font-semibold py-3 rounded-xl flex items-center justify-center space-x-2">
              <Calendar className="w-5 h-5" />
              <span>Выбрать время доставки</span>
            </button>
          </div>
        </>
      )}
    </div>
  );

  const renderProfileTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Профиль флориста</h1>
      
      <div className="ios-card p-4">
        <div className="flex items-center space-x-3 mb-4">
          <div className="w-16 h-16 bg-system-green rounded-full flex items-center justify-center">
            <span className="ios-title font-bold text-white">ЦР</span>
          </div>
          <div>
            <h3 className="ios-headline font-semibold">Цветочный VIP</h3>
            <p className="ios-body text-secondary-label">Постоянный покупатель</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center">
            <p className="ios-title font-bold text-system-green">47</p>
            <p className="ios-footnote text-secondary-label">Заказов</p>
          </div>
          <div className="text-center">
            <p className="ios-title font-bold text-system-purple">12%</p>
            <p className="ios-footnote text-secondary-label">Скидка</p>
          </div>
        </div>
      </div>

      <div className="space-y-3">
        <h2 className="ios-headline font-semibold">Избранные букеты</h2>
        {flowers.filter(flower => favorites.includes(flower.id)).map((flower) => (
          <div key={flower.id} className="ios-card p-3 flex items-center space-x-3">
            <OptimizedImage src={flower.image} alt={flower.name} className="w-20 h-20 object-cover rounded-lg" />
            <div className="flex-1">
              <h4 className="ios-body font-semibold line-clamp-1">{flower.name}</h4>
              <p className="ios-footnote text-secondary-label">${flower.price} • {flower.category}</p>
            </div>
            <ChevronRight className="w-5 h-5 text-tertiary-label" />
          </div>
        ))}
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">История заказов</h3>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="ios-body">Последний заказ:</span>
            <span className="ios-body font-medium">16 дек 2024</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Любимые цветы:</span>
            <span className="ios-body font-medium">Розы</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Потрачено всего:</span>
            <span className="ios-body font-medium text-system-green">$2,340</span>
          </div>
        </div>
      </div>

      <div className="ios-card p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200">
        <div className="flex items-center space-x-2 mb-2">
          <Gift className="w-5 h-5 text-system-green" />
          <span className="ios-body font-semibold text-system-green">Программа лояльности</span>
        </div>
        <p className="ios-footnote text-secondary-label mb-2">
          До следующей скидки осталось всего 3 заказа
        </p>
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div className="bg-system-green h-2 rounded-full" style={{ width: '70%' }}></div>
        </div>
      </div>
    </div>
  );

  return (
    <div className="h-full flex flex-col bg-system-background">
      <div className="flex-1 overflow-y-auto p-4">
        {activeTab === 'home' && renderHomeTab()}
        {activeTab === 'catalog' && renderCatalogTab()}
        {activeTab === 'cart' && renderCartTab()}
        {activeTab === 'profile' && renderProfileTab()}
      </div>

      {/* Модальное окно */}
      {isModalOpen && selectedFlower && (
        <div className="fixed inset-0 bg-black/50 flex items-end z-50">
          <div className="bg-system-background max-w-md mx-auto w-full rounded-t-3xl p-6 space-y-4 max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-start">
              <h3 className="ios-title font-bold line-clamp-2">{selectedFlower.name}</h3>
              <button onClick={closeFlowerModal}>
                <X className="w-6 h-6 text-secondary-label" />
              </button>
            </div>
            
            <OptimizedImage src={selectedFlower.image} alt={selectedFlower.name} className="w-full h-48 object-cover rounded-xl" />
            
            <div className="space-y-3">
              <p className="ios-body text-secondary-label">{selectedFlower.description}</p>
              
              <div className="grid grid-cols-2 gap-4">
                <div className="ios-card p-3">
                  <p className="ios-caption2 text-secondary-label">Размер</p>
                  <p className="ios-body font-semibold">{selectedFlower.size}</p>
                </div>
                <div className="ios-card p-3">
                  <p className="ios-caption2 text-secondary-label">Свежесть</p>
                  <p className="ios-body font-semibold">{selectedFlower.freshness}</p>
                </div>
              </div>
              
              <div className="flex items-center space-x-4">
                <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-quaternary-system-fill text-label">
                  {selectedFlower.category}
                </span>
                <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-system-green/10 text-system-green">
                  {selectedFlower.occasion}
                </span>
                <div className="flex items-center space-x-1">
                  <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                  <span className="ios-footnote">{selectedFlower.rating}</span>
                </div>
              </div>
              
              <div className="flex items-center justify-between">
                <span className="ios-title font-bold text-system-green">${selectedFlower.price}</span>
                <span className="ios-footnote text-secondary-label">
                  В наличии: {selectedFlower.inStock} букетов
                </span>
              </div>
              
              <button className="w-full bg-system-green text-white ios-body font-semibold py-3 rounded-xl">
                В корзину
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}```

### demos/InteriorLux.tsx
```tsx
import { useState } from "react";
import { 
  Heart, 
  Star, 
  X, 
  Home,
  Sofa,
  TrendingUp
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";
import { ConfirmDrawer } from "../ui/modern-drawer";

interface InteriorLuxProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

const products = [
  { id: 1, name: 'Диван Scandi', price: 2500, image: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?auto=format,compress&fm=webp&q=75&w=400', description: 'Элегантный диван в скандинавском стиле с мягкой обивкой', category: 'Гостиная', inStock: 5, rating: 4.8, brand: 'Nordic Home', material: 'Ткань, дерево', dimensions: '220x90x80 см' },
  { id: 2, name: 'Стол Oak Dining', price: 1800, image: 'https://images.unsplash.com/photo-1549497538-303791108f95?auto=format,compress&fm=webp&q=75&w=400', description: 'Обеденный стол из массива дуба с натуральной отделкой', category: 'Кухня', inStock: 8, rating: 4.9, brand: 'WoodCraft', material: 'Массив дуба', dimensions: '180x90x75 см' },
  { id: 3, name: 'Кресло Vintage', price: 850, image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?auto=format,compress&fm=webp&q=75&w=400', description: 'Винтажное кресло с бархатной обивкой и деревянными ножками', category: 'Гостиная', inStock: 12, rating: 4.7, brand: 'Retro Style', material: 'Бархат, дерево', dimensions: '80x75x85 см' },
  { id: 4, name: 'Кровать King Size', price: 2800, image: 'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?auto=format,compress&fm=webp&q=75&w=400', description: 'Роскошная кровать с мягким изголовьем и ортопедическим основанием', category: 'Спальня', inStock: 6, rating: 4.9, brand: 'DreamBeds', material: 'Экокожа, дерево', dimensions: '200x200x120 см' },
  { id: 5, name: 'Комод Chester', price: 950, image: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?auto=format,compress&fm=webp&q=75&w=400', description: 'Комод в английском стиле с латунными ручками', category: 'Спальня', inStock: 10, rating: 4.7, brand: 'ClassicFurniture', material: 'Массив ясеня', dimensions: '120x40x80 см' },
  { id: 6, name: 'Ковер Persian', price: 680, image: 'https://images.unsplash.com/photo-1600121848594-d8644e57abab?auto=format,compress&fm=webp&q=75&w=400', description: 'Персидский ковер ручной работы с традиционным орнаментом', category: 'Декор', inStock: 15, rating: 4.5, brand: 'Orient Rugs', material: 'Шерсть', dimensions: '200x300 см' },
  { id: 7, name: 'Люстра Crystal', price: 1500, image: 'https://images.unsplash.com/photo-1513506003901-1e6a229e2d15?auto=format,compress&fm=webp&q=75&w=400', description: 'Хрустальная люстра в классическом стиле', category: 'Декор', inStock: 4, rating: 4.8, brand: 'CrystalLight', material: 'Хрусталь, металл', dimensions: '80x80x100 см' },
  { id: 8, name: 'Столик Coffee', price: 650, image: 'https://images.unsplash.com/photo-1551298370-9d3d53740c72?auto=format,compress&fm=webp&q=75&w=400', description: 'Журнальный столик со стеклянной столешницей', category: 'Гостиная', inStock: 9, rating: 4.6, brand: 'GlassWorks', material: 'Стекло, металл', dimensions: '120x60x45 см' },
  { id: 9, name: 'Шкаф Wardrobe Pro', price: 3200, image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?auto=format,compress&fm=webp&q=75&w=400', description: 'Вместительный шкаф с зеркальными дверями', category: 'Спальня', inStock: 3, rating: 4.8, brand: 'StoragePlus', material: 'ЛДСП, зеркало', dimensions: '200x60x240 см' },
  { id: 10, name: 'Картина Abstract', price: 350, image: 'https://images.unsplash.com/photo-1561214115-f2f134cc4912?auto=format,compress&fm=webp&q=75&w=400', description: 'Абстрактная картина маслом в современном стиле', category: 'Декор', inStock: 20, rating: 4.2, brand: 'ArtGallery', material: 'Холст, масло', dimensions: '60x80 см' },
  { id: 11, name: 'Стеллаж Industrial', price: 1200, image: 'https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?auto=format,compress&fm=webp&q=75&w=400', description: 'Стеллаж в индустриальном стиле с полками из дерева', category: 'Гостиная', inStock: 7, rating: 4.6, brand: 'MetalWorks', material: 'Металл, дерево', dimensions: '180x40x200 см' },
  { id: 12, name: 'Барный стул Loft', price: 280, image: 'https://images.unsplash.com/photo-1503602642458-232111445657?auto=format,compress&fm=webp&q=75&w=400', description: 'Барный стул в стиле лофт с регулируемой высотой', category: 'Кухня', inStock: 18, rating: 4.4, brand: 'UrbanStyle', material: 'Металл, экокожа', dimensions: '45x45x85 см' },
  { id: 13, name: 'Тумба TV Stand', price: 750, image: 'https://images.unsplash.com/photo-1594026112284-02bb6f3352fe?auto=format,compress&fm=webp&q=75&w=400', description: 'Современная тумба под телевизор с ящиками', category: 'Гостиная', inStock: 11, rating: 4.5, brand: 'MediaFurniture', material: 'МДФ, стекло', dimensions: '160x40x50 см' },
  { id: 14, name: 'Зеркало Gold Frame', price: 320, image: 'https://images.unsplash.com/photo-1618220924273-338d82d6a886?auto=format,compress&fm=webp&q=75&w=400', description: 'Зеркало в золотой раме барокко', category: 'Декор', inStock: 14, rating: 4.4, brand: 'DecorArt', material: 'Дерево, позолота', dimensions: '80x120 см' },
  { id: 15, name: 'Пуф Ottoman', price: 280, image: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?auto=format,compress&fm=webp&q=75&w=400', description: 'Круглый пуф с местом для хранения', category: 'Гостиная', inStock: 16, rating: 4.3, brand: 'ComfortSeating', material: 'Ткань, поролон', dimensions: '60x60x40 см' },
  { id: 16, name: 'Обеденный стул Nordic', price: 180, image: 'https://images.unsplash.com/photo-1503602642458-232111445657?auto=format,compress&fm=webp&q=75&w=400', description: 'Скандинавский обеденный стул из массива бука', category: 'Кухня', inStock: 24, rating: 4.6, brand: 'Nordic Home', material: 'Массив бука, ткань', dimensions: '45x50x80 см' },
  { id: 17, name: 'Подушки Velvet Set', price: 120, image: 'https://images.unsplash.com/photo-1584100936595-c0654b55a2e2?auto=format,compress&fm=webp&q=75&w=400', description: 'Набор бархатных подушек (4 шт)', category: 'Декор', inStock: 30, rating: 4.5, brand: 'SoftDecor', material: 'Бархат', dimensions: '45x45 см' },
  { id: 18, name: 'Торшер Modern Arc', price: 450, image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format,compress&fm=webp&q=75&w=400', description: 'Современный торшер с мраморным основанием', category: 'Декор', inStock: 8, rating: 4.6, brand: 'LightDesign', material: 'Мрамор, металл', dimensions: '40x40x180 см' },
  { id: 19, name: 'Кухонный остров', price: 2200, image: 'https://images.unsplash.com/photo-1556912172-45b7abe8b7e1?auto=format,compress&fm=webp&q=75&w=400', description: 'Кухонный остров с мраморной столешницей', category: 'Кухня', inStock: 4, rating: 4.9, brand: 'KitchenPro', material: 'Дерево, мрамор', dimensions: '180x90x90 см' },
  { id: 20, name: 'Прикроватная тумба', price: 380, image: 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?auto=format,compress&fm=webp&q=75&w=400', description: 'Прикроватная тумба с выдвижными ящиками', category: 'Спальня', inStock: 13, rating: 4.5, brand: 'DreamBeds', material: 'МДФ', dimensions: '50x40x60 см' }
];

const categories = ['Все', 'Гостиная', 'Спальня', 'Кухня', 'Декор'];

export default function InteriorLux({ activeTab }: InteriorLuxProps) {
  const [selectedProduct, setSelectedProduct] = useState<typeof products[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([1, 4, 11]);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: products.slice(0, 6).map(p => p.image),
    priority: true
  });

  const openProductModal = (product: typeof products[0]) => {
    setSelectedProduct(product);
    setIsModalOpen(true);
  };

  const closeProductModal = () => {
    setIsModalOpen(false);
    setTimeout(() => setSelectedProduct(null), 300);
  };

  const toggleFavorite = (productId: number) => {
    setFavorites(prev => 
      prev.includes(productId) 
        ? prev.filter(id => id !== productId)
        : [...prev, productId]
    );
  };

  const filteredProducts = selectedCategory === 'Все' 
    ? products 
    : products.filter(p => p.category === selectedCategory);

  // HOME TAB - Ultra Minimalist 2025
  const renderHomeTab = () => (
    <div className="min-h-screen bg-white font-montserrat pb-24">
      <div className="max-w-md mx-auto px-4 py-8 space-y-8">
        {/* Minimalist Header */}
        <div className="text-center space-y-4">
          <div className="w-20 h-20 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl mx-auto flex items-center justify-center shadow-lg">
            <Home className="w-10 h-10 text-white" strokeWidth={2} />
          </div>
          <div>
            <h1 className="text-3xl font-bold text-gray-900 mb-2">InteriorLux</h1>
            <p className="text-sm text-gray-500">Дизайнерская мебель и декор</p>
          </div>
        </div>

        {/* Hero Section */}
        <div className="relative bg-gradient-to-br from-emerald-500 to-teal-600 rounded-3xl p-8 text-white overflow-hidden">
          <div className="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-3xl"></div>
          <div className="absolute bottom-0 left-0 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
          <div className="relative z-10">
            <h2 className="text-2xl font-bold mb-3">Коллекция 2025</h2>
            <p className="text-white/90 mb-4">Создайте дом своей мечты с нашей мебелью</p>
            <button 
              onClick={() => setSelectedCategory('Гостиная')}
              className="px-6 py-3 bg-white text-emerald-600 rounded-xl font-semibold hover:shadow-lg transition-all duration-300"
              data-testid="button-view-collection"
            >
              Смотреть каталог
            </button>
          </div>
        </div>

        {/* Categories Grid */}
        <div className="space-y-6">
          <div className="flex items-center justify-between">
            <h2 className="text-2xl font-bold text-gray-900">Категории</h2>
            <TrendingUp className="w-5 h-5 text-emerald-600" />
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer"
              onClick={() => setSelectedCategory('Гостиная')}
              data-testid="category-living"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Sofa className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Гостиная</h3>
              <p className="text-center text-sm text-gray-500">42 товара</p>
            </div>

            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer"
              onClick={() => setSelectedCategory('Спальня')}
              data-testid="category-bedroom"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Star className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Спальня</h3>
              <p className="text-center text-sm text-gray-500">28 товаров</p>
            </div>

            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer"
              onClick={() => setSelectedCategory('Кухня')}
              data-testid="category-kitchen"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-orange-500 to-amber-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Home className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Кухня</h3>
              <p className="text-center text-sm text-gray-500">18 товаров</p>
            </div>

            <div 
              className="group bg-gray-50 rounded-2xl p-6 hover:shadow-lg transition-all duration-300 cursor-pointer"
              onClick={() => setSelectedCategory('Декор')}
              data-testid="category-decor"
            >
              <div className="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <Heart className="w-6 h-6 text-white" />
              </div>
              <h3 className="text-center font-semibold text-gray-900 mb-1">Декор</h3>
              <p className="text-center text-sm text-gray-500">34 товара</p>
            </div>
          </div>
        </div>

        {/* Popular Items */}
        <div className="space-y-6">
          <h2 className="text-2xl font-bold text-gray-900">Популярное</h2>
          <div className="grid grid-cols-2 gap-4">
            {products.slice(0, 6).map(product => (
              <div 
                key={product.id}
                className="group bg-white rounded-2xl overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer border border-gray-100"
                onClick={() => openProductModal(product)}
                data-testid={`product-card-${product.id}`}
              >
                <div className="relative aspect-square overflow-hidden bg-gray-100">
                  <OptimizedImage 
                    src={product.image}
                    alt={product.name}
                    className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                    priority={product.id <= 4}
                  />
                  <button 
                    className="absolute top-3 right-3 w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    data-testid={`button-favorite-${product.id}`}
                  >
                    <Heart 
                      className={`w-5 h-5 ${favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-gray-400'}`} 
                      strokeWidth={2}
                    />
                  </button>
                </div>
                <div className="p-4 space-y-2">
                  <div className="text-xs font-medium text-emerald-600 mb-1">{product.category}</div>
                  <h3 className="font-semibold text-gray-900 line-clamp-2 text-sm">{product.name}</h3>
                  <div className="flex items-center justify-between">
                    <p className="text-lg font-bold text-gray-900">${product.price.toLocaleString()}</p>
                    <div className="flex items-center gap-1">
                      <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                      <span className="text-xs text-gray-600">{product.rating}</span>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );

  // CATALOG TAB - Modern Grid with Sticky Pills
  const renderCatalogTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat pb-24">
      {/* Sticky Category Pills */}
      <div className="sticky top-0 z-20 bg-white border-b border-gray-200 py-5 px-4">
        <div className="max-w-md mx-auto">
          <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
            {categories.map(cat => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-4 py-2 rounded-full whitespace-nowrap transition-all duration-300 font-medium text-sm ${
                  selectedCategory === cat 
                    ? 'bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg' 
                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                }`}
                data-testid={`filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Products Grid */}
      <div className="max-w-md mx-auto px-4 py-6">
        <div className="mb-4">
          <p className="text-sm text-gray-600">Найдено {filteredProducts.length} товаров</p>
        </div>
        <div className="grid grid-cols-2 gap-4">
          {filteredProducts.map(product => (
            <div 
              key={product.id}
              className="group bg-white rounded-2xl overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer"
              onClick={() => openProductModal(product)}
              data-testid={`product-${product.id}`}
            >
              <div className="relative aspect-square overflow-hidden bg-gray-100">
                <OptimizedImage 
                  src={product.image}
                  alt={product.name}
                  className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                  priority={product.id <= 4}
                />
                <button 
                  className="absolute top-3 right-3 w-10 h-10 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(product.id);
                  }}
                  data-testid={`favorite-${product.id}`}
                >
                  <Heart 
                    className={`w-5 h-5 ${favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-gray-400'}`}
                    strokeWidth={2}
                  />
                </button>
              </div>
              <div className="p-4 space-y-2">
                <div className="text-xs font-medium text-emerald-600 mb-1">{product.category}</div>
                <h3 className="font-semibold text-gray-900 line-clamp-2 text-sm">{product.name}</h3>
                <div className="flex items-center justify-between">
                  <p className="text-lg font-bold text-gray-900">${product.price.toLocaleString()}</p>
                  <div className="flex items-center gap-1">
                    <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                    <span className="text-xs text-gray-600">{product.rating}</span>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  // CART TAB
  const renderCartTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat pb-24">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="text-2xl font-bold text-gray-900">Корзина</h1>
        <div className="text-center py-16">
          <Home className="w-16 h-16 text-gray-300 mx-auto mb-4" />
          <p className="text-gray-500">Корзина пуста</p>
        </div>
      </div>
    </div>
  );

  // PROFILE TAB
  const renderProfileTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat pb-24">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="text-2xl font-bold text-gray-900">Профиль</h1>
        <div className="bg-white rounded-2xl p-6">
          <p className="text-gray-600">Профиль пользователя</p>
        </div>
      </div>
    </div>
  );

  // PRODUCT DETAIL MODAL
  const renderProductModal = () => {
    if (!selectedProduct) return null;

    return (
      <div 
        className={`fixed inset-0 z-50 bg-white transition-all duration-300 ${
          isModalOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'
        }`}
        style={{ overflowY: 'auto' }}
      >
        <div className="max-w-md mx-auto">
          {/* Close Button */}
          <button 
            onClick={closeProductModal}
            className="fixed top-4 right-4 z-10 w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-lg hover:scale-110 transition-transform"
            data-testid="button-close-modal"
          >
            <X className="w-6 h-6 text-gray-900" />
          </button>

          {/* Product Image */}
          <div className="relative aspect-square overflow-hidden bg-gray-100">
            <OptimizedImage 
              src={selectedProduct.image}
              alt={selectedProduct.name}
              className="w-full h-full object-cover"
            />
          </div>

          {/* Product Info */}
          <div className="p-6 space-y-6">
            {/* Category Badge */}
            <div className="inline-block px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-full text-sm font-semibold">
              {selectedProduct.category}
            </div>

            {/* Title & Price */}
            <div className="space-y-2">
              <h1 className="text-3xl font-bold text-gray-900">{selectedProduct.name}</h1>
              <div className="flex items-center justify-between">
                <p className="text-3xl font-bold text-emerald-600">${selectedProduct.price.toLocaleString()}</p>
                <div className="flex items-center gap-2">
                  <Star className="w-5 h-5 fill-yellow-400 text-yellow-400" />
                  <span className="text-lg font-semibold text-gray-900">{selectedProduct.rating}</span>
                  <span className="text-gray-500">(87)</span>
                </div>
              </div>
            </div>

            {/* Brand */}
            <div className="text-sm text-gray-600">
              от <span className="font-semibold text-gray-900">{selectedProduct.brand}</span>
            </div>

            {/* Description */}
            <p className="text-gray-700 leading-relaxed">{selectedProduct.description}</p>

            {/* Specifications */}
            <div className="space-y-4">
              <h3 className="text-lg font-semibold text-gray-900">Характеристики</h3>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-gray-50 rounded-xl p-4">
                  <p className="text-sm text-gray-500 mb-1">Размеры</p>
                  <p className="font-semibold text-gray-900">{selectedProduct.dimensions}</p>
                </div>
                <div className="bg-gray-50 rounded-xl p-4">
                  <p className="text-sm text-gray-500 mb-1">Материал</p>
                  <p className="font-semibold text-gray-900">{selectedProduct.material}</p>
                </div>
              </div>
            </div>

            {/* Stock */}
            <div className="flex items-center gap-2">
              <div className="w-2 h-2 bg-green-500 rounded-full"></div>
              <span className="text-sm text-green-600 font-medium">В наличии {selectedProduct.inStock} шт</span>
            </div>

            {/* Add to Cart Button */}
            <ConfirmDrawer
              trigger={
                <button 
                  className="w-full py-4 bg-gradient-to-r from-emerald-500 to-teal-600 text-white rounded-xl font-semibold text-lg hover:shadow-xl transition-all duration-300"
                  data-testid="button-add-to-cart"
                >
                  Добавить в корзину
                </button>
              }
              title="Добавить в корзину?"
              description={`${selectedProduct.name} — ${new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'USD', minimumFractionDigits: 0 }).format(selectedProduct.price)}`}
              confirmText="Добавить"
              cancelText="Отмена"
              variant="default"
              onConfirm={() => setSelectedProduct(null)}
            />
          </div>
        </div>
      </div>
    );
  };

  return (
    <>
      {activeTab === 'home' && renderHomeTab()}
      {activeTab === 'catalog' && renderCatalogTab()}
      {activeTab === 'cart' && renderCartTab()}
      {activeTab === 'profile' && renderProfileTab()}
      {renderProductModal()}
    </>
  );
}
```

### demos/Medical.tsx
```tsx
import React, { useState } from 'react';
import {
  Heart,
  Calendar,
  UserCheck,
  Clock,
  Star,
  Stethoscope,
  Activity,
  Pill,
  Shield,
  Phone,
  MapPin,
  Plus
} from 'lucide-react';
import { OptimizedImage } from "../OptimizedImage";

interface MedicalProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
  onNavigate: (tab: string) => void;
}

interface Service {
  id: number;
  name: string;
  specialty: string;
  doctor: string;
  price: number;
  duration: string;
  rating: number;
  image: string;
  available: boolean;
}

interface CartItem extends Service {
  quantity: number;
  appointment: string;
}

const services: Service[] = [
  {
    id: 1,
    name: 'Общий осмотр',
    specialty: 'Терапевт',
    doctor: 'Др. Иванов А.С.',
    price: 80,
    duration: '30 мин',
    rating: 4.9,
    image: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=800&h=500&fit=crop&crop=center',
    available: true
  },
  {
    id: 2,
    name: 'Кардиограмма',
    specialty: 'Кардиолог',
    doctor: 'Др. Петрова М.В.',
    price: 120,
    duration: '45 мин',
    rating: 4.8,
    image: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?w=800&h=500&fit=crop&crop=center',
    available: true
  },
  {
    id: 3,
    name: 'УЗИ диагностика',
    specialty: 'Диагност',
    doctor: 'Др. Смирнов В.К.',
    price: 150,
    duration: '60 мин',
    rating: 4.7,
    image: 'https://images.unsplash.com/photo-1551601651-2a8555f1a136?w=800&h=500&fit=crop&crop=center',
    available: true
  },
  {
    id: 4,
    name: 'Стоматология',
    specialty: 'Стоматолог',
    doctor: 'Др. Козлова Е.Н.',
    price: 200,
    duration: '90 мин',
    rating: 4.9,
    image: 'https://images.unsplash.com/photo-1606811971618-4486d14f3f99?w=800&h=500&fit=crop&crop=center',
    available: true
  }
];

const categories = ['Все', 'Терапевт', 'Кардиолог', 'Диагност', 'Стоматолог'];

export default function Medical({ activeTab, onNavigate }: MedicalProps) {
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [cartItems, setCartItems] = useState<CartItem[]>([]);
  const [selectedService, setSelectedService] = useState<Service | null>(null);

  const filteredServices = selectedCategory === 'Все' 
    ? services 
    : services.filter(service => service.specialty === selectedCategory);

  const addToCart = (service: Service) => {
    const existingItem = cartItems.find(item => item.id === service.id);
    if (existingItem) {
      setCartItems(prev => 
        prev.map(item => 
          item.id === service.id ? { ...item, quantity: item.quantity + 1 } : item
        )
      );
    } else {
      setCartItems(prev => [...prev, { ...service, quantity: 1, appointment: 'Ближайшее время' }]);
    }
  };

  const removeFromCart = (serviceId: number) => {
    setCartItems(prev => prev.filter(item => item.id !== serviceId));
  };

  const updateQuantity = (serviceId: number, newQuantity: number) => {
    if (newQuantity === 0) {
      removeFromCart(serviceId);
      return;
    }
    setCartItems(prev => 
      prev.map(item => 
        item.id === serviceId ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const openServiceModal = (service: Service) => {
    setSelectedService(service);
  };

  const closeServiceModal = () => {
    setSelectedService(null);
  };

  const cartTotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  const renderHomeTab = () => (
    <div className="min-h-screen bg-blue-50 font-montserrat">
      <div className="max-w-md mx-auto">
        
        {/* Medical Header */}
        <div className="px-6 pt-20 pb-16 text-center">
          <div className="w-20 h-20 bg-blue-600 rounded-xl flex items-center justify-center mx-auto mb-8">
            <Heart className="w-6 h-6 text-white" />
          </div>
          <h1 className="text-2xl font-semibold text-blue-900 mb-3 tracking-wide">MediCare Center</h1>
          <p className="text-blue-600 text-sm font-medium">Premium Healthcare Services</p>
        </div>

        {/* Hero Medical Section */}
        <div className="px-6 pb-20">
          <div className="aspect-[16/10] rounded-2xl overflow-hidden bg-blue-100 mb-12 relative">
            <OptimizedImage 
              src="https://images.unsplash.com/photo-1631217868264-e5b90bb7e133?w=800&h=500&fit=crop&crop=center" 
              alt="Premium Medical Care"
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-blue-900/80 via-blue-900/40 to-transparent" />
            <div className="absolute bottom-6 left-6 right-6 text-white">
              <h2 className="text-xl font-semibold mb-2">Your Health, Our Priority</h2>
              <p className="text-white/80 text-sm mb-4">Expert medical care with modern technology</p>
              <button 
                className="bg-white text-blue-900 px-6 py-2 rounded-lg text-sm font-medium hover:bg-blue-50 transition-colors"
                onClick={() => openServiceModal(services[0])}
              >
                Book Appointment
              </button>
            </div>
          </div>
        </div>

        {/* Medical Stats */}
        <div className="px-6 py-20 border-t border-blue-200">
          <div className="text-center mb-16">
            <h3 className="text-lg font-semibold text-blue-900 mb-4">Trusted Healthcare</h3>
            <p className="text-blue-600 text-sm font-medium leading-relaxed">
              Professional medical services with experienced doctors and modern equipment.
            </p>
          </div>
          
          <div className="grid grid-cols-2 gap-12 text-center">
            {[
              { number: '50+', label: 'Doctors' },
              { number: '10K+', label: 'Patients' },
              { number: '24/7', label: 'Emergency' },
              { number: '98%', label: 'Satisfaction' }
            ].map((stat, index) => (
              <div key={index}>
                <div className="text-2xl font-bold text-blue-600 mb-1">{stat.number}</div>
                <div className="text-blue-500 text-xs font-medium">{stat.label}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Featured Services */}
        <div className="px-6 py-20 border-t border-blue-200">
          <div className="flex items-center justify-between mb-12">
            <h3 className="text-lg font-semibold text-blue-900">Popular Services</h3>
            <button 
              className="text-blue-500 text-sm font-medium hover:text-blue-600 transition-colors"
              onClick={() => setSelectedCategory('Все')}
            >
              View all
            </button>
          </div>
          
          <div className="space-y-12">
            {services.slice(0, 2).map((service, index) => (
              <div 
                key={service.id} 
                className="group cursor-pointer"
                onClick={() => openServiceModal(service)}
              >
                <div className="aspect-[5/3] rounded-xl overflow-hidden bg-blue-100 mb-6 relative">
                  <OptimizedImage 
                    src={service.image}
                    alt={service.name}
                    className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                  />
                  <div className="absolute top-3 left-3 bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded">
                    {service.duration}
                  </div>
                  <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm text-blue-900 text-xs font-medium px-2 py-1 rounded flex items-center space-x-1">
                    <Star className="w-3 h-3 text-blue-500 fill-current" />
                    <span>{service.rating}</span>
                  </div>
                </div>
                <div className="space-y-3">
                  <div className="flex items-start justify-between">
                    <div>
                      <h4 className="text-blue-900 font-semibold text-base">{service.name}</h4>
                      <p className="text-blue-500 text-sm font-medium">{service.doctor}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-blue-900 font-semibold">${service.price}</p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Медицинские услуги</h1>
      
      {/* Categories */}
      <div className="flex space-x-2 overflow-x-auto pb-2">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setSelectedCategory(category)}
            className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
              selectedCategory === category
                ? 'bg-system-blue text-white'
                : 'bg-quaternary-system-fill text-label'
            }`}
          >
            {category}
          </button>
        ))}
      </div>

      {/* Services List */}
      <div className="space-y-3">
        {filteredServices.map((service) => (
          <div 
            key={service.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openServiceModal(service)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage
                src={service.image}
                alt={service.name}
                className="w-20 h-20 rounded-lg object-cover"
              />
              <div className="flex-1">
                <h4 className="ios-body font-semibold">{service.name}</h4>
                <p className="ios-footnote text-secondary-label">{service.doctor}</p>
                <div className="flex items-center justify-between mt-2">
                  <span className="ios-body font-bold text-system-blue">${service.price}</span>
                  <div className="flex items-center space-x-1">
                    <Star className="w-3 h-3 text-system-orange" />
                    <span className="ios-caption2">{service.rating}</span>
                  </div>
                </div>
              </div>
              <div className="text-right">
                <div className={`w-3 h-3 rounded-full ${service.available ? 'bg-system-green' : 'bg-system-red'}`}></div>
                <p className="ios-caption2 text-secondary-label mt-1">{service.duration}</p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Записи на прием</h1>
        
        {cartItems.length === 0 ? (
          <div className="text-center py-12">
            <Heart className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
            <h2 className="ios-title font-semibold text-secondary-label mb-2">Нет записей</h2>
            <p className="ios-body text-tertiary-label">Выберите медицинскую услугу для записи</p>
          </div>
        ) : (
          <>
            <div className="space-y-3">
              {cartItems.map((item) => (
                <div key={item.id} className="ios-card p-4">
                  <div className="flex items-center space-x-3">
                    <OptimizedImage
                      src={item.image}
                      alt={item.name}
                      className="w-20 h-20 rounded-lg object-cover"
                    />
                    <div className="flex-1">
                      <h4 className="ios-body font-semibold">{item.name}</h4>
                      <p className="ios-footnote text-secondary-label">{item.doctor}</p>
                      <p className="ios-caption2 text-system-blue">${item.price}</p>
                    </div>
                    <div className="flex items-center space-x-2">
                      <button
                        onClick={() => updateQuantity(item.id, item.quantity - 1)}
                        className="w-8 h-8 rounded-full bg-quaternary-system-fill flex items-center justify-center"
                      >
                        <span className="text-lg font-medium">-</span>
                      </button>
                      <span className="ios-body font-semibold w-8 text-center">{item.quantity}</span>
                      <button
                        onClick={() => updateQuantity(item.id, item.quantity + 1)}
                        className="w-8 h-8 rounded-full bg-system-blue flex items-center justify-center"
                      >
                        <Plus className="w-4 h-4 text-white" />
                      </button>
                    </div>
                  </div>
                </div>
              ))}
            </div>
            
            <div className="ios-card p-4">
              <div className="flex justify-between items-center">
                <span className="ios-headline font-semibold">Итого</span>
                <span className="ios-headline font-bold text-system-blue">${cartTotal}</span>
              </div>
              <button className="w-full bg-system-blue text-white ios-body font-semibold py-3 rounded-xl mt-4">
                Записаться на прием
              </button>
            </div>
          </>
        )}
      </div>
    </div>
  );

  const renderProfileTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Профиль пациента</h1>
        
        <div className="ios-card p-6 text-center">
          <div className="w-20 h-20 bg-system-blue rounded-full flex items-center justify-center mx-auto mb-4">
            <UserCheck className="w-10 h-10 text-white" />
          </div>
          <h2 className="ios-headline font-semibold mb-1">Иван Петров</h2>
          <p className="ios-footnote text-secondary-label">Постоянный пациент</p>
        </div>

        <div className="space-y-1">
          <div className="ios-list-item">
            <Calendar className="w-5 h-5 text-system-blue" />
            <span className="ios-body">История приемов</span>
          </div>
          <div className="ios-list-item">
            <Activity className="w-5 h-5 text-system-green" />
            <span className="ios-body">Медицинская карта</span>
          </div>
          <div className="ios-list-item">
            <Shield className="w-5 h-5 text-system-orange" />
            <span className="ios-body">Страховка</span>
          </div>
        </div>
      </div>
    </div>
  );

  // Service Modal
  if (selectedService) {
    return (
      <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
          <div className="relative">
            <OptimizedImage
              src={selectedService.image}
              alt={selectedService.name}
              className="w-full h-48 object-cover rounded-t-2xl"
            />
            <button
              onClick={closeServiceModal}
              className="absolute top-4 right-4 w-8 h-8 bg-black/20 rounded-full flex items-center justify-center text-white"
            >
              ×
            </button>
          </div>
          
          <div className="p-6 space-y-4">
            <div>
              <h2 className="ios-title font-bold mb-2">{selectedService.name}</h2>
              <p className="ios-body text-secondary-label">{selectedService.doctor}</p>
            </div>
            
            <div className="flex items-center space-x-4">
              <div className="flex items-center space-x-1">
                <Star className="w-4 h-4 text-system-orange" />
                <span className="ios-body">{selectedService.rating}</span>
              </div>
              <div className="flex items-center space-x-1">
                <Clock className="w-4 h-4 text-system-blue" />
                <span className="ios-body">{selectedService.duration}</span>
              </div>
            </div>
            
            <div className="flex items-center justify-between py-4 border-t border-separator">
              <span className="ios-headline font-semibold">${selectedService.price}</span>
              <button
                onClick={() => {
                  addToCart(selectedService);
                  closeServiceModal();
                }}
                className="bg-system-blue text-white px-6 py-2 rounded-xl ios-body font-semibold"
              >
                Записаться
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  switch (activeTab) {
    case 'catalog':
      return renderCatalogTab();
    case 'cart':
      return renderCartTab();
    case 'profile':
      return renderProfileTab();
    default:
      return renderHomeTab();
  }
}```

### demos/PremiumFashionStore.tsx
```tsx
import { useState, useEffect, memo } from "react";
import { m, AnimatePresence } from "framer-motion";
import { Heart, ShoppingBag, X, ChevronLeft, Filter, Star, Package, CreditCard, MapPin, Settings, LogOut, User, Sparkles, TrendingUp, Zap, Search, Menu } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { ConfirmDrawer } from "../ui/modern-drawer";
import { Skeleton } from "../ui/skeleton";
import { useFilter } from "@/hooks/useFilter";
import blackHoodieImage from "@assets/c63bf9171394787.646e06bedc2c7_1761732722277.jpg";
import colorfulHoodieImage from "@assets/fb10cc201496475.6675676d24955_1761732737648.jpg";

// Video served from public/videos/ to reduce Docker image size  
const fashionVideo = "/videos/4e4993d0ac079a607a0bee301af06749_1761775010830.mp4";

interface PremiumFashionStoreProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  size: string;
  quantity: number;
  image: string;
  color: string;
}

interface Order {
  id: number;
  items: CartItem[];
  total: number;
  date: string;
  status: 'processing' | 'shipped' | 'delivered';
}

interface Product {
  id: number;
  name: string;
  price: number;
  oldPrice?: number;
  image: string;
  hoverImage: string;
  description: string;
  sizes: string[];
  colors: string[];
  colorHex: string[];
  category: string;
  gender: 'Men' | 'Woman' | 'Children';
  inStock: number;
  rating: number;
  brand: string;
  isNew?: boolean;
  isTrending?: boolean;
}

const products: Product[] = [
  { 
    id: 1, 
    name: 'Carbon Collection Hoodie', 
    price: 12900, 
    oldPrice: 15900,
    image: blackHoodieImage, 
    hoverImage: blackHoodieImage,
    description: 'Премиальный черный худи Carbon Collection с минималистичным дизайном', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Графит'], 
    colorHex: ['#1A1A1A', '#2D2D2D'],
    category: 'Худи', 
    gender: 'Men',
    inStock: 15, 
    rating: 5.0, 
    brand: 'CARBON',
    isNew: true,
    isTrending: true
  },
  { 
    id: 2, 
    name: 'Colorblock Hoodie', 
    price: 13900, 
    oldPrice: 17900,
    image: colorfulHoodieImage, 
    hoverImage: colorfulHoodieImage,
    description: 'Яркий разноцветный худи с уникальной комбинацией цветов', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Мульти', 'Фиолетовый'], 
    colorHex: ['#9B59B6', '#7E57C2'],
    category: 'Худи', 
    gender: 'Men',
    inStock: 8, 
    rating: 4.9, 
    brand: 'URBAN',
    isNew: true,
    isTrending: true
  },
  { 
    id: 3, 
    name: 'Olive Puffer', 
    price: 52900, 
    oldPrice: 67000,
    image: 'https://images.unsplash.com/photo-1544441893-675973e31985?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=1200&fit=crop&q=90',
    description: 'Роскошный пуховик оливкового цвета премиум класса', 
    sizes: ['XS', 'S', 'M', 'L'], 
    colors: ['Оливковый', 'Черный', 'Бежевый'], 
    colorHex: ['#9CAF88', '#1A1A1A', '#D4A574'],
    category: 'Куртки', 
    gender: 'Men',
    inStock: 5, 
    rating: 5.0, 
    brand: 'PUFF',
    isNew: true,
    isTrending: true
  },
  { 
    id: 4, 
    name: 'Orange Oversized', 
    price: 25500, 
    oldPrice: 35000,
    image: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=800&h=1200&fit=crop&q=90',
    description: 'Яркий оверсайз пуховик для стильного образа', 
    sizes: ['S', 'M', 'L', 'XL'], 
    colors: ['Оранжевый', 'Желтый'], 
    colorHex: ['#F97316', '#EAB308'],
    category: 'Куртки', 
    gender: 'Woman',
    inStock: 8, 
    rating: 4.9, 
    brand: 'PUFF',
    isNew: true,
    isTrending: true
  },
  { 
    id: 5, 
    name: 'Pink Classic', 
    price: 35000, 
    image: 'https://images.unsplash.com/photo-1485968579580-b6d095142e6e?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?w=800&h=1200&fit=crop&q=90',
    description: 'Элегантный розовый пуховик с капюшоном', 
    sizes: ['XS', 'S', 'M', 'L'], 
    colors: ['Розовый', 'Фиолетовый'], 
    colorHex: ['#EC4899', '#A855F7'],
    category: 'Куртки', 
    gender: 'Woman',
    inStock: 10, 
    rating: 5.0, 
    brand: 'PUFF',
    isTrending: true
  },
  { 
    id: 6, 
    name: 'Blue Winter', 
    price: 43000, 
    image: 'https://images.unsplash.com/photo-1539533018447-63fcce2678e3?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=800&h=1200&fit=crop&q=90',
    description: 'Зимняя куртка с утеплителем премиум класса', 
    sizes: ['S', 'M', 'L'], 
    colors: ['Синий', 'Черный'], 
    colorHex: ['#3B82F6', '#1A1A1A'],
    category: 'Куртки', 
    gender: 'Children',
    inStock: 6, 
    rating: 4.8, 
    brand: 'PUFF' 
  },
  { 
    id: 7, 
    name: 'Black Bomber', 
    price: 31000, 
    image: 'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1490481651871-ab68de25d43d?w=800&h=1200&fit=crop&q=90',
    description: 'Классический черный бомбер на любой случай', 
    sizes: ['XS', 'S', 'M', 'L', 'XL'], 
    colors: ['Черный', 'Серый'], 
    colorHex: ['#1A1A1A', '#6B7280'],
    category: 'Куртки', 
    gender: 'Men',
    inStock: 12, 
    rating: 4.9, 
    brand: 'PUFF',
    isNew: true
  },
  { 
    id: 8, 
    name: 'Beige Trench', 
    price: 57000, 
    image: 'https://images.unsplash.com/photo-1434389677669-e08b4cac3105?w=800&h=1200&fit=crop&q=90', 
    hoverImage: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=800&h=1200&fit=crop&q=90',
    description: 'Элегантный тренч бежевого цвета', 
    sizes: ['S', 'M', 'L'], 
    colors: ['Бежевый', 'Кэмел'], 
    colorHex: ['#D4A574', '#C19A6B'],
    category: 'Пальто', 
    gender: 'Woman',
    inStock: 4, 
    rating: 5.0, 
    brand: 'PUFF' 
  },
];

const categories = ['Все', 'Худи', 'Куртки', 'Пальто'];
const genderFilters = ['All', 'Men', 'Woman', 'Children'];

function PremiumFashionStore({ activeTab }: PremiumFashionStoreProps) {
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [selectedSize, setSelectedSize] = useState<string>('');
  const [selectedColor, setSelectedColor] = useState<string>('');
  const [favorites, setFavorites] = useState<Set<number>>(new Set());
  const [cart, setCart] = useState<CartItem[]>([]);
  const [orders, setOrders] = useState<Order[]>([]);
  const [selectedCategory, setSelectedCategory] = useState<string>('Все');
  const [selectedGender, setSelectedGender] = useState<string>('All');
  const [showCheckoutSuccess, setShowCheckoutSuccess] = useState(false);
  const [loadedImages, setLoadedImages] = useState<Set<number>>(new Set());

  const { filteredItems, searchQuery, handleSearch } = useFilter({
    items: products,
    searchFields: ['name', 'description', 'category', 'brand'] as (keyof Product)[],
  });

  useEffect(() => {
    if (activeTab !== 'catalog') {
      setSelectedProduct(null);
    }
    if (activeTab !== 'home') {
      setSelectedGender('All');
    }
  }, [activeTab]);

  const filteredProducts = filteredItems.filter(p => {
    const categoryMatch = selectedCategory === 'Все' || p.category === selectedCategory;
    
    if (activeTab === 'home') {
      const genderMatch = selectedGender === 'All' || p.gender === selectedGender;
      return categoryMatch && genderMatch;
    }
    
    return categoryMatch;
  });

  const handleImageLoad = (productId: number) => {
    setLoadedImages(prev => new Set(prev).add(productId));
  };

  const toggleFavorite = (productId: number) => {
    const newFavorites = new Set(favorites);
    if (newFavorites.has(productId)) {
      newFavorites.delete(productId);
    } else {
      newFavorites.add(productId);
    }
    setFavorites(newFavorites);
  };

  const openProduct = (product: Product) => {
    setSelectedProduct(product);
    setSelectedSize(product.sizes[0]);
    setSelectedColor(product.colors[0]);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    
    const cartItem: CartItem = {
      id: Date.now(),
      name: selectedProduct.name,
      price: selectedProduct.price,
      size: selectedSize,
      quantity: 1,
      image: selectedProduct.image,
      color: selectedColor
    };
    
    setCart([...cart, cartItem]);
    setSelectedProduct(null);
  };

  const formatPrice = (price: number) => {
    return new Intl.NumberFormat('ru-RU', {
      style: 'currency',
      currency: 'RUB',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(price);
  };

  const handleCheckout = () => {
    if (cart.length === 0) return;
    
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const newOrder: Order = {
      id: Date.now(),
      items: [...cart],
      total: total,
      date: new Date().toLocaleDateString('ru-RU'),
      status: 'processing'
    };
    
    setOrders([newOrder, ...orders]);
    setCart([]);
    setShowCheckoutSuccess(true);
    setTimeout(() => setShowCheckoutSuccess(false), 3000);
  };

  // PRODUCT PAGE
  if (activeTab === 'catalog' && selectedProduct) {
    const bgColor = selectedProduct.colorHex[selectedProduct.colors.indexOf(selectedColor)] || '#1A1A1A';
    
    return (
      <div className="min-h-screen text-white overflow-auto pb-24" style={{ backgroundColor: bgColor }}>
        <div className="absolute top-0 left-0 right-0 z-10 demo-nav-safe flex items-center justify-between">
          <button 
            onClick={() => setSelectedProduct(null)}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center"
            data-testid="button-back"
          >
            <ChevronLeft className="w-6 h-6" />
          </button>
          <button
            onClick={(e) => {
              e.stopPropagation();
              toggleFavorite(selectedProduct.id);
            }}
            className="w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center"
            data-testid={`button-favorite-${selectedProduct.id}`}
          >
            <Heart 
              className={`w-5 h-5 ${favorites.has(selectedProduct.id) ? 'fill-white text-white' : 'text-white'}`}
            />
          </button>
        </div>

        <div className="relative h-[60vh]">
          <img
            src={selectedProduct.hoverImage}
            alt={selectedProduct.name}
            className="w-full h-full object-cover"
            loading="lazy"
          />
        </div>

        <div className="bg-white/10 backdrop-blur-xl rounded-t-3xl p-6 space-y-6 pb-32">
          <div className="text-center">
            <h2 className="text-2xl font-bold mb-2">{selectedProduct.name}</h2>
            <div className="flex items-center justify-center gap-3">
              <p className="text-3xl font-bold">{formatPrice(selectedProduct.price)}</p>
              {selectedProduct.oldPrice && (
                <p className="text-xl text-white/50 line-through">{formatPrice(selectedProduct.oldPrice)}</p>
              )}
            </div>
          </div>

          <p className="text-sm text-white/80 text-center">{selectedProduct.description}</p>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите цвет:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedProduct.colors.map((color, idx) => (
                <button
                  key={color}
                  onClick={() => setSelectedColor(color)}
                  className={`w-10 h-10 rounded-full border-2 transition-all ${
                    selectedColor === color
                      ? 'border-white scale-110'
                      : 'border-white/30'
                  }`}
                  style={{ backgroundColor: selectedProduct.colorHex[idx] }}
                  data-testid={`button-color-${color}`}
                />
              ))}
            </div>
          </div>

          <div>
            <p className="text-sm mb-3 text-white/80 text-center">Выберите размер:</p>
            <div className="flex items-center justify-center gap-3">
              {selectedProduct.sizes.map((size) => (
                <button
                  key={size}
                  onClick={() => setSelectedSize(size)}
                  className={`w-12 h-12 rounded-full font-semibold transition-all ${
                    selectedSize === size
                      ? 'bg-[#CDFF38] text-black'
                      : 'bg-white/20 text-white hover:bg-white/30'
                  }`}
                  data-testid={`button-size-${size}`}
                >
                  {size}
                </button>
              ))}
            </div>
          </div>

          <ConfirmDrawer
            trigger={
              <button
                className="w-full bg-[#CDFF38] text-black font-bold py-4 rounded-full hover:bg-[#B8E633] transition-all"
                data-testid="button-buy-now"
              >
                Добавить в корзину
              </button>
            }
            title="Добавить в корзину?"
            description={`${selectedProduct.name} • ${selectedColor} • ${selectedSize}`}
            confirmText="Добавить"
            cancelText="Отмена"
            variant="default"
            onConfirm={addToCart}
          />
        </div>
      </div>
    );
  }

  // HOME PAGE - REAL TIME SHOPPING STYLE
  if (activeTab === 'home') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        {/* Header */}
        <div className="p-6 pb-4">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <button aria-label="Меню" data-testid="button-view-menu">
              <Menu className="w-6 h-6" />
            </button>
            <div className="flex items-center gap-3">
              <button aria-label="Корзина" data-testid="button-view-cart">
                <ShoppingBag className="w-6 h-6" />
              </button>
              <button aria-label="Избранное" data-testid="button-view-favorites">
                <Heart className="w-6 h-6" />
              </button>
            </div>
          </div>

          {/* Title */}
          <div className="mb-6">
            <h1 className="text-4xl font-black mb-1 tracking-tight">
              REAL TIME<br/>
              SHOPPING
            </h1>
          </div>

          {/* Gender Filters */}
          <div className="flex items-center gap-4 mb-6">
            <button 
              className="p-2 bg-white rounded-full"
              aria-label="Главная"
              data-testid="button-view-home"
            >
              <svg className="w-5 h-5 text-black" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
              </svg>
            </button>
            {genderFilters.map((gender, idx) => (
              <button
                key={gender}
                onClick={() => setSelectedGender(gender)}
                className={`text-sm font-medium transition-colors ${
                  selectedGender === gender
                    ? 'text-white'
                    : 'text-white/40'
                }`}
                data-testid={`button-filter-${gender.toLowerCase()}`}
              >
                {gender}
              </button>
            ))}
          </div>

          {/* Search Bar */}
          <div className="flex items-center gap-3 mb-6">
            <div className="flex-1 bg-white/10 backdrop-blur-xl rounded-full px-4 py-3 flex items-center gap-2">
              <Search className="w-5 h-5 text-white/50" />
              <input
                type="text"
                placeholder="Поиск товаров..."
                value={searchQuery}
                onChange={(e) => handleSearch(e.target.value)}
                className="bg-transparent text-white placeholder:text-white/50 outline-none flex-1 text-sm"
                data-testid="input-search"
              />
            </div>
          </div>
        </div>

        {/* Video Hero Banner */}
        <div className="relative mb-6 mx-6 rounded-3xl overflow-hidden" style={{ height: '500px' }}>
          <video
            autoPlay
            loop
            muted
            playsInline
            className="absolute inset-0 w-full h-full object-cover"
            data-testid="video-hero-banner"
          >
            <source src={fashionVideo} type="video/mp4" />
          </video>
          
          {/* Gradient Overlay */}
          <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
          
          {/* Content Overlay */}
          <div className="absolute bottom-0 left-0 right-0 p-8">
            <m.div
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
            >
              <h2 className="text-5xl font-black mb-3 tracking-tight leading-tight">
                НОВАЯ<br/>
                КОЛЛЕКЦИЯ
              </h2>
              <p className="text-lg text-white/80 mb-6" style={{ letterSpacing: '0.1em' }}>
                Эксклюзивные модели 2025
              </p>
              <button 
                className="px-8 py-4 rounded-full font-bold text-black transition-all hover:scale-105"
                style={{
                  background: '#CDFF38',
                  boxShadow: '0 0 30px rgba(205, 255, 56, 0.4)'
                }}
                data-testid="button-view-collection"
              >
                Смотреть коллекцию
              </button>
            </m.div>
          </div>
        </div>

        {/* Featured Product Cards */}
        <div className="px-6 space-y-4">
          {filteredProducts.slice(0, 3).map((product, idx) => (
            <m.div
              key={product.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: idx * 0.1 }}
              onClick={() => openProduct(product)}
              className="relative cursor-pointer group rounded-3xl overflow-hidden"
              style={{ height: idx === 0 ? '400px' : '320px' }}
              data-testid={`featured-product-${product.id}`}
            >
              {/* Background Image with Skeleton */}
              <div className="absolute inset-0">
                {!loadedImages.has(product.id) && (
                  <Skeleton className="w-full h-full absolute inset-0" />
                )}
                <img
                  src={product.image}
                  alt={product.name}
                  className={`w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 ${!loadedImages.has(product.id) ? 'opacity-0' : 'opacity-100'}`}
                  loading="lazy"
                  onLoad={() => handleImageLoad(product.id)}
                />
              </div>

              {/* Gradient Overlay */}
              <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent"></div>

              {/* Badge */}
              <div className="absolute top-4 left-4">
                <div className="px-3 py-1 bg-white/20 backdrop-blur-xl rounded-full">
                  <span className="text-xs font-semibold text-white">
                    {product.isNew ? 'New' : product.category}
                  </span>
                </div>
              </div>

              {/* Favorite */}
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  toggleFavorite(product.id);
                }}
                aria-label="Избранное"
                className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 backdrop-blur-xl flex items-center justify-center"
                data-testid={`button-favorite-${product.id}`}
              >
                <Heart 
                  className={`w-5 h-5 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                />
              </button>

              {/* Content */}
              <div className="absolute bottom-0 left-0 right-0 p-6">
                <div className="flex items-end justify-between">
                  <div className="flex-1">
                    <h3 className="text-2xl font-bold mb-2 leading-tight">
                      {product.name.split(' ').slice(0, 2).join(' ')}<br/>
                      {product.name.split(' ').slice(2).join(' ')}
                    </h3>
                    <p className="text-sm text-white/80 mb-4">{product.gender}'s wear</p>
                  </div>

                  {/* Buy Button */}
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      openProduct(product);
                    }}
                    aria-label="Добавить в корзину"
                    className="w-14 h-14 rounded-full bg-[#CDFF38] flex items-center justify-center hover:bg-[#B8E633] transition-all hover:scale-110"
                    data-testid={`button-add-to-cart-${product.id}`}
                  >
                    <ShoppingBag className="w-6 h-6 text-black" />
                  </button>
                </div>

                {/* Price */}
                <div className="mt-3">
                  <p className="text-lg font-bold">{formatPrice(product.price)}</p>
                </div>
              </div>
            </m.div>
          ))}
        </div>

        {/* Bottom Spacer */}
        <div className="h-8"></div>
      </div>
    );
  }

  // CATALOG PAGE
  if (activeTab === 'catalog') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6">
          <div className="flex items-center justify-between mb-6 scroll-fade-in">
            <h1 className="text-2xl font-bold">Каталог</h1>
            <div className="flex items-center gap-3">
              <button className="p-2" aria-label="Поиск" data-testid="button-view-search">
                <Search className="w-6 h-6" />
              </button>
              <button className="p-2" aria-label="Фильтр" data-testid="button-view-filter">
                <Filter className="w-6 h-6" />
              </button>
            </div>
          </div>

          {/* Categories */}
          <div className="flex gap-2 mb-6 overflow-x-auto pb-2 scrollbar-hide">
            {categories.map((cat) => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2.5 rounded-full text-sm font-semibold whitespace-nowrap transition-all ${
                  selectedCategory === cat
                    ? 'bg-[#CDFF38] text-black'
                    : 'bg-white/10 text-white/70 hover:bg-white/20'
                }`}
                data-testid={`button-filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>

          {/* Products Grid */}
          <div className="grid grid-cols-2 gap-4">
            {filteredProducts.map((product, idx) => (
              <m.div
                key={product.id}
                whileTap={{ scale: 0.97 }}
                onClick={() => openProduct(product)}
                className={`relative cursor-pointer scroll-fade-in-delay-${Math.min((idx % 4) + 2, 5)}`}
                data-testid={`product-card-${product.id}`}
              >
                <div className="relative aspect-[3/4] rounded-3xl overflow-hidden mb-3 bg-white/5">
                  {!loadedImages.has(product.id) && (
                    <Skeleton className="w-full h-full absolute inset-0" />
                  )}
                  <img
                    src={product.image}
                    alt={product.name}
                    className={`w-full h-full object-cover transition-opacity ${!loadedImages.has(product.id) ? 'opacity-0' : 'opacity-100'}`}
                    loading="lazy"
                    onLoad={() => handleImageLoad(product.id)}
                  />
                  
                  {/* Favorite */}
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(product.id);
                    }}
                    aria-label="Избранное"
                    className="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/40 backdrop-blur-xl flex items-center justify-center"
                    data-testid={`button-favorite-catalog-${product.id}`}
                  >
                    <Heart 
                      className={`w-4 h-4 ${favorites.has(product.id) ? 'fill-white text-white' : 'text-white'}`}
                    />
                  </button>

                  {/* Badge */}
                  {product.isNew && (
                    <div className="absolute top-2 left-2 px-2 py-1 bg-[#CDFF38] text-black text-xs font-bold rounded-full">
                      NEW
                    </div>
                  )}
                </div>

                {/* Product Info */}
                <div>
                  <p className="text-sm font-semibold mb-1 truncate">{product.name}</p>
                  <div className="flex items-center justify-between">
                    <p className="text-base font-bold">{formatPrice(product.price)}</p>
                    {product.oldPrice && (
                      <p className="text-xs text-white/40 line-through">{formatPrice(product.oldPrice)}</p>
                    )}
                  </div>
                </div>
              </m.div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // CART PAGE
  if (activeTab === 'cart') {
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-32">
        <div className="p-6">
          <h1 className="text-2xl font-bold mb-6">Корзина</h1>

          {cart.length === 0 ? (
            <div className="flex flex-col items-center justify-center py-20">
              <ShoppingBag className="w-20 h-20 text-white/20 mb-4" />
              <p className="text-white/50 text-center">Ваша корзина пуста</p>
            </div>
          ) : (
            <div className="space-y-4">
              {cart.map((item) => (
                <div
                  key={item.id}
                  className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 flex gap-4"
                  data-testid={`cart-item-${item.id}`}
                >
                  <img
                    src={item.image}
                    alt={item.name}
                    className="w-20 h-20 rounded-xl object-cover"
                    loading="lazy"
                  />
                  <div className="flex-1">
                    <h3 className="font-semibold mb-1">{item.name}</h3>
                    <p className="text-sm text-white/60 mb-2">
                      {item.color} • {item.size}
                    </p>
                    <p className="text-lg font-bold">{formatPrice(item.price)}</p>
                  </div>
                  <button
                    onClick={() => setCart(cart.filter(i => i.id !== item.id))}
                    aria-label="Удалить"
                    className="w-8 h-8"
                    data-testid={`button-remove-${item.id}`}
                  >
                    <X className="w-5 h-5" />
                  </button>
                </div>
              ))}

              <div className="fixed bottom-24 left-0 right-0 p-6 bg-[#0A0A0A] border-t border-white/10">
                <div className="flex items-center justify-between mb-4">
                  <span className="text-lg font-semibold">Итого:</span>
                  <span className="text-2xl font-bold">{formatPrice(total)}</span>
                </div>
                <ConfirmDrawer
                  trigger={
                    <button
                      className="w-full bg-[#CDFF38] text-black font-bold py-4 rounded-full hover:bg-[#B8E633] transition-all"
                      data-testid="button-checkout"
                    >
                      Оформить заказ
                    </button>
                  }
                  title="Оформить заказ?"
                  description={`${cart.length} товаров на сумму ${formatPrice(total)}`}
                  confirmText="Оформить"
                  cancelText="Отмена"
                  variant="default"
                  onConfirm={handleCheckout}
                />
              </div>
              {showCheckoutSuccess && (
                <div className="fixed top-20 left-4 right-4 bg-[#CDFF38] text-black p-4 rounded-2xl text-center font-bold z-50 animate-pulse">
                  Заказ успешно оформлен!
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    );
  }

  // PROFILE PAGE
  if (activeTab === 'profile') {
    return (
      <div className="min-h-screen bg-[#0A0A0A] text-white overflow-auto pb-24">
        <div className="p-6 bg-card/80 backdrop-blur-xl border-b border-border/50">
          <div className="flex items-center gap-4 mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-[#CDFF38] to-[#B8E633] rounded-full flex items-center justify-center">
              <User className="w-8 h-8 text-black" />
            </div>
            <div>
              <h2 className="text-xl font-bold">Александр Петров</h2>
              <p className="text-sm text-muted-foreground">+7 (999) 123-45-67</p>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-3">
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Заказы</p>
              <p className="text-2xl font-bold">{orders.length}</p>
            </div>
            <div className="p-4 bg-white/10 backdrop-blur-xl rounded-xl border border-white/20">
              <p className="text-sm text-white/70 mb-1">Избранное</p>
              <p className="text-2xl font-bold">{favorites.size}</p>
            </div>
          </div>
        </div>

        <div className="p-4 space-y-4">
          <div className="scroll-fade-in">
            <h3 className="text-lg font-bold mb-4">Мои заказы</h3>
            {orders.length === 0 ? (
              <div className="text-center py-8 text-white/50">
                <Package className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>У вас пока нет заказов</p>
              </div>
            ) : (
              <div className="space-y-3">
                {orders.map((order) => (
                  <div key={order.id} className="bg-white/10 rounded-xl p-4" data-testid={`order-${order.id}`}>
                    <div className="flex justify-between mb-2">
                      <span className="text-sm text-white/70">Заказ #{order.id.toString().slice(-6)}</span>
                      <span className="text-sm text-white/70">{order.date}</span>
                    </div>
                    <div className="flex justify-between mb-2">
                      <span className="text-white/80">{order.items.length} товаров</span>
                      <span className="font-bold">{formatPrice(order.total)}</span>
                    </div>
                    <div className="mt-2">
                      <span className="text-xs px-2 py-1 bg-[#CDFF38]/20 text-[#CDFF38] rounded-full">
                        {order.status === 'processing' ? 'В обработке' : order.status === 'shipped' ? 'Отправлен' : 'Доставлен'}
                      </span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <div className="space-y-2">
          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-orders">
            <div className="flex items-center gap-3">
              <Package className="w-5 h-5 text-white/70" />
              <span className="font-medium">История заказов</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-favorites">
            <div className="flex items-center gap-3">
              <Heart className="w-5 h-5 text-white/70" />
              <span className="font-medium">Избранное</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-payment">
            <div className="flex items-center gap-3">
              <CreditCard className="w-5 h-5 text-white/70" />
              <span className="font-medium">Способы оплаты</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-address">
            <div className="flex items-center gap-3">
              <MapPin className="w-5 h-5 text-white/70" />
              <span className="font-medium">Адреса доставки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-white/5 backdrop-blur-xl rounded-xl border border-white/10 flex items-center justify-between hover-elevate active-elevate-2" data-testid="button-settings">
            <div className="flex items-center gap-3">
              <Settings className="w-5 h-5 text-white/70" />
              <span className="font-medium">Настройки</span>
            </div>
            <ChevronLeft className="w-5 h-5 rotate-180 text-white/50" />
          </button>

          <button className="w-full p-4 bg-red-500/10 backdrop-blur-xl rounded-xl border border-red-500/20 flex items-center justify-between hover-elevate active-elevate-2 mt-4" data-testid="button-logout">
            <div className="flex items-center gap-3">
              <LogOut className="w-5 h-5 text-red-400" />
              <span className="font-medium text-red-400">Выйти</span>
            </div>
          </button>
          </div>
        </div>
      </div>
    );
  }

  return null;
}

export default memo(PremiumFashionStore);
```

### demos/Taxi.tsx
```tsx
import { useState } from "react";
import { 
  Car, 
  Heart, 
  Star, 
  MapPin, 
  Clock,
  Plus,
  Minus,
  X,
  ChevronRight,
  Navigation,
  Shield,
  CreditCard,
  User,
  Phone
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface TaxiProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface Trip {
  id: number;
  from: string;
  to: string;
  date: string;
  price: number;
  status: 'Завершена' | 'В пути' | 'Ожидает';
  driver: string;
  car: string;
}

const drivers = [
  { id: 1, name: 'Александр Петров', car: 'Toyota Camry', year: 2020, plate: 'А123БВ777', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.9, trips: 2840, category: 'Эконом', price: 8, features: ['Кондиционер', 'Музыка', 'USB зарядка'], eta: '3 мин', distance: '0.8 км' },
  { id: 2, name: 'Михаил Иванов', car: 'BMW 3 Series', year: 2021, plate: 'В456ГД777', image: 'https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.8, trips: 1920, category: 'Комфорт', price: 12, features: ['Кожаные сиденья', 'Wi-Fi', 'Минеральная вода'], eta: '5 мин', distance: '1.2 км' },
  { id: 3, name: 'Дмитрий Сидоров', car: 'Mercedes E-Class', year: 2022, plate: 'С789ЕЖ777', image: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 5.0, trips: 1150, category: 'Бизнес', price: 18, features: ['Премиум салон', 'Шампанское', 'Газеты'], eta: '7 мин', distance: '2.1 км' },
  { id: 4, name: 'Сергей Козлов', car: 'Kia Rio', year: 2019, plate: 'Д012ЗИ777', image: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.7, trips: 3560, category: 'Эконом', price: 7, features: ['Кондиционер', 'Радио'], eta: '4 мин', distance: '1.0 км' },
  { id: 5, name: 'Анатолий Волков', car: 'Hyundai Solaris', year: 2020, plate: 'Е345КЛ777', image: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.6, trips: 2180, category: 'Эконом', price: 8, features: ['Кондиционер', 'Bluetooth'], eta: '6 мин', distance: '1.5 км' },
  { id: 6, name: 'Владимир Новиков', car: 'Audi A6', year: 2021, plate: 'Ж678МН777', image: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.9, trips: 980, category: 'Бизнес', price: 20, features: ['Премиум салон', 'Массаж сидений', 'Климат-контроль'], eta: '10 мин', distance: '3.2 км' },
  { id: 7, name: 'Игорь Смирнов', car: 'Volkswagen Polo', year: 2020, plate: 'З901ОП777', image: 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.5, trips: 2670, category: 'Эконом', price: 8, features: ['Кондиционер', 'USB'], eta: '8 мин', distance: '2.0 км' },
  { id: 8, name: 'Роман Федоров', car: 'Lexus GS', year: 2022, plate: 'И234РС777', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 5.0, trips: 640, category: 'Премиум', price: 25, features: ['VIP салон', 'Личный водитель', 'Закуски'], eta: '12 мин', distance: '4.0 км' },
  { id: 9, name: 'Евгений Морозов', car: 'Skoda Rapid', year: 2019, plate: 'К567ТУ777', image: 'https://images.unsplash.com/photo-1556157382-97eda2d62296?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.4, trips: 4120, category: 'Эконом', price: 7, features: ['Радио', 'Кондиционер'], eta: '5 мин', distance: '1.1 км' },
  { id: 10, name: 'Павел Орлов', car: 'Nissan Sentra', year: 2020, plate: 'Л890ФХ777', image: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.6, trips: 1890, category: 'Комфорт', price: 11, features: ['Кожаный салон', 'Музыка', 'Wi-Fi'], eta: '9 мин', distance: '2.8 км' },
  { id: 11, name: 'Олег Крылов', car: 'Ford Focus', year: 2021, plate: 'М123ЦЧ777', image: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.7, trips: 2340, category: 'Комфорт', price: 10, features: ['Подогрев сидений', 'Bluetooth', 'Зарядка'], eta: '7 мин', distance: '1.8 км' },
  { id: 12, name: 'Виктор Зайцев', car: 'Renault Logan', year: 2019, plate: 'Н456ШЩ777', image: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.3, trips: 5670, category: 'Эконом', price: 6, features: ['Кондиционер'], eta: '11 мин', distance: '3.5 км' },
  { id: 13, name: 'Геннадий Белов', car: 'Mazda 6', year: 2020, plate: 'О789ЪЫ777', image: 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.8, trips: 1560, category: 'Комфорт', price: 13, features: ['Премиум аудио', 'Кожа', 'Климат'], eta: '6 мин', distance: '1.6 км' },
  { id: 14, name: 'Алексей Тихонов', car: 'Chevrolet Cruze', year: 2021, plate: 'П012ЬЭ777', image: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.5, trips: 2890, category: 'Эконом', price: 8, features: ['USB зарядка', 'Кондиционер'], eta: '14 мин', distance: '4.2 км' },
  { id: 15, name: 'Константин Попов', car: 'Infiniti Q50', year: 2022, plate: 'Р345ЮЯ777', image: 'https://images.unsplash.com/photo-1556157382-97eda2d62296?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.9, trips: 780, category: 'Премиум', price: 22, features: ['VIP салон', 'Массаж', 'Шампанское'], eta: '15 мин', distance: '5.0 км' },
  { id: 16, name: 'Станислав Гусев', car: 'Lada Vesta', year: 2020, plate: 'С678АБ777', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.2, trips: 3450, category: 'Эконом', price: 6, features: ['Радио'], eta: '13 мин', distance: '3.8 км' },
  { id: 17, name: 'Денис Соколов', car: 'Peugeot 408', year: 2021, plate: 'Т901ВГ777', image: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.6, trips: 1670, category: 'Комфорт', price: 12, features: ['Панорамная крыша', 'Wi-Fi', 'Климат'], eta: '16 мин', distance: '5.5 км' },
  { id: 18, name: 'Артём Лебедев', car: 'Mitsubishi Lancer', year: 2019, plate: 'У234ДЕ777', image: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.4, trips: 2980, category: 'Эконом', price: 7, features: ['Кондиционер', 'Bluetooth'], eta: '18 мин', distance: '6.0 км' },
  { id: 19, name: 'Валерий Кузнецов', car: 'Jaguar XF', year: 2022, plate: 'Ф567ЖЗ777', image: 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 5.0, trips: 420, category: 'Люкс', price: 30, features: ['Люкс салон', 'Персональный водитель', 'Встреча с табличкой'], eta: '20 мин', distance: '7.2 км' },
  { id: 20, name: 'Максим Ефимов', car: 'Honda Civic', year: 2020, plate: 'Х890ИК777', image: 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&h=400', rating: 4.7, trips: 2150, category: 'Комфорт', price: 11, features: ['Спортивный салон', 'Подогрев', 'Премиум звук'], eta: '22 мин', distance: '8.0 км' }
];

const categories = ['Все', 'Эконом', 'Комфорт', 'Бизнес', 'Премиум', 'Люкс'];

const initialTrips: Trip[] = [
  { id: 1, from: 'Красная площадь', to: 'Домодедово', date: 'Сегодня 14:30', price: 45, status: 'В пути', driver: 'Александр П.', car: 'Toyota Camry' },
  { id: 2, from: 'Тверская, 15', to: 'Ленинский пр., 99', date: 'Вчера 09:15', price: 18, status: 'Завершена', driver: 'Михаил И.', car: 'BMW 3 Series' },
];

export default function Taxi({ activeTab }: TaxiProps) {
  const [selectedDriver, setSelectedDriver] = useState<typeof drivers[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [trips, setTrips] = useState<Trip[]>(initialTrips);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([1, 2, 3, 6]);
  const [currentLocation] = useState('Тверская площадь');
  const [destination, setDestination] = useState('');

  const openDriverModal = (driver: typeof drivers[0]) => {
    setSelectedDriver(driver);
    setIsModalOpen(true);
  };

  const closeDriverModal = () => {
    setIsModalOpen(false);
    setSelectedDriver(null);
  };

  const toggleFavorite = (driverId: number) => {
    setFavorites(prev => 
      prev.includes(driverId) 
        ? prev.filter(id => id !== driverId)
        : [...prev, driverId]
    );
  };

  const filteredDrivers = selectedCategory === 'Все' 
    ? drivers 
    : drivers.filter(driver => driver.category === selectedCategory);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: drivers.slice(0, 6).map(item => item.image),
    priority: true
  });


  const renderHomeTab = () => (
    <div className="min-h-screen bg-yellow-50 font-montserrat">
      <div className="max-w-md mx-auto">
        
        {/* Modern Taxi Header */}
        <div className="px-6 pt-20 pb-16 text-center">
          <div className="w-20 h-20 bg-yellow-500 rounded-xl flex items-center justify-center mx-auto mb-8">
            <Car className="w-6 h-6 text-yellow-900" />
          </div>
          <h1 className="text-2xl font-semibold text-yellow-900 mb-3 tracking-wide">CityRide</h1>
          <p className="text-yellow-600 text-sm font-medium">Premium Urban Transport</p>
        </div>

        {/* Hero Taxi Section */}
        <div className="px-6 pb-20">
          <div className="aspect-[16/10] rounded-2xl overflow-hidden bg-yellow-100 mb-12 relative">
            <OptimizedImage 
              src="https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=800&h=500&fit=crop&crop=center" 
              alt="Premium City Transportation"
              className="w-full h-full object-cover"
            />
            <div className="absolute inset-0 bg-gradient-to-t from-yellow-900/80 via-yellow-900/40 to-transparent" />
            <div className="absolute bottom-6 left-6 right-6 text-white">
              <h2 className="text-xl font-semibold mb-2">Your Ride Awaits</h2>
              <p className="text-white/80 text-sm mb-4">Professional drivers, premium vehicles</p>
              <button 
                className="bg-white text-yellow-900 px-6 py-2 rounded-lg text-sm font-medium hover:bg-yellow-50 transition-colors"
                onClick={() => openDriverModal(drivers[0])}
              >
                Book Now
              </button>
            </div>
          </div>
        </div>

        {/* Service Stats */}
        <div className="px-6 py-20 border-t border-yellow-200">
          <div className="text-center mb-16">
            <h3 className="text-lg font-semibold text-yellow-900 mb-4">Why Choose Us</h3>
            <p className="text-yellow-600 text-sm font-medium leading-relaxed">
              Fast, reliable, and comfortable rides across the city.
            </p>
          </div>
          
          <div className="grid grid-cols-2 gap-12 text-center">
            {[
              { number: '5 min', label: 'Average Wait' },
              { number: '4.9★', label: 'Rating' },
              { number: '50K+', label: 'Rides Daily' },
              { number: '24/7', label: 'Available' }
            ].map((stat, index) => (
              <div key={index}>
                <div className="text-2xl font-bold text-yellow-600 mb-1">{stat.number}</div>
                <div className="text-yellow-500 text-xs font-medium">{stat.label}</div>
              </div>
            ))}
          </div>
        </div>

        {/* Featured Drivers */}
        <div className="px-6 py-20 border-t border-yellow-200">
          <div className="flex items-center justify-between mb-12">
            <h3 className="text-lg font-semibold text-yellow-900">Available Drivers</h3>
            <button 
              className="text-yellow-500 text-sm font-medium hover:text-yellow-600 transition-colors"
              onClick={() => setSelectedCategory('Все')}
            >
              View all
            </button>
          </div>
          
          <div className="space-y-12">
            {drivers.slice(0, 2).map((driver, index) => (
              <div 
                key={driver.id} 
                className="group cursor-pointer"
                onClick={() => openDriverModal(driver)}
              >
                <div className="aspect-[5/3] rounded-xl overflow-hidden bg-yellow-100 mb-6 relative">
                  <OptimizedImage 
                    src={index === 0 ? 
                      "https://images.unsplash.com/photo-1485463611174-f302f6a5c1c9?w=800&h=480&fit=crop&crop=center" : 
                      "https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=800&h=480&fit=crop&crop=center"
                    }
                    alt={driver.car}
                    className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
                  />
                  <div className="absolute top-3 left-3 bg-yellow-500 text-yellow-900 text-xs font-bold px-2 py-1 rounded">
                    {driver.eta}
                  </div>
                  <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm text-yellow-900 text-xs font-medium px-2 py-1 rounded flex items-center space-x-1">
                    <Star className="w-3 h-3 text-yellow-500 fill-current" />
                    <span>{driver.rating}</span>
                  </div>
                </div>
                <div className="space-y-3">
                  <div className="flex items-start justify-between">
                    <div>
                      <h4 className="text-yellow-900 font-semibold text-base">{driver.name}</h4>
                      <p className="text-yellow-500 text-sm font-medium">{driver.car} • {driver.category}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-yellow-900 font-semibold">${driver.price}/km</p>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="bg-white min-h-screen">
      <div className="max-w-md mx-auto px-4 py-6 space-y-6">
        <h1 className="ios-title font-bold">Доступные водители</h1>
      
      {/* Фильтр по категориям */}
      <div className="flex space-x-2 overflow-x-auto pb-2">
        {categories.map((category) => (
          <button
            key={category}
            onClick={() => setSelectedCategory(category)}
            className={`px-4 py-2 rounded-full whitespace-nowrap ios-footnote font-medium ${
              selectedCategory === category
                ? 'bg-system-orange text-white'
                : 'bg-quaternary-system-fill text-label'
            }`}
          >
            {category}
          </button>
        ))}
      </div>

      {/* Список водителей */}
      <div className="space-y-3">
        {filteredDrivers.map((driver) => (
          <div 
            key={driver.id} 
            className="ios-card p-4 cursor-pointer"
            onClick={() => openDriverModal(driver)}
          >
            <div className="flex items-center space-x-3">
              <OptimizedImage src={driver.image} alt={driver.name} className="w-20 h-20 object-cover rounded-full" />
              <div className="flex-1">
                <div className="flex items-center justify-between mb-1">
                  <h4 className="ios-body font-semibold">{driver.name}</h4>
                  <button
                    onClick={(e) => {
                      e.stopPropagation();
                      toggleFavorite(driver.id);
                    }}
                    className="p-1"
                  >
                    <Heart 
                      className={`w-4 h-4 ${
                        favorites.includes(driver.id) 
                          ? 'fill-red-500 text-red-500' 
                          : 'text-secondary-label'
                      }`} 
                    />
                  </button>
                </div>
                <p className="ios-footnote text-secondary-label mb-1">{driver.car} ({driver.year}) • {driver.plate}</p>
                <div className="flex items-center justify-between">
                  <div className="flex items-center space-x-4">
                    <span className="ios-caption2 px-2 py-1 bg-quaternary-system-fill rounded">{driver.category}</span>
                    <div className="flex items-center space-x-1">
                      <Star className="w-3 h-3 fill-yellow-400 text-yellow-400" />
                      <span className="ios-caption2">{driver.rating}</span>
                    </div>
                    <span className="ios-caption2 text-secondary-label">{driver.trips} поездок</span>
                  </div>
                  <div className="text-right">
                    <p className="ios-body font-bold text-system-orange">от ${driver.price}</p>
                    <p className="ios-footnote text-system-green">{driver.eta}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Мои поездки</h1>
      
      {trips.length === 0 ? (
        <div className="text-center py-12">
          <Car className="w-16 h-16 text-quaternary-label mx-auto mb-4" />
          <p className="ios-body text-secondary-label">Нет поездок</p>
          <p className="ios-footnote text-tertiary-label">Закажите первую поездку</p>
        </div>
      ) : (
        <>
          <div className="space-y-3">
            {trips.map((trip) => (
              <div key={trip.id} className="ios-card p-4">
                <div className="flex items-center justify-between mb-3">
                  <div className="flex-1">
                    <div className="flex items-center space-x-2 mb-1">
                      <div className="w-2 h-2 bg-system-green rounded-full"></div>
                      <span className="ios-footnote text-secondary-label">{trip.from}</span>
                    </div>
                    <div className="flex items-center space-x-2">
                      <div className="w-2 h-2 bg-system-red rounded-full"></div>
                      <span className="ios-footnote text-secondary-label">{trip.to}</span>
                    </div>
                  </div>
                  <span className={`px-2 py-1 rounded-full ios-caption2 font-semibold ${
                    trip.status === 'Завершена' ? 'bg-green-100 text-green-700' :
                    trip.status === 'В пути' ? 'bg-blue-100 text-blue-700' :
                    'bg-orange-100 text-orange-700'
                  }`}>
                    {trip.status}
                  </span>
                </div>
                
                <div className="space-y-2">
                  <div className="flex justify-between">
                    <span className="ios-footnote text-secondary-label">Водитель:</span>
                    <span className="ios-footnote font-medium">{trip.driver}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="ios-footnote text-secondary-label">Автомобиль:</span>
                    <span className="ios-footnote font-medium">{trip.car}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="ios-footnote text-secondary-label">Дата:</span>
                    <span className="ios-footnote font-medium">{trip.date}</span>
                  </div>
                  <div className="flex justify-between">
                    <span className="ios-body font-semibold">Стоимость:</span>
                    <span className="ios-body font-bold text-system-orange">${trip.price}</span>
                  </div>
                </div>

                {trip.status === 'В пути' && (
                  <div className="flex space-x-2 mt-3">
                    <button className="flex-1 bg-system-orange text-white ios-footnote font-semibold py-2 rounded-lg">
                      Отследить поездку
                    </button>
                    <button className="flex-1 bg-quaternary-system-fill text-label ios-footnote font-medium py-2 rounded-lg">
                      Связаться с водителем
                    </button>
                  </div>
                )}
              </div>
            ))}
          </div>

          <div className="ios-card p-4">
            <h3 className="ios-headline font-semibold mb-2">Статистика поездок</h3>
            <div className="grid grid-cols-2 gap-4">
              <div className="text-center">
                <p className="ios-title font-bold text-system-orange">{trips.length}</p>
                <p className="ios-footnote text-secondary-label">Всего поездок</p>
              </div>
              <div className="text-center">
                <p className="ios-title font-bold text-system-green">
                  ${trips.reduce((sum, trip) => sum + trip.price, 0)}
                </p>
                <p className="ios-footnote text-secondary-label">Общая стоимость</p>
              </div>
            </div>
          </div>
        </>
      )}
    </div>
  );

  const renderProfileTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4">
      <h1 className="ios-title font-bold">Профиль пассажира</h1>
      
      <div className="ios-card p-4">
        <div className="flex items-center space-x-3 mb-4">
          <div className="w-16 h-16 bg-system-orange rounded-full flex items-center justify-center">
            <span className="ios-title font-bold text-white">СТ</span>
          </div>
          <div>
            <h3 className="ios-headline font-semibold">Премиум пассажир</h3>
            <p className="ios-body text-secondary-label">Постоянный клиент</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center">
            <p className="ios-title font-bold text-system-orange">87</p>
            <p className="ios-footnote text-secondary-label">Поездок</p>
          </div>
          <div className="text-center">
            <p className="ios-title font-bold text-system-yellow">4.9</p>
            <p className="ios-footnote text-secondary-label">Рейтинг</p>
          </div>
        </div>
      </div>

      <div className="space-y-3">
        <h2 className="ios-headline font-semibold">Избранные водители</h2>
        {drivers.filter(driver => favorites.includes(driver.id)).map((driver) => (
          <div key={driver.id} className="ios-card p-3 flex items-center space-x-3">
            <OptimizedImage src={driver.image} alt={driver.name} className="w-20 h-20 object-cover rounded-full" />
            <div className="flex-1">
              <h4 className="ios-body font-semibold">{driver.name}</h4>
              <p className="ios-footnote text-secondary-label">{driver.car} • {driver.rating} ⭐</p>
            </div>
            <ChevronRight className="w-5 h-5 text-tertiary-label" />
          </div>
        ))}
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Способы оплаты</h3>
        <div className="space-y-2">
          <div className="flex items-center space-x-3">
            <CreditCard className="w-5 h-5 text-system-blue" />
            <div className="flex-1">
              <p className="ios-body font-medium">•••• 4589</p>
              <p className="ios-footnote text-secondary-label">Visa</p>
            </div>
            <span className="ios-caption2 px-2 py-1 bg-system-blue/10 text-system-blue rounded">Основная</span>
          </div>
          <div className="flex items-center space-x-3">
            <CreditCard className="w-5 h-5 text-system-purple" />
            <div className="flex-1">
              <p className="ios-body font-medium">•••• 7821</p>
              <p className="ios-footnote text-secondary-label">MasterCard</p>
            </div>
          </div>
        </div>
      </div>

      <div className="ios-card p-4">
        <h3 className="ios-headline font-semibold mb-3">Статистика</h3>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span className="ios-body">Любимый тариф:</span>
            <span className="ios-body font-medium">Комфорт</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Средняя поездка:</span>
            <span className="ios-body font-medium">$15</span>
          </div>
          <div className="flex justify-between">
            <span className="ios-body">Потрачено всего:</span>
            <span className="ios-body font-medium text-system-orange">$1,290</span>
          </div>
        </div>
      </div>
    </div>
  );

  return (
    <div className="h-full flex flex-col bg-system-background">
      <div className="flex-1 overflow-y-auto p-4">
        {activeTab === 'home' && renderHomeTab()}
        {activeTab === 'catalog' && renderCatalogTab()}
        {activeTab === 'cart' && renderCartTab()}
        {activeTab === 'profile' && renderProfileTab()}
      </div>

      {/* Модальное окно */}
      {isModalOpen && selectedDriver && (
        <div className="fixed inset-0 bg-black/50 flex items-end z-50">
          <div className="bg-system-background max-w-md mx-auto w-full rounded-t-3xl p-6 space-y-4 max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-start">
              <h3 className="ios-title font-bold">{selectedDriver.name}</h3>
              <button onClick={closeDriverModal}>
                <X className="w-6 h-6 text-secondary-label" />
              </button>
            </div>
            
            <div className="flex items-center space-x-4">
              <OptimizedImage src={selectedDriver.image} alt={selectedDriver.name} className="w-20 h-20 object-cover rounded-full" />
              <div className="flex-1">
                <h4 className="ios-headline font-semibold">{selectedDriver.car}</h4>
                <p className="ios-body text-secondary-label">{selectedDriver.year} • {selectedDriver.plate}</p>
                <div className="flex items-center space-x-1 mt-1">
                  <Star className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                  <span className="ios-body font-medium">{selectedDriver.rating}</span>
                  <span className="ios-footnote text-secondary-label">({selectedDriver.trips} поездок)</span>
                </div>
              </div>
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="ios-card p-3 text-center">
                <Clock className="w-5 h-5 text-secondary-label mx-auto mb-1" />
                <p className="ios-caption2 text-secondary-label">Время прибытия</p>
                <p className="ios-body font-semibold text-system-green">{selectedDriver.eta}</p>
              </div>
              <div className="ios-card p-3 text-center">
                <MapPin className="w-5 h-5 text-secondary-label mx-auto mb-1" />
                <p className="ios-caption2 text-secondary-label">Расстояние</p>
                <p className="ios-body font-semibold">{selectedDriver.distance}</p>
              </div>
            </div>
            
            <div className="space-y-2">
              <h4 className="ios-body font-semibold">Удобства:</h4>
              <div className="flex flex-wrap gap-2">
                {selectedDriver.features.map((feature, index) => (
                  <span key={index} className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-quaternary-system-fill text-label">
                    {feature}
                  </span>
                ))}
              </div>
            </div>
            
            <div className="flex items-center justify-between">
              <div>
                <p className="ios-footnote text-secondary-label">Стоимость поездки</p>
                <p className="ios-title font-bold text-system-orange">от ${selectedDriver.price}</p>
              </div>
              <span className="px-3 py-1 rounded-full ios-caption2 font-semibold bg-system-orange/10 text-system-orange">
                {selectedDriver.category}
              </span>
            </div>
            
            <div className="flex space-x-2">
              <button className="flex-1 bg-system-orange text-white ios-body font-semibold py-3 rounded-xl">
                Заказать поездку
              </button>
              <button className="flex-1 bg-quaternary-system-fill text-label ios-body font-medium py-3 rounded-xl">
                Позвонить водителю
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}```

### demos/TeaHouse.tsx
```tsx
import { useState } from "react";
import { 
  Star, 
  Heart, 
  Filter, 
  Search, 
  ShoppingBag, 
  Plus, 
  Minus, 
  ChevronRight, 
  Leaf,
  Award,
  Gift,
  Clock,
  Thermometer
} from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface TeaHouseProps {
  activeTab?: string;
  onNavigate?: (tab: string) => void;
}

export default function TeaHouse({ activeTab = 'home', onNavigate }: TeaHouseProps) {
  const [selectedCategory, setSelectedCategory] = useState('Все сорта');
  const [favorites, setFavorites] = useState<string[]>([]);
  const [cartItems, setCartItems] = useState<any[]>([]);
  
  // 20 premium teas
  const teas = [
    {
      id: '1',
      name: 'Да Хун Пао',
      origin: 'Китай, Фуцзянь',
      price: 185,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Улун',
      description: 'Легендарный улун с утесов Уи Шань',
      rating: 4.95,
      caffeine: 'Средний',
      brewTime: '3-5 минут',
      temperature: '95°C',
      weight: '50г',
      year: 2024,
      premium: true
    },
    {
      id: '2',
      name: 'Лун Цзин',
      origin: 'Китай, Чжэцзян',
      price: 120,
      image: 'https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=400',
      category: 'Зелёный',
      description: 'Знаменитый зелёный чай из Ханчжоу',
      rating: 4.8,
      caffeine: 'Высокий',
      brewTime: '2-3 минуты',
      temperature: '80°C',
      weight: '50г',
      year: 2024,
      premium: false
    },
    {
      id: '3',
      name: 'Пу-эр Шэн',
      origin: 'Китай, Юньнань',
      price: 95,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Пу-эр',
      description: 'Выдержанный сырой пу-эр 15 лет',
      rating: 4.7,
      caffeine: 'Средний',
      brewTime: '30 секунд',
      temperature: '100°C',
      weight: '357г (блин)',
      year: 2009,
      premium: true
    },
    {
      id: '4',
      name: 'Эрл Грей Супериор',
      origin: 'Англия',
      price: 65,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Чёрный',
      description: 'Классический английский чай с бергамотом',
      rating: 4.5,
      caffeine: 'Высокий',
      brewTime: '3-5 минут',
      temperature: '100°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '5',
      name: 'Гёкуро',
      origin: 'Япония',
      price: 240,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Зелёный',
      description: 'Элитный японский теневой чай',
      rating: 4.9,
      caffeine: 'Высокий',
      brewTime: '1-2 минуты',
      temperature: '60°C',
      weight: '30г',
      year: 2024,
      premium: true
    },
    {
      id: '6',
      name: 'Железная Богиня Гуаньинь',
      origin: 'Китай, Фуцзянь',
      price: 155,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Улун',
      description: 'Классический Тигуаньинь высшего сорта',
      rating: 4.8,
      caffeine: 'Средний',
      brewTime: '3-5 минут',
      temperature: '95°C',
      weight: '50г',
      year: 2024,
      premium: true
    },
    {
      id: '7',
      name: 'Дарджилинг FTGFOP',
      origin: 'Индия',
      price: 85,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Чёрный',
      description: 'Мускатный аромат с гималайских склонов',
      rating: 4.6,
      caffeine: 'Высокий',
      brewTime: '3-4 минуты',
      temperature: '100°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '8',
      name: 'Белый Пион',
      origin: 'Китай, Фуцзянь',
      price: 135,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Белый',
      description: 'Деликатный белый чай с нежным вкусом',
      rating: 4.7,
      caffeine: 'Низкий',
      brewTime: '5-7 минут',
      temperature: '85°C',
      weight: '50г',
      year: 2024,
      premium: false
    },
    {
      id: '9',
      name: 'Маття церемониальная',
      origin: 'Япония',
      price: 320,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Маття',
      description: 'Церемониальная маття высшего сорта',
      rating: 4.95,
      caffeine: 'Очень высокий',
      brewTime: 'Взбивание',
      temperature: '70°C',
      weight: '30г',
      year: 2024,
      premium: true
    },
    {
      id: '10',
      name: 'Лапсанг Сушонг',
      origin: 'Китай, Фуцзянь',
      price: 75,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Чёрный',
      description: 'Копчёный чай с сосновым ароматом',
      rating: 4.4,
      caffeine: 'Высокий',
      brewTime: '3-5 минут',
      temperature: '100°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '11',
      name: 'Жасминовые Жемчужины',
      origin: 'Китай, Фуцзянь',
      price: 105,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Ароматизированный',
      description: 'Зелёный чай с цветами жасмина',
      rating: 4.6,
      caffeine: 'Средний',
      brewTime: '2-3 минуты',
      temperature: '85°C',
      weight: '50г',
      year: 2024,
      premium: false
    },
    {
      id: '12',
      name: 'Ройбуш ванильный',
      origin: 'ЮАР',
      price: 45,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Травяной',
      description: 'Африканский красный куст с ванилью',
      rating: 4.3,
      caffeine: 'Без кофеина',
      brewTime: '5-7 минут',
      temperature: '100°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '13',
      name: 'Формоза Улун',
      origin: 'Тайвань',
      price: 195,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Улун',
      description: 'Высокогорный тайваньский улун',
      rating: 4.85,
      caffeine: 'Средний',
      brewTime: '3-5 минут',
      temperature: '95°C',
      weight: '50г',
      year: 2024,
      premium: true
    },
    {
      id: '14',
      name: 'Ассам TGFOP',
      origin: 'Индия',
      price: 70,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Чёрный',
      description: 'Крепкий утренний чай из Ассама',
      rating: 4.5,
      caffeine: 'Очень высокий',
      brewTime: '3-5 минут',
      temperature: '100°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '15',
      name: 'Кимун Конгоу',
      origin: 'Китай, Аньхой',
      price: 90,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Чёрный',
      description: 'Китайский чёрный чай с винным букетом',
      rating: 4.6,
      caffeine: 'Высокий',
      brewTime: '3-4 минуты',
      temperature: '95°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '16',
      name: 'Шен Пу-эр 2015',
      origin: 'Китай, Юньнань',
      price: 145,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Пу-эр',
      description: 'Выдержанный сырой пу-эр из старых деревьев',
      rating: 4.8,
      caffeine: 'Средний',
      brewTime: '20-30 секунд',
      temperature: '100°C',
      weight: '357г (блин)',
      year: 2015,
      premium: true
    },
    {
      id: '17',
      name: 'Чай Масала',
      origin: 'Индия',
      price: 55,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Пряный',
      description: 'Традиционная индийская смесь со специями',
      rating: 4.4,
      caffeine: 'Высокий',
      brewTime: '5-7 минут',
      temperature: '100°C',
      weight: '100г',
      year: 2024,
      premium: false
    },
    {
      id: '18',
      name: 'Серебряные Иглы',
      origin: 'Китай, Фуцзянь',
      price: 280,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Белый',
      description: 'Элитный белый чай из почек',
      rating: 4.9,
      caffeine: 'Низкий',
      brewTime: '5-10 минут',
      temperature: '85°C',
      weight: '30г',
      year: 2024,
      premium: true
    },
    {
      id: '19',
      name: 'Сенча Гёкуро стиль',
      origin: 'Япония',
      price: 125,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Зелёный',
      description: 'Премиальная сенча теневой сушки',
      rating: 4.7,
      caffeine: 'Высокий',
      brewTime: '1-2 минуты',
      temperature: '70°C',
      weight: '50г',
      year: 2024,
      premium: true
    },
    {
      id: '20',
      name: 'Тикуаньинь Ван',
      origin: 'Китай, Фуцзянь',
      price: 220,
      image: 'https://images.unsplash.com/photo-1597318343706-0a1bb9cbae84?w=400',
      category: 'Улун',
      description: 'Король Железной Богини Милосердия',
      rating: 4.95,
      caffeine: 'Средний',
      brewTime: '30 секунд',
      temperature: '100°C',
      weight: '50г',
      year: 2024,
      premium: true
    }
  ];

  const categories = ['Все сорта', 'Зелёный', 'Чёрный', 'Улун', 'Пу-эр', 'Белый', 'Травяной', 'Ароматизированный', 'Маття', 'Пряный'];
  
  const filteredTeas = selectedCategory === 'Все сорта' 
    ? teas 
    : teas.filter(tea => tea.category === selectedCategory);

  const toggleFavorite = (teaId: string) => {
    setFavorites(prev => 
      prev.includes(teaId) 
        ? prev.filter(id => id !== teaId)
        : [...prev, teaId]
    );
  };

  const addToCart = (tea: any) => {
    setCartItems(prev => {
      const existing = prev.find(item => item.id === tea.id);
      if (existing) {
        return prev.map(item => 
          item.id === tea.id ? { ...item, quantity: item.quantity + 1 } : item
        );
      }
      return [...prev, { ...tea, quantity: 1 }];
    });
  };

  const updateQuantity = (teaId: string, newQuantity: number) => {
    if (newQuantity <= 0) {
      setCartItems(prev => prev.filter(item => item.id !== teaId));
      return;
    }
    setCartItems(prev => 
      prev.map(item => 
        item.id === teaId ? { ...item, quantity: newQuantity } : item
      )
    );
  };

  const cartTotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  // Preload first 6 product images for instant visibility
  useImagePreloader({
    images: teas.slice(0, 6).map(item => item.image),
    priority: true
  });


  const renderHomeTab = () => (
    <div className="min-h-screen bg-gray-50 font-montserrat">
      <div className="max-w-md mx-auto">
        
        {/* Zen Header */}
        <div className="px-6 pt-20 pb-20 text-center">
          <div className="w-1 h-20 bg-green-700 mx-auto mb-12"></div>
          <h1 className="text-2xl font-normal text-gray-900 mb-4 tracking-[0.2em]">TeaHouse</h1>
          <p className="text-gray-500 text-sm font-normal">Mindful Tea Ceremony</p>
        </div>

        {/* Zen Garden */}
        <div className="px-6 pb-24">
          <div className="aspect-[3/2] rounded-none overflow-hidden bg-gray-100 mb-16">
            <OptimizedImage 
              src="https://images.unsplash.com/photo-1564890269302-d38e2dc4cd19?w=800&h=533&fit=crop&crop=center" 
              alt="Tea Ceremony"
              className="w-full h-full object-cover"
            />
          </div>
          
          <div className="text-center space-y-8">
            <div className="space-y-6">
              <h2 className="text-lg font-normal text-gray-900">Daily Ritual</h2>
              <p className="text-gray-600 text-sm font-normal leading-relaxed max-w-xs mx-auto">
                Experience the ancient art of tea through carefully selected leaves and mindful preparation.
              </p>
            </div>
            <button 
              className="border border-gray-300 text-gray-900 px-12 py-3 text-sm font-normal hover:bg-gray-100 transition-colors"
              onClick={() => onNavigate?.('catalog')}
            >
              Browse Tea
            </button>
          </div>
        </div>

        {/* Philosophy */}
        <div className="px-6 py-24 border-t border-gray-200">
          <div className="text-center space-y-12">
            <h3 className="text-base font-normal text-gray-900">The Way of Tea</h3>
            <div className="grid grid-cols-1 gap-12 max-w-xs mx-auto">
              {[
                { word: '静', meaning: 'Stillness', desc: 'Find peace in the moment' },
                { word: '和', meaning: 'Harmony', desc: 'Balance in every sip' },
                { word: '清', meaning: 'Purity', desc: 'Clear mind and spirit' }
              ].map((principle, index) => (
                <div key={index} className="text-center space-y-3">
                  <div className="text-3xl font-normal text-green-700">{principle.word}</div>
                  <div className="text-gray-900 text-sm font-medium">{principle.meaning}</div>
                  <div className="text-gray-500 text-xs font-normal">{principle.desc}</div>
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Featured Selection */}
        <div className="px-6 py-24 border-t border-gray-200">
          <div className="space-y-16">
            <div className="text-center">
              <h3 className="text-base font-normal text-gray-900 mb-4">Curated Selection</h3>
              <div className="w-12 h-px bg-gray-300 mx-auto"></div>
            </div>
            
            <div className="space-y-20">
              {teas.filter(tea => tea.premium).slice(0, 2).map((tea, index) => (
                <div 
                  key={tea.id} 
                  className="group cursor-pointer text-center"
                  onClick={() => onNavigate?.('catalog')}
                >
                  <div className="aspect-square rounded-none overflow-hidden bg-gray-100 mb-8 max-w-xs mx-auto">
                    <OptimizedImage 
                      src={tea.image} 
                      alt={tea.name}
                      className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000"
                    />
                  </div>
                  <div className="space-y-2">
                    <h4 className="text-gray-900 font-normal text-base">{tea.name}</h4>
                    <p className="text-gray-500 text-sm font-normal">{tea.origin}</p>
                    <div className="pt-2">
                      <div className="w-6 h-px bg-gray-300 mx-auto mb-2"></div>
                      <p className="text-gray-900 font-normal">${tea.price}</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

      </div>
    </div>
  );

  const renderCatalogTab = () => (
    <div className="min-h-screen bg-gradient-to-br from-teal-50 via-green-50 to-emerald-50 font-montserrat">
      <div className="max-w-md mx-auto px-6 py-8 space-y-6">
        {/* Header */}
        <div className="text-center space-y-3">
          <h1 className="text-2xl font-montserrat font-bold text-gray-900">Каталог чая</h1>
          <p className="text-gray-600 font-montserrat">Найдите свой идеальный вкус</p>
        </div>

        {/* Search */}
        <div className="bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-white/30 shadow-lg">
          <div className="flex items-center space-x-3">
            <div className="flex-1 flex items-center space-x-3 bg-gray-50 rounded-2xl px-4 py-3">
              <Search className="w-5 h-5 text-gray-400" />
              <input
                type="text"
                placeholder="Поиск чая..."
                className="flex-1 bg-transparent border-none outline-none font-montserrat text-gray-900 placeholder-gray-400"
              />
            </div>
            <button className="w-20 h-20 bg-gradient-to-r from-teal-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
              <Filter className="w-5 h-5 text-white" />
            </button>
          </div>
        </div>

        {/* Categories */}
        <div className="overflow-x-auto">
          <div className="flex space-x-2 min-w-max">
            {categories.map((category) => (
              <button
                key={category}
                className={`px-4 py-2 rounded-xl font-montserrat font-medium whitespace-nowrap transition-all ${
                  selectedCategory === category 
                    ? 'bg-gradient-to-r from-teal-500 to-green-600 text-white shadow-lg' 
                    : 'bg-white/80 text-gray-700 border border-gray-200 hover:bg-white'
                }`}
                onClick={() => setSelectedCategory(category)}
              >
                {category}
              </button>
            ))}
          </div>
        </div>

        {/* Teas Grid */}
        <div className="grid grid-cols-2 gap-3">
          {filteredTeas.map((tea) => (
            <div key={tea.id} className="bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-white/30 shadow-lg hover:shadow-xl transition-all">
              <div className="relative mb-3">
                <OptimizedImage src={tea.image} alt={tea.name} className="w-full h-32 object-cover rounded-xl" />
                <div className="absolute top-2 left-2 flex space-x-1">
                  {tea.premium && (
                    <span className="bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-full">PREMIUM</span>
                  )}
                </div>
                <button
                  onClick={() => toggleFavorite(tea.id)}
                  className="absolute top-2 right-2 w-8 h-8 bg-white/90 backdrop-blur rounded-full flex items-center justify-center shadow-md"
                >
                  <Heart className={`w-4 h-4 ${favorites.includes(tea.id) ? 'fill-red-500 text-red-500' : 'text-gray-600'}`} />
                </button>
              </div>
              
              <h3 className="text-gray-900 font-montserrat font-semibold text-sm mb-1 line-clamp-1">{tea.name}</h3>
              <p className="text-teal-600 text-xs font-montserrat mb-1">{tea.origin}</p>
              <p className="text-gray-500 text-xs font-montserrat mb-2">{tea.weight} • {tea.temperature}</p>
              
              <div className="flex items-center justify-between mb-3">
                <div className="flex items-center space-x-1">
                  <Star className="w-3 h-3 text-yellow-400 fill-current" />
                  <span className="text-gray-600 text-xs">{tea.rating}</span>
                </div>
                <span className="text-teal-600 font-bold text-sm">${tea.price}</span>
              </div>
              
              <button
                onClick={() => addToCart(tea)}
                className="w-full bg-gradient-to-r from-teal-500 to-green-600 text-white font-montserrat font-semibold py-2 rounded-xl hover:shadow-lg transition-all"
              >
                В корзину
              </button>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  const renderCartTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4 bg-gradient-to-br from-teal-50 via-green-50 to-emerald-50 min-h-screen">
      <h1 className="text-2xl font-montserrat font-bold text-gray-900">Корзина</h1>
      
      {cartItems.length === 0 ? (
        <div className="text-center py-12">
          <ShoppingBag className="w-16 h-16 text-gray-400 mx-auto mb-4" />
          <p className="text-gray-600 font-montserrat">Корзина пуста</p>
          <p className="text-gray-400 text-sm font-montserrat">Добавьте чай из каталога</p>
        </div>
      ) : (
        <>
          <div className="space-y-3">
            {cartItems.map((item) => (
              <div key={item.id} className="bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-white/30 shadow-lg">
                <div className="flex items-center space-x-3">
                  <OptimizedImage src={item.image} alt={item.name} className="w-20 h-20 object-cover rounded-xl" />
                  <div className="flex-1">
                    <h4 className="text-gray-900 font-montserrat font-semibold">{item.name}</h4>
                    <p className="text-teal-600 text-sm font-montserrat">{item.origin}</p>
                    <p className="text-gray-600 text-sm">{item.weight} • ${item.price}</p>
                  </div>
                  <div className="flex items-center space-x-2">
                    <button
                      onClick={() => updateQuantity(item.id, item.quantity - 1)}
                      className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"
                    >
                      <Minus className="w-4 h-4 text-gray-600" />
                    </button>
                    <span className="text-gray-900 font-montserrat font-semibold w-8 text-center">{item.quantity}</span>
                    <button
                      onClick={() => updateQuantity(item.id, item.quantity + 1)}
                      className="w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center"
                    >
                      <Plus className="w-4 h-4" />
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div className="bg-white/80 backdrop-blur-xl rounded-2xl p-4 border border-white/30 shadow-lg space-y-3">
            <div className="flex justify-between items-center">
              <span className="text-gray-700 font-montserrat">Подытог:</span>
              <span className="text-gray-900 font-montserrat font-semibold">${cartTotal}</span>
            </div>
            <div className="flex justify-between items-center">
              <span className="text-gray-700 font-montserrat">Доставка:</span>
              <span className="text-gray-900 font-montserrat font-semibold">$10</span>
            </div>
            <hr className="border-gray-200" />
            <div className="flex justify-between items-center">
              <span className="text-xl font-montserrat font-bold text-gray-900">Итого:</span>
              <span className="text-xl font-montserrat font-bold text-teal-600">${cartTotal + 10}</span>
            </div>
            
            <button className="w-full bg-gradient-to-r from-teal-500 to-green-600 text-white font-montserrat font-semibold py-3 rounded-xl hover:shadow-xl transition-all">
              Оформить заказ
            </button>
          </div>
        </>
      )}
    </div>
  );

  const renderProfileTab = () => (
    <div className="max-w-md mx-auto px-4 py-6 space-y-4 bg-gradient-to-br from-teal-50 via-green-50 to-emerald-50 min-h-screen">
      <h1 className="text-2xl font-montserrat font-bold text-gray-900">Профиль</h1>
      
      <div className="bg-white/80 backdrop-blur-xl rounded-2xl p-6 border border-white/30 shadow-lg">
        <div className="flex items-center space-x-4 mb-4">
          <div className="w-16 h-16 bg-gradient-to-r from-teal-500 to-green-600 rounded-full flex items-center justify-center">
            <span className="text-xl font-montserrat font-bold text-white">ЧД</span>
          </div>
          <div>
            <h3 className="text-xl font-montserrat font-semibold text-gray-900">Tea Master</h3>
            <p className="text-teal-600 font-montserrat">Ценитель чайного искусства</p>
          </div>
        </div>
        
        <div className="grid grid-cols-2 gap-4">
          <div className="text-center">
            <p className="text-2xl font-montserrat font-bold text-teal-600">89</p>
            <p className="text-gray-600 text-sm font-montserrat">Сортов попробовано</p>
          </div>
          <div className="text-center">
            <p className="text-2xl font-montserrat font-bold text-green-600">$2.1K</p>
            <p className="text-gray-600 text-sm font-montserrat">Потрачено</p>
          </div>
        </div>
      </div>

      <div className="space-y-3">
        <h2 className="text-xl font-montserrat font-semibold text-gray-900">Избранные сорта</h2>
        {teas.filter(tea => favorites.includes(tea.id)).map((tea) => (
          <div key={tea.id} className="bg-white/80 backdrop-blur-xl rounded-2xl p-3 border border-white/30 shadow-lg flex items-center space-x-3">
            <OptimizedImage src={tea.image} alt={tea.name} className="w-20 h-20 object-cover rounded-lg" />
            <div className="flex-1">
              <h4 className="text-gray-900 font-montserrat font-semibold">{tea.name}</h4>
              <p className="text-teal-600 text-sm font-montserrat">{tea.origin} • ${tea.price}</p>
            </div>
            <ChevronRight className="w-5 h-5 text-gray-400" />
          </div>
        ))}
        {favorites.length === 0 && (
          <p className="text-gray-500 text-center py-4 font-montserrat">Нет избранных сортов</p>
        )}
      </div>
    </div>
  );

  switch (activeTab) {
    case 'catalog':
      return renderCatalogTab();
    case 'cart':
      return renderCartTab();
    case 'profile':
      return renderProfileTab();
    default:
      return renderHomeTab();
  }
}```

### demos/TimeElite_PREMIUM.tsx
```tsx
import { useState } from "react";
import { Heart, Star, X, Sparkles, Crown, Award } from "lucide-react";
import { OptimizedImage } from "../OptimizedImage";
import { useImagePreloader } from "../../hooks/useImagePreloader";

interface TimeEliteProps {
  activeTab: 'home' | 'catalog' | 'cart' | 'profile';
}

interface CartItem {
  id: number;
  name: string;
  price: number;
  quantity: number;
  image: string;
}

const products = [
  { id: 1, name: 'Rolex Submariner', price: 12500, image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format,compress&fm=webp&q=75&w=800', description: 'Легендарные швейцарские часы для дайвинга с автоматическим механизмом', brand: 'Rolex', category: 'Дайверские', movement: 'Automatic', waterResist: '300m', material: 'Нержавеющая сталь 904L', diameter: '41mm', inStock: 3, rating: 5.0 },
  { id: 2, name: 'Omega Speedmaster', price: 8900, image: 'https://images.unsplash.com/photo-1434056886845-dac89ffe9b56?auto=format,compress&fm=webp&q=75&w=800', description: 'Легендарные лунные часы NASA с хронографом', brand: 'Omega', category: 'Хронографы', movement: 'Manual', waterResist: '50m', material: 'Нержавеющая сталь', diameter: '42mm', inStock: 5, rating: 4.9 },
  { id: 3, name: 'Patek Philippe Nautilus', price: 45000, image: 'https://images.unsplash.com/photo-1587836374062-d60746f9f518?auto=format,compress&fm=webp&q=75&w=800', description: 'Эксклюзивные спортивно-элегантные часы из коллекции Nautilus', brand: 'Patek Philippe', category: 'Классические', movement: 'Automatic', waterResist: '120m', material: 'Платина', diameter: '40mm', inStock: 1, rating: 5.0 },
  { id: 4, name: 'Audemars Piguet Royal Oak', price: 38000, image: 'https://images.unsplash.com/photo-1611078031785-f8ab1d3ed0dc?auto=format,compress&fm=webp&q=75&w=800', description: 'Икон��ческие часы с восьмиугольным безелем', brand: 'Audemars Piguet', category: 'Классические', movement: 'Automatic', waterResist: '50m', material: 'Розовое золото', diameter: '41mm', inStock: 2, rating: 5.0 },
  { id: 5, name: 'Cartier Santos', price: 7200, image: 'https://images.unsplash.com/photo-1622434641406-a158123450f9?auto=format,compress&fm=webp&q=75&w=800', description: 'Элегантные часы с квадратным корпусом и римскими цифрами', brand: 'Cartier', category: 'Классические', movement: 'Automatic', waterResist: '100m', material: 'Сталь и золото', diameter: '39mm', inStock: 4, rating: 4.8 },
  { id: 6, name: 'TAG Heuer Carrera', price: 5500, image: 'https://images.unsplash.com/photo-1614164185128-e4ec99c436d7?auto=format,compress&fm=webp&q=75&w=800', description: 'Спортивный хронограф вдохновленный автогонками', brand: 'TAG Heuer', category: 'Хронографы', movement: 'Automatic', waterResist: '100m', material: 'Нержавеющая сталь', diameter: '43mm', inStock: 6, rating: 4.7 },
];

const categories = ['Все', 'Rolex', 'Omega', 'Patek Philippe', 'Cartier', 'Audemars Piguet'];

export default function TimeElite({ activeTab }: TimeEliteProps) {
  const [selectedProduct, setSelectedProduct] = useState<typeof products[0] | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [cartItems, setCartItems] = useState<CartItem[]>([]);
  const [selectedCategory, setSelectedCategory] = useState('Все');
  const [favorites, setFavorites] = useState<number[]>([1, 3]);

  useImagePreloader({
    images: products.slice(0, 6).map(p => p.image),
    priority: true
  });

  const openProductModal = (product: typeof products[0]) => {
    setSelectedProduct(product);
    setIsModalOpen(true);
  };

  const closeProductModal = () => {
    setIsModalOpen(false);
    setTimeout(() => setSelectedProduct(null), 300);
  };

  const addToCart = () => {
    if (!selectedProduct) return;
    const newItem: CartItem = {
      id: selectedProduct.id,
      name: selectedProduct.name,
      price: selectedProduct.price,
      quantity: 1,
      image: selectedProduct.image
    };
    setCartItems(prev => [...prev, newItem]);
    closeProductModal();
  };

  const toggleFavorite = (productId: number) => {
    setFavorites(prev => 
      prev.includes(productId) 
        ? prev.filter(id => id !== productId)
        : [...prev, productId]
    );
  };

  const filteredProducts = selectedCategory === 'Все' 
    ? products 
    : products.filter(p => p.brand === selectedCategory);

  // PREMIUM HOME PAGE
  const renderHomeTab = () => (
    <div className="min-h-screen bg-black font-montserrat pb-24 overflow-hidden">
      {/* Premium Gradient Background */}
      <div className="fixed inset-0 bg-gradient-to-br from-amber-900/20 via-black to-yellow-900/20 pointer-events-none"></div>
      
      <div className="relative max-w-md mx-auto">
        {/* Luxury Header */}
        <div className="text-center px-6 pt-12 pb-8">
          <div className="inline-flex items-center justify-center w-24 h-24 bg-gradient-to-br from-yellow-400 via-amber-500 to-yellow-600 rounded-full mb-6 shadow-2xl shadow-yellow-500/50">
            <Crown className="w-12 h-12 text-black" strokeWidth={2.5} />
          </div>
          <h1 className="text-5xl font-bold bg-gradient-to-r from-yellow-200 via-amber-100 to-yellow-200 bg-clip-text text-transparent mb-3 tracking-tight">
            TimeElite
          </h1>
          <p className="text-amber-200/80 text-sm font-semibold">Luxury Swiss Timepieces</p>
        </div>

        {/* Hero Section - Large Image */}
        <div className="px-6 mb-12">
          <div className="relative rounded-3xl overflow-hidden group cursor-pointer" onClick={() => openProductModal(products[0])}>
            <div className="aspect-[4/5] bg-gradient-to-br from-gray-900 to-black">
              <OptimizedImage 
                src={products[0].image}
                alt={products[0].name}
                className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                priority
              />
            </div>
            {/* Glass Overlay */}
            <div className="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent">
              <div className="absolute bottom-0 left-0 right-0 p-8">
                <div className="flex items-center gap-2 mb-3">
                  <Award className="w-5 h-5 text-yellow-400" />
                  <span className="text-yellow-400 text-xs font-bold">Featured Collection</span>
                </div>
                <h2 className="text-3xl font-bold text-white mb-2">{products[0].name}</h2>
                <p className="text-amber-100/80 mb-4">{products[0].description}</p>
                <div className="flex items-center justify-between">
                  <span className="text-2xl font-bold text-yellow-400">${products[0].price.toLocaleString()}</span>
                  <button className="px-6 py-3 bg-gradient-to-r from-yellow-400 to-amber-500 text-black rounded-full font-bold hover:shadow-2xl hover:shadow-yellow-500/50 transition-all duration-300">
                    Explore
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Premium Brands */}
        <div className="px-6 mb-12">
          <h2 className="text-2xl font-bold text-white mb-6">Exclusive Brands</h2>
          <div className="grid grid-cols-2 gap-4">
            {['Rolex', 'Patek Philippe', 'Omega', 'Cartier'].map((brand) => (
              <button
                key={brand}
                onClick={() => setSelectedCategory(brand)}
                className="group relative overflow-hidden rounded-2xl bg-white/5 backdrop-blur-xl border border-white/10 p-6 hover:bg-white/10 hover:border-yellow-500/50 transition-all duration-300"
                data-testid={`brand-${brand.toLowerCase().replace(' ', '-')}`}
              >
                <div className="absolute inset-0 bg-gradient-to-br from-yellow-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div className="relative">
                  <Sparkles className="w-8 h-8 text-yellow-400 mb-3 group-hover:scale-110 transition-transform" />
                  <h3 className="text-white font-bold mb-1">{brand}</h3>
                  <p className="text-amber-200/60 text-xs">Swiss Excellence</p>
                </div>
              </button>
            ))}
          </div>
        </div>

        {/* Luxury Collection */}
        <div className="px-6">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-2xl font-bold text-white">Luxury Collection</h2>
            <Crown className="w-6 h-6 text-yellow-400" />
          </div>
          <div className="space-y-6">
            {products.slice(0, 3).map(product => (
              <div 
                key={product.id}
                onClick={() => openProductModal(product)}
                className="group relative overflow-hidden rounded-3xl bg-white/5 backdrop-blur-xl border border-white/10 hover:bg-white/10 hover:border-yellow-500/50 transition-all duration-300 cursor-pointer"
                data-testid={`product-card-${product.id}`}
              >
                <div className="flex gap-6 p-6">
                  <div className="w-32 h-32 rounded-2xl overflow-hidden bg-gradient-to-br from-gray-900 to-black flex-shrink-0">
                    <OptimizedImage 
                      src={product.image}
                      alt={product.name}
                      className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                      priority={product.id <= 3}
                    />
                  </div>
                  <div className="flex-1 flex flex-col justify-between">
                    <div>
                      <div className="flex items-center gap-2 mb-2">
                        <span className="px-3 py-1 bg-yellow-500/20 text-yellow-400 text-xs font-bold rounded-full">{product.brand}</span>
                        {product.inStock <= 3 && (
                          <span className="px-3 py-1 bg-red-500/20 text-red-400 text-xs font-bold rounded-full">Limited</span>
                        )}
                      </div>
                      <h3 className="text-white font-bold text-lg mb-2">{product.name}</h3>
                      <div className="flex items-center gap-1 mb-3">
                        {[...Array(5)].map((_, i) => (
                          <Star key={i} className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                        ))}
                      </div>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-2xl font-bold text-yellow-400">${product.price.toLocaleString()}</span>
                      <button 
                        onClick={(e) => {
                          e.stopPropagation();
                          toggleFavorite(product.id);
                        }}
                        className="w-10 h-10 bg-white/10 rounded-full flex items-center justify-center hover:bg-white/20 transition-colors"
                      >
                        <Heart className={`w-5 h-5 ${favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );

  // PREMIUM CATALOG
  const renderCatalogTab = () => (
    <div className="min-h-screen bg-black font-montserrat pb-24">
      <div className="fixed inset-0 bg-gradient-to-br from-amber-900/20 via-black to-yellow-900/20 pointer-events-none"></div>
      
      {/* Sticky Pills */}
      <div className="sticky top-0 z-20 bg-black/80 backdrop-blur-2xl border-b border-white/10 py-5 px-4">
        <div className="max-w-md mx-auto">
          <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
            {categories.map(cat => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-5 py-2 rounded-full whitespace-nowrap transition-all duration-300 font-semibold text-sm ${
                  selectedCategory === cat 
                    ? 'bg-gradient-to-r from-yellow-400 to-amber-500 text-black shadow-lg shadow-yellow-500/50' 
                    : 'bg-white/10 text-white hover:bg-white/20 border border-white/20'
                }`}
                data-testid={`filter-${cat.toLowerCase()}`}
              >
                {cat}
              </button>
            ))}
          </div>
        </div>
      </div>

      {/* Products Grid */}
      <div className="relative max-w-md mx-auto px-4 py-6">
        <div className="mb-4">
          <p className="text-amber-200/60 text-sm">{filteredProducts.length} Timepieces Available</p>
        </div>
        <div className="grid grid-cols-1 gap-6">
          {filteredProducts.map(product => (
            <div 
              key={product.id}
              onClick={() => openProductModal(product)}
              className="group relative overflow-hidden rounded-3xl bg-white/5 backdrop-blur-xl border border-white/10 hover:bg-white/10 hover:border-yellow-500/50 transition-all duration-300 cursor-pointer"
              data-testid={`product-${product.id}`}
            >
              <div className="aspect-[4/3] relative overflow-hidden bg-gradient-to-br from-gray-900 to-black">
                <OptimizedImage 
                  src={product.image}
                  alt={product.name}
                  className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                  priority={product.id <= 4}
                />
                <button 
                  onClick={(e) => {
                    e.stopPropagation();
                    toggleFavorite(product.id);
                  }}
                  className="absolute top-4 right-4 w-12 h-12 bg-black/60 backdrop-blur-xl rounded-full flex items-center justify-center hover:bg-black/80 transition-all"
                >
                  <Heart className={`w-6 h-6 ${favorites.includes(product.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
                </button>
              </div>
              <div className="p-6">
                <div className="flex items-center gap-2 mb-3">
                  <span className="px-3 py-1 bg-yellow-500/20 text-yellow-400 text-xs font-bold rounded-full">{product.brand}</span>
                  {product.inStock <= 3 && (
                    <span className="px-3 py-1 bg-red-500/20 text-red-400 text-xs font-bold rounded-full">Only {product.inStock} left</span>
                  )}
                </div>
                <h3 className="text-white font-bold text-xl mb-2">{product.name}</h3>
                <p className="text-amber-200/60 text-sm mb-4 line-clamp-2">{product.description}</p>
                <div className="flex items-center justify-between">
                  <span className="text-2xl font-bold text-yellow-400">${product.price.toLocaleString()}</span>
                  <div className="flex items-center gap-1">
                    {[...Array(5)].map((_, i) => (
                      <Star key={i} className="w-4 h-4 fill-yellow-400 text-yellow-400" />
                    ))}
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );

  // PREMIUM MODAL
  const renderProductModal = () => {
    if (!selectedProduct || !isModalOpen) return null;

    return (
      <div className="fixed inset-0 z-50 bg-black overflow-y-auto font-montserrat">
        <div className="fixed inset-0 bg-gradient-to-br from-amber-900/20 via-black to-yellow-900/20"></div>
        
        <div className="relative max-w-md mx-auto">
          <button 
            onClick={closeProductModal}
            className="fixed top-6 right-6 z-10 w-14 h-14 bg-white/10 backdrop-blur-2xl rounded-full flex items-center justify-center hover:bg-white/20 transition-all border border-white/20"
            data-testid="button-close-modal"
          >
            <X className="w-7 h-7 text-white" strokeWidth={2} />
          </button>

          {/* Large Product Image */}
          <div className="relative aspect-square bg-gradient-to-br from-gray-900 to-black">
            <OptimizedImage 
              src={selectedProduct.image}
              alt={selectedProduct.name}
              className="w-full h-full object-cover"
              priority
            />
            <button 
              onClick={() => toggleFavorite(selectedProduct.id)}
              className="absolute top-6 left-6 w-14 h-14 bg-black/60 backdrop-blur-2xl rounded-full flex items-center justify-center hover:bg-black/80 transition-all border border-white/20"
            >
              <Heart className={`w-7 h-7 ${favorites.includes(selectedProduct.id) ? 'fill-red-500 text-red-500' : 'text-white'}`} />
            </button>
          </div>

          {/* Product Info */}
          <div className="p-8 space-y-8">
            <div>
              <div className="flex items-center gap-2 mb-4">
                <span className="px-4 py-2 bg-yellow-500/20 text-yellow-400 text-sm font-bold rounded-full">{selectedProduct.brand}</span>
                {selectedProduct.inStock <= 3 && (
                  <span className="px-4 py-2 bg-red-500/20 text-red-400 text-sm font-bold rounded-full">Only {selectedProduct.inStock} Available</span>
                )}
              </div>
              <h1 className="text-4xl font-bold text-white mb-4 leading-tight">{selectedProduct.name}</h1>
              <div className="flex items-center justify-between mb-6">
                <span className="text-4xl font-bold text-yellow-400">${selectedProduct.price.toLocaleString()}</span>
                <div className="flex items-center gap-2">
                  {[...Array(5)].map((_, i) => (
                    <Star key={i} className="w-6 h-6 fill-yellow-400 text-yellow-400" />
                  ))}
                  <span className="text-amber-200 ml-2">({selectedProduct.rating})</span>
                </div>
              </div>
            </div>

            <div className="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>

            <div>
              <h3 className="text-white font-bold text-lg mb-3">Description</h3>
              <p className="text-amber-200/80 leading-relaxed">{selectedProduct.description}</p>
            </div>

            <div className="h-px bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>

            <div>
              <h3 className="text-white font-bold text-lg mb-4">Specifications</h3>
              <div className="grid grid-cols-2 gap-4">
                <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                  <p className="text-amber-200/60 text-xs mb-1">Movement</p>
                  <p className="text-white font-semibold">{selectedProduct.movement}</p>
                </div>
                <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                  <p className="text-amber-200/60 text-xs mb-1">Water Resistance</p>
                  <p className="text-white font-semibold">{selectedProduct.waterResist}</p>
                </div>
                <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                  <p className="text-amber-200/60 text-xs mb-1">Material</p>
                  <p className="text-white font-semibold">{selectedProduct.material}</p>
                </div>
                <div className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                  <p className="text-amber-200/60 text-xs mb-1">Diameter</p>
                  <p className="text-white font-semibold">{selectedProduct.diameter}</p>
                </div>
              </div>
            </div>

            <button 
              onClick={addToCart}
              className="w-full py-5 bg-gradient-to-r from-yellow-400 via-amber-500 to-yellow-400 text-black rounded-2xl font-bold text-lg hover:shadow-2xl hover:shadow-yellow-500/50 transition-all duration-300 relative overflow-hidden group"
              data-testid="button-add-to-cart"
            >
              <span className="relative z-10">Add to Collection</span>
              <div className="absolute inset-0 bg-gradient-to-r from-amber-400 to-yellow-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            </button>
          </div>
        </div>
      </div>
    );
  };

  // Cart & Profile (simplified for demo)
  const renderCartTab = () => (
    <div className="min-h-screen bg-black font-montserrat pb-24">
      <div className="max-w-md mx-auto px-6 py-8">
        <h1 className="text-3xl font-bold text-white mb-6">Your Collection</h1>
        {cartItems.length === 0 ? (
          <div className="text-center py-16">
            <Crown className="w-16 h-16 text-yellow-400/50 mx-auto mb-4" />
            <p className="text-amber-200/60">No timepieces added yet</p>
          </div>
        ) : (
          <div className="space-y-4">
            {cartItems.map(item => (
              <div key={item.id} className="bg-white/5 backdrop-blur-xl rounded-2xl p-4 border border-white/10">
                <h3 className="text-white font-bold">{item.name}</h3>
                <p className="text-yellow-400 font-bold">${item.price.toLocaleString()}</p>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );

  const renderProfileTab = () => (
    <div className="min-h-screen bg-black font-montserrat pb-24">
      <div className="max-w-md mx-auto px-6 py-8">
        <h1 className="text-3xl font-bold text-white mb-6">Profile</h1>
        <div className="bg-white/5 backdrop-blur-xl rounded-3xl p-8 border border-white/10 text-center">
          <div className="w-24 h-24 bg-gradient-to-br from-yellow-400 to-amber-500 rounded-full mx-auto mb-4 flex items-center justify-center">
            <span className="text-3xl font-bold text-black">VIP</span>
          </div>
          <h2 className="text-2xl font-bold text-white mb-2">Luxury Member</h2>
          <p className="text-amber-200/60">collector@timeelite.com</p>
        </div>
      </div>
    </div>
  );

  return (
    <>
      {activeTab === 'home' && renderHomeTab()}
      {activeTab === 'catalog' && renderCatalogTab()}
      {activeTab === 'cart' && renderCartTab()}
      {activeTab === 'profile' && renderProfileTab()}
      {renderProductModal()}
    </>
  );
}
```

## ИКОНКИ И ОБЩИЕ КОМПОНЕНТЫ

### icons/GamificationIcons.tsx
```tsx
import React from 'react';

export const BronzeMedal = ({ className = "w-8 h-8" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="bronze" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#CD7F32', stopOpacity: 1 }} />
        <stop offset="50%" style={{ stopColor: '#E8A87C', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#8B5A2B', stopOpacity: 1 }} />
      </linearGradient>
      <filter id="shadow">
        <feDropShadow dx="0" dy="2" stdDeviation="3" floodOpacity="0.3"/>
      </filter>
    </defs>
    <circle cx="32" cy="32" r="28" fill="url(#bronze)" filter="url(#shadow)" />
    <circle cx="32" cy="32" r="24" fill="none" stroke="#FFF" strokeWidth="1" opacity="0.3" />
    <text x="32" y="40" fontSize="24" fontWeight="bold" fill="#FFF" textAnchor="middle" fontFamily="Arial, sans-serif">3</text>
  </svg>
);

export const SilverMedal = ({ className = "w-8 h-8" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="silver" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#C0C0C0', stopOpacity: 1 }} />
        <stop offset="50%" style={{ stopColor: '#E8E8E8', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#A8A8A8', stopOpacity: 1 }} />
      </linearGradient>
      <filter id="shadowSilver">
        <feDropShadow dx="0" dy="2" stdDeviation="3" floodOpacity="0.4"/>
      </filter>
    </defs>
    <circle cx="32" cy="32" r="28" fill="url(#silver)" filter="url(#shadowSilver)" />
    <circle cx="32" cy="32" r="24" fill="none" stroke="#FFF" strokeWidth="1" opacity="0.5" />
    <text x="32" y="40" fontSize="24" fontWeight="bold" fill="#444" textAnchor="middle" fontFamily="Arial, sans-serif">2</text>
  </svg>
);

export const GoldMedal = ({ className = "w-8 h-8" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="gold" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#FFD700', stopOpacity: 1 }} />
        <stop offset="50%" style={{ stopColor: '#FFF4A3', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#DAA520', stopOpacity: 1 }} />
      </linearGradient>
      <filter id="shadowGold">
        <feDropShadow dx="0" dy="3" stdDeviation="4" floodOpacity="0.5"/>
      </filter>
    </defs>
    <circle cx="32" cy="32" r="28" fill="url(#gold)" filter="url(#shadowGold)" />
    <circle cx="32" cy="32" r="24" fill="none" stroke="#FFF" strokeWidth="1.5" opacity="0.6" />
    <text x="32" y="40" fontSize="24" fontWeight="bold" fill="#8B6914" textAnchor="middle" fontFamily="Arial, sans-serif">1</text>
  </svg>
);

export const PlatinumMedal = ({ className = "w-8 h-8" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="platinum" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#E5E4E2', stopOpacity: 1 }} />
        <stop offset="25%" style={{ stopColor: '#B0E0E6', stopOpacity: 1 }} />
        <stop offset="50%" style={{ stopColor: '#E0E0E0', stopOpacity: 1 }} />
        <stop offset="75%" style={{ stopColor: '#87CEEB', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#D3D3D3', stopOpacity: 1 }} />
      </linearGradient>
      <filter id="shadowPlatinum">
        <feDropShadow dx="0" dy="4" stdDeviation="5" floodOpacity="0.6"/>
      </filter>
      <radialGradient id="shine">
        <stop offset="0%" style={{ stopColor: '#FFF', stopOpacity: 0.8 }} />
        <stop offset="100%" style={{ stopColor: '#FFF', stopOpacity: 0 }} />
      </radialGradient>
    </defs>
    <circle cx="32" cy="32" r="28" fill="url(#platinum)" filter="url(#shadowPlatinum)" />
    <circle cx="32" cy="32" r="24" fill="none" stroke="#FFF" strokeWidth="2" opacity="0.7" />
    <circle cx="28" cy="24" r="6" fill="url(#shine)" opacity="0.5" />
    <path d="M 32 20 L 34 26 L 40 26 L 35 30 L 37 36 L 32 32 L 27 36 L 29 30 L 24 26 L 30 26 Z" fill="#FFF" opacity="0.8" />
  </svg>
);

export const ShieldIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="shieldGrad" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#10b981', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#059669', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M32 8 L52 16 L52 32 C52 44 42 54 32 56 C22 54 12 44 12 32 L12 16 Z" fill="url(#shieldGrad)" stroke="#FFF" strokeWidth="2"/>
    <path d="M28 32 L30 34 L36 28" stroke="#FFF" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" fill="none"/>
  </svg>
);

export const CrownIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="crownGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#FFD700', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#FFA500', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M8 44 L16 24 L24 32 L32 16 L40 32 L48 24 L56 44 Z" fill="url(#crownGrad)" stroke="#FFF" strokeWidth="2"/>
    <rect x="8" y="44" width="48" height="8" rx="2" fill="url(#crownGrad)" stroke="#FFF" strokeWidth="2"/>
    <circle cx="16" cy="24" r="3" fill="#FFF"/>
    <circle cx="32" cy="16" r="3" fill="#FFF"/>
    <circle cx="48" cy="24" r="3" fill="#FFF"/>
  </svg>
);

export const DiamondIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="diamondGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#60A5FA', stopOpacity: 1 }} />
        <stop offset="50%" style={{ stopColor: '#93C5FD', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#3B82F6', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M32 8 L48 24 L32 56 L16 24 Z" fill="url(#diamondGrad)" stroke="#FFF" strokeWidth="2"/>
    <path d="M16 24 L48 24 L32 8 Z" fill="#FFF" opacity="0.3"/>
    <line x1="32" y1="8" x2="32" y2="56" stroke="#FFF" strokeWidth="1" opacity="0.4"/>
  </svg>
);

export const LightningIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="lightningGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#FBBF24', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#F59E0B', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M36 8 L20 32 L28 32 L24 56 L44 28 L36 28 Z" fill="url(#lightningGrad)" stroke="#FFF" strokeWidth="2" strokeLinejoin="round"/>
  </svg>
);

export const StarBurstIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="starGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#A78BFA', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#8B5CF6', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M32 4 L36 24 L56 20 L40 32 L56 44 L36 40 L32 60 L28 40 L8 44 L24 32 L8 20 L28 24 Z" fill="url(#starGrad)" stroke="#FFF" strokeWidth="2"/>
    <circle cx="32" cy="32" r="8" fill="#FFF" opacity="0.5"/>
  </svg>
);

export const TrophyStarIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="trophyGrad" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#EC4899', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#DB2777', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M20 12 L20 24 C20 32 24 36 32 36 C40 36 44 32 44 24 L44 12 Z" fill="url(#trophyGrad)" stroke="#FFF" strokeWidth="2"/>
    <path d="M16 12 L12 12 C12 16 14 20 18 22" stroke="#FFF" strokeWidth="2" fill="none"/>
    <path d="M48 12 L52 12 C52 16 50 20 46 22" stroke="#FFF" strokeWidth="2" fill="none"/>
    <rect x="28" y="36" width="8" height="12" fill="url(#trophyGrad)" stroke="#FFF" strokeWidth="2"/>
    <rect x="22" y="48" width="20" height="6" rx="2" fill="url(#trophyGrad)" stroke="#FFF" strokeWidth="2"/>
    <path d="M32 16 L34 22 L40 22 L35 26 L37 32 L32 28 L27 32 L29 26 L24 22 L30 22 Z" fill="#FFF"/>
  </svg>
);

export const RocketIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="rocketGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#06B6D4', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#0891B2', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M32 8 C32 8 44 12 44 28 L44 44 L38 50 L32 56 L26 50 L20 44 L20 28 C20 12 32 8 32 8 Z" fill="url(#rocketGrad)" stroke="#FFF" strokeWidth="2"/>
    <circle cx="32" cy="28" r="6" fill="#FFF" opacity="0.6"/>
    <path d="M26 50 L20 56 L16 52 L22 46" fill="#F59E0B" stroke="#FFF" strokeWidth="1.5"/>
    <path d="M38 50 L44 56 L48 52 L42 46" fill="#F59E0B" stroke="#FFF" strokeWidth="1.5"/>
    <ellipse cx="32" cy="56" rx="10" ry="4" fill="#F59E0B" opacity="0.5"/>
  </svg>
);

export const GemIcon = ({ className = "w-12 h-12" }: { className?: string }) => (
  <svg className={className} viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="gemGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style={{ stopColor: '#10B981', stopOpacity: 1 }} />
        <stop offset="50%" style={{ stopColor: '#34D399', stopOpacity: 1 }} />
        <stop offset="100%" style={{ stopColor: '#059669', stopOpacity: 1 }} />
      </linearGradient>
    </defs>
    <path d="M24 14 L40 14 L52 26 L32 54 L12 26 Z" fill="url(#gemGrad)" stroke="#FFF" strokeWidth="2"/>
    <path d="M24 14 L32 26 L40 14" stroke="#FFF" strokeWidth="1.5" fill="none"/>
    <path d="M12 26 L32 26 L52 26" stroke="#FFF" strokeWidth="1.5"/>
    <line x1="32" y1="26" x2="32" y2="54" stroke="#FFF" strokeWidth="1.5"/>
  </svg>
);
```

### components/icons.ts
```tsx
export {
  ArrowLeft,
  ArrowRight,
  Award,
  AlertCircle,
  BarChart,
  BarChart3,
  Bell,
  Building,
  Briefcase,
  Calendar,
  Camera,
  Car,
  Check,
  CheckCircle,
  ChefHat,
  ChevronDown,
  ChevronRight,
  ChevronUp,
  Clock,
  Coffee,
  CreditCard,
  Crown,
  Diamond,
  Droplets,
  Dumbbell,
  Eye,
  EyeOff,
  ExternalLink,
  FastForward,
  FileText,
  Filter,
  Flower,
  Globe,
  GraduationCap,
  Headphones,
  Heart,
  Home,
  Info,
  Key,
  Leaf,
  Lock,
  LogOut,
  Mail,
  MapPin,
  Menu,
  MessageCircle,
  MessageSquare,
  Minus,
  Monitor,
  MoreHorizontal,
  Navigation,
  Package,
  PanelLeft,
  Phone,
  Pizza,
  Play,
  Plus,
  Redo,
  Rewind,
  Rocket,
  Ruler,
  Scale,
  Search,
  Send,
  Settings,
  Shield,
  ShoppingBag,
  ShoppingCart,
  Smartphone,
  Soup,
  Sparkles,
  Star,
  ThumbsUp,
  Timer,
  Trash2,
  TrendingUp,
  Truck,
  Undo,
  Upload,
  User,
  UserCircle2,
  Users,
  Utensils,
  Volume2,
  Wifi,
  Wrench,
  X,
  Zap
} from 'lucide-react';
```

### shared/ProductCard.tsx
```tsx
import { memo } from 'react';
import { Heart, ShoppingCart } from 'lucide-react';
import { LazyImage } from '../LazyImage';

export interface Product {
  id: string;
  name: string;
  price: number;
  image: string;
  category?: string;
  description?: string;
  discount?: number;
  rating?: number;
  inStock?: boolean;
}

interface ProductCardProps {
  product: Product;
  isFavorite?: boolean;
  onToggleFavorite?: (productId: string) => void;
  onAddToCart?: (product: Product) => void;
  onClick?: () => void;
  showAddToCart?: boolean;
  className?: string;
}

export const ProductCard = memo(({ 
  product,
  isFavorite = false,
  onToggleFavorite,
  onAddToCart,
  onClick,
  showAddToCart = true,
  className = ''
}: ProductCardProps) => {
  const finalPrice = product.discount 
    ? product.price * (1 - product.discount / 100) 
    : product.price;
  
  const hasDiscount = product.discount && product.discount > 0;

  return (
    <div 
      className={`bg-white rounded-2xl overflow-hidden shadow-sm hover:shadow-md transition-shadow ${className}`}
      onClick={onClick}
    >
      <div className="relative aspect-square">
        <LazyImage
          src={product.image}
          alt={product.name}
          className="w-full h-full object-cover"
        />
        
        {hasDiscount && (
          <div className="absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-lg">
            -{product.discount}%
          </div>
        )}
        
        {product.inStock === false && (
          <div className="absolute inset-0 bg-black/50 flex items-center justify-center">
            <span className="text-white font-bold">Нет в наличии</span>
          </div>
        )}

        {onToggleFavorite && (
          <button
            onClick={(e) => {
              e.stopPropagation();
              onToggleFavorite(product.id);
            }}
            className="absolute top-2 right-2 p-2 bg-white/90 rounded-full hover:bg-white transition-colors"
            aria-label={isFavorite ? "Удалить из избранного" : "Добавить в избранное"}
          >
            <Heart 
              className={`w-5 h-5 transition-colors ${
                isFavorite ? 'fill-red-500 text-red-500' : 'text-gray-600'
              }`}
            />
          </button>
        )}
      </div>

      <div className="p-4">
        {product.category && (
          <p className="text-xs text-gray-500 mb-1">{product.category}</p>
        )}
        
        <h3 className="font-semibold text-gray-900 mb-2 line-clamp-2">
          {product.name}
        </h3>

        {product.description && (
          <p className="text-sm text-gray-600 mb-2 line-clamp-2">
            {product.description}
          </p>
        )}

        {product.rating && (
          <div className="flex items-center gap-1 mb-2">
            <span className="text-yellow-500">★</span>
            <span className="text-sm text-gray-600">{product.rating.toFixed(1)}</span>
          </div>
        )}

        <div className="flex items-center justify-between">
          <div className="flex items-center gap-2">
            <span className="text-lg font-bold text-gray-900">
              {finalPrice.toLocaleString()}₽
            </span>
            {hasDiscount && (
              <span className="text-sm text-gray-400 line-through">
                {product.price.toLocaleString()}₽
              </span>
            )}
          </div>

          {showAddToCart && onAddToCart && product.inStock !== false && (
            <button
              onClick={(e) => {
                e.stopPropagation();
                onAddToCart(product);
              }}
              className="p-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors"
              aria-label="Добавить в корзину"
            >
              <ShoppingCart className="w-5 h-5" />
            </button>
          )}
        </div>
      </div>
    </div>
  );
});

ProductCard.displayName = 'ProductCard';
```

### design-tokens.ts
```tsx
export const DesignTokens = {
  spacing: {
    xs: '8px',
    sm: '16px',
    md: '24px',
    lg: '32px',
    xl: '48px',
    '2xl': '64px',
    '3xl': '96px',
  },
  
  radius: {
    none: '0',
    sm: '4px',
    md: '8px',
    lg: '12px',
    xl: '16px',
    '2xl': '24px',
    '3xl': '32px',
    full: '9999px',
  },
  
  fontSize: {
    xs: '12px',
    sm: '14px',
    base: '16px',
    lg: '18px',
    xl: '20px',
    '2xl': '24px',
    '3xl': '32px',
    '4xl': '40px',
    '5xl': '48px',
    '6xl': '56px',
  },
  
  fontWeight: {
    regular: 400,
    medium: 500,
    semibold: 600,
    bold: 700,
    extrabold: 800,
  },
  
  lineHeight: {
    tight: 1.2,
    snug: 1.25,
    normal: 1.5,
    relaxed: 1.75,
  },
  
  shadow: {
    sm: '0 2px 8px rgba(0, 0, 0, 0.08)',
    md: '0 4px 16px rgba(0, 0, 0, 0.12)',
    lg: '0 8px 32px rgba(0, 0, 0, 0.16)',
    xl: '0 16px 48px rgba(0, 0, 0, 0.20)',
    apple: `
      0 2px 8px rgba(0, 0, 0, 0.04),
      0 4px 16px rgba(0, 0, 0, 0.08),
      0 8px 32px rgba(0, 0, 0, 0.06)
    `,
    appleHover: `
      0 4px 12px rgba(0, 0, 0, 0.06),
      0 8px 24px rgba(0, 0, 0, 0.10),
      0 16px 48px rgba(0, 0, 0, 0.08)
    `,
    premium: `
      0 4px 12px rgba(16, 185, 129, 0.15),
      0 8px 24px rgba(16, 185, 129, 0.10),
      0 16px 48px rgba(0, 0, 0, 0.08)
    `,
  },
  
  transition: {
    fast: '150ms cubic-bezier(0.4, 0, 0.2, 1)',
    base: '250ms cubic-bezier(0.4, 0, 0.2, 1)',
    slow: '350ms cubic-bezier(0.4, 0, 0.2, 1)',
    spring: '400ms cubic-bezier(0.34, 1.56, 0.64, 1)',
  },
  
  easing: {
    apple: 'cubic-bezier(0.25, 0.1, 0.25, 1)',
    appleIn: 'cubic-bezier(0.42, 0, 1, 1)',
    appleOut: 'cubic-bezier(0, 0, 0.58, 1)',
    appleInOut: 'cubic-bezier(0.42, 0, 0.58, 1)',
    springBounce: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
    springSmooth: 'cubic-bezier(0.34, 1.56, 0.64, 1)',
  },
  
  colors: {
    black: '#1d1d1f',
    white: '#f5f5f7',
    textPrimary: 'rgba(255, 255, 255, 0.92)',
    textSecondary: 'rgba(255, 255, 255, 0.70)',
    textTertiary: 'rgba(255, 255, 255, 0.45)',
    textQuaternary: 'rgba(255, 255, 255, 0.25)',
    emeraldApple: '#30d158',
    blueApple: '#0a84ff',
  },
  
  spring: {
    default: {
      stiffness: 300,
      damping: 25,
      mass: 0.5,
    },
    bouncy: {
      stiffness: 400,
      damping: 20,
      mass: 0.5,
    },
    gentle: {
      stiffness: 200,
      damping: 30,
      mass: 0.5,
    },
  },
} as const;

export type DesignTokens = typeof DesignTokens;
```

